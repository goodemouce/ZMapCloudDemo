var Cegore;(function(e){e.Version=103})(Cegore||(Cegore={}));var Cegore;(function(e){class t{static defaultValue(e,t){if(e!==undefined&&e!==null){return e}return t}static isDefined(e){return e!==undefined&&e!==null}static isNull(e){return e===null}static typeOf(e){var t=typeof e;if(t=="object"){if(e){if(e instanceof Array){return"array"}else if(e instanceof Object){return t}var i=Object.prototype.toString.call(e);if(i=="[object Window]"){return"object"}if(i=="[object Array]"||typeof e.length=="number"&&typeof e.splice!="undefined"&&typeof e.propertyIsEnumerable!="undefined"&&!e.propertyIsEnumerable("splice")){return"array"}if(i=="[object Function]"||typeof e.call!="undefined"&&typeof e.propertyIsEnumerable!="undefined"&&!e.propertyIsEnumerable("call")){return"function"}}else{return"null"}}else if(t=="function"&&typeof e.call=="undefined"){return"object"}return t}static isFunction(e){return typeof e==="function"}static isString(e){return typeof e==="string"}static isNumber(e){return typeof e==="number"}static isObject(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}static isBool(e){return typeof e==="boolean"}static isArray(e){return t.typeOf(e)=="array"}static isInstanceOf(e,t){return e instanceof t}static freezeObject(e){return t._freezeObject(e)}}t._freezeObject=Object.freeze?Object.freeze:function(e){return e};e.TypeCheck=t})(Cegore||(Cegore={}));var Cegore;(function(s){class e{constructor(e){this._data={};this._creator=null;this._creator=e}getOrCreate(e,t){var i=this._data[e];if(s.TypeCheck.isDefined(i)){return i.val}if(s.TypeCheck.isDefined(t)){i={val:t};this._data[e]=i;return i.val}if(s.TypeCheck.isDefined(this._creator)){i={val:this._creator()};this._data[e]=i;return i.val}return undefined}get(e){var t=this._data[e];if(s.TypeCheck.isDefined(t)){return t.val}return}put(e,t){this._data[e]={val:t}}key(e){for(var t in this._data){if(this._data[t].val===e){return t}}return}keys(){var e=[];for(var t in this._data){e.push(t)}return e}exist(e){return s.TypeCheck.isDefined(this._data[e])}remove(e){delete this._data[e]}clear(){this._data={}}removeAll(){this.clear()}}s.HashMap=e})(Cegore||(Cegore={}));var Cegore;(function(r){class e{static startsWidth(e,t,i){var s=this.length;var r=t.length;if(s<r||r==0)return false;var n=e.substr(0,r);if(i){n=n.toLowerCase();t=t.toLowerCase()}return n===t}static endsWidth(e,t,i){var s=this.length;var r=t.length;if(s<r||r==0)return false;var n=e.substr(s-r,r);if(i){n=n.toLowerCase();t=t.toLowerCase()}return n===t}static parseInt(e,t,i){let s=parseInt(e,i);if(!isNaN(s))return s;if(r.TypeCheck.isDefined(t))return t;return 0}static parseFloat(e,t){let i=parseFloat(e);if(!isNaN(i))return i;if(r.TypeCheck.isDefined(t))return t;return 0}static toPostFormBody(t){const i=[];for(let e in t){i.push(`${e}=${encodeURIComponent(t[e])}`)}return i.join("&")}}r.StringUtil=e})(Cegore||(Cegore={}));var Cegore;(function(e){class t{static indexOf(t,i,s){if(!e.TypeCheck.isFunction(s)){throw"cmp must be function."}for(let e=0;e<i.length;++e){if(s(i[e],t)){return e}}return-1}}t.EmptyArray=e.TypeCheck.freezeObject([]);e.ArrayUtil=t})(Cegore||(Cegore={}));var Cegore;(function(i){class t{static loadWithXhr(e){t.onPromise(Cesium.Resource.fetch(e),e)}static loadJSON(e){t.onPromise(Cesium.Resource.fetchJson(e.url),e)}static onPromise(e,t){if(!i.TypeCheck.isDefined(e))return;if(i.TypeCheck.isFunction(t.success))e.then(t.success);if(i.TypeCheck.isFunction(t.error))e.otherwise(t.error)}}i.LoadWithXhr=t})(Cegore||(Cegore={}));var Cegore;(function(e){class t{static createContext2D(e,t){var i=document.createElement("CANVAS");if(e)i.width=e;if(t)i.height=t;return i.getContext("2d")}}e.DOM=t})(Cegore||(Cegore={}));var Cegore;(function(r){class n{constructor(e,t){this.x=0;this.y=0;this.set(e,t)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get magnitude(){return this.length}get squaredLength(){return this.x*this.x+this.y*this.y}set(e,t){let i,s;switch(r.TypeCheck.typeOf(e)){case"number":i=e;s=t;break;case"array":i=e[0];s=e[1];break;case"object":i=e.x;s=e.y;break}this.x=r.StringUtil.parseFloat(i);this.y=r.StringUtil.parseFloat(s)}clone(e){return n.clone(this,e)}equals(e){return n.equals(this,e)}toString(){return"("+this.x+","+this.y+")"}_asCzVector2(){return new Cesium.Cartesian2(this.x,this.y)}static distance(e,t){return Math.sqrt(n.squaredDistance(e,t))}static squaredDistance(e,t){let i=e.x-t.x;let s=e.y-t.y;return i*i+s*s}static clone(e,t){return n.newOrResult(e.x,e.y,t)}static equals(e,t){return e===t||r.TypeCheck.isDefined(e)&&r.TypeCheck.isDefined(t)&&e.x===t.x&&e.y===t.y}static add(e,t,i){return n.newOrResult(e.x+t.x,e.y+t.y,i)}static sub(e,t,i){return n.newOrResult(e.x-t.x,e.y-t.y,i)}static mul(e,t,i){if(r.TypeCheck.isNumber(t))return n.newOrResult(e.x*t,e.y*t,i);if(r.TypeCheck.isInstanceOf(t,n))return n.newOrResult(e.x*t.x,e.y*t.y,i);throw"unknown param right."}static div(e,t,i){if(r.TypeCheck.isNumber(t))return n.newOrResult(e.x/t,e.y/t,i);if(r.TypeCheck.isInstanceOf(t,n))return n.newOrResult(e.x/t.x,e.y/t.y,i);throw"unknown param right."}static negate(e,t){return n.newOrResult(-e.x,-e.y,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static cross(e,t,i){return n.newOrResult(-t.y,t.x,i)}static normalize(e,t){let i=e.length;let s=e.x,r=e.y;if(i>1e-8){i=1/i;s*=i;r*=i}return n.newOrResult(s,r,t)}static middle(e,t,i){return n.newOrResult((e.x+t.x)*.5,(e.y+t.y)*.5,i)}static floor(e,t,i){let s=e.x<t.x?e.x:t.x;let r=e.y<t.y?e.y:t.y;return n.newOrResult(s,r,i)}static ceil(e,t,i){let s=e.x>t.x?e.x:t.x;let r=e.y>t.y?e.y:t.y;return n.newOrResult(s,r,i)}static lerp(e,t,i,s){i=r.GeoMath.clamp(i,0,1);n.mul(e,1-i,n._LerpStart);n.mul(t,i,n._LerpEnd);return n.add(n._LerpStart,n._LerpEnd,s)}static angle(e,t){n.normalize(e,n._AngleStart);n.normalize(t,n._AngleEnd);return r.GeoMath.acosClamped(n.dot(n._AngleStart,n._AngleEnd))}static newOrResult(e,t,i){if(!r.TypeCheck.isInstanceOf(i,n)){return new n(e,t)}i.x=e;i.y=t;return i}}n._LerpStart=new n;n._LerpEnd=new n;n.ZERO=r.TypeCheck.freezeObject(new n(0,0));n.UNIT=r.TypeCheck.freezeObject(new n(1,1));n.UNIT_X=r.TypeCheck.freezeObject(new n(1,0));n.UNIT_Y=r.TypeCheck.freezeObject(new n(0,1));r.Vector2=n})(Cegore||(Cegore={}));var Cegore;(function(o){class a{constructor(e,t,i){this.x=0;this.y=0;this.z=0;this.set(e,t,i)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}get magnitude(){return this.length}get squaredLength(){return this.x*this.x+this.y*this.y+this.z*this.z}set(e,t,i){let s,r,n;switch(o.TypeCheck.typeOf(e)){case"number":s=e;r=t;n=i;break;case"array":s=e[0];r=e[1];n=e[2];break;case"object":s=e.x;r=e.y;n=e.z;break}this.x=o.StringUtil.parseFloat(s);this.y=o.StringUtil.parseFloat(r);this.z=o.StringUtil.parseFloat(n)}clone(e){return a.clone(this,e)}equals(e){return a.equals(this,e)}toString(){return"("+this.x+","+this.y+","+this.z+")"}_asCzVector3(){return new Cesium.Cartesian3(this.x,this.y,this.z)}static distance(e,t){return Math.sqrt(a.squaredDistance(e,t))}static squaredDistance(e,t){let i=e.x-t.x;let s=e.y-t.y;let r=e.z-t.z;return i*i+s*s+r*r}static clone(e,t){return a.newOrResult(e.x,e.y,e.z,t)}static equals(e,t){return e===t||o.TypeCheck.isDefined(e)&&o.TypeCheck.isDefined(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z}static add(e,t,i){return a.newOrResult(e.x+t.x,e.y+t.y,e.z+t.z,i)}static sub(e,t,i){return a.newOrResult(e.x-t.x,e.y-t.y,e.z-t.z,i)}static mul(e,t,i){if(o.TypeCheck.isNumber(t))return a.newOrResult(e.x*t,e.y*t,e.z*t,i);if(o.TypeCheck.isInstanceOf(t,a))return a.newOrResult(e.x*t.x,e.y*t.y,e.z*t.z,i);throw"unknown param right."}static div(e,t,i){if(o.TypeCheck.isNumber(t))return a.newOrResult(e.x/t,e.y/t,e.z/t,i);if(o.TypeCheck.isInstanceOf(t,a))return a.newOrResult(e.x/t.x,e.y/t.y,e.z/t.z,i);throw"unknown param right."}static negate(e,t){return a.newOrResult(-e.x,-e.y,-e.z,t)}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static cross(e,t,i){let s=e.y*t.z-e.z*t.y;let r=e.z*t.x-e.x*t.z;let n=e.x*t.y-e.y*t.x;return a.newOrResult(s,r,n,i)}static normalize(e,t){let i=e.length;let s=e.x,r=e.y,n=e.z;if(i>1e-8){i=1/i;s*=i;r*=i;n*=i}return a.newOrResult(s,r,n,t)}static middle(e,t,i){return a.newOrResult((e.x+t.x)*.5,(e.y+t.y)*.5,(e.z+t.z)*.5,i)}static floor(e,t,i){let s=e.x<t.x?e.x:t.x;let r=e.y<t.y?e.y:t.y;let n=e.z<t.z?e.z:t.z;return a.newOrResult(s,r,n,i)}static ceil(e,t,i){let s=e.x>t.x?e.x:t.x;let r=e.y>t.y?e.y:t.y;let n=e.z>t.z?e.z:t.z;return a.newOrResult(s,r,n,i)}static lerp(e,t,i,s){i=o.GeoMath.clamp(i,0,1);a.mul(e,1-i,a._LerpStart);a.mul(t,i,a._LerpEnd);return a.add(a._LerpStart,a._LerpEnd,s)}static angle(e,t){a.normalize(e,a._AngleStart);a.normalize(t,a._AngleEnd);var i=a.dot(a._AngleStart,a._AngleEnd);var s=a.cross(a._AngleStart,a._AngleEnd,a._AngleCross);var r=s.length;return Math.atan2(r,i)}static newOrResult(e,t,i,s){if(!o.TypeCheck.isInstanceOf(s,a)){return new a(e,t,i)}s.x=e;s.y=t;s.z=i;return s}}a._LerpStart=new a;a._LerpEnd=new a;a.ZERO=o.TypeCheck.freezeObject(new a(0,0,0));a.UNIT=o.TypeCheck.freezeObject(new a(1,1,1));a.UNIT_X=o.TypeCheck.freezeObject(new a(1,0,0));a.UNIT_Y=o.TypeCheck.freezeObject(new a(0,1,0));a.UNIT_Z=o.TypeCheck.freezeObject(new a(0,0,1));o.Vector3=a})(Cegore||(Cegore={}));var Cegore;(function(a){class s{constructor(e,t,i){this.set(e,t,i)}get lon(){return this._x}get lat(){return this._y}get altitude(){return this._z}set lon(e){this._x=a.StringUtil.parseFloat(e)}set lat(e){this._y=a.StringUtil.parseFloat(e)}set altitude(e){this._z=a.StringUtil.parseFloat(e)}get x(){return this.lon}set x(e){this.lon=e}get y(){return this.lat}set y(e){this.lat=e}get z(){return this.altitude}set z(e){this.altitude=e}set(e,t,i){let s,r,n;if(e instanceof Cesium.Cartesian3){e=Cesium.Cartographic.fromCartesian(e)}if(e instanceof Cesium.Cartographic){s=a.GeoMath.toDegree(e.longitude);r=a.GeoMath.toDegree(e.latitude);n=e.height}else{const o=e;switch(a.TypeCheck.typeOf(e)){case"array":{s=e[0];r=e[1];n=e[2];break}case"object":{s=o.x;r=o.y;n=o.z;break}case"number":case"string":{s=a.StringUtil.parseFloat(e);r=a.StringUtil.parseFloat(t);n=a.StringUtil.parseFloat(i);break}}}this.lon=a.TypeCheck.defaultValue(s,0);this.lat=a.TypeCheck.defaultValue(r,0);this.altitude=a.TypeCheck.defaultValue(n,0)}static from(e,t,i){if(a.TypeCheck.isInstanceOf(e,s))return e;return new s(e,t,i)}static parsePoints(e){let t=[];let i=e.split("|");for(let e=0;e<i.length;++e){let e=i.split(",");t.push(e[0],e[1],e[2])}return t}}a.Position=s})(Cegore||(Cegore={}));var Cegore;(function(a){class l{constructor(t,i,s,r,n){this._minx=0;this._miny=0;this._maxx=0;this._maxy=0;this._isEmpty=true;this._isGeographical=true;let e=a.TypeCheck.typeOf(t);if(e==="number"){}else if(e==="array"){let e=t;n=i;t=e[0];i=e[1];s=e[2];r=e[3]}else if(a.TypeCheck.isInstanceOf(t,Cesium.Rectangle)){let e=t;t=a.GeoMath.toDegree(e.west);i=a.GeoMath.toDegree(e.south);s=a.GeoMath.toDegree(e.east);r=a.GeoMath.toDegree(e.north)}else if(e==="object"){let e=t;n=i;if(a.TypeCheck.isDefined(t.minx)){t=e.minx;i=e.miny;s=e.maxx;r=e.maxy}else if(a.TypeCheck.isDefined(t.west)){t=e.west;i=e.south;s=e.east;r=e.north}else if(a.TypeCheck.isDefined(t.left)){t=e.left;i=e.bottom;s=e.right;r=e.top}}else if(e==="boolean"){n=t}else{return}this._minx=a.TypeCheck.defaultValue(t,0);this._miny=a.TypeCheck.defaultValue(i,0);this._maxx=a.TypeCheck.defaultValue(s,0);this._maxy=a.TypeCheck.defaultValue(r,0);this._isGeographical=a.TypeCheck.defaultValue(n,true);this._isEmpty=false}get minx(){return this._isEmpty?0:this._minx}set minx(e){this._minx=this._isGeographical?l.normalizeLongitude(e):e;this._isEmpty=false}get maxx(){return this._isEmpty?0:this._maxx}set maxx(e){this._maxx=this._isGeographical?l.normalizeLongitude(e):e;this._isEmpty=false}get miny(){return this._isEmpty?0:this._miny}set miny(e){this._miny=this._isGeographical?l.normalizeLatitude(e):e;this._isEmpty=false}get maxy(){return this._isEmpty?0:this._maxy}set maxy(e){this._maxy=this._isGeographical?l.normalizeLatitude(e):e;this._isEmpty=false}get empty(){return this._isEmpty}set empty(e){this._isEmpty=e}get isGeographical(){return this._isGeographical}get width(){return this.maxx-this.minx}get height(){return this.maxy-this.miny}get west(){return this.minx}set west(e){this.minx=e}get east(){return this.maxx}set east(e){this.maxx=e}get south(){return this.miny}set south(e){this.miny=e}get north(){return this.maxy}set north(e){this.maxy=e}get left(){return this.minx}set left(e){this.minx=e}get right(){return this.maxx}set right(e){this.maxx=e}get bottom(){return this.miny}set bottom(e){this.miny=e}get top(){return this.maxy}set top(e){this.maxy=e}center(i){if(!a.TypeCheck.isInstanceOf(i,a.Position)){i=new a.Position}if(this._isGeographical){let e=this.minx;let t=this.maxx;if(t<e)t+=360;i.x=a.GeoMath.stdAngle((t+e)/2)}else{i.x=(this.minx+this.maxx)/2}i.y=(this.miny+this.maxy)/2;return i}min(e){if(!a.TypeCheck.isInstanceOf(e,a.Position)){e=new a.Position}e.x=this.minx;e.y=this.miny;return e}max(e){if(!a.TypeCheck.isInstanceOf(e,a.Position)){e=new a.Position}e.x=this.maxx;e.y=this.maxy;return e}leftBottom(e){return this.min(e)}leftTop(e){if(!a.TypeCheck.isInstanceOf(e,a.Position)){e=new a.Position}e.x=this.minx;e.y=this.maxy;return e}rightTop(e){return this.max(e)}rightBottom(e){if(!a.TypeCheck.isInstanceOf(e,a.Position)){e=new a.Position}e.x=this.maxx;e.y=this.miny;return e}southWest(e){return this.leftBottom(e)}southEast(e){return this.rightBottom(e)}northWest(e){return this.leftTop(e)}northEast(e){return this.rightTop(e)}inflate(t,i){if(a.TypeCheck.isNumber(t)){if(!a.TypeCheck.isNumber(i))i=t}else if(a.TypeCheck.isInstanceOf(t,a.Vector2)){let e=t;t=e.x;i=e.y}else if(a.TypeCheck.isInstanceOf(t,a.Position)){let e=t;t=e.x;i=e.y}this.minx-=t;this.maxx+=t;this.miny-=i;this.maxy+=i}merge(t,s){if(a.TypeCheck.isArray(t)){for(let e=0;e<t.length;++e){this.merge(t[e])}return}if(a.TypeCheck.isNumber(t)){let i=t;let e=s;if(this.empty){this.minx=this.maxx=i;this.miny=this.maxy=e;this.empty=false;return}if(this._isGeographical){let e=a.GeoMath.innerAngle(i,this.minx);let t=a.GeoMath.innerAngle(i,this.maxx);if(e<=t&&i<this.minx)this.minx=i;if(e>=t&&i>this.maxx)this.maxx=i}else{if(i<this.minx)this.minx=i;if(i>this.maxx)this.maxx=i}if(e<this.miny)this.miny=e;if(e>this.maxy)this.maxy=e;return}if(a.TypeCheck.isInstanceOf(t,a.Position)){this.merge(t.x,t.y);return}if(a.TypeCheck.isInstanceOf(t,l)){let s=t;if(this.empty){this.minx=s.minx;this.miny=s.miny;this.maxx=s.maxx;this.maxy=s.maxy;this.empty=false;return}if(this._isGeographical){let e=this.center();let t=a.GeoMath.innerAngle(e.x,this.minx);let i=a.GeoMath.innerAngle(e.x,this.maxx);if(t<=i&&s.minx<this.minx)this.minx=s.minx;if(t>=i&&s.maxx>this.maxx)this.maxx=s.maxx}else{if(s.minx<this.minx)this.minx=s.minx;if(s.maxx>this.maxx)this.maxx=s.maxx}if(s.miny<this.miny)this.miny=s.miny;if(s.maxy>this.maxy)this.maxy=s.maxy;return}}asArray(e){if(!a.TypeCheck.isArray(e)){e=[]}e[0]=this.minx;e[1]=this.miny;e[2]=this.maxx;e[3]=this.maxy;return e}clone(e){if(!a.TypeCheck.isInstanceOf(e,l)){e=new l}e.minx=this.minx;e.miny=this.miny;e.maxx=this.maxx;e.maxy=this.maxy;return e}contains(t){if(a.TypeCheck.isInstanceOf(t,a.Position)){let s=t;if(this.isGeographical){let e=s.x;let t=this.miny;let i=this.maxx;if(i<t)i+=360;if(e<t)e+=360;if(e<t||e>i)return false}else{if(s.x<this.minx||s.x>this.maxx)return false}if(s.y<this.miny||s.y>this.maxy)return false;return true}else if(a.TypeCheck.isInstanceOf(t,l)){let e=t;return this.contains(e.min())&&this.contains(e.max())}throw"unknow param v, v must be a Position or Rectangle."}intersection(r,e){let n,o;if(this._isGeographical){let e=this.minx;let t=this.maxx;let i=r.minx;let s=r.maxx;if(t<e){if(s<i)i+=360;else if(i<t){i+=360;s+=360}t+=360}else if(s<i){if(e<s){e+=360;t+=360}s+=360}n=e>i?e:i;o=t<s?t:s;if(n>o)return undefined}else{n=this.minx>r.minx?this.minx:r.minx;o=this.maxx<r.maxx?this.maxx:r.maxx;if(n>o)return undefined}let t,i;t=this.miny>r.miny?this.miny:r.miny;i=this.maxy<r.maxy?this.maxy:r.maxy;if(t>i)return undefined;if(!a.TypeCheck.isInstanceOf(e,l)){e=new l}e.minx=n;e.maxx=o;e.miny=t;e.maxy=i;return e}toCZRectangle(){return Cesium.Rectangle.fromDegrees(this._minx,this.miny,this.maxx,this.maxy)}static toCZRectangle(e){if(!e)return undefined;if(e instanceof l)return e.toCZRectangle();return new l(e).toCZRectangle()}static normalizeLongitude(e){return a.GeoMath.stdAngle(e)}static normalizeLatitude(e){return a.GeoMath.clamp(e,-90,90)}}a.Rectangle=l})(Cegore||(Cegore={}));var Cegore;(function(o){class e{constructor(e,t,i){this._heading=0;this._pitch=0;this._roll=0;this.set(e,t,i)}get heading(){return this._heading}set heading(e){this._heading=e}get pitch(){return this._pitch}set pitch(e){this._pitch=e}get roll(){return this._roll}set roll(e){this._roll=e}set(t,e,i){let s,r,n;if(o.TypeCheck.isArray(t)){let e=t;s=e[0];r=e[1];n=e[2]}else if(o.TypeCheck.isObject(t)){let e=t;s=e.heading;r=e.pitch;n=e.roll}else if(o.TypeCheck.isNumber(t)){s=t;r=e;n=i}this.heading=o.TypeCheck.defaultValue(s,0);this.pitch=o.TypeCheck.defaultValue(r,0);this.roll=o.TypeCheck.defaultValue(n,0)}setFromRadius(t,e,i){let s,r,n;if(o.TypeCheck.isArray(t)){let e=t;s=e[0];r=e[1];n=e[2]}else if(o.TypeCheck.isObject(t)){let e=t;s=e.heading;r=e.pitch;n=e.roll}else if(o.TypeCheck.isNumber(t)){s=t;r=e;n=i}this.heading=o.GeoMath.toDegree(o.TypeCheck.defaultValue(s,0));this.pitch=o.GeoMath.toDegree(o.TypeCheck.defaultValue(r,0));this.roll=o.GeoMath.toDegree(o.TypeCheck.defaultValue(n,0))}}o.HeadingPitchRoll=e})(Cegore||(Cegore={}));var Cegore;(function(a){class e{constructor(e,t,i){this.heading=0;this.pitch=0;this.distance=0;this.set(e,t,i)}set(e,t,i){let s,r,n;let o=a.TypeCheck.typeOf(e);switch(o){case"number":s=e;r=t;n=i;break;case"array":s=e[0];r=e[1];n=e[2];break;case"object":s=e.heading;r=e.pitch;n=e.distance;break}this.heading=a.TypeCheck.defaultValue(s,0);this.pitch=a.TypeCheck.defaultValue(r,0);this.distance=a.TypeCheck.defaultValue(n,0)}_asCzObject(e){if(!a.TypeCheck.isInstanceOf(e,Cesium.HeadingPitchRange)){e=new Cesium.HeadingPitchRange}e.heading=a.GeoMath.toRadian(this.heading);e.pitch=a.GeoMath.toRadian(this.pitch);e.range=this.distance;return e}}a.HeadingPitchDistance=e})(Cegore||(Cegore={}));var Cegore;(function(c){class u{static toRadian(e){return e*this._degree2radian}static toDegree(e){return e*this._radian2degree}static clamp(e,t,i){if(e<t)e=t;if(e>i)e=i;return e}static acosClamped(e){return Math.acos(u.clamp(e,-1,1))}static asinClamped(e){return Math.asin(u.clamp(e,-1,1))}static random(e,t){let i=Math.random();let s=c.TypeCheck.defaultValue(e,0);let r=c.TypeCheck.defaultValue(t,1);return s+(r-s)*i}static surfaceDistance(i,e,s){if(c.TypeCheck.isArray(i)){let t=0;for(let e=1;e<i.length;++e){t+=u.surfaceDistance(i[e-1],i[e],s)}return t}if(!c.TypeCheck.isInstanceOf(i,c.Position))i=new c.Position(i);if(!c.TypeCheck.isInstanceOf(e,c.Position))e=new c.Position(e);if(!c.TypeCheck.isDefined(s))s=6378137;let t=u.toRadian(i.lat);let r=u.toRadian(e.lat);let n=u.toRadian(i.lon);let o=u.toRadian(e.lon);let a=Math.cos(t)*Math.cos(r)*Math.cos(n-o);let l=Math.sin(t)*Math.sin(r);let h=u.clamp(a+l,-1,1);return Math.acos(h)*s}static innerAngle(e,t){e=u.stdAngle(e);t=u.stdAngle(t);let i=Math.abs(e-t);if(i>180)i=360-i;return i}static stdAngle(e){let t=e%360;if(t>180)t-=360;if(t<-180)t+=360;return t}static surfaceArea(s,r){var n=[];var t=new c.Rectangle;for(let e=0;e<s.length;++e){t.merge(s[e])}var o=t.min();for(let i=0;i<s.length;++i){var a=new c.Position(s[i]);let e=u.surfaceDistance(new c.Position(a.x,a.y),new c.Position(a.x,o.y),r);let t=u.surfaceDistance(new c.Position(a.x,a.y),new c.Position(o.x,a.y),r);n.push(new c.Position(e,t))}return u.area(n)}static area(e){return Math.abs(u.signedArea(e))}static signedArea(e){if(e==null||e.length<3)return 0;var t=e.length;var i=e[t-1];var s=e[0];var r=e[1];var n=s.y*(i.x-r.x);for(var o=1;o<t;++o){i=s;s=r;r=e[(o+1)%t];n+=s.y*(i.x-r.x)}return n/2}}u._degree2radian=Math.PI/180;u._radian2degree=180/Math.PI;c.GeoMath=u})(Cegore||(Cegore={}));var Cegore;(function(o){class r{constructor(e,t){this._begin=e;this._end=t;this._interp=new o.Vector2}interp(e){return o.Vector2.lerp(this._begin,this._end,e,this._interp)}}class n{constructor(t,i){this._segments=[];let s=t.length<i.length?t.length:i.length;for(let e=0;e<s;++e){this._segments[e]=new r(t[e],i[e])}this._interp=[]}interp(t){for(let e=0;e<this._segments.length;++e){this._interp[e]=this._segments[e].interp(t)}return this._interp}}class e{static nearPoint(i,s){let r=0;let n=o.Vector2.squaredDistance(i,s[0]);for(let t=1;t<s.length;++t){let e=o.Vector2.squaredDistance(i,s[t]);if(e<n){n=e;r=t}}return r}}class t{constructor(e){let s=e.lines.slice();for(let e=0;e<s.length;++e){let t=s[e];for(let e=0;e<t.length;++e){if(!o.TypeCheck.isInstanceOf(t[e],o.Vector2))t[e]=new o.Vector2(t[e])}}this._bridges=[];for(let i=1;i<s.length;++i){let e=s[i-1];let t=s[i];this._bridges.push(new n(e,t))}}interp(e){e=o.GeoMath.clamp(e,0,1);let t=e*this._bridges.length;let i,s;if(e==1){i=this._bridges.length-1;s=1}else{i=Math.floor(t);s=t-i}return this._bridges[i].interp(s)}}o.MultiLineInterp=t})(Cegore||(Cegore={}));var Cegore;(function(n){class e{constructor(e){let t=n.TypeCheck.defaultValue(e.width,512);let i=n.TypeCheck.defaultValue(e.height,512);this._ctx=this.createCanvasContext2D(e.canvas,t,i);this._canvas=this._ctx.canvas}get canvas(){return this._canvas}get context(){return this._ctx}get rect(){return this._rect}get width(){return this._canvas.width}get height(){return this._canvas.height}clear(){this._ctx.clearRect(0,0,this.width,this.height)}calcRect(e){if(!n.TypeCheck.isDefined(this._rect))this._rect=new n.Rectangle;else this._rect.empty=true;function r(i,s){for(let t=0;t<i.length;++t){let e=i[t];if(n.TypeCheck.isInstanceOf(e,n.Vector2))s.merge(e.x,e.y);else if(n.TypeCheck.isNumber(e[0])){i[t]=new n.Vector2(e);s.merge(e[0],e[1])}else r(e,s)}}r(e,this._rect);this._geoWidth=this._rect.width;this._getHeight=this._rect.height}convertX(e){return(e-this._rect.minx)/this._geoWidth*this.width}convertY(e){return(this._rect.maxy-e)/this._getHeight*this.height}createCanvasContext2D(e,t,i){let s;if(n.TypeCheck.isDefined(e)){if(n.TypeCheck.isString(e))s=document.getElementById(e);else if(n.TypeCheck.isInstanceOf(e,HTMLCanvasElement))s=e}if(!s){s=document.createElement("CANVAS")}if(t)s.width=t;if(i)s.height=i;return s.getContext("2d")}}n.CanvasDraw=e})(Cegore||(Cegore={}));var Cegore;(function(i){class e extends i.CanvasDraw{constructor(e,t){super(t);this.calcRect(e);this._interp=new i.MultiLineInterp({lines:e})}draw(e){const t=this.context;t.fillStyle="#FF0000";const i=this._interp.interp(e);this.clear();t.beginPath();t.moveTo(this.convertX(i[0].x),this.convertY(i[0].y));for(var s=1;s<i.length;++s){t.lineTo(this.convertX(i[s].x),this.convertY(i[s].y))}t.closePath();t.fill()}}i.PolygonMask=e})(Cegore||(Cegore={}));var Cegore;(function(n){class e extends n.CanvasDraw{constructor(e,t){super(t);this._fill=true;this._ctx1=this.createCanvasContext2D(null,this.width,this.height);this._canvas1=this._ctx1.canvas;this._ctx2=this.createCanvasContext2D(null,this.width,this.height);this._canvas2=this._ctx2.canvas;this._lines=e;this.calcRect(e)}draw(e){this.clear();this.context.fillStyle="#FF0000";this.context.strokeStyle="#FF0000";e=n.GeoMath.clamp(e,0,1);let t=e*(this._lines.length-1);let i=Math.floor(t);if(i===this._lines.length-1)i--;let s=i+1;let r=t-i;this.drawLine(this._ctx1,this._lines[i]);this.drawLine(this._ctx2,this._lines[s]);this.drawMix(this._ctx1,this._ctx2,r)}drawLine(i,e){const t=this._fill;i.fillStyle="#FFFFFF";i.strokeStyle="#FFFFFF";i.clearRect(0,0,this.width,this.height);i.beginPath();let s=this;function r(t){if(!n.TypeCheck.isInstanceOf(t[0],n.Vector2)){for(let e=0;e<t.length;++e){r(t[e])}}i.moveTo(s.convertX(t[0].x),s.convertY(t[0].y));for(var e=1;e<t.length;++e){i.lineTo(s.convertX(t[e].x),s.convertY(t[e].y))}}r(e);if(this._fill)i.fill();else i.stroke()}drawMix(e,t,i){const s=this.width;const r=this.height;let n=e.getImageData(0,0,s,r);let o=t.getImageData(0,0,s,r);let a=this.context.getImageData(0,0,s,r);let l=n.data;let h=o.data;let c=a.data;let u=s*r*4;for(let e=0;e<u;e+=4){c[e]=255;c[e+1]=c[e+2]=0;if(l[e+3]!=0&&h[e+3]!=0){c[e+3]=(l[e]+h[e])/2}else if(l[e+3]!=0){c[e+3]=(1-i)*l[e+3]}else if(h[e+3]!=0){c[e+3]=i*h[e+3]}else{c[e+3]=0}c[e]=c[e+3]}this.context.putImageData(a,0,0)}}n.PolylineGradual=e})(Cegore||(Cegore={}));var Cegore;(function(l){class e{constructor(e){this._viewer=e.viewer;let t=l.TypeCheck.defaultValue(e.textureSize,{});function a(i,s,r){if(i.length==0)return;let n=true;let o=i[0].length;for(let t=0;t<i.length;++t){let e=i[t];if(l.TypeCheck.isNumber(e[0])){i[t]=new l.Vector2(e)}else{a(e,s+1,r)}if(o!=e.length)n=false}if(s==0)r.isEquel=n;if(s>1)r.isSimple=false}let i={isEquel:false,isSimple:true};let s=e.lines.slice();a(s,0,i);if(i.isEquel&&i.isSimple){this._polygonMask=new l.PolygonMask(s,{canvas:e.canvas,width:t.width,height:t.height})}else{this._polygonMask=new l.PolylineGradual(s,{canvas:e.canvas,width:t.width,height:t.height})}this._material=new Cesium.Material({fabric:{type:"Water",uniforms:{specularMap:this._polygonMask.canvas,normalMap:"../../build/dep.debug/Assets/Textures/waterNormals.jpg",frequency:1e4,animationSpeed:.01,amplitude:1}}});this._appearance=new Cesium.EllipsoidSurfaceAppearance({aboveGround:true,faceForward:false,material:this._material,renderState:{fog:{enabled:true,density:.01}}});this._geometry=new Cesium.RectangleGeometry({rectangle:this._polygonMask.rect.toCZRectangle(),vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,height:e.height,extrudedHeight:e.extrudedHeight,granularity:Math.PI/5e3});this._primitive=e.viewer._czdata.viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:this._geometry}),appearance:this._appearance,show:true}))}draw(e){this._polygonMask.draw(e);let t=this._material._textures.specularMap;let i=this._polygonMask.canvas;if(t&&t.width==i.width&&t.height==i.height){t.copyFrom(i)}}set visible(e){if(this._primitive)this._primitive.show=e}get visible(){return this._primitive?this._primitive.show:false}remove(){this._viewer._czdata.viewer.scene.primitives.remove(this._primitive);this._primitive=this._primitive.destroy();this._appearance=null;this._material=this._material.destroy();this._geometry=null;this._polygonMask=null}}l.DynamicArea=e})(Cegore||(Cegore={}));var Cegore;(function(n){class o{constructor(e,t,i,s){this._r=0;this._g=0;this._b=0;this._a=0;this.set(e,t,i,s)}set(t,i,s,r){if(n.TypeCheck.isInstanceOf(t,Cesium.Color)){let e=t;t=e.red;i=e.green;s=e.blue;r=e.alpha}else if(n.TypeCheck.isString(t)){let e=o.fromCssColor(t);t=e.r;i=e.g;s=e.b;r=e.a}else if(n.TypeCheck.isArray(t)){let e=t;t=e[0];i=e[1];s=e[2];r=e[3]}else if(n.TypeCheck.isObject(t)){let e=t;t=e.r;i=e.g;s=e.b;r=e.a}this.r=t;this.g=i;this.b=s;this.a=r}get red(){return this._r}get green(){return this._g}get blue(){return this._b}get alpha(){return this._a}get r(){return this._r}get g(){return this._g}get b(){return this._b}get a(){return this._a}set r(e){this._r=n.GeoMath.clamp(n.TypeCheck.defaultValue(e,0),0,1)}set g(e){this._g=n.GeoMath.clamp(n.TypeCheck.defaultValue(e,0),0,1)}set b(e){this._b=n.GeoMath.clamp(n.TypeCheck.defaultValue(e,0),0,1)}set a(e){this._a=n.GeoMath.clamp(n.TypeCheck.defaultValue(e,0),0,1)}static fromCssColor(e){return new o(Cesium.Color.fromCssColorString(e))}static fromBytes(e,t,i,s,r){if(!n.TypeCheck.isInstanceOf(r,o)){r=o.BLACK}r.r=e/255;r.g=t/255;r.b=i/255;r.a=s/255;return r}static fromRGBA32(e,t){o.UnionUint32[0]=e;return o.fromBytes(o.UnionUint8[0],o.UnionUint8[1],o.UnionUint8[2],o.UnionUint8[3],t)}static fromRandom(e,t){function i(e,t,i){if(n.TypeCheck.isNumber(e)){return e}else{t=n.TypeCheck.defaultValue(t,0);i=n.TypeCheck.defaultValue(i,1);return n.GeoMath.random(t,i)}}if(!n.TypeCheck.isInstanceOf(t,o)){t=o.BLACK}t.r=i(e.red,e.minRed,e.maxRed);t.g=i(e.green,e.minGreen,e.maxGreen);t.b=i(e.blue,e.minBlue,e.maxBlue);t.a=i(e.alpha,e.minAlpha,e.maxAlpha);return t}toCssColor(){return new Cesium.Color(this._r,this._g,this._b,this._a).toCssColorString()}toBytes(e){if(!n.TypeCheck.isArray(e)){e=[]}e[0]=Math.floor(this._r*255);e[1]=Math.floor(this._g*255);e[2]=Math.floor(this._b*255);e[3]=Math.floor(this._a*255);return e}toRGBA32(){let e=this.toBytes();o.UnionUint8[0]=e[0];o.UnionUint8[1]=e[1];o.UnionUint8[2]=e[2];o.UnionUint8[3]=e[3];return o.UnionUint32[0]}toCZColor(){return new Cesium.Color(this._r,this._g,this._b,this._a)}}o.RED=n.TypeCheck.freezeObject(o.fromCssColor("#FF0000"));o.GREEN=n.TypeCheck.freezeObject(o.fromCssColor("#00FF00"));o.BLUE=n.TypeCheck.freezeObject(o.fromCssColor("#0000FF"));o.BLACK=n.TypeCheck.freezeObject(o.fromCssColor("#000000"));o.WHITE=n.TypeCheck.freezeObject(o.fromCssColor("#FFFFFF"));o.YELLOW=n.TypeCheck.freezeObject(o.fromCssColor("#FFFF00"));o.AUQA=n.TypeCheck.freezeObject(o.fromCssColor("#00FFFF"));o.FUCHSIA=n.TypeCheck.freezeObject(o.fromCssColor("#FF00FF"));o.GRAY=n.TypeCheck.freezeObject(o.fromCssColor("#808080"));o.ScratchArrayBuffer=new ArrayBuffer(4);o.UnionUint32=new Uint32Array(o.ScratchArrayBuffer);o.UnionUint8=new Uint8Array(o.ScratchArrayBuffer);n.Color=o})(Cegore||(Cegore={}));var Cegore;(function(t){class e{}t.Material=e;class i extends e{constructor(e){super();this._color=new t.Color(t.Color.WHITE);if(!t.TypeCheck.isInstanceOf(e,t.Color)){e=new t.Color(e)}this._czmat=new Cesium.ColorMaterialProperty(e.toCZColor())}get type(){return"Color"}get czmat(){return this._czmat}get color(){return this._color}set color(e){this._color.set(e);this._czmat.color=this._color.toCZColor()}}t.ColorMaterial=i;class s extends e{constructor(e){super();this._color=new t.Color(t.Color.WHITE);this._repeat=new t.Vector2(1,1);this._transparent=false;this._czmat=new Cesium.ImageMaterialProperty;this.color=e.color;this.image=e.image;this.repeat=e.repeat;this.transparent=e.transparent}get type(){return"Image"}get czmat(){return this._czmat}get color(){return this._color}set color(e){this._color.set(e);this._czmat.color=this._color.toCZColor()}get image(){return this._image}set image(e){this._image=e;this._czmat.image=e}get repeat(){return this._repeat}set repeat(e){this._repeat.set(e);this._czmat.repeat=this._repeat._asCzVector2()}get transparent(){return this._transparent}set transparent(e){this._transparent=e;this._czmat.transparent=e}}t.ImageMaterial=s})(Cegore||(Cegore={}));var Cegore;(function(r){class n{constructor(e,t){this._callback=e;this._self=t}static equal(e,t){return e._callback===t._callback&&e._self===t._self}fire(e){try{this._callback.apply(this._self,e)}catch(e){console.error("fire event error.")}}}class e{constructor(){this._listeners=[]}on(e,t){if(!r.TypeCheck.isFunction(e))throw"need param 'callback' is Function.";let i=new n(e,t);let s=r.ArrayUtil.indexOf(i,this._listeners,n.equal);if(s===-1)this._listeners.push(i)}off(e,t){let i=new n(e,t);let s=r.ArrayUtil.indexOf(i,this._listeners,n.equal);if(s!==-1)this._listeners.splice(s)}fire(...t){for(let e=0;e<this._listeners.length;++e){this._listeners[e].fire(t)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}}r.Event=e})(Cegore||(Cegore={}));var Cegore;(function(r){class e{constructor(i){this._events=new r.HashMap(function(){return new r.Event});if(r.TypeCheck.isArray(i)){for(let t=0;t<i.length;++t){let e=i[t];if(r.TypeCheck.isString(e.type)&&r.TypeCheck.isFunction(e.callback)){this.on(e.type,e.callback,e.self)}}}else if(r.TypeCheck.isObject(i)){for(let t in i){let e=i[t];if(r.TypeCheck.isFunction(e))this.on(t,e)}}}on(e,t,i){if(!r.TypeCheck.isString(e))throw"need param 'type' is string.";if(!r.TypeCheck.isFunction(t))throw"need param 'callback' is Function.";this._events.getOrCreate(e).on(t,i)}off(e,t,i){let s=this._events.get(e);if(!r.TypeCheck.isDefined(s))return;s.off(t,i)}fire(e,...t){let i=this._events.get(e);if(!r.TypeCheck.isDefined(i))return;i.fire.apply(i,t)}}r.EventHandle=e})(Cegore||(Cegore={}));var Cegore;(function(i){class s{static genName(e,t){if(i.TypeCheck.isDefined(e))return e;if(i.TypeCheck.isDefined(t))return t+"-"+s.NextIndex++;else return"AutoName-"+s.NextIndex++}}s.NextIndex=0;i.AutoNames=s})(Cegore||(Cegore={}));var Cegore;(function(t){class e{constructor(e){this._onTick=new t.Event;this._czClock=e._czdata.viewer.clock;this._czClock.onTick.addEventListener(()=>{this._onTick.fire(this)})}get onTick(){return this._onTick}get currentTime(){return Cesium.JulianDate.toDate(this._czClock.currentTime)}set currentTime(e){this._czClock.currentTime=Cesium.JulianDate.fromDate(e)}get startTime(){return Cesium.JulianDate.toDate(this._czClock.startTime)}set startTime(e){this._czClock.startTime=Cesium.JulianDate.fromDate(e)}get stopTime(){return Cesium.JulianDate.toDate(this._czClock.stopTime)}set stopTime(e){this._czClock.stopTime=Cesium.JulianDate.fromDate(e)}}t.Clock=e})(Cegore||(Cegore={}));var Cegore;(function(a){class e{constructor(e){this._position=new a.Position;this._orientation=new a.HeadingPitchRoll;this._eventChanged=new a.Event;this._eventMoveStart=new a.Event;this._eventMoveEnd=new a.Event;this._viewer=e;this._czData=e._czdata;this._czCamera=this._czData.camera;this._czCamera.changed.addEventListener(()=>{this._eventChanged.fire(this)});this._czCamera.moveStart.addEventListener(()=>{this._eventMoveStart.fire(this)});this._czCamera.moveEnd.addEventListener(()=>{this._eventMoveEnd.fire(this)})}get position(){this._position.set(this._czData.camera.positionCartographic);return this._position}set position(e){if(!a.TypeCheck.isInstanceOf(e,a.Position)){this._position.set(e);e=this._position}this.setView({position:e})}get orientation(){this._orientation.setFromRadius(this._czData.camera.heading,this._czData.camera.pitch,this._czData.camera.roll);return this._orientation}set orientation(e){if(!a.TypeCheck.isInstanceOf(e,a.HeadingPitchRoll)){this._orientation.set(e);e=this._orientation}this.setView({orientation:e})}get changed(){return this._eventChanged}get moveStart(){return this._eventMoveStart}get moveEnd(){return this._eventMoveEnd}flyTo(e){let t;let i;if(a.TypeCheck.isDefined(e.position))t=this.fromPosition(e.position);else if(a.TypeCheck.isDefined(e.rect))t=this.fromRectange(e.rect);else throw"position or rect is need.";if(a.TypeCheck.isDefined(e.orientation))i=this.fromOrientation(e.orientation);return this._czCamera.flyTo({destination:t,orientation:i,duration:e.duration,complete:e.complete,cancel:e.cancel,endTransform:Cesium.Matrix4.IDENTITY})}flyToSphere(e){let t=e.center;let i=e.offset;if(!a.TypeCheck.isInstanceOf(t,a.Position))t=new a.Position(t);if(!a.TypeCheck.isInstanceOf(i,a.HeadingPitchDistance))i=new a.HeadingPitchDistance(i);let s=new Cesium.BoundingSphere(this.fromPosition(t),e.radius);let r;if(a.TypeCheck.isDefined(e.offset)){r=i._asCzObject()}this._czCamera.flyToBoundingSphere(s,{offset:r,duration:e.duration,complete:e.complete,cancel:e.cancel,endTransform:Cesium.Matrix4.IDENTITY})}stopFly(){this._czData.camera.cancelFlight()}setView(e){let t;let i;if(a.TypeCheck.isDefined(e.position))t=this.fromPosition(e.position);else if(a.TypeCheck.isDefined(e.rect))t=this.fromRectange(e.rect);else throw"position or rect is need.";if(a.TypeCheck.isDefined(e.orientation))i=this.fromOrientation(e.orientation);return this._czData.camera.setView({destination:t,orientation:i,endTransform:Cesium.Matrix4.IDENTITY})}getView(){return{position:this.position,orientation:this.orientation}}lookAt(e,t){if(!a.TypeCheck.isInstanceOf(e,a.Position))e=new a.Position(e);if(!a.TypeCheck.isInstanceOf(t,a.HeadingPitchDistance))t=new a.HeadingPitchDistance(t);this._czCamera.lookAt(this.fromPosition(e),t._asCzObject())}lookAtFromTo(e,t){if(!a.TypeCheck.isInstanceOf(t,a.Position))t=new a.Position(t);if(!a.TypeCheck.isInstanceOf(e,a.Position))e=new a.Position(e);let i=this.fromPosition(e);let s=this.fromPosition(t);var r=Cesium.Transforms.eastNorthUpToFixedFrame(s,Cesium.Ellipsoid.WGS84);var n=Cesium.Matrix4.inverse(r,new Cesium.Matrix4);var o=Cesium.Matrix4.multiplyByPoint(n,i,new Cesium.Cartesian3);this._czCamera.lookAtTransform(r,o)}clearLookAt(){this._czCamera.lookAtTransform(Cesium.Matrix4.IDENTITY)}fromRectange(e){if(!a.TypeCheck.isInstanceOf(e,a.Rectangle))e=new a.Rectangle(e);return Cesium.Rectangle.fromDegrees(e.minx,e.miny,e.maxx,e.maxy)}fromPosition(e){if(!a.TypeCheck.isInstanceOf(e,a.Position))e=new a.Position(e);return Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z,this._czData.ellipsoid)}fromOrientation(e){if(!a.TypeCheck.isInstanceOf(e,a.HeadingPitchRoll))e=new a.HeadingPitchRoll(e);return{heading:a.GeoMath.toRadian(e.heading),pitch:a.GeoMath.toRadian(e.pitch),roll:a.GeoMath.toRadian(e.roll)}}}a.Camera=e})(Cegore||(Cegore={}));var Cegore;(function(e){class t{constructor(e){this.enableInputs=true;this.enableTranslate=true;this.enableZoom=true;this.enableRotate=true;this.enableTilt=true;this.enableUpDown=true;this.enableLook=true;this.inertiaSpin=.9;this.inertiaTranslate=.9;this.inertiaZoom=.8;this.maximumMovementRatio=.1;this.bounceAnimationTime=3;this.minimumZoomDistance=1;this.maximumZoomDistance=2e7;this.minimumPitch=Cesium.Math.toRadians(0);this.maximumPitch=Cesium.Math.toRadians(90);this.lookViewMinimumPitch=Cesium.Math.toRadians(0);this.lookViewMaximumPitch=Cesium.Math.toRadians(90);this.translateEventTypes=Cesium.CameraEventType.LEFT_DRAG;this.zoomEventTypes=[Cesium.CameraEventType.WHEEL,Cesium.CameraEventType.PINCH];this.rotateEventTypes=Cesium.CameraEventType.LEFT_DRAG;this.tiltEventTypes=[Cesium.CameraEventType.RIGHT_DRAG,Cesium.CameraEventType.PINCH,{eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL}];this.upDownEventTypes={eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT};this.lookEventTypes={eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT};this.enableCollisionDetection=true;this.enableFlatMode=false;this.flatModeHeight=0;this.flatModeOffset=0;this._lastInertiaSpinMovement=undefined;this._lastInertiaZoomMovement=undefined;this._lastInertiaTranslateMovement=undefined;this._lastInertiaTiltMovement=undefined;this._horizontalRotationAxis=undefined;this._tiltCenterMousePosition=new Cesium.Cartesian2(-1,-1);this._tiltCenter=new Cesium.Cartesian3;this._lastPickPosition=new Cesium.Cartesian3;this._zoomFactor=5;this._maximumRotateRate=1.77;this._minimumRotateRate=1/5e3;this._minimumZoomRate=20;this._maximumZoomRate=5906376272e3;if(!Cesium.defined(e)){throw new Cesium.DeveloperError("scene is required.")}this._scene=e;this._aggregator=new Cesium.CameraEventAggregator(e.canvas)}set viewRectange(e){this._viewRectange=e.clone(this._viewRectange);if(e){const t=Cesium.Rectangle.center(e);t.height=0;this._viewCenter=Cesium.Cartographic.toCartesian(t,undefined,this._viewCenter)}}get viewRectange(){return this._viewRectange}isDestroyed(){return false}destroy(){this._aggregator=this._aggregator&&this._aggregator.destroy();return Cesium.destroyObject(this)}update(){const e=this._scene;const t=e.mode;if(t===Cesium.SceneMode.SCENE2D){this.update2D()}else if(t===Cesium.SceneMode.COLUMBUS_VIEW){this._horizontalRotationAxis=Cesium.Cartesian3.UNIT_Z;this.updateCV()}else if(t===Cesium.SceneMode.SCENE3D){this._horizontalRotationAxis=undefined;this.update3D()}this._aggregator.reset()}onMap(){return true}_checkLimit(e,t,i,s,r){const n=this._scene.globe;if(this.enableCollisionDetection&&n&&n.show){const o=T;const a=i.clone(o.direction);Cesium.Cartesian3.normalize(a,a);const l=n.pick(o,this._scene,P);if(Cesium.defined(l)&&Cesium.Cartesian3.magnitudeSquared(i)<Cesium.Cartesian3.magnitudeSquared(l)){return false}}if(this._viewRectange&&!Cesium.Cartesian3.equals(t,i)&&e===this.spin3D){const h=Cesium.Cartographic.fromCartesian(t,undefined,this._temp_view_c0);const c=Cesium.Cartographic.fromCartesian(i,undefined,this._temp_view_c1);if(Cesium.Rectangle.contains(this._viewRectange,c)){console.info("范围内");return true}h.height=0;c.height=0;const u=Cesium.Cartographic.toCartesian(h,undefined,this._temp_view_p0);const d=Cesium.Cartographic.toCartesian(c,undefined,this._temp_view_p1);const m=Cesium.Cartesian3.distanceSquared(this._viewCenter,u);const p=Cesium.Cartesian3.distanceSquared(this._viewCenter,d);console.info("范围外",p-m);if(p>m)return false}return true}getEllipsoid(){return Cesium.defined(this._scene.globe)?this._scene.globe.ellipsoid:this._scene.mapProjection.ellipsoid}update2D(){}updateCV(){}update3D(){this.reactToInput(this.enableRotate,this.rotateEventTypes,this.spin3D,this.inertiaSpin,"_lastInertiaSpinMovement");this.reactToInput(this.enableZoom,this.zoomEventTypes,this.zoom3D,this.inertiaZoom,"_lastInertiaZoomMovement");this.reactToInput(this.enableTilt,this.tiltEventTypes,this.tilt3D,this.inertiaSpin,"_lastInertiaTiltMovement");this.reactToInput(this.enableLook,this.lookEventTypes,this.look3D);this.reactToInput(this.enableUpDown,this.upDownEventTypes,this.upDown)}reactToInput(e,t,i,s,r){if(!Cesium.defined(t))return;if(!this.enableInputs||!e)return;const n=this._aggregator;const o=this._scene;const a=o.camera;let l=t;if(!Array.isArray(l)){g[0]=t;l=g}const h=Cesium.Cartesian3.clone(a.positionWC,b);const c=w(o,a,E);const u=l.length;for(let e=0;e<u;++e){const p=l[e];const f=Cesium.defined(p.eventType)?p.eventType:p;const _=p.modifier;const y=n.isMoving(f,_)&&n.getMovement(f,_);const C=n.getStartMousePosition(f,_);if(y){try{i.call(this,C,y)}catch(e){}}else if(s<1){v(n,f,_,s,i,this,r)}}const d=Cesium.Cartesian3.clone(a.positionWC,x);const m=w(o,a,S);if(!this._checkLimit(i,h,d,c,m)){a.setView({destination:h,orientation:c})}}pickReal(e,t){const i=this._scene;const s=i.globe;const r=i.camera;const n=r.getPickRay(e,m);let o,a;if(i.pickPositionSupported){if(i.pick(e))o=i.pickPosition(e,c)}if(s&&s.show){a=s.pick(n,i,u)}const l=Cesium.defined(o)?Cesium.Cartesian3.distance(o,r.positionWC):Number.POSITIVE_INFINITY;const h=Cesium.defined(a)?Cesium.Cartesian3.distance(a,r.positionWC):Number.POSITIVE_INFINITY;if(l<h){return Cesium.Cartesian3.clone(o,t)}if(h!=Number.POSITIVE_INFINITY){return Cesium.Cartesian3.clone(a,t)}return undefined}pickFlat(e,t){const i=this._scene;const s=i.camera;const r=s.getPickRay(e,m);const n=this.getEllipsoid();const o=1+(this.flatModeHeight+this.flatModeOffset)/n.maximumRadius;const a=Cesium.Cartesian3.multiplyByScalar(n.radii,o,p);const l=Cesium.Ellipsoid.fromCartesian3(a,f);const h=Cesium.IntersectionTests.rayEllipsoid(r,l);if(!Cesium.defined(h))return undefined;if(h.start>0){return Cesium.Ray.getPoint(r,h.start,t)}if(h.start==0){const c=n.oneOverRadii;const u=Cesium.Cartesian3.multiplyComponents(c,r.origin,a);const d=Cesium.Cartesian3.magnitudeSquared(u);if(d<1){return Cesium.Ray.getPoint(r,h.stop,t)}return Cesium.Ray.getPoint(r,1,t)}return undefined}pickPosition(e,t){if(this.enableFlatMode){return this.pickFlat(e,t)}else{return this.pickReal(e,t)}}rotate3D(e,t,i){i=Cesium.defaultValue(i,{});const s=Cesium.defaultValue(i.onlyVertical,false);const r=Cesium.defaultValue(i.onlyHorizontal,false);const n=Cesium.defaultValue(i.minimumPitch,-180);const o=Cesium.defaultValue(i.maximumPitch,180);const a=this._scene;var l=a.camera;var h=a.canvas;const c=l.direction;const u=Cesium.Cartesian3.cross(Cesium.Cartesian3.UNIT_Z,l.right,new Cesium.Cartesian3);const d=Cesium.Cartesian3.dot(u,c);let m=Math.sqrt(c.x*c.x+c.y*c.y);if(d<0)m=-m;const p=-Math.atan2(c.z,m);const f=this._maximumRotateRate;let _=(t.startPosition.x-t.endPosition.x)/h.clientWidth;let y=(t.startPosition.y-t.endPosition.y)/h.clientHeight;_=Math.min(_,this.maximumMovementRatio);y=Math.min(y,this.maximumMovementRatio);let C=f*_*Math.PI*2;let g=f*y*Math.PI;if(p-g>o){g=p-o}if(p-g<n){g=p-n}if(!s){l.rotate(Cesium.Cartesian3.UNIT_Z,-C)}if(!r){l.rotate(l.right,-g)}}spin3D(e,t){var i=this._scene;var s=i.camera;if(!Cesium.Matrix4.equals(s.transform,Cesium.Matrix4.IDENTITY)){this.rotate3D(e,t,{minimumPitch:this.lookViewMinimumPitch,maximumPitch:this.lookViewMaximumPitch});return}this.pan3D(e,t)}pan3D(e,t){const i=this._scene;const r=i.camera;const s=Cesium.Cartesian2.clone(t.startPosition,F);const n=Cesium.Cartesian2.clone(t.endPosition,N);let o,a;o=this.pickPosition(s,I);if(!Cesium.defined(o))return;this._lastPickPosition=Cesium.Cartesian3.fromElements(o.x,o.y,o.z,A);const l=r.getPickRay(n,O);a=M(Cesium.Cartesian3.magnitude(o),l,D);if(!Cesium.defined(a))return;o=r.worldToCameraCoordinates(o,o);a=r.worldToCameraCoordinates(a,a);if(!Cesium.defined(r.constrainedAxis)){Cesium.Cartesian3.normalize(o,o);Cesium.Cartesian3.normalize(a,a);const h=Cesium.Cartesian3.dot(o,a);const c=Cesium.Cartesian3.cross(o,a,L);if(h<1&&!Cesium.Cartesian3.equalsEpsilon(c,Cesium.Cartesian3.ZERO,Cesium.Math.EPSILON14)){const u=Math.acos(h);r.rotate(c,u)}}else{const d=r.constrainedAxis;const m=Cesium.Cartesian3.mostOrthogonalAxis(d,L);Cesium.Cartesian3.cross(m,d,m);Cesium.Cartesian3.normalize(m,m);const p=Cesium.Cartesian3.cross(d,m,R);const f=Cesium.Cartesian3.magnitude(o);const _=Cesium.Cartesian3.dot(d,o);const y=Math.acos(_/f);const C=Cesium.Cartesian3.multiplyByScalar(d,_,k);Cesium.Cartesian3.subtract(o,C,C);Cesium.Cartesian3.normalize(C,C);const g=Cesium.Cartesian3.magnitude(a);const v=Cesium.Cartesian3.dot(d,a);const w=Math.acos(v/g);const T=Cesium.Cartesian3.multiplyByScalar(d,v,z);Cesium.Cartesian3.subtract(a,T,T);Cesium.Cartesian3.normalize(T,T);let e=Math.acos(Cesium.Cartesian3.dot(C,m));if(Cesium.Cartesian3.dot(C,p)<0){e=Cesium.Math.TWO_PI-e}let t=Math.acos(Cesium.Cartesian3.dot(T,m));if(Cesium.Cartesian3.dot(T,p)<0){t=Cesium.Math.TWO_PI-t}const P=e-t;let i;if(Cesium.Cartesian3.equalsEpsilon(d,r.position,Cesium.Math.EPSILON2)){i=r.right}else{i=Cesium.Cartesian3.cross(d,r.position,L)}const b=Cesium.Cartesian3.cross(d,i,L);const x=Cesium.Cartesian3.dot(b,Cesium.Cartesian3.subtract(o,d,R));const E=Cesium.Cartesian3.dot(b,Cesium.Cartesian3.subtract(a,d,R));let s;if(x>0&&E>0){s=w-y}else if(x>0&&E<=0){if(Cesium.Cartesian3.dot(r.position,d)>0){s=-y-w}else{s=y+w}}else{s=y-w}r.rotateRight(P);r.rotateUp(s)}}zoom3D(e,t){if(Cesium.defined(t.distance)){t=t.distance}const i=this._scene;const s=i.camera;const r=i.canvas;let n;const o=Cesium.Matrix4.equals(s.transform,Cesium.Matrix4.IDENTITY);if(o){n=this.pickReal(e,V);if(n)this._lastPickPosition=n;if(this.enableFlatMode){if(n){const _=this.getEllipsoid();const y=Cesium.Cartographic.fromCartesian(n,_,G);this.flatModeHeight=y.height}else{n=this.pickFlat(e,V)}}}else{n=Cesium.Matrix4.getTranslation(s.transform,V)}if(!n)return;const a=Cesium.Cartesian3.subtract(n,s.positionWC,Z);Cesium.Cartesian3.normalize(a,a);const l=Cesium.Cartesian3.distance(s.positionWC,n);const h=this.minimumZoomDistance;const c=this.maximumZoomDistance;const u=l-h;let d=this._zoomFactor*u;d=Cesium.Math.clamp(d,this._minimumZoomRate,this._maximumZoomRate);const m=t.endPosition.y-t.startPosition.y;const p=Math.min(m/r.clientHeight,this.maximumMovementRatio);let f=d*p;if(l-f<this.minimumZoomDistance){f=l-this.minimumZoomDistance}if(l-f>this.maximumZoomDistance){f=l-this.maximumZoomDistance}if(o){Cesium.Cartesian3.multiplyByScalar(a,f,B);const C=Cesium.Cartesian3.add(B,s.positionWC,B);const g=w(i,s,U);s.setView({destination:C,orientation:g,endTransform:s.transform})}else s.zoomIn(f)}tilt3D(e,t){const i=this._scene;const s=i.camera;if(!Cesium.Matrix4.equals(s.transform,Cesium.Matrix4.IDENTITY)){return}if(Cesium.defined(t.angleAndHeight)){t=t.angleAndHeight}const r=i.canvas;const n=this.getEllipsoid();let o;if(1){if(Cesium.Cartesian2.equals(this._tiltCenterMousePosition,e)){o=this._tiltCenter}else{const h=j;h.x=r.width*.5;h.y=r.height*.5;o=this.pickPosition(h,this._tiltCenter);if(!Cesium.defined(o))o=this.pickPosition(e,this._tiltCenter);if(!o)o=this._tiltCenter;if(Cesium.defined(o))e.clone(this._tiltCenterMousePosition)}this._lastPickPosition=o}else{o=this._lastPickPosition}if(!Cesium.defined(o)){return}const a=Cesium.Transforms.eastNorthUpToFixedFrame(o,n,W);const l=Cesium.Matrix4.clone(s.transform,H);s._setTransform(a);this.rotate3D(e,t,{minimumPitch:this.minimumPitch,maximumPitch:this.maximumPitch});s._setTransform(l)}look3D(e,t,i){const s=this._scene;const r=s.camera;let n=Y;n.x=t.startPosition.x;n.y=0;let o=q;o.x=t.endPosition.x;o.y=0;let a=r.getPickRay(n,$);let l=r.getPickRay(o,X);let h=0;let c,u;if(r.frustum instanceof Cesium.OrthographicFrustum){c=a.origin;u=l.origin;Cesium.Cartesian3.add(r.direction,c,c);Cesium.Cartesian3.add(r.direction,u,u);Cesium.Cartesian3.subtract(c,r.position,c);Cesium.Cartesian3.subtract(u,r.position,u);Cesium.Cartesian3.normalize(c,c);Cesium.Cartesian3.normalize(u,u)}else{c=a.direction;u=l.direction}var d=Cesium.Cartesian3.dot(c,u);if(d<1){h=Math.acos(d)}h=t.startPosition.x>t.endPosition.x?-h:h;var m=this._horizontalRotationAxis;if(Cesium.defined(i)){r.look(i,-h)}else if(Cesium.defined(m)){r.look(m,-h)}else{r.lookLeft(h)}n.x=0;n.y=t.startPosition.y;o.x=0;o.y=t.endPosition.y;a=r.getPickRay(n,$);l=r.getPickRay(o,X);h=0;if(r.frustum instanceof Cesium.OrthographicFrustum){c=a.origin;u=l.origin;Cesium.Cartesian3.add(r.direction,c,c);Cesium.Cartesian3.add(r.direction,u,u);Cesium.Cartesian3.subtract(c,r.position,c);Cesium.Cartesian3.subtract(u,r.position,u);Cesium.Cartesian3.normalize(c,c);Cesium.Cartesian3.normalize(u,u)}else{c=a.direction;u=l.direction}d=Cesium.Cartesian3.dot(c,u);if(d<1){h=Math.acos(d)}h=t.startPosition.y>t.endPosition.y?-h:h;i=Cesium.defaultValue(i,m);if(Cesium.defined(i)){var p=r.direction;var f=Cesium.Cartesian3.negate(i,K);var _=Cesium.Cartesian3.equalsEpsilon(p,i,Cesium.Math.EPSILON2);var y=Cesium.Cartesian3.equalsEpsilon(p,f,Cesium.Math.EPSILON2);if(!_&&!y){d=Cesium.Cartesian3.dot(p,i);var C=Cesium.Math.acosClamped(d);if(h>0&&h>C){h=C-Cesium.Math.EPSILON4}d=Cesium.Cartesian3.dot(p,f);C=Cesium.Math.acosClamped(d);if(h<0&&-h>C){h=-C+Cesium.Math.EPSILON4}var g=Cesium.Cartesian3.cross(i,p,J);r.look(g,h)}else if(_&&h<0||y&&h>0){r.look(r.right,-h)}}else{r.lookUp(h)}}upDown(e,t){if(Cesium.defined(t.distance)){t=t.distance}const i=this._scene;const s=i.camera;const r=i.canvas;if(!Cesium.Matrix4.equals(s.transform,Cesium.Matrix4.IDENTITY)){return}let n;const o=Cesium.Matrix4.equals(s.transform,Cesium.Matrix4.IDENTITY);if(o){n=this.pickPosition(e,V)}else{n=Cesium.Matrix4.getTranslation(s.transform,V)}if(!n)return;const a=Q;s.positionWC.clone(a.origin);const l=a.direction;Cesium.Cartesian3.subtract(Cesium.Cartesian3.ZERO,s.positionWC,l);Cesium.Cartesian3.normalize(l,l);const h=this.minimumZoomDistance;const c=this.maximumZoomDistance;const u=Cesium.Cartesian3.subtract(n,s.positionWC,Z);Cesium.Cartesian3.normalize(u,u);const d=Cesium.Cartesian3.distance(s.positionWC,n);const m=d-h;let p=this._zoomFactor*m;p=Cesium.Math.clamp(p,this._minimumZoomRate,this._maximumZoomRate);const f=t.endPosition.y-t.startPosition.y;const _=Math.min(f/r.clientHeight,this.maximumMovementRatio);const y=p*_;s.move(l,-y);if(this.enableFlatMode){this.flatModeHeight+=y}}}e.CameraController=t;const g=[];const m=new Cesium.Ray;const p=new Cesium.Cartesian3;const f=new Cesium.Ellipsoid;const i=new Cesium.Interval;const c=new Cesium.Cartesian3;const u=new Cesium.Cartesian3;function _(e,t){if(e<0){return 0}var i=(1-t)*25;return Math.exp(-i*e)}function y(e){return Cesium.Cartesian2.equalsEpsilon(e.startPosition,e.endPosition,Cesium.Math.EPSILON14)}const C=.4;function v(e,t,i,s,r,n,o){var a=n[o];if(!Cesium.defined(a)){a=n[o]={startPosition:new Cesium.Cartesian2,endPosition:new Cesium.Cartesian2,motion:new Cesium.Cartesian2,active:false}}var l=e.getButtonPressTime(t,i);var h=e.getButtonReleaseTime(t,i);var c=l&&h&&(h.getTime()-l.getTime())/1e3;var u=new Date;var d=h&&(u.getTime()-h.getTime())/1e3;if(l&&h&&c<C){var m=_(d,s);if(!a.active){var p=e.getLastMovement(t,i);if(!Cesium.defined(p)||y(p)){return}a.motion.x=(p.endPosition.x-p.startPosition.x)*.5;a.motion.y=(p.endPosition.y-p.startPosition.y)*.5;a.startPosition=Cesium.Cartesian2.clone(p.startPosition,a.startPosition);a.endPosition=Cesium.Cartesian2.multiplyByScalar(a.motion,m,a.endPosition);a.endPosition=Cesium.Cartesian2.add(a.startPosition,a.endPosition,a.endPosition);a.active=true}else{a.startPosition=Cesium.Cartesian2.clone(a.endPosition,a.startPosition);a.endPosition=Cesium.Cartesian2.multiplyByScalar(a.motion,m,a.endPosition);a.endPosition=Cesium.Cartesian2.add(a.startPosition,a.endPosition,a.endPosition);a.motion=Cesium.Cartesian2.clone(Cesium.Cartesian2.ZERO,a.motion)}if(isNaN(a.endPosition.x)||isNaN(a.endPosition.y)||Cesium.Cartesian2.distance(a.startPosition,a.endPosition)<.5){a.active=false;return}if(!e.isButtonDown(t,i)){var f=e.getStartMousePosition(t,i);r.call(n,f,a)}}else{a.active=false}}function o(e,t){let i=0;if(!Cesium.Math.equalsEpsilon(Math.abs(e.z),1,Cesium.Math.EPSILON3)){i=Math.atan2(e.y,e.x)-Cesium.Math.PI_OVER_TWO}else{i=Math.atan2(t.y,t.x)-Cesium.Math.PI_OVER_TWO}return Cesium.Math.TWO_PI-Cesium.Math.zeroToTwoPi(i)}function a(e){return Cesium.Math.PI_OVER_TWO-Cesium.Math.acosClamped(e.z)}function l(e,t,i){let s=0;if(!Cesium.Math.equalsEpsilon(Math.abs(e.z),1,Cesium.Math.EPSILON3)){s=Math.atan2(-i.z,t.z);s=Cesium.Math.zeroToTwoPi(s+Cesium.Math.TWO_PI)}return s}const h=new Cesium.Matrix4;const d=new Cesium.Matrix4;function w(e,t,i){if(e.mode!==Cesium.SceneMode.MORPHING){const s=e.mapProjection.ellipsoid;const r=Cesium.Matrix4.clone(t.transform,h);const n=Cesium.Transforms.eastNorthUpToFixedFrame(t.positionWC,s,d);t._setTransform(n);if(!(i instanceof Cesium.HeadingPitchRoll)){i=new Cesium.HeadingPitchRoll}i.heading=o(t.direction,t.up);i.pitch=a(t.direction);i.roll=l(t.direction,t.up,t.right);t._setTransform(r);return i}return undefined}const n=new Cesium.BoundingSphere;function M(e,t,i){const s=n;s.radius=e;const r=Cesium.IntersectionTests.raySphere(t,s);if(!Cesium.defined(r))return undefined;if(r.start>0){return Cesium.Ray.getPoint(t,r.start,i)}if(r.start==0){return Cesium.Ray.getPoint(t,r.stop,i)}return undefined}const A=new Cesium.Cartesian3;const T=new Cesium.Ray;const P=new Cesium.Cartesian3;const b=new Cesium.Cartesian3;const x=new Cesium.Cartesian3;const E=new Cesium.HeadingPitchRoll;const S=new Cesium.HeadingPitchRoll;const I=Cesium.Cartesian4.clone(Cesium.Cartesian4.UNIT_W);const D=Cesium.Cartesian4.clone(Cesium.Cartesian4.UNIT_W);const O=new Cesium.Ray;const L=new Cesium.Cartesian3;const R=new Cesium.Cartesian3;const k=new Cesium.Cartesian3;const z=new Cesium.Cartesian3;const F=new Cesium.Cartesian2;const N=new Cesium.Cartesian2;const B=new Cesium.Cartesian3;const V=new Cesium.Cartesian3;const Z=new Cesium.Cartesian3;const G=new Cesium.Cartographic;const U=new Cesium.HeadingPitchRoll;const W=new Cesium.Matrix4;const H=new Cesium.Matrix4;const j=new Cesium.Cartesian2;const Y=new Cesium.Cartesian2;const q=new Cesium.Cartesian2;const $=new Cesium.Ray;const X=new Cesium.Ray;const K=new Cesium.Cartesian3;const J=new Cesium.Cartesian3;const Q=new Cesium.Ray;const s=new Cesium.Ray;const r=new Cesium.Cartesian3})(Cegore||(Cegore={}));var Cegore;(function(n){class t{constructor(){this._position=new n.Position;this._orientation=new n.HeadingPitchRoll}static applyProps(t,i,s){for(var r=0;r<i.length;++r){let e=s[i[r]];if(n.TypeCheck.isDefined(e))t[i[r]]=e}}applyProps(e){t.applyProps(this,t.RenderablePropList,e)}get id(){return this._czRenderable.id}set visible(e){this._czRenderable.show=e}get visible(){return this._czRenderable.show}get position(){return this._position}set position(e){this._position.set(e);this.applyPose()}get orientation(){return this._orientation}set orientation(e){this._orientation.set(e);this.applyPose()}applyPose(){let e=Cesium.Cartesian3.fromDegrees(this._position.lon,this._position.lat,this._position.altitude);let t=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(this._orientation.heading),Cesium.Math.toRadians(this._orientation.pitch),Cesium.Math.toRadians(this._orientation.roll));let i=Cesium.Transforms.headingPitchRollQuaternion(e,t);this._czRenderable.position=e;this._czRenderable.orientation=i}}t.RenderablePropList=["visible","position","orientation"];n.Renderable=t})(Cegore||(Cegore={}));var Cegore;(function(s){class e{constructor(e){this.mFactories=new s.HashMap;this.mDefaultFac=e}regFactory(e,t){this.mFactories.put(e,t)}unregFactory(e){this.mFactories.remove(e)}createProvider(e,t){e=s.TypeCheck.defaultValue(e,this.mDefaultFac);let i=this.mFactories.get(e);if(i)return i.createProvider(t);return}}s.ProviderCollection=e;class t{}t.TerrainProviders=new e("ZMapTerrain");t.ImageProviders=new e("ZMapImage");s.Providers=t})(Cegore||(Cegore={}));var Cegore;(function(s){class e{constructor(e){if(!s.TypeCheck.isObject(e)){throw"Invalid iamge info"}var t=this.createProvider(e);if(!s.TypeCheck.isDefined(t)){throw'Can not create image layer by type : "'+e.type+'"'}this._name=s.AutoNames.genName(e.name,"ImageLayer");this._type=e.type;this._provider=t;this._czLayer=new Cesium.ImageryLayer(t,{rectangle:s.Rectangle.toCZRectangle(e.rectangle),show:s.TypeCheck.defaultValue(e.visible,true),alpha:s.TypeCheck.defaultValue(e.alpha,1),brightness:s.TypeCheck.defaultValue(e.brightness,1)});this._czLayer.brightness=s.TypeCheck.defaultValue(e.brightness,1);this._czLayer["_ZMapLayer"]=this}get _czlayer(){return this._czLayer}get name(){return this._name}get type(){return this._type}set visible(e){this._czLayer.show=e}get visible(){return this._czLayer.show}set alpha(e){this._czLayer.alpha=e}get alpha(){return this._czLayer.alpha}set brightness(e){this._czLayer.brightness=e}get brightness(){return this._czLayer.brightness}get provider(){return this._provider}createProvider(e){let t={};for(var i in e){if(this.hasOwnProperty(i))continue;t[i]=e[i]}if(s.TypeCheck.isDefined(t.scheme)){if(t.scheme==="WebMercator"){t.tilingScheme=new Cesium.WebMercatorTilingScheme({ellipsoid:t.ellipsoid})}else{if(t.scheme.endsWith("level-0"))t.tilingScheme=new Cesium.GeographicTilingScheme({ellipsoid:t.ellipsoid});else t.tilingScheme=new Cesium.GeographicTilingScheme({ellipsoid:t.ellipsoid,numberOfLevelZeroTilesX:8,numberOfLevelZeroTilesY:4})}}return s.Providers.ImageProviders.createProvider(e.type,t)}}s.ImageLayer=e})(Cegore||(Cegore={}));var Cegore;(function(i){class e{constructor(e){this._layers=new i.HashMap;this._globe=e;this._czLayers=this._globe._czglobe.imageryLayers}get length(){return this._czLayers.length}add(e,t){if(!i.TypeCheck.isInstanceOf(e,i.ImageLayer)){e=new i.ImageLayer(e)}if(this._layers.exist(e.name)){throw"image layer named :"+e.name+" allready exist."}this._czLayers.add(e._czlayer,t);this._layers.put(e.name,e)}get(e){if(i.TypeCheck.isNumber(e)){var t=this._czLayers.get(e);if(t)return t._ZMapLayer}else if(i.TypeCheck.isString(e)){return this._layers.get(e)}else throw"id must be string or number"}remove(e){if(i.TypeCheck.isNumber(e)||i.TypeCheck.isString(e)){this.remove(this.get(e))}else if(i.TypeCheck.isInstanceOf(e,i.ImageLayer)){var t=e;this._czLayers.remove(t._czlayer);this._layers.remove(e.name)}else throw"id must be string or number or ImageLayer"}removeAll(){this._czLayers.removeAll();this._layers.removeAll()}clear(){this.removeAll()}}i.ImageLayerCollection=e})(Cegore||(Cegore={}));var Cegore;(function(t){class e{constructor(e){this._scene=e;this._czData=e._czdata;this._czGlobe=this._czData.globe;this._images=new t.ImageLayerCollection(this)}setTerrain(e){var t=this.createProvider(e);if(t==null){throw"Invalid terrain info"}this._czData.globe.terrainProvider=t}get _czglobe(){return this._czGlobe}get images(){return this._images}get baseColor(){return new t.Color(this._czGlobe.baseColor)}set baseColor(e){if(!t.TypeCheck.isInstanceOf(e,t.Color))e=new t.Color(e);this._czGlobe.baseColor=e.toCZColor()}get enableDepthTest(){return this._czGlobe.depthTestAgainstTerrain}set enableDepthTest(e){this._czGlobe.depthTestAgainstTerrain=e}get enableLighting(){return this._czGlobe.enableLighting}set enableLighting(e){this._czGlobe.enableLighting=e}get enableWaterEffect(){return this._czGlobe.showWaterEffect}set enableWaterEffect(e){this._czGlobe.showWaterEffect=e}get tileCacheSize(){return this._czGlobe.tileCacheSize}set tileCacheSize(e){this._czGlobe.tileCacheSize=e}get tileLoadProgress(){if(!t.TypeCheck.isDefined(this._tileLoadProgress)){this._tileLoadProgress=new t.Event;this._czGlobe.tileLoadProgressEvent.addEventListener(e=>{this._tileLoadProgress.fire(e)})}return this._tileLoadProgress}createProvider(e){return t.Providers.TerrainProviders.createProvider(e.type,e)}}t.Globe=e;(function(){const t=1.001;const i=new Cesium.Cartesian3;if(!Cesium.EllipsoidalOccluder.prototype.isScaledSpacePointVisibleOld){Cesium.EllipsoidalOccluder.prototype.isScaledSpacePointVisibleOld=Cesium.EllipsoidalOccluder.prototype.isScaledSpacePointVisible;Cesium.EllipsoidalOccluder.prototype.isScaledSpacePointVisible=function(e){Cesium.Cartesian3.multiplyByScalar(e,t,i);return this.isScaledSpacePointVisibleOld(i)}}})()})(Cegore||(Cegore={}));var Cegore;(function(e){class t extends e.Renderable{constructor(){super()}applyProps(e){super.applyProps(e)}get name(){return this._name}set name(e){this._name=e}get parent(){return this._parent}get children(){return e.ArrayUtil.EmptyArray}get isLeaf(){return true}onAdded(e){this._parent=e}onRemoved(){this._parent=null}onAttachRoot(){this._parent.models._onAddModel(this)}onDetachRoot(){this._parent.models._onRemoveModel(this)}}t.ModelPropList=["name"];e.Model=t})(Cegore||(Cegore={}));var Cegore;(function(r){class n{constructor(e){this._children=[];e=r.TypeCheck.defaultValue(e,{});this._name=r.TypeCheck.defaultValue(e.name,"未命名")}get models(){return this._models}get name(){return this._name}get parent(){return this._parent}get children(){return this._children}get isLeaf(){return false}add(e){if(e.parent===this)return;if(e.parent)e.parent.remove(e);this._children.push(e);e.onAdded(this);if(this._models)e.onAttachRoot()}remove(e){if(e.parent!==this)return;let t=this._children.indexOf(e);this._children.splice(t);e.onDetachRoot();e.onRemoved()}removeAll(){for(var e=0;e<this._children.length;++e){this._children[e].onDetachRoot();this._children[e].onRemoved()}this._children=[]}setModelCollection(e){this._models=e}onAdded(e){this._parent=e;this._models=e._models;if(this._models)this.onAttachRoot()}onRemoved(){if(this._models)this.onDetachRoot();this._parent=null;this._models=null}onAttachRoot(){for(var e=0;e<this._children.length;++e){this._children[e].onAttachRoot()}}onDetachRoot(){for(var e=0;e<this._children.length;++e){this._children[e].onDetachRoot()}}static getAllModels(t,i){for(var s=0;s<t.children.length;++s){let e=t.children[s];if(r.TypeCheck.isInstanceOf(e,n))n.getAllModels(e,i);else i.push(e)}return i}}r.ModelGroup=n})(Cegore||(Cegore={}));var Cegore;(function(t){class e{constructor(e){this._models=new t.HashMap;this._czData=e._czdata;this._DataSource=new Cesium.CustomDataSource("ModelCollection");this._czData.viewer.dataSources.add(this._DataSource);this._entities=this._DataSource.entities;this._root=new t.ModelGroup({name:"根节点"});this._root.setModelCollection(this)}get root(){return this._root}add(e){this._root.add(e)}remove(e){this._root.remove(e)}_onAddModel(e){this._models.put(e.id,e);this._entities.add(e._czRenderable)}_onRemoveModel(e){this._models.remove(e.id);this._entities.remove(e._czRenderable)}}t.ModelCollection=e})(Cegore||(Cegore={}));var Cegore;(function(t){class i extends t.Model{constructor(e){super();this._enablePcik=true;this._color=new t.Color(t.Color.WHITE);this._outlineColor=new t.Color(t.Color.BLACK);this._outlineSize=0;this._czEntity=new Cesium.Entity;this._czModel=new Cesium.ModelGraphics;this._czEntity.model=this._czModel;this.applyProps(e)}applyProps(e){super.applyProps(e);t.Renderable.applyProps(this,i.GltfModelPropList,e)}get _czRenderable(){return this._czEntity}get type(){return"GltfModel"}get uri(){return this._uri}set uri(e){this._uri=e;this._czModel.uri=e}get enablePick(){return this._enablePcik}set enablePick(e){this._enablePcik=e;this._czModel.allowPicking=e}get minPixelSize(){return this._minPixelSize}set minPixelSize(e){this._minPixelSize=e;this._czModel.minimumPixelSize=e}get color(){return this._color}set color(e){this._color.set(e);this._czModel.color=this._color.toCZColor()}get outlineColor(){return this._outlineColor}set outlineColor(e){this._outlineColor.set(e);this._czModel.silhouetteColor=this._outlineColor.toCZColor()}get outlineSize(){return this._outlineSize}set outlineSize(e){this._outlineSize=e;this._czModel.silhouetteSize=e}}i.GltfModelPropList=["uri","enablePick","minPixelSize","color","outlineColor","outlineSize"];t.GltfModel=i})(Cegore||(Cegore={}));var Cegore;(function(i){class t extends i.Model{constructor(){super();this._fill=true;this._outline=false;this._outlineColor=new i.Color(i.Color.BLACK);this._outlineWidth=1;this._shadows=i.ShadowMode.DISABLED}applyProps(e){super.applyProps(e);i.Renderable.applyProps(this,t.ShapePropList,e)}get fill(){return this._fill}set fill(e){this._fill=e;this._czShape.fill=e}get material(){return this._material}set material(e){let t=e;if(i.TypeCheck.isInstanceOf(t,i.Material))this._material=t;else if(i.TypeCheck.isInstanceOf(t,i.Color))this._material=new i.ColorMaterial(t);else if(i.TypeCheck.isString(t)||i.TypeCheck.isInstanceOf(t,HTMLImageElement)||i.TypeCheck.isInstanceOf(t,HTMLCanvasElement)||i.TypeCheck.isInstanceOf(t,HTMLVideoElement))this._material=new i.ImageMaterial({image:t});else if(i.TypeCheck.isObject(t))this._material=new i.ImageMaterial(t);this._czShape.material=this._material.czmat}get outline(){return this._outline}set outline(e){this._outline=e;this._czShape.outline=e}get outlineColor(){return new i.Color(this._czShape.outlineColor)}set outlineColor(e){this._outlineColor.set(e);this._czShape.outlineColor=this._outlineColor.toCZColor()}get outlineWidth(){return this._czShape.outlineWidth}set outlineWidth(e){this._outlineWidth=e;this._czShape.outlineWidth=e}get shadows(){return this._czShape.shadows}set shadows(e){this._shadows=e;this._czShape.shadows=e}get displayDistance(){return this._displayDistance}set displayDistance(e){this._displayDistance=e;this._czShape.distanceDisplayCondition=e}}t.ShapePropList=["material","fill","outline","outlineColor","outlineWidth","shadows","displayDistance"];i.Shape=t})(Cegore||(Cegore={}));var Cegore;(function(t){class i extends t.Shape{constructor(e){super()}applyProps(e){super.applyProps(e);t.Renderable.applyProps(this,i.ShapeExtrudedPropList,e)}get height(){return this._height}set height(e){this._height=e;this._czShape.height=e}get extrudedHeight(){return this._extrudedHeight}set extrudedHeight(e){this._extrudedHeight=e;this._czShape.extrudedHeight=e}get rotation(){return this._rotation}set rotation(e){this._rotation=e;this._czShape.rotation=t.GeoMath.toRadian(e)}}i.ShapeExtrudedPropList=["height","extrudedHeight","rotation"];t.ShapeExtruded=i})(Cegore||(Cegore={}));var Cegore;(function(t){class i extends t.Shape{constructor(e){super();this._dimensions=new t.Vector3;this._czEntity=new Cesium.Entity;this._czBox=new Cesium.BoxGraphics;this._czEntity.box=this._czBox;this.applyProps(e)}applyProps(e){super.applyProps(e);t.Renderable.applyProps(this,i.BoxPropList,e)}get _czRenderable(){return this._czEntity}get _czShape(){return this._czBox}get type(){return"BoxModel"}get dimensions(){return this._dimensions}set dimensions(e){this._dimensions.set(e);this._czBox.dimensions=this._dimensions._asCzVector3()}}i.BoxPropList=["dimensions"];t.BoxModel=i})(Cegore||(Cegore={}));var Cegore;(function(t){class i extends t.Shape{constructor(e){super();this._czEntity=new Cesium.Entity;this._czCylinder=new Cesium.CylinderGraphics;this._czEntity.cylinder=this._czCylinder;this.applyProps(e)}applyProps(e){super.applyProps(e);t.Renderable.applyProps(this,i.CylinderPropList,e)}get _czRenderable(){return this._czEntity}get _czShape(){return this._czCylinder}get type(){return"CylinderModel"}get length(){return this._length}set length(e){this._length=e;this._czCylinder.length=e}get topRadius(){return this._topRadius}set topRadius(e){this._topRadius=e;this._czCylinder.topRadius=e}get bottomRadius(){return this._bottomRadius}set bottomRadius(e){this._bottomRadius=e;this._czCylinder.bottomRadius=e}get slices(){return this._slices}set slices(e){this._slices=e;this._czCylinder.slices=e}get verticalLines(){return this._verticalLines}set verticalLines(e){this._verticalLines=e;this._czCylinder.numberOfVerticalLines=e}}i.CylinderPropList=["length","topRadius","bottomRadius","slices","verticalLines"];t.CylinderModel=i})(Cegore||(Cegore={}));var Cegore;(function(t){class i extends t.ShapeExtruded{constructor(e){super();this._czEntity=new Cesium.Entity;this._czEllipse=new Cesium.EllipseGraphics;this._czEntity.ellipse=this._czEllipse;this.applyProps(e)}applyProps(e){super.applyProps(e);t.Renderable.applyProps(this,i.EllipsePropList,e)}get _czRenderable(){return this._czEntity}get _czShape(){return this._czEllipse}get type(){return"EllipseModel"}get semiMajorAxis(){return this._semiMajorAxis}set semiMajorAxis(e){this._semiMajorAxis=e;this._czEllipse.semiMajorAxis=e}get semiMinorAxis(){return this._semiMinorAxis}set semiMinorAxis(e){this._semiMinorAxis=e;this._czEllipse.semiMinorAxis=e}get slices(){return this._slices}set slices(e){this._slices=e;this._czEllipse.granularity=Math.PI/4/e}get verticalLines(){return this._verticalLines}set verticalLines(e){this._verticalLines=e;this._czEllipse.numberOfVerticalLines=e}}i.EllipsePropList=["semiMajorAxis","semiMinorAxis","slices","verticalLines"];t.EllipseModel=i})(Cegore||(Cegore={}));var Cegore;(function(t){class i extends t.Shape{constructor(e){super();this._czEntity=new Cesium.Entity;this._czEllipsoid=new Cesium.EllipsoidGraphics;this._czEntity.ellipsoid=this._czEllipsoid;this.applyProps(e)}applyProps(e){super.applyProps(e);t.Renderable.applyProps(this,i.EllipsoidPropList,e)}get _czRenderable(){return this._czEntity}get _czShape(){return this._czEllipsoid}get type(){return"EllipsoidModel"}get semiMajorAxis(){return this._semiMajorAxis}set semiMajorAxis(e){this._semiMajorAxis=e;this._czEllipsoid.semiMajorAxis=e}get semiMinorAxis(){return this._semiMinorAxis}set semiMinorAxis(e){this._semiMinorAxis=e;this._czEllipsoid.semiMinorAxis=e}get height(){return this._height}set height(e){this._height=e;this._czEllipsoid.height=e}get extrudedHeight(){return this._extrudedHeight}set extrudedHeight(e){this._extrudedHeight=e;this._czEllipsoid.extrudedHeight=e}get rotation(){return this._rotation}set rotation(e){this._rotation=e;this._czEllipsoid.rotation=t.GeoMath.toRadian(e)}get slices(){return this._slices}set slices(e){this._slices=e;this._czEllipsoid.granularity=Math.PI/4/e}get verticalLines(){return this._verticalLines}set verticalLines(e){this._verticalLines=e;this._czEllipsoid.numberOfVerticalLines=e}}i.EllipsoidPropList=["semiMajorAxis","semiMinorAxis","height","extrudedHeight","slices","rotation","verticalLines"];t.EllipsoidModel=i})(Cegore||(Cegore={}));var Cegore;(function(r){let i;(function(e){e[e["NONE"]=0]="NONE";e[e["GLOW"]=1]="GLOW";e[e["OUTLINE"]=2]="OUTLINE";e[e["DASH"]=3]="DASH";e[e["ARROW"]=4]="ARROW"})(i=r.PolylineStyle||(r.PolylineStyle={}));class t extends r.Model{constructor(e){super();this._dynamic=false;this._color=new r.Color(r.Color.WHITE);this._style=i.NONE;this._outlineColor=new r.Color(r.Color.BLACK);this._outlineWidth=1;this._shadows=r.ShadowMode.DISABLED;this._czEntity=new Cesium.Entity;this._czPolyline=new Cesium.PolylineGraphics;this._czEntity.polyline=this._czPolyline;this._dynamic=r.TypeCheck.defaultValue(e.dynamic,false);this.applyProps(e)}applyProps(e){super.applyProps(e);r.Renderable.applyProps(this,t.PolylinePropList,e)}get _czRenderable(){return this._czEntity}get _czShape(){return this._czPolyline}get type(){return"PolylineModel"}get positions(){return this._positions}set positions(e){this._positions=[];this._czPositions=[];for(var t=0;t<e.length;++t){var i=new r.Position(e[t]);this._positions.push(i);this._czPositions.push(Cesium.Cartesian3.fromDegrees(i.lon,i.lat,i.altitude))}var s=this._czPositions;if(this._dynamic&&!r.TypeCheck.isInstanceOf(this._czShape.positions,Cesium.CallbackProperty))this._czShape.positions=new Cesium.CallbackProperty(function(e,t){return s},false);else this._czShape.positions=s}get followSurface(){return this._followSurface}set followSurface(e){this._followSurface=e;this._czShape.followSuface=e}get color(){return this._color}set color(e){this._color.set(e);if(this._style==i.NONE)this._czShape.material=e.toCZColor();else this._czShape.material.color=e.toCZColor()}get color2(){return this._color2}set color2(e){if(!this._color2){this._color2=new r.Color(r.Color.WHITE)}this._color2.set(e);this._czShape.depthFailMaterial=e.toCZColor()}get width(){return this._width}set width(e){this._width=e;this._czShape.width=e}get style(){return this._style}set style(e){if(this._style==e)return;this._style=e;var t=this._color.toCZColor();switch(e){case i.GLOW:this._czShape.material=new Cesium.PolylineGlowMaterialProperty({color:t,glowPower:this._glow});break;case i.DASH:this._czShape.material=new Cesium.PolylineDashMaterialProperty({color:t});break;case i.ARROW:this._czShape.material=new Cesium.PolylineArrowMaterialProperty(t);break;case i.OUTLINE:this._czShape.material=new Cesium.PolylineOutlineMaterialProperty({color:t,outlineWidth:this._outlineWidth,outlineColor:this._outlineColor.toCZColor()});break;case i.NONE:default:this._czShape.material=this._color.toCZColor();break}}get glow(){return this._glow}set glow(e){if(this._style==i.GLOW){this._czShape.material.glowPower=e}}get outlineColor(){return this._outlineColor}set outlineColor(e){this._outlineColor.set(e);if(this._style==i.OUTLINE){this._czShape.material.outlineColor=this._outlineColor.toCZColor()}}get outlineWidth(){return this._outlineWidth}set outlineWidth(e){this._outlineWidth=e;if(this._style==i.OUTLINE)this._czShape.material.outlineWidth=e}get shadows(){return this._shadows}set shadows(e){this._shadows=e;this._czShape.shadows=e}get displayDistance(){return this._displayDistance}set displayDistance(e){this._displayDistance=e;this._czShape.distanceDisplayCondition=e}}t.PolylinePropList=["positions","followSurface","width","style","color","color2","glow","outlineWidth","outlineColor","shadows","displayDistance"];r.PolylineModel=t})(Cegore||(Cegore={}));var Cegore;(function(c){class e{}c.PolygonHierarchy=e;class t extends c.ShapeExtruded{constructor(e){super();this._dynamic=false;this._usePositionHeight=false;this._closeTop=true;this._closeBottom=true;this._czEntity=new Cesium.Entity;this._czPolygon=new Cesium.PolygonGraphics;this._czEntity.polygon=this._czPolygon;this._dynamic=c.TypeCheck.defaultValue(e.dynamic,false);this.applyProps(e)}applyProps(e){super.applyProps(e);c.Renderable.applyProps(this,t.PolygonPropList,e)}get _czRenderable(){return this._czEntity}get _czShape(){return this._czPolygon}get type(){return"PolygonModel"}get positions(){return this._positions}set positions(e){this._positions=[];var t,i=[];for(var s=0;s<e.length;++s){var r=e[s];var n=[],o=[];for(var a=0;a<r.length;++a){var l=new c.Position(r[a]);n.push(l);o.push(Cesium.Cartesian3.fromDegrees(l.lon,l.lat,l.altitude))}this._positions(n);if(s==0)t=o;else i.push(new Cesium.PolygonHierarchy(o))}this._czPositions=new Cesium.PolygonHierarchy(t,i);var h=this._czPositions;if(this._dynamic&&!c.TypeCheck.isInstanceOf(this._czShape.positions,Cesium.CallbackProperty))this._czShape.positions=new Cesium.CallbackProperty(function(e,t){return h},false);else this._czShape.positions=h}get usePositionHeight(){return this._usePositionHeight}set usePositionHeight(e){this._usePositionHeight=e;this._czShape.perPositionHeight=e}get closeTop(){return this._closeTop}set closeTop(e){this._closeTop=e;this._czShape.closeTop=e}get closeBottom(){return this._closeBottom}set closeBottom(e){this._closeBottom=e;this._czShape.closeBottom=e}}t.PolygonPropList=["positions","usePositionHeight","closeTop","closeBottom"];c.PolygonModel=t})(Cegore||(Cegore={}));var Cegore;(function(e){class t extends e.Renderable{}e.PrimitiveModel=t})(Cegore||(Cegore={}));var Cegore;(function(n){class e extends n.Renderable{constructor(e){super();this._layer="";this.mAutoOffset=true;if(!n.TypeCheck.isDefined(e.text)&&!n.TypeCheck.isDefined(e.icon))throw"need options.text or options.icon";this._name=n.AutoNames.genName(e.name,"Label");this._layer=n.TypeCheck.defaultValue(e.layer,"");this._events=new n.EventHandle(e.labelevent);this._czEntity=new Cesium.Entity({name:this._layer+" "+this._name});this._czEntity._zMapRenderable=this;this.setText(e.text);this.setIcon(e.icon);super.applyProps({position:e.pos,visible:e.visible})}get _czRenderable(){return this._czEntity}get type(){return"Label"}get name(){return this._name}get layer(){return this._layer}get text(){if(n.TypeCheck.isDefined(this._czText))return this._czText.text}set text(e){this.setText({title:e})}get icon(){if(n.TypeCheck.isDefined(this._czIcon))return this._czIcon.image.src}set icon(e){this.setIcon({img:e})}get events(){return this._events}_applyProp(e,t,i,s){if(!n.TypeCheck.isDefined(e))return;let r;switch(s){case"Cartesian2":r=new Cesium.Cartesian2(e[0],e[1]);break;case"Color":r=Cesium.Color.fromCssColorString(e);break;default:r=e}t[i]=r}_applyTextProp(e,t,i){this._applyProp(e,this._czText,t,i)}_applyIconProp(e,t,i){this._applyProp(e,this._czIcon,t,i)}setText(i){if(!n.TypeCheck.isDefined(i))return;if(!n.TypeCheck.isDefined(this._czText)){this._czText=new Cesium.LabelGraphics;this._czEntity.label=this._czText}if(n.TypeCheck.isDefined(i.font)||n.TypeCheck.isDefined(i.size)){let e=n.TypeCheck.defaultValue(i.font,"sans-serif");let t=n.TypeCheck.defaultValue(i.size,"10");this._czText.font=t+"px "+e}this._applyTextProp(i.title,"text");this._applyTextProp(i.color,"fillColor","Color");if(n.TypeCheck.isDefined(i.border)){this._applyTextProp(i.border.color,"outlineColor","Color");this._applyTextProp(i.border.width,"outlineWidth")}if(n.TypeCheck.isDefined(i.unit)){this._applyTextProp(i.unit.offset,"pixelOffset","Cartesian2");if(n.TypeCheck.isDefined(i.unit.offset))this.mAutoOffset=false}}setIcon(e){if(!n.TypeCheck.isDefined(e))return;if(!n.TypeCheck.isDefined(this._czIcon)){this._czIcon=new Cesium.BillboardGraphics;this._czEntity.billboard=this._czIcon}let t;if(n.TypeCheck.isString(e.img)){t=e.img}else if(n.TypeCheck.isArray(e.img)&&e.img.length>0){t=e.img[0]}if(n.TypeCheck.isDefined(t)){let i=this;let s=new Image;s.src=t;s.onload=function(){i._czIcon.image=s;if(i.mAutoOffset&&n.TypeCheck.isDefined(i._czText)){let e=i._czIcon.scale?i._czIcon.scale.getValue():1;let t=s.height*e;i._czText.pixelOffset=new Cesium.Cartesian2(0,-t)}}}this._applyIconProp(e.scale,"scale");this._applyIconProp(e.color,"color","Color");if(n.TypeCheck.isDefined(e.unit)){this._applyIconProp(e.unit.offset,"pixelOffset","Cartesian2")}}}n.Label=e})(Cegore||(Cegore={}));var Cegore;(function(a){class e{constructor(e){this._layers=new a.HashMap(function(){return new a.HashMap});this.mLabelEvent=new a.EventHandle;this._scene=e;this._czData=e._czdata;this._czDataSource=new Cesium.CustomDataSource("LabelCollection");this._czData.viewer.dataSources.add(this._czDataSource);this._czEntities=this._czDataSource.entities;var t=this;this.mCZHandle=new Cesium.ScreenSpaceEventHandler(this._czData.scene.canvas);this.mCZHandle.setInputAction(e=>{this.onLabelMoveEvent(e)},Cesium.ScreenSpaceEventType.MOUSE_MOVE);this.mCZHandle.setInputAction(e=>{this.onLabelClickEvent(e)},Cesium.ScreenSpaceEventType.LEFT_CLICK)}onLabelMoveEvent(e){}onLabelClickEvent(e){var t=this.pick(e.position);if(!a.TypeCheck.isDefined(t))return;t.events.fire("onclick",t,e.position);this.mLabelEvent.fire("onclick",t,e.position)}_getOrCreateLayer(e){return this._layers.getOrCreate(e,null)}_getLayer(e){return this._layers.get(e)}get events(){return this.mLabelEvent}add(e){this.remove(e);if(!a.TypeCheck.isInstanceOf(e,a.Label)){e=new a.Label(e)}this._getOrCreateLayer(e.layer).put(e.name,e);this._czEntities.add(e._czRenderable);return e}get(e,t){t=a.TypeCheck.defaultValue(t,"");var i=this._getLayer(t);if(!a.TypeCheck.isDefined(i))return;return i.get(e)}pick(e,t){var i;if(a.TypeCheck.isArray(e)){var s=e;i=new Cesium.Cartesian2(s[0],s[1])}else if(e instanceof Cesium.Cartesian2){i=e}else if(a.TypeCheck.isObject(e)){var r=e;i=new Cesium.Cartesian2(r.x,r.y)}else{i=new Cesium.Cartesian2(e,t)}var n=this._czData.scene.pick(i);if(a.TypeCheck.isDefined(n)){var o=a.TypeCheck.defaultValue(n.id,n.primitive.id);if(o instanceof Cesium.Entity&&o["_zMapRenderable"]instanceof a.Label){return o["_zMapRenderable"]}}}remove(e,t){let i;if(a.TypeCheck.isString(e)){i=this.get(e,t)}else if(a.TypeCheck.isInstanceOf(e,a.Label)){i=e}else if(a.TypeCheck.isObject(e)){i=this.get(e.name,e.layer)}else{throw"invaild param!"}if(!a.TypeCheck.isInstanceOf(i,a.Label)){return}var s=i._czRenderable;this._czEntities.remove(s);var r=this._getLayer(i.layer);if(a.TypeCheck.isDefined(r)){r.remove(i.name)}}removeLayer(e){var t=this._getLayer(e);if(!a.TypeCheck.isDefined(t))return;var i=t.keys();for(var s=0;s<i.length;++s){var r=t.get(i[s]);this._czEntities.remove(r)}this._layers.remove(e)}removeAll(){this._czEntities.removeAll();this._layers.clear()}clear(){this.removeAll()}}a.LabelCollection=e})(Cegore||(Cegore={}));var Cegore;(function(a){let e;(function(e){e[e["COLUMBUS_VIEW"]=1]="COLUMBUS_VIEW";e[e["MORPHING"]=0]="MORPHING";e[e["SCENE2D"]=2]="SCENE2D";e[e["SCENE3D"]=3]="SCENE3D"})(e=a.SceneMode||(a.SceneMode={}));let t;(function(e){e[e["DISABLED"]=0]="DISABLED";e[e["ENABLED"]=1]="ENABLED";e[e["CAST_ONLY"]=2]="CAST_ONLY";e[e["RECEIVE_ONLY"]=3]="RECEIVE_ONLY"})(t=a.ShadowMode||(a.ShadowMode={}));class l{constructor(e){this._isUnderWater=false;this._viewer=e;this._czData=e._czdata;this._czScene=this._czData.scene;this._globe=new a.Globe(this);this._labels=new a.LabelCollection(this);this._models=new a.ModelCollection(this)}get _czdata(){return this._czData}get mode(){return this._czScene.mode}set mode(e){this._czScene.mode=e}get globe(){return this._globe}get models(){return this._models}get labels(){return this._labels}get enableFog(){return this._czScene.fog.enabled}set enableFog(e){this._czScene.fog.enabled=e}get fogDensity(){return this._czScene.fog.density}set fogDensity(e){this._czScene.fog.density=e}get enableFXAA(){return this._czScene.fxaa}set enableFXAA(e){this._czScene.fxaa=e}get terrainScale(){return this._czScene.terrainExaggeration}set terrainScale(e){this._czScene.terrainExaggeration=e}get preRender(){if(!a.TypeCheck.isDefined(this._preRender)){this._preRender=new a.Event;this._czScene.preRender.addEventListener((e,t)=>{this._preRender.fire(Cesium.JulianDate.toDate(t))})}return this._preRender}get postRender(){if(!a.TypeCheck.isDefined(this._poseRender)){this._poseRender=new a.Event;this._czScene.poseRender.addEventListener((e,t)=>{this._poseRender.fire(Cesium.JulianDate.toDate(t))})}return this._poseRender}get underWater(){return this._isUnderWater}set underWater(e){if(!a.TypeCheck.isDefined(this._UnderWaterMaterial)){this._UnderWaterMaterial=new Cesium.Material({fabric:{type:"GlobeFog",uniforms:{fogColor:Cesium.Color.fromBytes(44,59,103)},source:l._GlobeFog},translucent:function(e){return false}})}if(e){this._czScene.globe.material=this._UnderWaterMaterial;var t=Cesium._shaders.GlobeFS;var i=t.indexOf("czm_material material = czm_getMaterial(materialInput);\n");t=t.substr(0,i)+"materialInput.positionToEyeEC = v_positionEC;\n"+t.substr(i);this._czScene.globe._surfaceShaderSet.baseFragmentShaderSource.sources[1]=t}else{this._czScene.globe.material=undefined}this.enableFog=!e;this._isUnderWater=e}pick(e,t){let i=l.asCartesian2(e,t);var s=this._czScene.pick(i);if(!a.TypeCheck.isDefined(s))return undefined;var r=a.TypeCheck.defaultValue(s.id,s.primitive.id);if(r instanceof Cesium.Entity&&r["_zMapRenderable"]instanceof a.Renderable){return r["_zMapRenderable"]}return undefined}pickMulti(e,t,i){let s=[];let r=l.asCartesian2(e,t);let n=this._czScene.pick(r);if(!a.TypeCheck.isArray(n))return s;for(let t=0;t<n.length;++t){let e=n[t];var o=a.TypeCheck.defaultValue(n.id,n.primitive.id);if(o instanceof Cesium.Entity&&o["_zMapRenderable"]instanceof a.Renderable){s.push(o["_zMapRenderable"])}}return s}pickPosition(e,t){let i=l.asCartesian2(e,t);let s=this._czScene.pickPosition(i);let r=Cesium.Cartographic.fromCartesian(s);return new a.Position(r)}calcDistance(e){return a.GeoMath.surfaceDistance(e,this._czData.ellipsoid.x)}calcArea(e){return a.GeoMath.surfaceArea(e,this._czData.ellipsoid.x)}static asCartesian2(e,t){if(a.TypeCheck.isInstanceOf(e,Cesium.Cartesian2))return e;let i,s;switch(a.TypeCheck.typeOf(e)){case"number":if(a.TypeCheck.isNumber(t)){i=e;s=t}break;case"array":i=a.StringUtil.parseFloat(e[0]);s=a.StringUtil.parseFloat(e[1]);break;case"object":i=a.StringUtil.parseFloat(e.x);s=a.StringUtil.parseFloat(e.y);break}if(!a.TypeCheck.isDefined(i)||!a.TypeCheck.isDefined(s)||isNaN(i)||isNaN(s)){throw"error params!"}return new Cesium.Cartesian2(i,s)}}l._GlobeFog="        uniform vec4 fogColor;\n        czm_material czm_getMaterial(czm_materialInput materialInput)\n        {\n            czm_material material = czm_getDefaultMaterial(materialInput);\n            float distanceToCamera = length(materialInput.positionToEyeEC);\n            float scalar = distanceToCamera * 0.00005;\n            float fog = 1.0 - exp(-(scalar * scalar));\n            material.diffuse = fogColor.rgb;\n            material.alpha = fog;\n            return material;\n        }\n";a.Scene=l})(Cegore||(Cegore={}));var Cegore;(function(h){class c{constructor(e){this.mViewer=e}get viewer(){return this.mViewer}get scene(){return this.mViewer.scene}get camera(){return this.mViewer.camera}get globe(){return this.mViewer.scene.globe}get ellipsoid(){return this.mViewer.scene.globe.ellipsoid}}h.CesiumData=c;class n{constructor(e,t){if(!t)t={};var i=t.czops||{};i.shouldAnimate=t.shouldAnimate?true:false;i.animation=t.animation?true:false;i.baseLayerPicker=t.baseLayerPicker?true:false;i.homeButton=t.homeButton?true:false;i.geocoder=t.geocoder?true:false;i.navigationHelpButton=t.navigationHelpButton?true:false;i.imageryProvider=t.imageryProvider?true:false;i.timeline=t.timeline?true:false;i.sceneModePicker=t.sceneModePicker?true:false;i.selectionIndicator=t.selectionIndicator?true:false;i.infoBox=t.infoBox?true:false;i.fullscreenButton=h.TypeCheck.defaultValue(t.fullscreenButton,true);i.fullscreenElement=h.TypeCheck.defaultValue(t.fullscreenElement,e);var s=i.contextOptions||{};var r=s.webgl||{};r.preserveDrawingBuffer=h.TypeCheck.defaultValue(r.preserveDrawingBuffer,true);s.webgl=r;i.contextOptions=s;const n=new Cesium.Viewer(e,i);const o=n.cesiumWidget.creditContainer;o.style.display="none";n.scene.highDynamicRange=h.TypeCheck.defaultValue(t.highDynamicRange,false);this._czData=new c(n);this._camera=new h.Camera(this);this._clock=new h.Clock(this);this._scene=new h.Scene(this);this._controller=new h.CameraController(n.scene);this._controller.enableFlatMode=false;this._controller.enableInputs=false;const a=n.scene.screenSpaceCameraController;a.minimumCollisionTerrainHeight=15e4;a.tiltEventTypes=[Cesium.CameraEventType.RIGHT_DRAG,Cesium.CameraEventType.PINCH];a.zoomEventTypes=[Cesium.CameraEventType.WHEEL,Cesium.CameraEventType.PINCH,{eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL}];this._cesium_controller=a;if(!window["USE_CESIUM_CAMERA_CONTROLLER"]){this._cesium_controller.enableInputs=false;this._controller.enableInputs=true;n.scene["_screenSpaceCameraController"]=this._controller}if(h.TypeCheck.isObject(t.terrain)){this.globe.setTerrain(t.terrain)}if(h.TypeCheck.isArray(t.images)){for(var l=0;l<t.images.length;++l){this.globe.images.add(t.images[l])}}if(h.TypeCheck.isDefined(t.currentTime)){this._clock.currentTime=t.currentTime}}static get version(){return"1.1.0"}get _czdata(){return this._czData}get camera(){return this._camera}get scene(){return this._scene}get models(){return this._scene.models}get labels(){return this._scene.labels}get globe(){return this._scene.globe}get images(){return this.globe.images}get clock(){return this._clock}get canvas(){return this._czData.viewer.canvas}get cameraController(){return this._controller}static getBaseUrlFromScript(){var e=document.getElementsByTagName("script");for(var t=0,i=e.length;t<i;++t){var s=e[t].getAttribute("src");var r=n.cesiumScriptRegex.exec(s);if(r!==null){return r[1]}}return undefined}}n.cesiumScriptRegex=/((?:.*\/)|^)depmain[\w-]*\.js(?:\W|$)/i;h.Viewer=n;CESIUM_BASE_URL=n.getBaseUrlFromScript()})(Cegore||(Cegore={}));var Cegore;(function(e){class t{constructor(){this._readyPromise=Cesium.when.resolve(true);this._tileWidth=256;this._tileHeight=256;this._minimumLevel=0;this._maximumLevel=18;this._errorEvent=new Cesium.Event;this._hasAlphaChannel=false}get ready(){return this._ready}get readyPromise(){return this._readyPromise}get rectangle(){if(!e.TypeCheck.isDefined(this._rectangle))this._rectangle=Cesium.Rectangle.MAX_VALUE;return this._rectangle}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get minimumLevel(){return this._minimumLevel}get maximumLevel(){return this._maximumLevel}get tilingScheme(){if(!e.TypeCheck.isDefined(this._tilingScheme))this._tilingScheme=new Cesium.GeographicTilingScheme;return this._tilingScheme}get tileDiscardPolicy(){return this._tileDiscardPolicy}get errorEvent(){return this._errorEvent}get credit(){return this._credit}get proxy(){return this._proxy}get hasAlphaChannel(){return this._hasAlphaChannel}getTileCredits(e,t,i){return undefined}pickFeatures(e,t,i,s,r){return undefined}}e.AbstractImageProvider=t})(Cegore||(Cegore={}));var Cegore;(function(e){e.Providers.ImageProviders.regFactory("ArcGisMapServer",{createProvider:function(e){return new Cesium.ArcGisMapServerImageryProvider(e)}});e.Providers.ImageProviders.regFactory("BingMaps",{createProvider:function(e){return new Cesium.BingMapsImageryProvider(e)}});e.Providers.ImageProviders.regFactory("Grid",{createProvider:function(e){return new Cesium.GridImageryProvider(e)}});e.Providers.ImageProviders.regFactory("Mapbox",{createProvider:function(e){return new Cesium.MapboxImageryProvider(e)}});e.Providers.ImageProviders.regFactory("SingleTile",{createProvider:function(e){return new Cesium.SingleTileImageryProvider(e)}});e.Providers.ImageProviders.regFactory("WMS",{createProvider:function(e){return new Cesium.WebMapServiceImageryProvider(e)}});e.Providers.ImageProviders.regFactory("WMTS",{createProvider:function(e){return new Cesium.WebMapTileServiceImageryProvider(e)}});e.Providers.ImageProviders.regFactory("UrlTemplate",{createProvider:function(e){return new Cesium.UrlTemplateImageryProvider(e)}});e.Providers.ImageProviders.regFactory("TileCoordinates",{createProvider:function(e){return new Cesium.TileCoordinatesImageryProvider(e)}})})(Cegore||(Cegore={}));var Cegore;(function(l){class n{constructor(e){this.getTileCredits=function(e,t,i){return undefined};this.requestImage=function(e,t,i){if(!this._ready){throw new Cesium.DeveloperError("requestImage must not be called before the imagery provider is ready.")}var s=n.buildImageUrl(this,e,t,i);return Cesium.ImageryProvider.loadImage(this,s)};var t=/\/$/;var i=new Cesium.Credit("WMTS");e=Cesium.defaultValue(e,{});var s=Cesium.defaultValue(e.url,"http://localhost:88/wmts");if(!t.test(s)){}this._url=s;if(this._url.indexOf("?")==-1){if(!l.StringUtil.endsWidth(this._url,"/tile/map",true))this._url+="/tile/map";this._url+="?"}this._url+="&origin=left|top";this._proxy=e.proxy;this._tileDiscardPolicy=e.tileDiscardPolicy;this._scheme=Cesium.defaultValue(e.scheme,"Geographic");this._tilingScheme=Cesium.defaultValue(e.tilingScheme,new Cesium.WebMercatorTilingScheme);this._tileWidth=256;this._tileHeight=256;this._minimumLevel=Cesium.defaultValue(e.minimumLevel,0);this._maximumLevel=Cesium.defaultValue(e.maximumLevel,18);this._rectangle=Cesium.defaultValue(l.Rectangle.toCZRectangle(e.rectangle),this._tilingScheme.rectangle);this._errorEvent=new Cesium.Event;this._ready=true;var r=Cesium.defaultValue(e.credit,i);if(typeof r==="string"){r=new Cesium.Credit(r)}this._credit=r}get url(){return this._url}get hasAlphaChannel(){return true}get proxy(){return this._proxy}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get maximumLevel(){return this._maximumLevel}get minimumLevel(){return this._minimumLevel}get tilingScheme(){return this._tilingScheme}get rectangle(){return this._rectangle}get ileDiscardPolicy(){return this._tileDiscardPolicy}get errorEvent(){return this._errorEvent}get ready(){return this._ready}get credit(){return this._credit}static buildImageUrl(e,t,i,s){var r=s;var n=e._proxy;if(e._scheme!=="WebMercator"){if(e._scheme.endsWith("level-0"))s=s+1;else s=s}var o=new l.Rectangle(e._tilingScheme.tileXYToRectangle(t,i,r));var a=e._url+"&id="+s+","+i+","+t+"&range="+o.west+","+o.south+","+o.east+","+o.north;if(Cesium.defined(n)){a=n.getURL(a)}return a}}class e{createProvider(e){return new n(e)}}l.Providers.ImageProviders.regFactory("ZMapImage",new e)})(Cegore||(Cegore={}));var Cegore;(function(n){class t{constructor(e){var t=/\/$/;var i=new Cesium.Credit("WMTS");e=n.TypeCheck.defaultValue(e,{});var s=Cesium.defaultValue(e.url,"http://localhost:88/wmts");if(!t.test(s)){}this._url=s;if(this._url.indexOf("?")==-1){if(!n.StringUtil.endsWidth(this._url,"/tile/dem",true))this._url+="/tile/dem";this._url+="?"}this._url+="&origin=left|top";this._proxy=e.proxy;this._scheme=Cesium.defaultValue(e.scheme,"Geographic");if(this._scheme==="WebMercator"){this._tilingScheme=new Cesium.WebMercatorTilingScheme({ellipsoid:e.ellipsoid})}else{if(this._scheme.endsWith("level-0"))this._tilingScheme=new Cesium.GeographicTilingScheme({ellipsoid:e.ellipsoid});else this._tilingScheme=new Cesium.GeographicTilingScheme({ellipsoid:e.ellipsoid,numberOfLevelZeroTilesX:8,numberOfLevelZeroTilesY:4})}this._tileWidth=n.TypeCheck.defaultValue(e.tileWidth,128);this._tileHeight=n.TypeCheck.defaultValue(e.tileHeight,128);this._minVal=n.TypeCheck.defaultValue(e.minVal,0);this._maxVal=n.TypeCheck.defaultValue(e.maxVal,1e3);this._minimumLevel=Cesium.defaultValue(e.minimumLevel,0);this._maximumLevel=Cesium.defaultValue(e.maximumLevel,18);this._rectangle=Cesium.defaultValue(n.Rectangle.toCZRectangle(e.rectangle),this._tilingScheme.rectangle);this._errorEvent=new Cesium.Event;this._ready=true;var r=Cesium.defaultValue(e.credit,i);if(typeof r==="string"){r=new Cesium.Credit(r)}this._credit=r}get url(){return this._url}get hasAlphaChannel(){return true}get proxy(){return this._proxy}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get maximumLevel(){return this._maximumLevel}get minimumLevel(){return this._minimumLevel}get tilingScheme(){return this._tilingScheme}get rectangle(){return this._rectangle}get ileDiscardPolicy(){return undefined}get errorEvent(){return this._errorEvent}get ready(){return this._ready}get credit(){return this._credit}getTileCredits(e,t,i){return undefined}requestImage(e,t,i){if(!this._ready){throw new Cesium.DeveloperError("requestImage must not be called before the imagery provider is ready.")}var s=this.buildImageUrl(e,t,i);return Cesium.ImageryProvider.loadImage(this,s)}buildImageUrl(e,t,i){const s=this._tilingScheme.tileXYToRectangle(e,t,i);if(this._scheme!=="WebMercator"){if(this._scheme.endsWith("level-0"))i=i+1;else i=i}var r=[Cesium.Math.toDegrees(s.west),Cesium.Math.toDegrees(s.south),Cesium.Math.toDegrees(s.east),Cesium.Math.toDegrees(s.north)];var n=this._url;n+="&id="+i+","+t+","+e;n+="&size="+this._tileWidth+"%2C"+this._tileHeight;n+="&range="+r.join(",");n+="&style=image&min="+this._minVal+"&max="+this._maxVal;return n}}class e{createProvider(e){return new t(e)}}n.Providers.ImageProviders.regFactory("ZMapDemImage",new e)})(Cegore||(Cegore={}));var Cegore;(function(d){class t{constructor(e){this._tileWidth=65;this._tileHeight=65;this._heightOffset=0;this._heightScale=1;this._heightScaleOffset=0;this._qmesh=true;this._clipHeight=0;this._clipInner=true;this._clipWall=true;this._clipFloor=true;this._url=e.url;if(this._url.indexOf("?")==-1){if(!d.StringUtil.endsWidth(this._url,"/tile/dem",true))this._url+="/tile/dem";this._url+="?"}this._token=e.token;this._qmesh=d.TypeCheck.defaultValue(e.qmesh,false);this._clip=e.clip;this._clipHeight=d.TypeCheck.defaultValue(e.clipHeight,0);this._clipInner=d.TypeCheck.defaultValue(e.clipInner,true);this._clipFloor=d.TypeCheck.defaultValue(e.clipFloor,true);this._clipWall=d.TypeCheck.defaultValue(e.clipWall,true);this._waterMask=d.TypeCheck.defaultValue(e.waterMask,false);this._waterHeight=d.TypeCheck.defaultValue(e.waterHeight,0);this._tileWidth=d.TypeCheck.defaultValue(e.tileWidth,20);this._tileHeight=d.TypeCheck.defaultValue(e.tileHeight,20);this._heightOffset=d.TypeCheck.defaultValue(e.heightOffset,0);this._heightScale=d.TypeCheck.defaultValue(e.heightScale,1);this._heightScaleOffset=d.TypeCheck.defaultValue(e.heightScaleOffset,0);this._tilingScheme=e.tilingScheme;if(!Cesium.defined(this._tilingScheme)){this._tilingScheme=new Cesium.GeographicTilingScheme({ellipsoid:Cesium.defaultValue(e.ellipsoid,Cesium.Ellipsoid.WGS84)})}this._levelZeroMaximumGeometricError=62617.21357121639;this._proxy=e.proxy;this._dataStruct={heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:false};this._errorEvent=new Cesium.Event;var t=e.credit;if(typeof t==="string"){t=new Cesium.Credit(t)}this._credit=t;this._readyPromise=Cesium.when.resolve(true)}get errorEvent(){return this._errorEvent}get credit(){return this._credit}get tilingScheme(){return this._tilingScheme}get ready(){return true}get readyPromise(){return this._readyPromise}get hasWaterMask(){return this._waterMask}get hasVertexNormals(){return false}requestTileGeometry(t,i,s,e){var r=this._tilingScheme.tileXYToRectangle(t,i,s);const n=(r.east-r.west)/(this._tileWidth-1);const o=(r.north-r.south)/(this._tileHeight-1);r.west-=n*.5;r.east+=n*.5;r.south-=o*.5;r.north+=o*.5;const a=[Cesium.Math.toDegrees(r.west),Cesium.Math.toDegrees(r.south),Cesium.Math.toDegrees(r.east),Cesium.Math.toDegrees(r.north)];const l=this._url;const h={id:`${s},${i},${t}`,size:`${this._tileWidth},${this._tileHeight}`,range:a.join(","),style:this._qmesh?"qmesh":"float",origin:"left|top",scale:this._heightScale,scaleOffset:this._heightScaleOffset,offset:this._heightOffset};if(this._qmesh&&this._clip){h.clip=this._clip;h["clip-h"]=this._clipHeight;h["clip-inner"]=this._clipInner;h["clip-wall"]=this._clipWall;h["clip-floor"]=this._clipFloor}const c=d.StringUtil.toPostFormBody(h);const u=Cesium.Resource.post({url:l,proxy:this._proxy,data:c,headers:{"Content-Type":"application/x-www-form-urlencoded"},request:e,responseType:"arraybuffer"});if(!Cesium.defined(u)){return undefined}return Cesium.when(u,e=>{if(this._qmesh)return this.loadQMesh(e,t,i,s);return this.loadHeightmap(e)})}getLevelMaximumGeometricError(e){return this._levelZeroMaximumGeometricError/(1<<e)}getTileDataAvailable(e,t,i){return undefined}loadHeightmap(e){const i=this._tileWidth*this._tileHeight;const t=i*4;const s=i*8;let r,n;if(this._waterMask)r=new Uint8Array(i);if(e.byteLength==t){n=new Float32Array(e);for(let e=0;e<i;++e){if(n[e]<=-1e5)n[e]=0}}else if(e.byteLength==s){n=new Float32Array(i);let t=new Float64Array(e);for(let e=0;e<i;++e){n[e]=t[e];if(t[e]<=-1e5)n[e]=0}}else{n=new Float32Array(i)}if(this._waterMask){for(let e=0;e<i;++e){if(n[e]<this._waterHeight)r[e]=255;else r[e]=0}}return new Cesium.HeightmapTerrainData({buffer:n,width:this._tileWidth,height:this._tileWidth,childTileMask:15,waterMask:r,structure:this._dataStruct})}loadQMesh(e,t,i,s){let r=0;const n=3;const o=n+1;const a=Float64Array.BYTES_PER_ELEMENT*n;const l=Float64Array.BYTES_PER_ELEMENT*o;const h=3;const c=Uint16Array.BYTES_PER_ELEMENT*h;const u=3;const d=new DataView(e);const m=S(d,r);r+=a;const p=[d.getFloat64(r,true),d.getFloat64(r+8,true),d.getFloat64(r+16,true),d.getFloat64(r+24,true)];r+=Float64Array.BYTES_PER_ELEMENT*4;const f=d.getFloat32(r,true);r+=Float32Array.BYTES_PER_ELEMENT;const _=d.getFloat32(r,true);r+=Float32Array.BYTES_PER_ELEMENT;const y=new Cesium.BoundingSphere(S(d,r),d.getFloat64(r+a,true));r+=l;const C=S(d,r);r+=a;const g=d.getUint32(r,true);r+=Uint32Array.BYTES_PER_ELEMENT;const v=new Uint16Array(e,r,g*3);r+=g*c;const w=I(d,r,u);r+=Uint32Array.BYTES_PER_ELEMENT+w.byteLength;const T=I(d,r,1);r+=Uint32Array.BYTES_PER_ELEMENT+T.byteLength;const P=I(d,r,1);r+=Uint32Array.BYTES_PER_ELEMENT+P.byteLength;const b=I(d,r,1);r+=Uint32Array.BYTES_PER_ELEMENT+b.byteLength;const x=I(d,r,1);r+=Uint32Array.BYTES_PER_ELEMENT+x.byteLength;const E=this.getLevelMaximumGeometricError(s)*5;const M=this._tilingScheme.tileXYToRectangle(t,i,s);let A;if(M.width<Cesium.Math.PI_OVER_TWO+Cesium.Math.EPSILON5){A=Cesium.OrientedBoundingBox.fromRectangle(M,f,_,this._tilingScheme.ellipsoid)}if(g==0){throw new Error("blank")}return new Cesium.QuantizedMeshTerrainData({minimumHeight:f,maximumHeight:_,boundingSphere:y,orientedBoundingBox:A,horizonOcclusionPoint:C,quantizedVertices:v,indices:w,westIndices:T,southIndices:P,eastIndices:b,northIndices:x,westSkirtHeight:E,southSkirtHeight:E,eastSkirtHeight:E,northSkirtHeight:E,childTileMask:15})}}function S(e,t){return new Cesium.Cartesian3(e.getFloat64(t,true),e.getFloat64(t+8,true),e.getFloat64(t+16,true))}function I(e,t,i){const s=e.getUint32(t,true);t+=Uint32Array.BYTES_PER_ELEMENT;return new Uint16Array(e.buffer,t,s*i)}class e{createProvider(e){return new t(e)}}d.Providers.TerrainProviders.regFactory("ZMapTerrain",new e)})(Cegore||(Cegore={}));var Cegore;(function(w){class t extends w.AbstractImageProvider{constructor(e){super();this._weightScale=1;this._shadow=250;e=Cesium.defaultValue(e,{});this._xfield=e.xField;this._yfield=e.yField;this._weightField=e.weightField;this._weightScale=Cesium.defaultValue(e.weightScale,1);this._weightCalc=e.weightCalc;this._tilingScheme=new Cesium.GeographicTilingScheme;this._minimumLevel=Cesium.defaultValue(e.minimumLevel,0);this._maximumLevel=Cesium.defaultValue(e.maximumLevel,18);this._hasAlphaChannel=true;this.initData(e.data);this.setBlurRadius(e.blur,e.radius);this.setGradient(e.gradient)}setBlurRadius(e,t){this._blur=w.TypeCheck.defaultValue(e,15);this._radius=w.TypeCheck.defaultValue(t,8);this._circleImage=this.createCircle()}setGradient(e){this._gradient=w.TypeCheck.defaultValue(e,t.DEFAULT_GRADIENT);this._colorTable=this.createGradientColorTable(this._gradient)}initData(s){this._data=[];var r=new w.Rectangle;for(let i=0;i<s.length;++i){let e=s[i];let t={x:this.xCoord(e),y:this.yCoord(e),v:this.value(e)};this._data.push(t);r.merge(t.x,t.y)}this._rectangle=r.toCZRectangle();this._ready=true}static fieldsValue(i,s,e){let r=w.TypeCheck.defaultValue(e,0);for(let t=0;t<s.length;++t){let e=s[t];if(!w.TypeCheck.isDefined(e))continue;r=i[e];if(w.TypeCheck.isDefined(r))break}if(!w.TypeCheck.isNumber(r))r=w.StringUtil.parseFloat(r);return r}xCoord(e){return t.fieldsValue(e,[this._xfield,"x","X"])}yCoord(e){return t.fieldsValue(e,[this._yfield,"y","Y"])}value(e){if(w.TypeCheck.isFunction(this._weightCalc))return this._weightCalc(e);else return t.fieldsValue(e,[this._weightField,"value","Value","VALUE"])}createGradientColorTable(e){var t=1;var i=256;var s=w.DOM.createContext2D(t,i);var r=s.createLinearGradient(0,0,t,i);var n=1/(e.length-1);for(var o=0,a=e.length;o<a;++o){r.addColorStop(o*n,e[o])}s.fillStyle=r;s.fillRect(0,0,t,i);return s.getImageData(0,0,t,i).data}createCircle(){var e=this._radius;var t=this._blur;var i=e+t+1;var s=2*i;var r=w.DOM.createContext2D(s,s);r.shadowOffsetX=r.shadowOffsetY=this._shadow;r.shadowBlur=t;r.shadowColor="#000";r.beginPath();var n=i-this._shadow;r.arc(n,n,e,0,Math.PI*2,true);r.fill();return r.canvas}requestImage(e,t,i){var s=w.DOM.createContext2D(this.tileWidth,this.tileHeight);var r=s.canvas;var n=this._circleImage;var o=n.width/2;var a=n.height/2;var l=new w.Position;var h=new w.Rectangle(this.tilingScheme.tileXYToRectangle(e,t,i));var c=h.width;var u=h.height;var d=h.clone();d.inflate(h.width/2,h.height/2);for(var m=0;m<this._data.length;++m){var p=this._data[m];l.set(p.x,p.y);if(!d.contains(l))continue;var f=(p.x-h.minx)/c*r.width;var _=(h.maxy-p.y)/u*r.height;s.globalAlpha=p.v*this._weightScale;s.drawImage(n,f-o,_-a)}var y=s.getImageData(0,0,r.width,r.height);var C=y.data;var g;for(var m=0,v=C.length;m<v;m+=4){g=C[m+3]*4;if(g){C[m]=this._colorTable[g];C[m+1]=this._colorTable[g+1];C[m+2]=this._colorTable[g+2]}}s.putImageData(y,0,0);return r}}t.DEFAULT_GRADIENT=["#00f","#0ff","#0f0","#ff0","#f00"];class e{createProvider(e){return new t(e)}}w.Providers.ImageProviders.regFactory("Heatmap",new e)})(Cegore||(Cegore={}));var Cegore;(function(a){class n{static LoadModel(e,t,i,s){var r=new a.Position(s.offset);var n=i.pos.split(",");n[0]=parseFloat(n[0])+r.x;n[1]=parseFloat(n[1])+r.y;n[2]=parseFloat(n[2])+r.z;e=e+"/model?style=glb&id="+encodeURIComponent(i.model);var o=new a.GltfModel({name:i.name,uri:e,position:n,minPixelSize:10});t.add(o)}static LoadFromPubModel(e,i,s){var r=new a.ModelGroup({name:e});a.LoadWithXhr.loadJSON({url:i+"/model?filter=detail",success:function(e){for(var t=0;t<e.items.length;++t){n.LoadModel(i,r,e.items[t],s)}}});return r}}a.ZMapModelLoader=n})(Cegore||(Cegore={}));var CZMAP;(function(a){let t=0;function e(e){return e._uid_||(e._uid_=String(++t))}a.getUid=e;function i(){return true}a.TRUE=i;function s(){return false}a.FALSE=s;function r(){}a.VOID=r;function n(...e){throw new Error("abstract method, not impl!")}a.abstract=n;function o(e,t){const i=t-e;return e+Math.floor(Math.random()*i)}a.randomInt=o;function l(e,t){const i=t-e;return e+Math.random()*i}a.randomFloat=l;function h(t){if(t===null)return t;const e=typeof t;if(e!=="object")return t;if(Array.isArray(t)){const i=[];for(let e=0;e<t.length;++e){i[e]=h(t[e])}return i}else{const s={};for(let e in t){s[e]=h(t[e])}return s}}a.deepCopy=h;function c(e){return typeof e==="function"||typeof e==="object"&&!Array.isArray(e)}function u(e){return typeof e==="object"?e===null:typeof e!=="function"}function d(e,...t){if(e===null||e===undefined){throw new TypeError("Cannot convert undefined or null to object")}const r=Object(e);t.forEach(t=>{if(t===null||t===undefined){return}for(let e in t){if(Object.prototype.hasOwnProperty.call(t,e)){const i=t[e];if(!a.defined(i))continue;const s=a.defaultValue(r[e],{});if(c(s)&&c(i))r[e]=d(s,i);else r[e]=i}}});return r}a.deepAssign=d;function m(e,t){const i=e.split(".");const s=t.split(".");const r=Math.max(i.length,s.length);for(let e=0;e<r;++e){const n=a.Parse.parseNumber(i[e],0);const o=a.Parse.parseNumber(s[e],0);if(n<o)return-1;if(n>o)return 1}return 0}a.compVersion=m;function p(e,t){try{if(typeof e==="function")return e.apply(undefined,t)}catch(e){}}a.tryCatchCall=p})(CZMAP||(CZMAP={}));var CZMAP;(function(e){function t(e){return e!==undefined&&e!==null}e.defined=t;function n(e,t){if(e!==undefined&&e!==null){return e}return t}e.defaultValue=n;function i(...e){return e.find(e=>t(e))}e.defaultValues=i;const o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";function s(e){const t=[];const i=n(e===null||e===void 0?void 0:e.len,8);for(let e=0;e<i;++e){const r=Math.random()*o.length;t.push(o[r])}let s="";if(e===null||e===void 0?void 0:e.prefix)s+=e.prefix;s+=t.join("");if(e===null||e===void 0?void 0:e.postfix)s+=e.postfix;return s}e.randomString=s;class r{static isNull(e){return e===null}static typeOf(e){if(Array.isArray(e))return"array";return typeof e}static isFunction(e){return typeof e==="function"}static isString(e){return typeof e==="string"}static isNumber(e){return typeof e==="number"&&!Number.isNaN(e)}static isObject(e){return this.typeOf(e)==="object"}static isBool(e){return typeof e==="boolean"}static isArray(e){return Array.isArray(e)}static isInstanceOf(e,t){return e instanceof t}}r.defaultValue=n;r.isDefined=t;e.Types=r})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{constructor(){this._disposed=false}dispose(){if(!this._disposed){this._disposed=true;this._disposeInternal()}}}e.Disposable=t})(CZMAP||(CZMAP={}));var CZMAP;(function(l){class o{constructor(e,t,i,s){this.target=e;this.type=t;this.listener=i;this.bindto=s}}l.ListenerObject=o;class e extends l.Disposable{constructor(){super();this._removing={};this._dispatching={};this._listeners={}}getListeners(e){return this._listeners[e]}hasListener(e){return e?e in this._listeners:Object.keys(this._listeners).length>0}addEventListener(e,t,i){let s=this._listeners[e];if(!s){s=this._listeners[e]=[]}const r=this.findListener(s,t,i);if(r!=-1)return s[r];const n=new o(this,e,t,i);s.push(n);return n}dispatchEvent(e,t){let i;const s=typeof e==="string"?new l.Event(e):e;const r=s.type;s.target=this;s.data=t;const n=this._listeners[r];if(n){if(!(r in this._dispatching)){this._dispatching[r]=0;this._removing[r]=0}++this._dispatching[r];for(let e=0,t=n.length;e<t;++e){const o=n[e];const a=o.bindto||o.target;try{if(o.listener.call(a,s)===false||s.propagationStopped){i=false;break}}catch(e){console.error(e)}}--this._dispatching[r];if(this._dispatching[r]===0){let e=this._removing[r];delete this._removing[r];while(e--){this.removeEventListener(r,l.VOID)}delete this._dispatching[r]}return i}}removeEventListener(e,t,i){const s=this._listeners[e];if(s){const r=this.findListener(s,t,i);if(r===-1)return;if(e in this._removing){s[r].listener=l.VOID;++this._removing[e]}else{s.splice(r,1);if(s.length===0){delete this._listeners[e]}}}}findListener(i,s,r){for(let t=0;t<i.length;++t){let e=i[t];if(e.listener===s&&e.bindto===r){return t}}return-1}removeAllEventListener(){const e=Object.keys(this._listeners);for(let i of e){const s=this._listeners[i];for(let t=s.length-1;t>=0;--t){let e=s[t];this.removeEventListener(i,e.listener,e.bindto)}}}_disposeInternal(){this.removeAllEventListener()}}l.EventTarget=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{constructor(e){this.target=null;this.type=e}preventDefault(){this.propagationStopped=true}stopPropagation(){this.propagationStopped=true}}e.Event=t})(CZMAP||(CZMAP={}));var CZMAP;(function(t){class e{}e.CHANGE="change";t.ObservableEvents=e;class i extends t.EventTarget{constructor(){super();this._revision=0}changed(){++this._revision;this.dispatchEvent(e.CHANGE)}getRevision(){return this._revision}on(t,i,s){if(Array.isArray(t)){const r=t.length;const n=new Array(r);for(let e=0;e<r;++e){n[e]=o(this,t[e],i,s)}return n}else{return o(this,t,i,s)}}un(i,s,r){if(Array.isArray(i)){for(let e=0,t=i.length;e<t;++e){n(this,i[e],s,r)}return}else{n(this,i,s,r)}}static unByKey(i){if(Array.isArray(i)){for(let e=0,t=i.length;e<t;++e){s(i[e])}}else{s(i)}}}t.Observable=i;function o(e,t,i,s){return e.addEventListener(t,i,s)}function n(e,t,i,s){e.removeEventListener(t,i,s)}function s(e){if(e instanceof t.ListenerObject){e.target.removeEventListener(e.type,e.listener,e.bindto)}}})(CZMAP||(CZMAP={}));var CZMAP;(function(o){class r extends o.Event{constructor(e,t,i){super(e);this.key=t;this.oldValue=i}}o.ObjectEvent=r;class s{constructor(e){this.value=undefined;this.default=undefined;this.check=undefined;this.equals=undefined;this.name=e}doCheck(e){return this.check?this.check(e):e}isEquals(e,t){return this.equals?this.equals(e,t):Object.is(e,t)}}class e{}o.BaseObjectProperty=e;class n extends o.ObservableEvents{}n.PROPERTYCHANGE="propertychange";o.BaseObjectEvents=n;class a extends o.Observable{constructor(e){super();this._values=new Map;o.getUid(this);this._initDefines();if(o.Types.isDefined(e)){this.setProperties(e)}}def(e,t,i,s){const r=this._getProperty(e,true);r.value=t;r.default=t;if(o.Types.isFunction(s))r.equals=s;if(o.Types.isFunction(i))r.check=i}get(e){return this._getProperty(e,false).value}getKeys(){return[...this._values.keys()]}getProperties(){const i={};for(let[e,t]of this._values){i[e]=o.defaultValue(t.value,t.default)}return i}notify(e,t,i){let s;s=a.getChangeEventType(e);this.dispatchEvent(new r(s,e,t),i);s=n.PROPERTYCHANGE;this.dispatchEvent(new r(s,e,t),i);this.changed()}notifyCurrent(e){this.notify(e,this.get(e))}notifyAll(){const e=this.getKeys();e.forEach(e=>{const t=this.get(e);if(o.Types.isDefined(t))this.notify(e,t)})}set(e,t,i,s){const r=this._getProperty(e,true);if(o.Types.isDefined(t))t=r.doCheck(t);else t=r.default;if(i){r.value=t}else{const n=r.value;r.value=t;if(!r.isEquals(n,t)){this.notify(e,n,s)}}}setProperties(e,t){for(const i in e){this.set(i,e[i],t)}}unset(e,t){if(this._values.has(e)){const i=this._values.get(e);this._values.delete(e);if(!t){this.notify(e,i)}}}onProperty(e,t,i){return this.on(a.getChangeEventType(e),t,i)}unProperty(e,t,i){return this.un(a.getChangeEventType(e),t,i)}onAllProperty(e,t){return this.on(n.PROPERTYCHANGE,e,t)}unAllProperty(e,t){return this.un(n.PROPERTYCHANGE,e,t)}static getChangeEventType(e){let t=i;return t.hasOwnProperty(e)?t[e]:t[e]="change:"+e}_getProperty(e,t){let i;if(this._values.has(e))i=this._values.get(e);else if(t){i=new s(e);this._values.set(e,i)}else i=l;return i}_initDefines(){}}o.BaseObject=a;const l=new s("EMPTY");const i={}})(CZMAP||(CZMAP={}));var CZMAP;(function(s){class e extends s.BaseObject{constructor(e,t,i){super();this._view=null;this._projection="EPSG:4326";this._enableTip=false;this._dynData=new s.DynamicData;this._mode=e;this._options=s.Types.defaultValue(i,{});if(s.Types.isString(t))this._mapDOM=document.getElementById(t);else this._mapDOM=t;this._mapID=this._mapDOM.id;if(!s.Types.isDefined(this._mapDOM))throw new Error("dom is empty.");this._viewID=this._mapDOM.id+"-mapview";this._projection=s.Types.defaultValue(this._options.projection,"EPSG:4326");this._createMapView(e);this._overlayRoot=this._createDOM("czmap-overlayRoot",true)}get mapID(){return this._mapID}get mapDOM(){return this._mapDOM}get viewID(){return this._viewID}get viewDOM(){return this._viewDOM}get overlayRoot(){return this._overlayRoot}get rootLayer(){return this._view.layerManager}get layers(){return this.rootLayer}get projection(){return this._projection}get mode(){return this._mode}get view(){return this._view}get view2d(){return this._view instanceof s.MapView2D?this._view:undefined}get view3d(){return this._view instanceof s.MapView3D?this._view:undefined}zoomTo(e){return this._view.zoomTo(e)}flyTo(e){return this._view.flyTo(e)}createPathRoam(){return this._view.createPathRoam()}measureDistance(e){return this._view.measureDistance(e)}measureArae(e){return this._view.measureArae(e)}measureClear(){return this._view.measureClear()}get enableTip(){return this._enableTip}set enableTip(e){if(this._enableTip!=e){this._enableTip=e}}setOnTip(e,t){this.view.events.on(s.MapEventsType.MOUSE_OVER,e,t);this.view.events.on(s.MapEventsType.MOUSE_OUT,e,t)}setOnClick(e,t){this.view.events.on(s.MapEventsType.MOUSE_CLICK,e,t)}get dynamiceDate(){return this._dynData}get containerElement(){return this._mapDOM}_createMapView(e){this._viewDOM=this._createDOM(this._viewID);switch(e){case s.MapMode.Mode2D:this._view=new s.MapView2D(this,this._viewID);break;case s.MapMode.Mode3D:this._view=new s.MapView3D(this,this._viewID,this._options);break;case s.MapMode.ModeCloud:this._view=new s.MapViewUE(this,this._viewID,this._options);break}}_createDOM(e,t){let i=document.createElement("div");i.id=e;if(!t){i.style.width="100%";i.style.height="100%"}i.style.overflow="hidden";this._mapDOM.append(i);return i}destroy(){this._dynData.unRegAll();this._view.dispose()}_disposeInternal(){super._disposeInternal();this.destroy()}}s.ComMap=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{static defs(...e){proj4.defs.apply(null,e)}}e.Projection=t;e.Proj=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){window.CZMAP["Map"]=e.ComMap})(CZMAP||(CZMAP={}));var CZMAP;(function(a){class e{constructor(e,t,i,s){this.map=e;this.layer=t;this.layerdef=i;this.url=a.Types.defaultValue(s.url,i.url);this.originkey=a.Types.defaultValue(s.originkey,"id");this.dynamicekey=a.Types.defaultValue(s.dynamicekey,"id");this.interval=a.Types.defaultValue(s.interval,1e4);this.handle=e=>{this.update(e)}}update(e){const n=this.layer.source;const t=n.getFormat();const o=this.layer.children.slice();const i=t.readFeatures(e);i.forEach(e=>{const t=e.properties[this.dynamicekey];if(!a.Types.isDefined(t))return;const i=o.findIndex(e=>{if(e===null)return false;return e.properties[this.originkey]===t});if(i==-1){n.addFeature(e)}else{const s=o[i];const r=Object.assign({},s.properties,e.properties);if(e.properties)s.feature.properties=r;if(e.geometry)s.feature.geometry=e.geometry;s.style.update(this.layerdef.style,r,true);o[i]=null}});o.forEach(e=>{if(e){this.layer.removeLayer(e)}})}reg(){this.map.dynamiceDate.reg(this.url,this.handle,a.DynamicDataType.JSON,this.interval)}unreg(){this.map.dynamiceDate.unReg(this.url,this.handle,a.DynamicDataType.JSON,this.interval)}}a.DynamicStyle=e})(CZMAP||(CZMAP={}));var CZMAP;(function(c){class u{static loadMapLayers(t,e){if(c.Types.isArray(e)){return e.map(e=>this.loadLayer(t.rootLayer,e))}else{return this.loadLayer(t.rootLayer,e)}}static loadLayer(e,t){let i;switch(t.type.toLowerCase()){case"folder":i=this.loadFolder(e,t);break;case"terrain":i=this.loadTerrain(e,t);break;case"tile":case"map":i=this.loadTileLayer(e,t);break;case"vector":case"point":i=this.loadVectorLayer(e,t);break;case"model":i=this.loadModelLayer(e,t);break;case"volume":i=this.loadVolumeLayer(e,t);break;case"3dtiles":i=this.loadTdtilesLayer(e,t);break;default:i=this.loadLayerOther(e,t);break}return i}static loadFolder(e,t){const i={name:t.name,visible:t.visible,define:t};const s=e.createLayer(c.Folder,i);if(c.Types.isArray(t.children))t.children.forEach(e=>this.loadLayer(s,e));return s}static loadTerrain(e,t){const i={name:t.name,visible:t.visible,url:t.url,define:t};return e.createLayer("terrain",i)}static loadTileLayer(e,t){t.style=t.style||{};const i={name:t.name,visible:t.visible,define:t,url:t.url,scheme:t.style.scheme,mapType:t.style["map-type"],minLevel:t.style["min-level"],maxLevel:t.style["max-level"],subdomains:t.style.subdomains};return e.createLayer("tile",i)}static loadFormatter(e){e=Object.assign({type:"table"},e);switch(e.type){case"table":return new c.TableDataFormat(e.option);case"geojson":return new c.GeoJSONFormat;default:return new c.TableDataFormat}}static loadVectorLayer(e,r){const t=u.loadFormatter(r.formatter);const i={format:t};if(c.StringUtils.isNotEmpty(r.url)){i.url=r.url}else if(c.Types.isDefined(r.data)){i.features=t.readFeatures(r.data);i.projection=t.readProjection(r.data)}function s(e,t,i){const s=new c.FeatureStyle;s.update(r.style,e.properties,false);return s}const n=new c.VectorSource(i);const o={name:r.name,visible:r.visible,source:n,style:s,enableCluster:r.enableCluster,multiLevelCluster:r.multiLevelCluster,pointAnimation:r.pointAnimation,enableAnimation:r.enableAnimation,animationTimes:r.animationTimes,maxAnimationDistance:r.maxAnimationDistance,define:r};if(r.refLine){const l=r.refLine;o.referenceLine=new c.NearestPointInLine({url:l.url,data:l.data,radius:l.radius})}const a=e.createLayer("vector",o);if(r.dynamic){const h=new c.DynamicStyle(e.map,a,r,r.dynamic);h.reg();a.set("dynamic",h)}return a}static loadModelLayer(e,t){let i="";const s=t.style||{};if(s.merge){if(s.merge==="byname")i=".+";else if(s.merge==="byprefix")i=".+"}let r=undefined;if(s.label){r=new c.LabelStyle(s.label)}const n={url:t.url,name:t.name,visible:t.visible,define:t,position:t.position,offset:t.offset,pose:t.pose,scale:t.scale,flat:s.flat,label:r,enableCluster:t.enableCluster,expandChild:s.expand,expandChildTree:s.expandTree,expandLeafChild:s.expandLeaf,mergeChild:s.merge==="byprefix"?a:o};return e.createLayer("model",n)}static loadVolumeLayer(e,t){return e.createLayer("volmue",t)}static loadTdtilesLayer(e,t){return e.createLayer("3dtiles",t)}static loadLayerOther(e,t){return e.createLayer(t.type,t)}}c.MapLoader=u;function o(t){let i;const s=[];for(let e=0;e<t.length;++e){const r=t[e];if(i&&r===i.name){i.index.push(e)}else{i=null}if(!i){i=s[s.length]={};i.name=r;i.index=[e];continue}}return s}function a(i){let s;const r=[];for(let t=0;t<i.length;++t){let e=i[t];const n=e.lastIndexOf("-");e=e.substr(0,n);if(s&&e===s.name){s.index.push(t)}else{s=null}if(!s){s=r[r.length]={};s.name=e;s.index=[t];continue}}return r}})(CZMAP||(CZMAP={}));var CZMAPAPP;(function(e){e.MapLoader=CZMAP.MapLoader;e.DynamicStyle=CZMAP.DynamicStyle})(CZMAPAPP||(CZMAPAPP={}));var CZMAP;(function(i){let s=0;class e{constructor(e,t){this.id=s++;this._view=e;if(e instanceof i.MapView3D)this._czviewer=e.czviewer}get view(){return this._view}get czviewer(){return this._czviewer}init(){return Promise.resolve()}destroy(){}cancelFlight(){if(this._czviewer)this._czviewer.camera.cancelFlight();else this.view.setViewInfo(this.view.getViewInfo())}}i.Action=e;let t=0;class r{constructor(e){this.id=t++;this.duration=2;this.skip=0;this.handle=0;this.skipNum=0;this.currentTime=0;if(e){this.duration=i.defaultValue(e.duration,2);this.skip=i.defaultValue(e.skip,0);this.callback=e.callback;this.finish=e.finish}}start(e){if(e)this.currentTime=e;this.lastTime=undefined;this.requestNext()}pause(){this.cancelNext()}stop(){if(this.finish)this.finish();this.cancelNext()}loop(e){e=(new Date).getTime();if(this.lastTime===undefined){this.lastTime=e}this.currentTime+=e-this.lastTime;this.lastTime=e;if(this.currentTime>this.duration){if(this.callback)this.callback(1,this.duration);if(this.finish)this.finish();return}if(this.skipNum>=this.skip){const t=this.currentTime/this.duration;if(this.callback)this.callback(t,this.currentTime);this.skipNum=0}this.skipNum++;this.requestNext()}requestNext(){this.handle=requestAnimationFrame(e=>this.loop(e))}cancelNext(){if(this.handle){cancelAnimationFrame(this.handle);this.handle=0}}}i.Loop=r})(CZMAP||(CZMAP={}));var CZMAP;(function(s){const r=/([0-9]+):([0-9]+)/;function n(e){if(typeof e==="number")return e;if(typeof e==="string"){if(r.test(e)){const t=RegExp.$1;const i=RegExp.$2;return Number.parseInt(t)*60+Number.parseInt(i)}}throw new Error("错误的时间格式!")}class e{constructor(t,e){this._start=n(e.start);this._end=n(e.end);let i=e.actions;if(!Array.isArray(i)){i=[e]}this._actions=i.map(e=>s.createAction(t,e))}get begin(){return this._start}get end(){return this._end}get duration(){return this._end-this._start}get actions(){return this._actions}start(){this.actions.forEach(e=>e.start())}pause(){this.actions.forEach(e=>e.pause())}finish(){this.actions.forEach(e=>e.finish())}destroy(){this.actions.forEach(e=>e.destroy());this.actions.length=0}}s.ActionGroup=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends globalThis.EventTarget{constructor(){super();this._onEndListener=e=>this._onended(e);this._loop=false;this._volume=1;this._startTime=0;this._offsetTime=0;this._pauseTime=0}get duration(){return this._buffer?this._buffer.duration:0}get paused(){return this._sourceNode===undefined}get volume(){return this._volume}set volume(e){this._volume=e;if(this._gainNode)this._gainNode.gain.value=e}get currentTime(){if(!this._context)return 0;if(this.paused)return this._pauseTime;const e=this.duration;const t=this._context.currentTime-this._startTime+this._offsetTime;if(t<e){return t}else if(this._loop){return t%e}else{return e}}set currentTime(e){if(this.paused){this._pauseTime=e}else{this.play(e)}}set loop(e){this._loop=e;if(this._sourceNode)this._sourceNode.loop=e}get loop(){return this._loop}async open(e){this.pause();const t=await fetch(e);const i=await t.arrayBuffer();return this.openBuffer(i)}async openBuffer(e){if(!this._context)this._context=new AudioContext;this._buffer=await this._context.decodeAudioData(e)}play(e){const t=this.paused;if(!t){this._stop()}this._start(e);if(t)this._fire("play")}pause(){this._pauseTime=this.currentTime;this._stop();this._fire("pause")}resume(){this.play(this._pauseTime)}addEventListener(e,t,i){super.addEventListener(e,t,i)}removeEventListener(e,t,i){super.removeEventListener(e,t,i)}_start(e){if(!this._buffer)return new Error("not open!");if(e===undefined)e=this._pauseTime;if(e>=this.duration)e=0;this._sourceNode=this._context.createBufferSource();this._sourceNode.buffer=this._buffer;this._sourceNode.loop=this._loop;this._sourceNode.addEventListener("ended",this._onEndListener);this._gainNode=this._context.createGain();this._gainNode.gain.value=this._volume;this._sourceNode.connect(this._gainNode);this._gainNode.connect(this._context.destination);this._sourceNode.start(0,e);this._startTime=this._context.currentTime;this._offsetTime=e||0}_stop(){if(this._sourceNode){this._sourceNode.removeEventListener("ended",this._onEndListener);this._sourceNode.stop();this._sourceNode.disconnect();this._sourceNode=undefined}if(this._gainNode){this._gainNode.disconnect();this._gainNode=undefined}}_onended(e){this._pauseTime=this.currentTime;this._fire("ended");if(this._sourceNode){this._sourceNode.disconnect();this._sourceNode=undefined}if(this._gainNode){this._gainNode.disconnect();this._gainNode=undefined}}_fire(e){this.dispatchEvent(new globalThis.Event(e))}}e.AudioPlayer=t})(CZMAP||(CZMAP={}));var CZMAP;(function(s){class e{constructor(e){this._groups=[];this._loopHandle=0;this._current=0;this._paused=true;this._currents=new Map;this._audioPlayer=new s.AudioPlayer;this._inited=false;this._view=e;this._ready=new Promise(e=>{this._readyResolve=e})}get duration(){return this._audioPlayer.duration}get current(){return this._current}set current(e){this._current=e;this._audioPlayer.currentTime=e}get paused(){return this._paused}get ready(){return this._ready}init(e){if(this._inited)return this._ready;this._inited=true;const i=[];e.groups.forEach(e=>{const t=new s.ActionGroup(this._view,e);t.actions.forEach(e=>{i.push(e.init())});this._groups.push(t)});i.push(this._audioPlayer.open(e.audio));Promise.all(i).then(this._readyResolve);return this._ready}play(e){this._paused=false;if(!this._loopHandle){this._run()}if(e!==undefined)this._current=e;for(let e of this._currents.values()){e.start()}this._audioPlayer.play(e)}pause(){this._paused=true;this._audioPlayer.pause();for(let e of this._currents.values()){e.pause()}}togger(){if(this.paused)this.play();else this.pause()}destroy(){if(this._loopHandle){cancelAnimationFrame(this._loopHandle);this._loopHandle=0}this._audioPlayer.pause();this._groups.forEach(e=>e.destroy());this._groups.length=0;this._currents.clear()}_run(){this._current=0;this._audioPlayer.play(0);let i;const s=e=>{if(i===undefined)i=e;const t=(e-i)/1e3;this._loop(t);i=e;this._loopHandle=requestAnimationFrame(s)};this._loopHandle=requestAnimationFrame(s)}_loop(e){if(this._paused)return;const i=this._currents;const s=this._current;const r=this._current+e;i.forEach((e,t)=>{if(e.begin>s||e.end<r){e.finish();i.delete(t)}});const t=this._findActions(s,r);t.forEach((e,t)=>{if(i.has(t))return;e.start();i.set(t,e)});this._current=r}_findActions(i,s){const r=new Map;this._groups.forEach((e,t)=>{if(e.begin<=s&&e.end>=i){r.set(t,e)}});return r}}s.ActionPlayer=e})(CZMAP||(CZMAP={}));var CZMAP;(function(h){class e extends h.Action{constructor(e,t){super(e,t);this._option=t}init(){return Promise.resolve()}start(){const e=this._option;this.view.setViewInfo({position:e.target,heading:e.hpr[0],pitch:e.hpr[1],roll:e.hpr[2]},{duration:e.duration})}pause(){this.cancelFlight()}finish(){}}class t extends h.Action{constructor(e,t){super(e,t);this._option=t}init(){return Promise.resolve()}start(){const e=this._option;const t=Cesium.Cartesian3.fromDegrees(...e.target);const i=new Cesium.BoundingSphere(t,e.distance);this.view.flyToSphere(i,{heading:e.heading,pitch:e.pitch,duration:e.duration})}pause(){this.cancelFlight()}finish(){}}class i extends h.Action{constructor(e,t){super(e,t);this._flying=false;this._option=t}init(){const e=this._option;const t=Cesium.Cartesian3.fromDegrees(...e.target);const s=new Cesium.BoundingSphere(t,e.distance);const i=this.view.getViewInfo();const r=h.defaultValue(e.flyDuration,2);const n=e.duration;const o=r+n;const a=e.speed||.05;const l={heading:h.defaultValue(e.heading,i.heading),pitch:e.pitch,distance:e.distance,duration:h.defaultValue(e.flyDuration,2)};this._loop=new h.Loop;this._loop.duration=o*1e3;this._loop.callback=(e,t)=>{const i=t/1e3;if(i<r){if(!this._flying){this._flying=true;l.duration=r-i;this.view.flyToSphere(s,l)}}else{l.heading+=a;l.duration=0;this.view.flyToSphere(s,l)}};return Promise.resolve()}async start(){this._loop.start();console.info("start rotate:"+this._loop.id)}pause(){this._loop.pause();this._flying=false;this.cancelFlight()}finish(){this._loop.stop()}}class s extends h.Action{constructor(e,t){super(e,t);this._entities=[];this._startLoop=new h.Loop({duration:1e3,callback:(t,e)=>{console.info("start:scale",t,e);this._entities.forEach(e=>n(e,t))}});this._finishLoop=new h.Loop({duration:1e3,callback:(t,e)=>{console.info("finish:scale",t,e);this._entities.forEach(e=>n(e,1-t))},finish:()=>{console.info("finished");this._entities.forEach(e=>e.show=false)}})}start(){if(!this._entities)return;this._finishLoop.stop();this._entities.forEach(e=>e.show=true);this._startLoop.start()}pause(){this._startLoop.pause();this._finishLoop.pause()}finish(){if(!this._entities)return;this._startLoop.stop();this._finishLoop.start()}destroy(){if(this._entities){if(this.czviewer)this._entities.forEach(e=>this.czviewer.entities.remove(e));this._entities.length=0}}}function r(e,t){const{billboard:i,label:s,polygon:r,polyline:n}=e;if(n){n.show=t}if(r){r.show=t}}function n(e,t){const{billboard:i,label:s,polygon:r,polyline:n}=e;if(i)i.scale=t;if(s)s.scale=t}class o extends s{constructor(e,t){super(e,t);this._option=t}init(){return this._init()}async _init(){const e=this._option;const t=await _(e.icon);if(this.czviewer){const i=this.czviewer.entities.add({position:Cesium.Cartesian3.fromDegrees(...e.target),show:false,billboard:{scale:0,image:e.icon,verticalOrigin:Cesium.VerticalOrigin.BOTTOM},label:{scale:0,text:e.text,font:e.textFont,style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:h.CesiumAttrib.getColor(e.textColor),outlineColor:Cesium.Color.BLACK,outlineWidth:2,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-t.height-10)}});this._entities.push(i)}}}function a(e){if(typeof e==="string")return h.CesiumAttrib.getColor(e);e=Object.assign({},e);e.color=h.CesiumAttrib.getColor(e.color);e.outlineColor=h.CesiumAttrib.getColor(e.outlineColor);switch(e.type){case"arrow":return new Cesium.PolylineArrowMaterialProperty(e.color);case"dash":return new Cesium.PolylineDashMaterialProperty(e);case"outline":return new Cesium.PolylineOutlineMaterialProperty(e);case"glow":return new Cesium.PolylineGlowMaterialProperty(e)}}function l(e,t,i){if(!e)return;const s=e[t];if(!s)return;const r=s.getValue(undefined);if(!r)return;const n=r.withAlpha(i);e[t]=n}class c extends s{constructor(e,t){super(e,t);this._option=t}async init(){let e=await m(this._option.points);this.createEntity(e)}createEntity(e){if(this.czviewer){const t=this.czviewer.entities.add({show:false,polyline:{positions:e.map(e=>Cesium.Cartesian3.fromDegrees(...e)),width:this._option.width,material:a(this._option.material)}});this._entities.push(t)}}}class u extends s{constructor(e,t){super(e,t);this._option=t}async init(){let e=await p(this._option.points);this.createEntity(e[0])}createEntity(e){const t=this._option;const i=Cesium.AxisAlignedBoundingBox.fromPoints(e.map(e=>new Cesium.Cartesian3(...e)));const s=Cesium.Cartesian3.midpoint(i.minimum,i.maximum,new Cesium.Cartesian3);const r=Cesium.Cartesian3.fromDegrees(s.x,s.y,s.z);const n={show:false};const o=e.map(e=>Cesium.Cartesian3.fromDegrees(...e));if(t.color){n.polygon={hierarchy:o,fill:true,material:a(t.color),outlineColor:h.CesiumAttrib.getColor(t.outlineColor)}}if(t.outlineColor&&t.outlineWidth){n.polyline={positions:o,width:t.outlineWidth,material:a(t.outlineColor)}}if(this._option.text){n.position=r;n.label={scale:0,text:t.text,font:t.textFont,fillColor:h.CesiumAttrib.getColor(t.textColor),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-10)}}this._entities.push(this.czviewer.entities.add(n))}}class d extends u{constructor(e,t){super(e,t)}async init(){}}async function m(e){if(typeof e==="string"){const t=await h.fetchJSON(e);const i=t.geometry.type;if(i==="LineString")return t.geometry.coordinates;else if(i==="Polygon")return t.geometry.coordinates[0];else{console.warn("错误的文件格式");return[]}}else{return e}}async function p(e){if(typeof e==="string"){const t=await h.fetchJSON(e);const i=t.geometry.type;if(i==="LineString")return[t.geometry.coordinates];else if(i==="Polygon")return t.geometry.coordinates;else{console.warn("错误的文件格式");return[]}}else{return e}}class f extends s{constructor(e,t){super(e,t);const i=Cesium.Cartesian3.fromDegrees(...t.points[0]);const s=Cesium.Cartesian3.fromDegrees(...t.points[1]);t.points.map(e=>Cesium.Cartesian3.fromDegrees(...e));if(this.czviewer){const r=this.czviewer.entities.add({show:false,position:Cesium.Cartesian3.midpoint(i,s,new Cesium.Cartesian3),label:{scale:0,text:t.text,font:t.textFont,fillColor:h.CesiumAttrib.getColor(t.textColor),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-20)},polyline:{positions:[i,s],width:t.lineWidth,material:new Cesium.PolylineArrowMaterialProperty(h.CesiumAttrib.getColor(t.lineColor))}});this._entities.push(r)}}}function _(s){return new Promise((e,t)=>{const i=new Image;i.onload=()=>e(i);i.crossOrigin="anonymous";i.src=s})}const y={flyto:t,viewinfo:e,pin:o,polyline:c,polygon:u,distance:f,rotate:i};function C(e,t){const i=y[t.type];if(!i)return;return new i(e,t)}h.createAction=C;function g(e,t){y[e]=t}h.registerAction=g})(CZMAP||(CZMAP={}));var CZMAP;(function(t){let i;(function(e){e["ID"]="id";e["PROPERTIES"]="properties";e["GEOMETRY"]="geometry"})(i=t.FeatureProperty||(t.FeatureProperty={}));class s extends t.BaseObject{constructor(e){super();this.def(i.ID,-1);this.def(i.PROPERTIES,{});this.def(i.GEOMETRY,null,s.checkGeometry);if(t.Types.isDefined(e)){this.set(i.ID,e.id);this.set(i.PROPERTIES,e.properties);this.set(i.GEOMETRY,e.geometry)}}get id(){return this.get(i.ID)}set id(e){this.set(i.ID,e)}get properties(){return this.get(i.PROPERTIES)}set properties(e){this.set(i.PROPERTIES,e)}get geometry(){return this.get(i.GEOMETRY)}set geometry(e){this.set(i.GEOMETRY,e)}static checkGeometry(e){return t.GeometryFactory.create(e)}}t.Feature=s})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{constructor(){this._box=new e.BoundingBox;if(this.constructor===t){throw new Error("Geometry is abstract.")}}get type(){return this.getGeometryType()}get coordinates(){return this.getCoordinates()}get box(){if(this._box.isEmpty())this.computeBox();return this._box.clone()}computeBox(){this._box.mergeCoordinates(this.coordinates)}}e.Geometry=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["ARRAY_BUFFER"]="arraybuffer";e["JSON"]="json";e["TEXT"]="text";e["XML"]="xml"})(t=e.FeatureFormatType||(e.FeatureFormatType={}));class i{constructor(){}}e.FeatureFormat=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["POINT"]="point";e["POLYLINE"]="polyline";e["POLYGON"]="polygon";e["MULTI_POINT"]="multipoint";e["MULTI_POLYLINE"]="multipolyline";e["MULTI_POLYGON"]="multipolygon";e["CIRCLE"]="circle";e["RECTANGLE"]="rectange"})(t=e.GeometryType||(e.GeometryType={}))})(CZMAP||(CZMAP={}));var CZMAP;(function(t){class e{static create(e){if(!t.Types.isDefined(e))return undefined;if(e instanceof t.Geometry)return e;switch(e.type.toLowerCase()){case t.GeometryType.POINT:return new t.GeoPoint(e);case t.GeometryType.POLYLINE:case"linestring":return new t.GeoPolyline(e);case t.GeometryType.POLYGON:return new t.GeoPolygon(e);case t.GeometryType.CIRCLE:return new t.GeoCircle(e);case t.GeometryType.RECTANGLE:return new t.GeoRectangle(e)}}}t.GeometryFactory=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.FeatureFormat{constructor(){super()}getType(){return e.FeatureFormatType.JSON}readFeature(e,t){return this.readFeatureFromObject(i(e),t)}readFeatures(e,t){return this.readFeaturesFromObject(i(e),t)}readProjection(e,t){return this.readProjectionFromObject(i(e),t)}readGeometry(e,t){return this.readGeometryFromObject(i(e),t)}}e.JSONFeatureFormat=t;function i(e){if(typeof e==="string"){const t=JSON.parse(e);return t?t:null}else if(e!==null){return e}else{return null}}})(CZMAP||(CZMAP={}));var CZMAP;(function(r){class e extends r.JSONFeatureFormat{constructor(){super()}readFeatureFromObject(e){let t=null;if(e["type"]==="Feature"){t=e}else{t={type:"Feature",geometry:e,properties:null}}const i=n(t["geometry"]);const s=new r.Feature;s.geometry=i;if("id"in t){s.id=t["id"]}if(t["properties"]){s.properties=t["properties"]}return s}readFeaturesFromObject(e){const t=e;let i;if(t["type"]==="FeatureCollection"){i=[];const s=e;const r=s["features"];for(let e=0,t=r.length;e<t;++e){i.push(this.readFeatureFromObject(r[e]))}}else{i=[this.readFeatureFromObject(e)]}return i}readGeometryFromObject(e){return n(e)}readProjectionFromObject(e){const t=e["crs"];let i;if(t){if(t["type"]=="name"){i=""}else{}}return i}}r.GeoJSONFormat=e;const t={Point:r.GeometryType.POINT,LineString:r.GeometryType.POLYLINE,Polygon:r.GeometryType.POLYGON,MultiPoint:r.GeometryType.MULTI_POINT};function n(e){if(!e){return null}return r.GeometryFactory.create(e)}})(CZMAP||(CZMAP={}));var CZMAP;(function(m){let p;(function(e){e["XY"]="xy";e["XYZ"]="xyz";e["XYM"]="xym";e["XYZM"]="xyzm"})(p=m.GeometryLayout||(m.GeometryLayout={}));class e extends m.JSONFeatureFormat{constructor(e){super();this._meta=e}readFeatureFromObject(e,t){const i=this.getTableMeta(t);const s=new m.Feature;s.geometry=r(e,i);s.properties=e;return s}readFeaturesFromObject(e){const t=e;const i=this.getDataList(e);let s=[];if(m.Types.isArray(i)){i.forEach(e=>{s.push(this.readFeatureFromObject(e,t.meta))})}return s}readGeometryFromObject(e,t){return r(e,this.getTableMeta(t))}readProjectionFromObject(e,t){const i=e;if(i.meta&&i.meta.epsg)return"EPSG:"+i.meta.epsg;return null}getTableMeta(e){return m.defaultValue(this._meta,e)}getDataList(t){const e=this.getTableMeta(t.meta);if(!e.datapath)return t.data;e.datapath.forEach(e=>t=t[e]);return t}}m.TableDataFormat=e;function f(t,i,...s){if(m.defined(i)){let e=t[i];if(m.defined(e))return e;if(typeof i==="number")return i}for(let e=0;e<s.length;++e){const r=t[s[e]];if(m.defined(r))return r}return undefined}function r(e,t){if(!e){return null}const s=e;if(m.Types.isArray(s.coordinates)){if(!m.Types.isDefined(s.type)){s.type=y(s.coordinates)}return m.GeometryFactory.create(s)}const r=t;if(!m.Types.isDefined(r))return null;const i=m.defaultValue(r.type,m.GeometryType.POINT);if(i===m.GeometryType.POINT){let e=f(s,r.x,"x","X");let t=f(s,r.y,"y","Y");let i=f(s,r.z,"z","Z");e=m.Types.isDefined(e)?Number.parseFloat(e):0;t=m.Types.isDefined(t)?Number.parseFloat(t):0;i=m.Types.isDefined(i)?Number.parseFloat(i):0;return new m.GeoPoint(e,t,i)}if(!m.defined(r.coordinates))return null;const n=s[r.coordinates];if(typeof n!=="string")return null;try{const o=JSON.parse(n);return m.GeometryFactory.create({type:i,coordinates:o})}catch(s){}try{const o=[];const a=m.defaultValue(r.layout,p.XY);const l=_(a);const h=m.Parse.parseArray(n,",;");const c=h.length/l;for(let e=0;e<c;++e){const u=[];const d=e*l;for(let e=0;e<l;++e){u.push(h[d+e])}o.push(u)}return m.GeometryFactory.create({type:m.GeometryType.POLYLINE,coordinates:o})}catch(s){}}function _(e){switch(e){case p.XY:return 2;case p.XYZ:case p.XYM:return 3;case p.XYZM:return 4}return 2}function y(e){if(!m.Types.isArray(e))return undefined;if(!m.Types.isArray(e[0]))return m.GeometryType.POINT;if(!m.Types.isArray(e[0][0]))return m.GeometryType.POLYLINE;return m.GeometryType.POLYGON}})(CZMAP||(CZMAP={}));var CZMAP;(function(c){function e(e,t,i){const s=e[t];const r=e[i];if(s>r){e[t]=r;e[i]=s}}class u{constructor(){this.minx=Infinity;this.miny=Infinity;this.minz=Infinity;this.maxx=-Infinity;this.maxy=-Infinity;this.maxz=-Infinity}static formString(e,t){if(!t)t=new u;const i=c.Numbers.parseArray(e,",",6);t.minx=i[0];t.miny=i[1];t.minz=i[2];t.maxx=i[3];t.maxy=i[4];t.maxz=i[5];return t}static formCenterSize(e,t,i){if(!i)i=new u;const s=c.GeoMath.mulScalar(t,.5);const[r,n,o]=e;const[a,l,h]=s;i.minx=r-a;i.miny=n-l;i.minz=o-h;i.maxx=r+a;i.maxy=n+l;i.maxz=o+h;return i}static fromExtent(e){const t=new u;const[i,s,r,n]=e;t.minx=i;t.miny=s;t.minz=0;t.maxx=r;t.maxy=n;t.maxx=Math.min(t.getWidth(),t.getHeight())*111e3*.5;return t}normalMinMax(){e(this,"minx","maxx");e(this,"miny","maxy");e(this,"minz","maxz")}setMin(e){this.minx=e[0];this.miny=e[1];this.minz=e[2]}setMax(e){this.maxx=e[0];this.maxy=e[1];this.maxz=e[2]}setMinMax(e,t){this.minx=e[0];this.miny=e[1];this.minz=e[2];this.maxx=t[0];this.maxy=t[1];this.maxz=t[2];this.normalMinMax()}getCenter(e){return c.createOrUpdatePoint((this.minx+this.maxx)/2,(this.miny+this.maxy)/2,(this.minz+this.maxz)/2,e)}getWidth(){return this.maxx-this.minx}getHeight(){return this.maxy-this.miny}getDepth(){return this.maxz-this.minz}getMin(e){return c.createOrUpdatePoint(this.minx,this.miny,this.minz,e)}getMax(e){return c.createOrUpdatePoint(this.maxx,this.maxy,this.maxz,e)}getSize(e){return c.createOrUpdatePoint(this.maxx-this.minx,this.maxy-this.miny,this.maxz-this.minz,e)}getBoundRadius(){return c.GeoMath.calcLength(c.GeoMath.sub(this.getCenter(),this.getMin()))}isEmpty(){return this.minx>this.maxx||this.miny>this.maxy||this.minz>this.maxz}setEmtpty(){this.minx=Infinity;this.miny=Infinity;this.minz=Infinity;this.maxx=-Infinity;this.maxy=-Infinity;this.maxz=-Infinity}inflate(e){this.inflateXYZ(e,e,e)}inflateMultiple(e){const t=this.getCenter();const i=this.getSize();this.minx=t[0]-i[0]/2*e;this.miny=t[1]-i[1]/2*e;this.minz=t[2]-i[2]/2*e;this.maxx=t[0]+i[0]/2*e;this.maxy=t[1]+i[1]/2*e;this.maxz=t[2]+i[2]/2*e}inflateXYZ(e,t,i){this.minx-=e;this.miny-=t;this.minz-=i;this.maxx+=e;this.maxy+=t;this.maxz+=i}containsPoint(e){return this.containsXYZ(e[0],e[1],e[2])}containsXYZ(e,t,i){const s=e>=this.minx&&e<=this.maxx&&t>=this.miny&&t<=this.maxy;if(c.Types.isDefined(i)){return s&&i>=this.minz&&i<=this.maxz}else{return s}}clone(e){if(!e)e=new u;e.minx=this.minx;e.miny=this.miny;e.minz=this.minz;e.maxx=this.maxx;e.maxy=this.maxy;e.maxz=this.maxz;return e}mergeBox(e){if(e.minx<this.minx)this.minx=e.minx;if(e.miny<this.miny)this.miny=e.miny;if(e.minz<this.minz)this.minz=e.minz;if(e.maxx>this.maxx)this.maxx=e.maxx;if(e.maxy>this.maxy)this.maxy=e.maxy;if(e.maxz>this.maxz)this.maxz=e.maxz}mergePoint(e){this.mergeXYZ(e[0],e[1],e[2])}mergeXYZ(e,t,i){if(e<this.minx)this.minx=e;if(t<this.miny)this.miny=t;if(i<this.minz)this.minz=i;if(e>this.maxx)this.maxx=e;if(t>this.maxy)this.maxy=t;if(i>this.maxz)this.maxz=i}mergeCoordinates(e){const s=e;if(!c.Types.isArray(s))return;if(c.Types.isArray(s[0])){s.forEach(e=>this.mergeCoordinates(e))}else if(c.Types.isNumber(s[0])){let[e,t,i]=s;this.mergeXYZ(e,t,c.defaultValue(i,0))}}}u.Empty=Object.freeze(new u);c.BoundingBox=u})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{static createEmpty(){return[Infinity,Infinity,-Infinity,-Infinity]}static createOrUpdate(e,t,i,s,r){if(r){r[0]=e;r[1]=t;r[2]=i;r[3]=s;return r}else{return[e,t,i,s]}}static createOrUpdateEmpty(e){return this.createOrUpdate(Infinity,Infinity,-Infinity,-Infinity,e)}static createOrUpdateFromCoordinates(e,t){const i=this.createOrUpdateEmpty(t);return this.extendCoordinates(i,e)}static boundingExtent(i){const s=this.createEmpty();for(let e=0,t=i.length;e<t;++e){this.extendCoordinate(s,i[e])}return s}static buffer(e,t,i){if(i){i[0]=e[0]-t;i[1]=e[1]-t;i[2]=e[2]+t;i[3]=e[3]+t;return i}else{return[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}}static clone(e,t){if(t){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}else{return e.slice()}}static containsCoordinate(e,t){return this.containsXY(e,t[0],t[1])}static containsExtent(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}static containsXY(e,t,i){return e[0]<=t&&t<=e[2]&&e[1]<=i&&i<=e[3]}static equals(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}static extend(e,t){if(t[0]<e[0]){e[0]=t[0]}if(t[2]>e[2]){e[2]=t[2]}if(t[1]<e[1]){e[1]=t[1]}if(t[3]>e[3]){e[3]=t[3]}return e}static extendCoordinate(e,t){if(t[0]<e[0]){e[0]=t[0]}if(t[0]>e[2]){e[2]=t[0]}if(t[1]<e[1]){e[1]=t[1]}if(t[1]>e[3]){e[3]=t[1]}}static extendCoordinates(i,s){for(let t=0,e=s.length;t<e;++t){let e=s[t];if(Array.isArray(e[0]))this.extendCoordinates(i,e);else this.extendCoordinate(i,e)}return i}static extendXY(e,t,i){e[0]=Math.min(e[0],t);e[1]=Math.min(e[1],i);e[2]=Math.max(e[2],t);e[3]=Math.max(e[3],i)}static getArea(e){let t=0;if(!this.isEmpty(e)){t=this.getWidth(e)*this.getHeight(e)}return t}static getCenter(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2,0]}static getIntersection(e,t,i){const s=i?i:this.createEmpty();if(this.intersects(e,t)){if(e[0]>t[0]){s[0]=e[0]}else{s[0]=t[0]}if(e[1]>t[1]){s[1]=e[1]}else{s[1]=t[1]}if(e[2]<t[2]){s[2]=e[2]}else{s[2]=t[2]}if(e[3]<t[3]){s[3]=e[3]}else{s[3]=t[3]}}else{this.createOrUpdateEmpty(s)}return s}static getSize(e){return[e[2]-e[0],e[3]-e[1],0]}static getTopLeft(e){return[e[0],e[3],0]}static getTopRight(e){return[e[2],e[3],0]}static getBottomLeft(e){return[e[0],e[1],0]}static getBottomRight(e){return[e[2],e[1],0]}static getWidth(e){return e[2]-e[0]}static getHeight(e){return e[3]-e[1]}static intersects(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}static isEmpty(e){return e[2]<e[0]||e[3]<e[1]}static returnOrUpdate(e,t){if(t){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}else{return e}}static scaleFromCenter(e,t){const i=(e[2]-e[0])/2*(t-1);const s=(e[3]-e[1])/2*(t-1);e[0]-=i;e[2]+=i;e[1]-=s;e[3]+=s}}e.Extents=t})(CZMAP||(CZMAP={}));var CZMAP;(function(s){class r extends s.Geometry{constructor(e,t){super();this._center=[0,0,0];this._radius=0;if(e instanceof r){this._center=e._center.slice(0);this._radius=e._radius}else if(s.Types.isArray(e)){this._center=e.slice();this._radius=t}else if(s.Types.isObject(e)){const i=e;if(i.type===s.GeometryType.CIRCLE){this._center=s.deepCopy(i.center);this._radius=i.radius}}}get center(){return this._center}get radius(){return this._radius}clone(){return new r(this)}getCoordinates(){return this._center}getGeometryType(){return s.GeometryType.CIRCLE}applyTransform(e,t){this._box.setEmtpty();e.call(t,this._center,this._center)}computeBox(){this._box.setEmtpty();this._box.mergeXYZ(this._center[0]-this._radius,this._center[1]-this._radius,this._center[2]-this._radius);this._box.mergeXYZ(this._center[0]+this._radius,this._center[1]+this._radius,this._center[2]+this._radius)}}s.GeoCircle=r})(CZMAP||(CZMAP={}));var CZMAP;(function(n){class o extends n.Geometry{constructor(e,t,i){super();this.x=0;this.y=0;this.z=0;this._coordinates=new Array(3);if(e instanceof o){this.x=e.x;this.y=e.y;this.z=e.z}else if(n.Types.isArray(e)){this.x=e[0];this.y=e[1];this.z=e[2]}else if(n.Types.isObject(e)){const s=e;if(s.type.toLowerCase()===n.GeometryType.POINT){const r=s.coordinates;this.x=r[0];this.y=r[1];this.z=r[2]}}else if(n.Types.isNumber(e)){this.x=e;this.y=t;this.z=i}}clone(){return new o(this)}getCoordinates(){this._coordinates[0]=this.x;this._coordinates[1]=this.y;this._coordinates[2]=this.z;return this._coordinates}getGeometryType(){return n.GeometryType.POINT}applyTransform(e,t){this._box.setEmtpty();const i=this.getCoordinates();e.call(t,i,i);this.x=i[0];this.y=i[1];this.z=i[2]}computeBox(){this._box.setEmtpty();this._box.mergeXYZ(this.x,this.y,this.z)}}n.GeoPoint=o})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class s extends i.Geometry{constructor(e){super();this._coordinates=[];if(e instanceof s)this._coordinates=i.deepCopy(e.coordinates);else if(i.Types.isArray(e))this._coordinates=i.deepCopy(e);else if(i.Types.isObject(e)){const t=e;if(t.type.toLowerCase()===i.GeometryType.POLYGON){this._coordinates=i.deepCopy(t.coordinates)}}}clone(){return new s(this)}getCoordinates(){return this._coordinates}getGeometryType(){return i.GeometryType.POLYGON}applyTransform(i,s){this._box.setEmtpty();const e=this._coordinates;e.forEach(t=>{t.forEach(e=>{i.call(s,t,t)})})}}i.GeoPolygon=s})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class s extends i.Geometry{constructor(e){super();this._coordinates=[];if(e instanceof s)this._coordinates=i.deepCopy(e.coordinates);else if(i.Types.isArray(e))this._coordinates=i.deepCopy(e);else if(i.Types.isObject(e)){const t=e;if(t.type.toLowerCase()===i.GeometryType.POLYLINE||t.type.toLowerCase()==="linestring"){this._coordinates=i.deepCopy(t.coordinates)}}}clone(){return new s(this)}getCoordinates(){return this._coordinates}getGeometryType(){return i.GeometryType.POLYLINE}applyTransform(t,i){this._box.setEmtpty();const e=this._coordinates;e.forEach(e=>{t.call(i,e,e)})}}i.GeoPolyline=s})(CZMAP||(CZMAP={}));var CZMAP;(function(r){class n extends r.Geometry{constructor(e,t){super();this._min=[0,0,0];this._max=[0,0,0];if(e instanceof n){const i=e;r.copyPoint(i.min,this._min);r.copyPoint(i.max,this._max)}else if(r.Types.isArray(e)){r.copyPoint(e,this._min);r.copyPoint(t,this._max)}else if(r.Types.isObject(e)){const s=e;if(s.type.toLowerCase()===r.GeometryType.RECTANGLE){r.copyPoint(s.coordinates[0],this._min);r.copyPoint(s.coordinates[1],this._max)}}}get min(){return this._min}get max(){return this._max}clone(){return new n(this)}getCoordinates(){const e=n._coords;r.copyPoint(this._min,e[0]);r.copyPoint(this._max,e[1]);return e}getGeometryType(){return r.GeometryType.CIRCLE}applyTransform(e,t){this._box.setEmtpty();e.call(t,this._min,this._min);e.call(t,this._max,this._max)}computeBox(){this._box.setEmtpty();this._box.mergePoint(this._min);this._box.mergePoint(this._max)}}n._coords=[[0,0,0],[0,0,0]];r.GeoRectangle=n})(CZMAP||(CZMAP={}));var CZMAP;(function(e){function t(e,t){return r(e[0],e[1],e[2],t)}e.copyPoint=t;function i(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}e.comparePoint=i;function s(){return new Array(3)}e.createEmptyPoint=s;function r(e,t,i,s){if(!s){s=[e,t,i]}else{s[0]=e;s[1]=t;s[2]=i}return s}e.createOrUpdatePoint=r})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.Disposable{constructor(e){super();this._parent=e;this._view=e.map.view}get parent(){return this._parent}get view(){return this._view}get map(){return this._view.map}get visible(){return this._visible}set visible(e){if(e!==this._visible){this._visible=e;this._onVisibleChangle()}}zoomTo(e){this.flyTo(Object.assign({duration:0},e))}flyTo(e){this._view.flyToBox(this.box,e)}destroy(){}_disposeInternal(){this.destroy()}}e.LayerRender=t})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e extends i.LayerRender{constructor(e){super(e);this._init();this._initPropHandle()}get featureLayer(){return this.parent}get vectorLayer(){return this.featureLayer.parent}get feature(){return this.featureLayer.feature}get geometry(){return this.featureLayer.geometry}get style(){return this.featureLayer.style}destroy(){super.destroy();this._releasePropHandle();this._release()}_initPropHandle(){this.parent.onProperty(i.FeatureLayerProperty.FEATURE,this._handleFeatureChange,this);this.parent.onProperty(i.FeatureLayerProperty.STYLE,this._handleStyleChange,this);requestAnimationFrame(()=>this.parent.notifyAll())}_releasePropHandle(){this.parent.unProperty(i.FeatureLayerProperty.FEATURE,this._handleFeatureChange,this);this.parent.unProperty(i.FeatureLayerProperty.STYLE,this._handleStyleChange,this);this._unlistenFeature();this._unlistenStyle()}_handleFeatureChange(e){this._listenFeature(this.feature)}_handleStyleChange(e){this._listenStyle(this.featureLayer.style)}_listenFeature(e){this._unlistenFeature();const t=this.feature;t.onProperty(i.FeatureProperty.GEOMETRY,this._handleGeometryChange,this);t.notifyCurrent(i.FeatureProperty.GEOMETRY);this._handleFeature=t}_unlistenFeature(){if(this._handleFeature){this._handleFeature.unProperty(i.FeatureProperty.GEOMETRY,this._handleGeometryChange,this);this._handleFeature=undefined}}_listenStyle(e){this._unlistenStyle();const t=(e,t)=>{if(!e)return;e.on(i.BaseObjectEvents.PROPERTYCHANGE,t,this);e.notifyAll()};this._handleStyle=e;t(e.stroke,this._handleStrokeStyle);t(e.model,this._handleModelStyle);t(e.label,this._handleLabelStyle);t(e.icon,this._handleIconStyle);t(e.wall,this._handleWallStyle)}_unlistenStyle(){if(!this._handleStyle)return;const e=(e,t)=>{if(!e)return;e.un(i.BaseObjectEvents.PROPERTYCHANGE,t,this)};const t=this._handleStyle;e(t.stroke,this._handleStrokeStyle);e(t.model,this._handleModelStyle);e(t.label,this._handleLabelStyle);e(t.icon,this._handleIconStyle);e(t.wall,this._handleWallStyle)}_handleLabelStyle(e){}_handleIconStyle(e){}_handleModelStyle(e){}_handleStrokeStyle(e){}_handleWallStyle(e){}_notifyStyle(){this.parent.notifyCurrent(i.FeatureLayerProperty.STYLE)}_transformCoordinates(e){return i.Transforms.transformCoordinates(e,this.featureLayer.projection,this.parent.map.projection)}}i.FeatureRender=e})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e extends i.BaseObjectEvents{}e.INIT="init";e.DESTROY="destroy";i.LayerEvents=e;class s extends i.BaseObjectProperty{}s.VISIBLE="visible";s.OPACITY="opacity";s.COLOR="color";i.LayerProperty=s;class r extends i.BaseObject{constructor(e,t){super();this._inited=false;this._ready=Promise.resolve();t=t||{};this.define=t.define||{};this._owner=i.Types.isDefined(e)?e.owner:this;this._id=this._owner.nextID();this._parent=e;this._name=i.Types.defaultValue(t.name,`Layer-${this._id}`);this.set(s.VISIBLE,false,true);this.set(s.OPACITY,1,true);this.set(s.COLOR,"white",true);this.onProperty(s.VISIBLE,this._handleVisibleChange,this)}get id(){return this._id}get map(){return this._owner.map}get view(){return this._owner.view}get owner(){return this._owner}get parent(){return this._parent}get name(){return this._name}get type(){return"Layer"}get ready(){return this._ready}get visible(){return this.get(s.VISIBLE)}set visible(e){this.set(s.VISIBLE,e)}get opacity(){return this.get(s.OPACITY)}set opacity(e){this.set(s.OPACITY,e)}get color(){return this.get(s.COLOR)}set color(e){this.set(s.COLOR,e)}get children(){return[]}isFolder(){return false}setVisible(e){this.visible=e}zoomTo(e){this.flyTo(Object.assign({duration:0},e))}flyTo(e){this.view.flyToBox(this.boundBox,e)}_init(){if(this._inited)return;this._inited=true;this._createInner();this.dispatchEvent(e.INIT)}_prepReady(){this._ready=new Promise((e,t)=>{this._readyResolve=e;this._readyReject=t})}destroy(){this._destroyInner();this.dispatchEvent(e.DESTROY)}remove(){this.owner.removeLayer(this)}findLayer(t){let i;if(typeof t==="string"){i=e=>e.name==t}else{i=t}return a(this,r,0,e=>i(e)?e:undefined)}forEachLayers(e){a(this,r,0,e)}forEachTypeLayers(e,t){a(this,e,0,t)}_disposeInternal(){super._disposeInternal();this.destroy()}_handleVisibleChange(e){const t=this.visible;if(t){this._init()}this._onVisible(t)}_onVisible(e){}}i.Layer=r;function a(e,t,i,s){let r=undefined;const n=e.children.slice();for(let e=0;e<n.length;++e){const o=n[e];if(o instanceof t){r=s(o,i+1);if(r)return r}r=a(o,t,i+1,s);if(r)return r}return undefined}})(CZMAP||(CZMAP={}));var CZMAP;(function(i){let s;(function(e){e["FEATURE"]="feature";e["STYLE"]="style"})(s=i.FeatureLayerProperty||(i.FeatureLayerProperty={}));class e extends i.Layer{constructor(e,t){super(e,t);this._box=new i.BoundingBox;if(t.feature instanceof i.Feature){this.feature=t.feature}else{this.feature=new i.Feature(t.feature)}this.style=t.style;this.onProperty(s.FEATURE,()=>{this._box=this.geometry.box;const e=this.transformCoordinates(this._box.getMin());const t=this.transformCoordinates(this._box.getMax());this._box.setMinMax(e,t)})}get type(){return"FeatureLayer"}get parent(){return super.parent}get boundBox(){return Object.freeze(this._box)}set enableLabel(e){if(this.style.label)this.style.label.visible=e}get enableLabel(){return this.style.label?this.style.visible:false}set enableIcon(e){if(this.style.icon)this.style.visible=e}get enableIcon(){return this.style.icon?this.style.icon.visible:false}get feature(){return this.get(s.FEATURE)}set feature(e){if(!(e instanceof i.Feature)){e=new i.Feature(e)}this.set(s.FEATURE,e)}get enableCluster(){return this.parent.enableCluster}get projection(){return this.parent.projection}get style(){return this.get(s.STYLE)}set style(e){this.set(s.STYLE,e)}get properties(){return this.feature.properties}get geometry(){return this.feature.geometry}_onVisible(e){super._onVisible(e);const t=this.render;if(t)t.visible=e}transformCoordinates(e){return i.Transforms.transformCoordinates(e,this.projection,this.map.projection)}}i.FeatureLayer=e})(CZMAP||(CZMAP={}));var CZMAP;(function(r){class n extends r.Event{constructor(e,t){super(e);this.layer=t}}r.FolderEvent=n;class o extends r.LayerEvents{}o.CHILD_ADDED="child-added";o.CHILD_REMOVED="child-removed";r.FolderEvents=o;class e extends r.Layer{constructor(e,t){super(e,t);this._children=[];this.onProperty(r.LayerProperty.VISIBLE,this._handleFolderVisibleChanged,this)}createLayer(e,t){let i;if(typeof e==="string"){i=this.owner.getCreator(e)}else{i=e}if(typeof i!=="function"){console.error(`不支持的图层类型或者构造器`,e);return}const s=new i(this,t);if(s==null)return;this._children.push(s);this.dispatchEvent(new n(o.CHILD_ADDED,s));s.onProperty(r.LayerProperty.VISIBLE,this._handleChildVisibleChanged,this);s.setVisible(r.defaultValue(t.visible,true));return s}removeLayer(e){if(e instanceof r.Layer){e=this._children.indexOf(e);if(e==-1)return}if(!r.Types.isNumber(e)){return}let t=this._children[e];this._children.splice(e,1);this.dispatchEvent(new n(o.CHILD_REMOVED,t));t.destroy()}removeAllLayer(){let e=this._children.slice(0);e.forEach(e=>this.removeLayer(e))}get type(){return"Folder"}isFolder(){return true}get children(){return this._children.slice(0)}get boundBox(){const t=new r.BoundingBox;this._children.forEach(e=>t.mergeBox(e.boundBox));return t}_createInner(){}_destroyInner(){this.removeAllLayer()}_handleFolderVisibleChanged(e){if(e.data&&e.data.cascade)return;const t=this.visible;this.children.forEach(e=>e.visible=t)}_handleChildVisibleChanged(e){const t=e.target.get(e.key);if(t){this.set(r.LayerProperty.VISIBLE,t,false,{cascade:true})}}}r.Folder=e})(CZMAP||(CZMAP={}));var CZMAP;(function(s){class r extends s.FolderEvents{}r.LAYER_ADDED="layer-added";r.LAYER_REMOVED="layer-removed";r.LAYER_VISIBLE_CHANGED="layer-changed";s.LayerManagerEvents=r;class e extends s.Folder{constructor(e){super(null,{name:"LayerManager"});this._creators=new Map;this._terrains=[];this._onLayerAdded=t;this._onLayerRemoved=t;this._onLayerVisible=t;this._next_id=0;this._map=e;this._handleEvents(this);this._register("folder",s.Folder);this._register("vector",s.VectorLayer);this._register("point",s.VectorLayer);this._register("terrain",s.TerrainLayer)}get map(){return this._map}get view(){return this._map.view}get type(){return"LayerManager"}get terrains(){return this._terrains.slice()}get activeTerrain(){const e=this._terrains;if(e.length==0)return undefined;if(e.length==1)return e[0];const t=this._terrains.find(e=>e.visible);if(t)return t;return e[0]}nextID(){return this._next_id++}getCreator(e){return this._creators.get(e)}_register(e,t){this._creators.set(e,t)}get onLayerAdded(){return this._onLayerAdded}get onLayerRemoved(){return this._onLayerRemoved}get onLayerVisible(){return this._onLayerVisible}set onLayerAdded(e){this._onLayerAdded=s.Types.defaultValue(e,t)}set onLayerRemoved(e){this._onLayerRemoved=s.Types.defaultValue(e,t)}set onLayerVisible(e){this._onLayerVisible=s.Types.defaultValue(e,t)}_handleEvents(e){e.on(s.FolderEvents.CHILD_ADDED,this._handleLayerAdded,this);e.on(s.FolderEvents.CHILD_REMOVED,this._handleLayerRemoved,this);e.onProperty(s.LayerProperty.VISIBLE,this._handleLayerVisibleChange,this)}_unhandleEvents(e){e.un(s.FolderEvents.CHILD_ADDED,this._handleLayerAdded,this);e.un(s.FolderEvents.CHILD_REMOVED,this._handleLayerRemoved,this);e.unProperty(s.LayerProperty.VISIBLE,this._handleLayerVisibleChange,this)}_handleLayerAdded(e){const t=e.layer;if(t instanceof s.TerrainLayer){t.on(s.LayerEvents.CHANGE,this._handleTerrainChange,this);this._terrains.push(t)}this._handleEvents(t);this._onLayerAdded(t);this.dispatchEvent(new s.FolderEvent(r.LAYER_ADDED,t))}_handleLayerRemoved(e){const t=e.layer;if(t instanceof s.TerrainLayer){if(t===this._terrain){this._terrain=undefined;this._clearTerrain()}const i=this._terrains.indexOf(t);if(i!=-1){this._terrains.splice(i,1)}t.un(s.LayerEvents.CHANGE,this._handleTerrainChange,this)}this._unhandleEvents(t);this._onLayerRemoved(t);this.dispatchEvent(new s.FolderEvent(r.LAYER_REMOVED,t))}_handleLayerVisibleChange(e){const t=e.target;if(t===this)return;this._onLayerVisible(t);this.dispatchEvent(new s.FolderEvent(r.LAYER_VISIBLE_CHANGED,t))}_handleTerrainChange(e){const t=e.target;if(!t.visible){this._terrain=undefined;this._clearTerrain();return}this._terrains.forEach(e=>{if(e!=t)e.visible=false});this._terrain=t;this._applyTerrain(t)}_clearTerrain(){}_applyTerrain(e){}}s.LayerManager=e;function t(){}})(CZMAP||(CZMAP={}));var CZMAP;(function(u){function i(e){const t=[];for(var i=0;i<e.length;++i){t.push({name:e[i],index:[i]})}return t}class a{constructor(e){if(e){this.node=e.id;this.box=u.BoundingBox.formString(e.box)}}static fromPoint(e){const t=new a;t.box=u.BoundingBox.formCenterSize(e,[0,0,0]);return t}}u.ModelNode=a;let h;(function(e){e[e["GLTF"]=0]="GLTF";e[e["OBJ"]=1]="OBJ";e[e["ZFCLS"]=2]="ZFCLS";e[e["TDTILES"]=3]="TDTILES"})(h=u.ModelDataFormat||(u.ModelDataFormat={}));class d{constructor(e,t,i){this.label=new Cesium.LabelGraphics({text:e,scale:.5,font:u.Types.defaultValue(i.font,"32px 黑体"),style:Cesium.LabelStyle.FILL,pixelOffset:u.CesiumAttrib.getCartesian2(i.offset),fillColor:u.CesiumAttrib.getColor(i.color,Cesium.Color.WHITE),outlineColor:u.CesiumAttrib.getColor(i.borderColor,Cesium.Color.BLACK),outlineWidth:u.CesiumAttrib.getNumber(i.borderWidth,0),showBackground:true,backgroundColor:u.CesiumAttrib.getColor(i.backgroundColor,Cesium.Color.DARKGREY),horizontalOrigin:u.CesiumAttrib.getHorizontal(i.horizontalOrigin),verticalOrigin:u.CesiumAttrib.getVertical(i.vertitalOrigin),distanceDisplayCondition:u.CesiumAttrib.getDisplayDistance(i.visibleRange),scaleByDistance:u.CesiumAttrib.getNearFarScalar(i.scaleDistance),translucencyByDistance:u.CesiumAttrib.getNearFarScalar(i.fadeDistance)});const s=i.lineOffset;const r=i.lineWidth;const n=u.CesiumAttrib.getColor(i.lineColor,Cesium.Color.RED);if(s&&r>0){const o={show:true,width:r,material:n,positions:[]};if(Cesium.ArcType)o.arcType=Cesium.ArcType.NONE;else o.followSurface=false;this.line=new Cesium.PolylineGraphics(o);this.offset=s.slice();this.offset[0]/=111e3;this.offset[1]/=111e3}else{this.offset=[0,0,0]}this.entity=new Cesium.Entity({name:e,show:i.visible});this.entity.label=this.label;this.entity.polyline=this.line;this.tar=t.slice()}update(e){const t=this.tar;const i=m(this.tar,this.offset);const s=Cesium.Cartesian3.fromElements(...t);const r=Cesium.Cartesian3.fromElements(...i);Cesium.Matrix4.multiplyByPoint(e,s,s);Cesium.Matrix4.multiplyByPoint(e,r,r);this.entity.position=r;if(this.line)this.line.positions=[s,r]}}class e extends u.Folder{constructor(e,t){super(e,t);this._box=new u.BoundingBox;this._show_child=false;this._models=[];this._labels=[];this._modelOrientation=new Cesium.Quaternion;this._labelOrientation=new Cesium.Quaternion;this._modelMatrix4=new Cesium.Matrix4;this._labelMatrix4=new Cesium.Matrix4;this._updateHandle=0;this._url=t.url;this._offset=u.ZFclsModel.parsePosition(t.offset,[0,0,0]);this._position=u.Types.isDefined(t.position)?u.ZFclsModel.parsePosition(t.position):undefined;this._pose=u.ZFclsModel.parsePosition(t.pose,[0,0,0]);this._scale=u.ZFclsModel.parsePosition(t.scale,[1,1,1]);this.view3d=e.map.view3d;this.scene=this.view3d.cesium.scene;this._labelStyle=t.label;if(this._labelStyle)this._enableLabel=this._labelStyle.visible;this._flat=u.Parse.parseBoolean(t.flat);this._enableCluster=u.Parse.parseBoolean(t.enableCluster);this._expandChild=u.Parse.parseBoolean(t.expandChild);this._expandChildTree=u.Parse.parseBoolean(t.expandChildTree);this._expandLeafChild=u.Parse.parseBoolean(t.expandLeafChild);this._mergeChild=u.Types.defaultValue(t.mergeChild,i);this._prepReady()}_addModel(e){const t=Cesium.Model.fromGltf({url:e,incrementallyLoadTextures:true,scene:this.scene,show:this.visible,color:new Cesium.Color(.999,.999,.999)});t.id={_czmap_obj:this};this.scene.primitives.add(t);this._models.push(t);return t}_createSubLayer(e,t,i,s){const r=u.BoundingBox.formString(this._zfclsInfo.box);const n=r.getCenter();let o;if(u.Types.isDefined(this._labelStyle)&&i&&i.length){const a=new u.BoundingBox;i.forEach(e=>{a.mergeBox(e.box)});const l=a.getCenter();l[2]=a.maxz;p(l,n,l);const h=this._labelStyle;const c=new d(e,l,h);o=c.entity;this._labels.push(c);if(this.enableCluster)this.view3d.clusterEntities.add(o);else this.view3d.entities.add(o)}s=s||this;return s.createLayer(u.SubModelLayer,{name:e,model:t,nodes:i,label:o})}_createInner(){const e=this._url.toLowerCase();if(e.indexOf(".gltf")!=-1||e.indexOf(".glb")!=-1){this._createOriginalModel();return}const t=e.indexOf("/zs/data/");if(t!=-1){const i=this._url.substr(0,t);const s=this._url.substr(t+9);fetch(this._url+"?f=json").then(e=>{if(e.ok)return e.json()}).then(e=>{if(!u.Types.isDefined(e))return;const t=e.attributes.MiddleWare.toLowerCase();switch(t){case"obj":this._createObjModel(`${i}/zs/obj/${s}`);break;case"zmap":this._createZfclsModel(`${i}/zs/zfcls/${s}`);break;case"":break}})}else if(e.indexOf("/zs/obj/")!=-1){this._createObjModel()}else if(e.indexOf("/zs/zfcls/")!=-1){this._createZfclsModel()}}_initModelReady(){const t=[];this._models.forEach(e=>t.push(e.readyPromise));Cesium.when.all(t).then(()=>this._readyResolve(),()=>this._readyReject())}_createOriginalModel(){this._format=h.GLTF;this._addModel(this._url);this._updatePositionAndPose(true);this._initModelReady()}_createObjModel(r){this._format=h.OBJ;if(!r)r=this._url;this._url2=r;fetch(r+"/files/zmapgltf.json").then(e=>{if(e.ok)return e.json();else throw"404"}).then(t=>{if(!this._position)this._position=u.ZFclsModel.parsePosition(t.position);if(!Array.isArray(t.children))return;if(t.children.length>1)this._show_child=true;for(let e=0;e<t.children.length;++e){const i=t.children[e];const s=this._addModel(`${r}/files/${i.url}`);if(this._expandChild){let e=i.url.lastIndexOf("/");let t=i.url.substring(e+1);e=t.lastIndexOf(".");if(e!=-1)t=t.substring(0,e);this._createSubLayer(t,s,[a.fromPoint(this._position)])}}this._updatePositionAndPose(true);this._initModelReady()}).catch(e=>{console.error(e)})}_createZfclsModel(o){this._format=h.ZFCLS;if(!o)o=this._url;this._url2=o;fetch(o+"/info").then(e=>{if(e.ok)return e.json()}).then(e=>{if(!e){console.warn(`请求模型数据失败，URL:'${o}'.`);return}const t=this._zfclsInfo=e;if(!this._position)this._position=u.ZFclsModel.parsePosition(t.position);const i=this._flat?"flat":0;const s=this._addModel(`${o}/model/${i}/${t.offset}`);if(this._expandChild){if(this._expandChildTree){t.children.forEach(e=>{this._createModelTreeItem(s,this,e)})}else{const r=u.ZFclsModel.tree2map(t.children);const n=u.ZFclsModel.merge(r,this._mergeChild);n.forEach(e=>{const t=e.items.map(e=>new a(e));this._createSubLayer(e.name,s,t)})}}this._updatePositionAndPose(true);this._initModelReady()})}_createModelTreeItem(t,e,i){const s=i.name&&i.name.length>0?i.name:`Feature-${i.id}`;if(!i.complex){this._createSubLayer(s,t,[new a(i)],e);return}while(i.children.length===1&&i.name===i.children[0].name){i=i.children[0]}function r(e){let t=false;e.children.forEach(e=>{if(e.complex)t=true});return t}if(this._expandLeafChild||r(i)){const n=this._createSubLayer(s,t,undefined,e);i.children.forEach(e=>{this._createModelTreeItem(t,n,e)})}else{const o=i.children.map(e=>new a(e));this._createSubLayer(s,t,o,e)}}get type(){return"ModelLayer"}get boundBox(){return Object.freeze(this._box)}get zfclsInfo(){return this._zfclsInfo}flyTo(e){this.zoomOrFlyto(e)}doExplode(e){this.ready.then(()=>{if(!this._explodes){this._explodes=new t(this.view3d.czviewer,this._models)}this._explodes.startExplode(e)})}restoreExplode(){if(this._explodes){this._explodes.restoreExplode()}}showBoxEntity(e=true,t){if(e){this._boxOption=Object.assign({color:"rgba(0,255,0,0.4)"},t)}else{this._boxOption=undefined}this._updateBoxEntity()}switchBoxEntity(e){this.showBoxEntity(!u.defined(this._boxOption),e)}_updateBoxEntity(){if(this._boxEntity)this.view3d.czviewer.entities.remove(this._boxEntity);const e=this._boxOption;if(!e)return;const t=this.boundBox.clone();t.inflateMultiple(1.2);this._boxEntity=this.view3d.czviewer.entities.add({name:"boundbox",rectangle:{coordinates:Cesium.Rectangle.fromDegrees(t.minx,t.miny,t.maxx,t.maxy),material:Cesium.Color.fromCssColorString(e.color),extrudedHeight:t.maxz,height:t.minz,outline:true,outlineColor:Cesium.Color.BLACK}})}showCoordGrid(e,t){if(e){this._gridOption=Object.assign({},t)}else{this._gridOption=undefined}this._updateCoordGrid()}switchCoordGrid(e){this.showCoordGrid(!u.defined(this._gridOption),e)}_updateCoordGrid(e){if(this._gridEntity)this.view3d.gridTool.remove(this._gridEntity);const t=this._gridOption;if(!t)return;const i=this.boundBox.clone();i.inflateMultiple(1.2);const s=Object.assign({},t);s.displayBox=i;s.dataBox=u.BoundingBox.formString(this.zfclsInfo.cbox);this._gridEntity=this.view.gridTool.create(s)}zoomOrFlyto(t){this.ready.then(()=>{let e=this._scale;if(this._format===h.ZFCLS&&!this._flat)e=[1,1,1];let r=null;this._models.forEach(e=>{const s=e["_runtime"].nodes;const t=Object.keys(s);t.forEach(e=>{const t=s[e];const i=t.commands;i.forEach(e=>{const t=e.boundingSphere.clone();Cesium.Matrix4.multiplyByPoint(e.command.modelMatrix,t.center,t.center);if(!r)r=t;else Cesium.BoundingSphere.union(t,r,r)})})});this.view.flyToSphere(r,t)})}showLabel(e){this.enableLabel=e}get enableLabel(){return this._enableLabel}set enableLabel(t){this._enableLabel=t;this.children.forEach(e=>e.enableLabel=t)}set position(e){this._position=u.ZFclsModel.parsePosition(e);this._updatePositionAndPose()}get position(){return this._position}set pose(e){this._pose=u.ZFclsModel.parsePosition(e);this._updatePositionAndPose()}get pose(){return this._pose}set scale(e){this._scale=u.ZFclsModel.parsePosition(e,[1,1,1]);this._updatePositionAndPose()}get scale(){return this._scale}set offset(e){this._offset=u.ZFclsModel.parsePosition(e,[0,0,0]);this._updatePositionAndPose()}get offset(){return this._offset}get enableCluster(){return this._enableCluster}set enableCluster(e){this._enableCluster=e}get format(){return this._format}get url2(){return this._url2}setClip(e,t){console.info("setClip",t);t=u.Parse.parseNumber(t);const i=new Cesium.Cartesian3(0,0,0);switch(e){case"x":case"+x":i.x=1;break;case"y":case"+y":i.y=1;break;case"z":case"+z":i.z=1;break;case"-x":i.x=-1;break;case"-y":i.y=-1;break;case"-z":i.z=-1;break;default:i.z=-1;break}if(!this._clips){const s=u.CesiumAttrib.getCartesian3Degree(this._position);this._clips=new Cesium.ClippingPlaneCollection({enabled:true,planes:[new Cesium.ClippingPlane(i,t)],edgeWidth:1});if(this._format===h.ZFCLS&&!this._flat){const r=Cesium.Transforms.eastNorthUpToFixedFrame(s);Cesium.Matrix4.setTranslation(r,Cesium.Cartesian3.ZERO,this._clips.modelMatrix)}this.ready.then(()=>{this.models.forEach(e=>e.clippingPlanes=this._clips)})}else{const n=this._clips.get(0);n.distance=t}}clearClip(){if(this._clips){this._clips.enabled=false}}async syncScaleHeight(e){await Promise.all([this.ready,...e.map(e=>e.ready)]);const s=this.scale;const r=this.position;e.forEach(e=>{const t=e.position;const i=t[2]-r[2];e.scale=s;e.offset[2]=e.offset[2]+i*s[2]})}_updatePositionAndPose(e){clearTimeout(this._updateHandle);if(e)this._updatePositionAndPoseImpl();else this._updateHandle=setTimeout(()=>this._updatePositionAndPoseImpl())}_updatePositionAndPoseImpl(){const e=this._modelOrientation;const t=m(this._position,this._offset);let i=u.CesiumAttrib.getCartesian3Degree(t);let s=u.CesiumAttrib.getCartesian3(this._scale);if(this._format===h.ZFCLS&&!this._flat){Cesium.Quaternion.clone(c,e);s.x=s.y=s.z=1}else{const l=Cesium.HeadingPitchRoll.fromDegrees(this._pose[0]+90,this._pose[1],this._pose[2]);Cesium.Transforms.headingPitchRollQuaternion(i,l,undefined,undefined,e)}const r=Cesium.HeadingPitchRoll.fromDegrees(this._pose[0],this._pose[1],this._pose[2]);const n=Cesium.Transforms.headingPitchRollQuaternion(i,r,undefined,undefined,this._labelOrientation);const o=Cesium.Matrix4.fromTranslationQuaternionRotationScale(i,e,s,this._modelMatrix4);this._models.forEach(e=>e.modelMatrix=o);const a=Cesium.Matrix4.fromTranslationQuaternionRotationScale(i,n,s,this._labelMatrix4);this._labels.forEach(e=>e.update(a));this._updateBoundBox();this._updateBoxEntity();this._updateCoordGrid()}_updateBoundBox(){const e=this.scale;const t=this.offset;const i=this.position.slice();if(!this.zfclsInfo)return;const s=u.BoundingBox.formString(this.zfclsInfo.cbox);const r=s.getSize();u.GeoMath.mul(r,e,r);u.GeoMath.add(i,t,i);this._box=u.BoundingBox.formCenterSize(i,r,s)}_destroyInner(){this._models.forEach(e=>{this.scene.primitives.remove(e)});this._labels.forEach(e=>{this.view3d.clusterEntities.remove(e.entity);this.view3d.entities.remove(e.entity)});this._models.length=0;this._labels.length=0;this._show_child=false}_onVisible(t){this._models.forEach(e=>e.show=t)}get models(){return this._models}}u.ModelLayer=e;const c=new Cesium.Quaternion(-.5,-.5,-.5,.5);function m(e,t,i){if(!i)i=[0,0,0];i[0]=e[0]+t[0];i[1]=e[1]+t[1];i[2]=e[2]+t[2];return i}function p(e,t,i){if(!i)i=[0,0,0];i[0]=e[0]-t[0];i[1]=e[1]-t[1];i[2]=e[2]-t[2];return i}class t{constructor(e,t){this._explodes=[];this._viewer=e;this._models=t.slice();const n=[];this._models.forEach(e=>{const r=e["_runtime"].nodes;const t=Object.keys(r);t.forEach(e=>{const t=r[e];const i=t.commands;let s;i.forEach(e=>{n.push(e.boundingSphere);if(!s)s=e.boundingSphere.clone();else Cesium.BoundingSphere.union(e.boundingSphere,s,s)});this._explodes.push({key:e,node:t,translation:Cesium.Cartesian3.clone(t.translation),boundingSphere:s})})});this._boundingSphere=Cesium.BoundingSphere.fromBoundingSpheres(n)}startExplode(e){this.restoreExplode();this._start=new Date;this._option=e||{};this._tickInstance=this._viewer.scene.preRender.addEventListener(this._tick,this)}restoreExplode(){if(this._tickInstance){this._tickInstance();this._tickInstance=undefined}this._explodes.forEach(e=>{Cesium.Cartesian3.clone(e.translation,e.node.translation)});this._notifyModelChanged()}_notifyModelChanged(){this._models.forEach(e=>{e.maximumScale=1e11+Math.random()})}_tick(e,t){const i=new Date;const s=i.getTime()-this._start.getTime();let r=s/u.Types.defaultValue(this._option.duration,1e3);if(r>1){r=1;this._tickInstance();this._tickInstance=undefined}const n=u.Types.defaultValue(this._option.explodeMultiple,5);this._explodes.forEach(e=>{const t=e.boundingSphere.center.y-this._boundingSphere.center.y;const i=t*n*r;e.node.translation.y=e.translation.y+i});this._notifyModelChanged()}}})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class s extends i.LayerProperty{}s.POSITION="position";s.POSE="pose";s.SCALE="scale";i.MoveableLayerProperty=s;class e extends i.Layer{constructor(e,t){super(e,t);this.def(s.POSITION,[0,0,0],i.Numbers.parseArray3,i.ArrayUtils.equals);this.def(s.POSE,[0,0,0],i.Numbers.parseArray3,i.ArrayUtils.equals);this.def(s.SCALE,[1,1,1],i.Numbers.parseArray3,i.ArrayUtils.equals);this.onProperty(s.POSITION,this._handlePositionChange,this);this.onProperty(s.POSE,this._handlePoseChange,this);this.onProperty(s.SCALE,this._handleScaleChange,this);if(i.defined(t.position))this.position=t.position;if(i.defined(t.scale))this.scale=t.scale;if(i.defined(t.pose))this.pose=t.pose}get position(){return this.get(s.POSITION)}set position(e){this.set(s.POSITION,e)}get pose(){return this.get(s.POSE)}set pose(e){this.set(s.POSE,e)}get scale(){return this.get(s.SCALE)}set scale(e){this.set(s.SCALE,e)}move(e){}_handlePositionChange(e){this._notifyTransformChange()}_handlePoseChange(e){this._notifyTransformChange()}_handleScaleChange(e){this._notifyTransformChange()}_notifyTransformChange(){window.cancelAnimationFrame(this._updateHandle);this._updateHandle=window.requestAnimationFrame(()=>this._onTransformChange())}_onTransformChange(){}}i.MoveableLayer=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.Layer{constructor(e,t){super(e,t);this.options=t}get type(){return"StaticImageLayer"}}e.StaticImageLayer=t})(CZMAP||(CZMAP={}));var CZMAP;(function(l){class h extends l.Folder{constructor(e,t){var i;super(e,t);this._flashHandle=undefined;this._nodecmds=[];this.view3d=e.map.view3d;this._model=t.model;this._nodes=t.nodes;this._label=t.label;if(this._label){this._label["_czmap_obj"]=this}if((i=this._nodes)===null||i===void 0?void 0:i.length){Cesium.when(this._model.readyPromise).then(()=>{this._nodes.forEach(e=>{const t=this._model["_runtime"].nodesByName[e.node];if(!t)return;t.publicNode._czmap_obj=this;const i=t.commands;i.forEach(e=>{this._nodecmds.push(e)})})})}}flyTo(e){this.zoomOrFly(e)}_getBoundingSphere(i){this._nodecmds.forEach(e=>{const t=e.boundingSphere.clone();Cesium.Matrix4.multiplyByPoint(e.command.modelMatrix,t.center,t.center);if(!i)i=t;else Cesium.BoundingSphere.union(t,i,i)});return i}zoomOrFly(t){function i(e,t){t=e._getBoundingSphere(t);e.children.forEach(e=>{t=i(e,t)});return t}Cesium.when(this._model.readyPromise).then(()=>{const e=i(this);if(e){this.view3d.flyToSphere(e,t);this.startFlash({flashColor:t.flashColor})}})}_onVisible(t){this._nodecmds.forEach(e=>e.show=t);this.enableLabel=t}get enableLabel(){var e;return(e=this._label)===null||e===void 0?void 0:e.show}set enableLabel(e){if(this._label)this._label.show=e}get enableCluster(){return this.parent.enableCluster}get properties(){const r=[];if(!this._nodes)return r;const n=this._model.gltf;this._nodes.forEach(e=>{var t;const i=n.nodes.find(e=>e.name==e.node);if(!i)return;const s=n.meshes[i.mesh];r.push((t=s===null||s===void 0?void 0:s.extras)===null||t===void 0?void 0:t.attribute)});return r}startFlash(e){if(l.Types.isDefined(this._flashHandle))return;e=l.deepAssign({flashCount:6,flashInterval:500},e);const t=l.CesiumAttrib.getColor(l.defaultValue(e.flashColor,h.defaultFlashColor));const r=["command","silhouetteColorCommand","silhouetteModelCommand","translucentCommand","command2D","silhouetteColorCommand2D","silhouetteModelCommand2D","translucentCommand2D"];const n={gltf_color(){return t},gltf_colorBlend(){return t.alpha}};const i=this._nodecmds.map(e=>{const s={nc:e};r.forEach(t=>{const i=e[t];if(!i)return;s[t]={};Object.keys(n).forEach(e=>{s[t][e]=i.uniformMap[e]})});return s});function s(){i.forEach(e=>{const i=e.nc;r.forEach(e=>{const t=i[e];if(!t)return;Object.keys(n).forEach(e=>{t.uniformMap[e]=n[e]})})})}function o(){i.forEach(s=>{const e=s.nc;r.forEach(t=>{const i=e[t];if(!i)return;Object.keys(n).forEach(e=>{i.uniformMap[e]=s[t][e]})})})}let a=e.flashCount;this._flashHandle=setInterval(()=>{if(a%2==0)s();else o();a--;if(a===0){clearInterval(this._flashHandle);this._flashHandle=undefined}},e.flashInterval)}cancelFlash(){if(this._flashHandle){clearTimeout(this._flashHandle);this._flashHandle=0}}}h.defaultFlashColor="red";l.SubModelLayer=h})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.MoveableLayerProperty{}e.TDTilesLayerProperty=t;class i extends e.MoveableLayer{constructor(e,t){super(e,t)}}e.TDTilesLayer=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.Layer{constructor(e,t){super(e,t);this._option=t}setClip(e){this._option.clip=e;this.changed()}get boundBox(){return e.BoundingBox.Empty}_createInner(){}_destroyInner(){}get type(){return"TerrainLayer"}get url(){return this._option.url}get option(){return this._option}}e.TerrainLayer=t})(CZMAP||(CZMAP={}));var CZMAP;(function(t){class i extends t.Layer{constructor(e,t){super(e,t);this.options=t;this.options.scheme=i.parseScheme(this.options.scheme)}get type(){return"TileLayer"}static parseScheme(e){if(t.Types.isString(e)&&e.toUpperCase()===t.TileLayerScheme.Geographic)return t.TileLayerScheme.Geographic;return t.TileLayerScheme.WebMercator}}t.TileLayer=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["Geographic"]="GEOGRAPHIC";e["WebMercator"]="WEBMERCATOR"})(t=e.TileLayerScheme||(e.TileLayerScheme={}))})(CZMAP||(CZMAP={}));var CZMAP;(function(t){class e extends t.BaseObject{constructor(e){super();this._projection=t.Types.defaultValue(e.projection,"EPSG:4326");this._state=t.Types.defaultValue(e.state,t.SourceState.READY)}get projection(){return this._projection}get state(){return this._state}refresh(){this.changed()}_setProjection(e){this._projection=e}_setState(e){this._state=e;this.changed()}}t.Source=e})(CZMAP||(CZMAP={}));var CZMAP;(function(r){let n;(function(e){e["ADDFEATURE"]="addfeature";e["CHANGEFEATURE"]="changefeature";e["REMOVEFEATURE"]="removefeature";e["CLEAR"]="clear"})(n=r.VectorSourceEventType||(r.VectorSourceEventType={}));class o extends r.Event{constructor(e,t){super(e);this.feature=t}}r.VectorSourceEvent=o;class e extends r.Source{constructor(e){super({projection:undefined,state:r.SourceState.UNDEFINED});this._box=new r.BoundingBox;this._keysmap=new Map;this._fidsmap=new Map;this._hasload=false;e=e||{};this._loader=r.VOID;this._format=e.format;this._url=e.url;if(r.Types.isDefined(e.projection))this._setProjection(e.projection);if(r.Types.isDefined(e.loader)){this._loader=e.loader}else if(r.Types.isDefined(this._url)&&r.Types.isDefined(this._format)){this._setState(r.SourceState.LOADING);this._loader=r.createUrlFeatureLoader(this._url,this._format,(e,t)=>{this._setProjection(t);this._setState(r.SourceState.READY);this.addFeatures(e)})}if(r.Types.isDefined(e.features)){e.features.forEach(this.addFeatureInternal,this);this._setState(r.SourceState.READY)}}addFeature(e){this.addFeatureInternal(e);this.changed()}addFeatureInternal(e){const t=r.getUid(e);if(this._keysmap.has(t))return;const i={id:e.id,key:t,feature:e};this._setupChangeEvents(i);this._keysmap.set(t,i);const s=e.id;if(s!==-1){this._fidsmap.set(s,i)}this.dispatchEvent(new o(n.ADDFEATURE,e))}_setupChangeEvents(e){e.bindch=e.feature.on(r.BaseObjectEvents.CHANGE,this._handleFeatureChange,this);e.bindpo=e.feature.on(r.BaseObjectEvents.PROPERTYCHANGE,this._handleFeatureChange,this)}addFeatures(e){e.forEach(e=>this.addFeatureInternal(e));this.changed()}clear(e){if(e){this._fidsmap.forEach(e=>{r.BaseObject.unByKey(e.bindch);r.BaseObject.unByKey(e.bindpo)});this._keysmap.clear();this._fidsmap.clear()}else{this.getFeatures().forEach(this.removeFeatureInternal,this)}const t=new o(n.CLEAR);this.dispatchEvent(t);this.changed()}forEachFeature(t,i){this._keysmap.forEach(e=>{t.call(i,e.feature)})}forEachFeatureInExtent(e,t,i){r.abstract()}forEachFeatureIntersectingExtent(e,t,i){r.abstract()}getFeatures(t){if(!t)t=[];this.forEachFeature(e=>t.push(e));return t}getFeaturesInExtent(e){return r.abstract()}getExtent(e){this._updateBox();return r.Extents.createOrUpdate(this._box.minx,this._box.miny,this._box.maxx,this._box.maxy,e)}getBox(e){this._updateBox();return this._box.clone(e)}_updateBox(){if(this._box.isEmpty()){this.forEachFeature(e=>{if(e.geometry)this._box.mergeBox(e.geometry.box)})}}getFeatureById(e){var t;return(t=this._fidsmap.get(e.toString()))===null||t===void 0?void 0:t.feature}getFormat(){return this._format}getUrl(){return this._url}_handleFeatureChange(e){const t=e.target;this.changed();this.dispatchEvent(new o(n.CHANGEFEATURE,t))}hasFeature(e){const t=r.getUid(e);return this._keysmap.has(t)}isEmpty(){return this._keysmap.size==0}loadFeatures(e,t,i){if(this._loader&&this._hasload==false){this._hasload=true;this._loader.call(this,null,t,i)}}removeFeature(e){this.removeFeatureInternal(e);this.changed()}removeFeatureInternal(e){const t=r.getUid(e);const i=this._keysmap.get(t);if(!r.Types.isDefined(i))return;r.BaseObject.unByKey(i.bindch);r.BaseObject.unByKey(i.bindpo);this._keysmap.delete(t);this._fidsmap.delete(i.id.toString());this.dispatchEvent(new o(n.REMOVEFEATURE,e))}}r.VectorSource=e})(CZMAP||(CZMAP={}));var CZMAP;(function(f){class _{static TriArea2D(e,t,i){let s=(e[0]-i[0])*(t[1]-i[1])-(e[1]-i[1])*(t[0]-i[0]);if(s<1e-20&&s>-1e-20)s=0;return s}static PolygonArea(t){const e=t.length;if(t==null||e<3)return 0;const i=e;let s=t[i-1];let r=t[0];let n=t[1];let o=r[1]*(s[0]-n[0]);for(let e=1;e<i;++e){s=r;r=n;n=t[(e+1)%i];o+=r[1]*(s[0]-n[0])}return o/2}static Dot2D(e,t){return e[0]*t[0]+e[1]*t[1]}static IsInTri(e,t,i,s){const r=f.GeoMath.sub(i,e);const n=f.GeoMath.sub(t,e);const o=f.GeoMath.sub(s,e);const a=_.Dot2D(r,r);const l=_.Dot2D(r,n);const h=_.Dot2D(r,o);const c=_.Dot2D(n,n);const u=_.Dot2D(n,o);const d=1/(a*c-l*l);const m=(c*h-l*u)*d;if(m<-1e-6||m>1.000001){return false}const p=(a*u-l*h)*d;if(p<-1e-6||p>1.000001){return false}return m+p<=1.000001}static Intersect2D(e,t,i,s,r,n=true){const o=_.TriArea2D(e,t,i);const a=_.TriArea2D(e,t,s);if(n&&o*a>=0){return false}const l=_.TriArea2D(i,s,e);const h=_.TriArea2D(i,s,t);if(n&&l*h>=0){return false}if(a-o==0){return false}if(r!=null){const c=l/(a-o);const u=c*(t[0]-e[0]);const d=c*(t[1]-e[1]);r[0]=e[0]+u;r[1]=e[1]+d}return true}static IsInSimplePolygon2D(t,e){let i=false;const s=t.length;let r=t[0][0];let n=t[0][1];let o=0,a=0;const l=e[0],h=e[1];for(let e=1;e<s;++e){o=t[e][0];a=t[e][1];if((a<=h&&h<n||n<=h&&h<a)&&l<(r-o)*(h-a)/(n-a)+o){i=!i}r=o;n=a}return i}static IsInPolygon2D(t,i){let s=false;const r=t.length;for(let e=0;e<r;++e){if(_.IsInSimplePolygon2D(t[e],i)){s=!s}}return s}static ProjPointToLine(e,t,i,s){if(!s)s=[0,0,0];const r=Math.abs(_.TriArea2D(e,t,i));const n=f.GeoMath.squareDistance(e,t);const o=f.GeoMath.squareDistance(e,i);const a=f.GeoMath.squareDistance(t,i);const l=r*r/n;const h=o-l;const c=a-l;if(h>n){return t}if(c>n){return e}const u=Math.sqrt(h/n);const d=u*(t[0]-e[0]);const m=u*(t[1]-e[1]);s[0]=e[0]+d;s[1]=e[1]+m;return s}}f.Math2D=_})(CZMAP||(CZMAP={}));var CZMAP;(function(d){const t=new d.GeoJSONFormat;class e{constructor(e){this._cellPrecent=.01;this._radius=0;e=e||{};this._radius=d.Types.defaultValue(e.radius,0);if(e.data){this._data=t.readFeatures(e.data);this._init()}else if(e.url){fetch(e.url).then(e=>e.json()).then(e=>{this._data=t.readFeatures(e);this._init()}).catch(e=>console.warn("load data error",e))}}_init(){if(!d.Types.isArray(this._data))return;const t=new d.BoundingBox;this._data.forEach(e=>{t.mergeBox(e.geometry.box)});const e=Math.max(...t.getSize());t.inflate(e*.05);const i=t.getWidth(),s=t.getHeight();const r=Math.max(i,s);const n=r*this._cellPrecent;const o=Math.floor(i/n);const a=Math.floor(s/n);const l=document.createElement("canvas");l.width=o;l.height=a;const h=l.getContext("2d");const c={ctx:h,box:t,width:i,height:s,cellNumX:o,cellNumY:a,cellSize:n};this._box=t;this._width=i;this._height=s;this._cellNumX=o;this._cellNumY=a;this._cellSize=n;if(this._radius)this._findRadius=Math.floor(this._radius/n);else this._findRadius=Math.floor(r*.1/n);this._ids=new Int32Array(o*a);this._data.forEach((e,t)=>{h.clearRect(0,0,o,a);const i=e.geometry;if(i.getGeometryType()==d.GeometryType.POLYLINE)this._drawLine(c,i);this._copyID(c,t+1)})}_drawLine(t,i){t.ctx.beginPath();t.ctx.lineWidth=1;t.ctx.strokeStyle="red";for(let e=0;e<i.coordinates.length;++e){const s=i.coordinates[e];const r=(s[0]-t.box.minx)/t.width*t.cellNumX;const n=(s[1]-t.box.miny)/t.height*t.cellNumY;if(e==0)t.ctx.moveTo(r,n);else t.ctx.lineTo(r,n)}t.ctx.stroke()}_copyID(e,t){const i=e.ctx.getImageData(0,0,e.cellNumX,e.cellNumY).data;const s=e.cellNumX*e.cellNumY;for(let e=0;e<s;++e){const r=e*4;if(i[r]!=0){this._ids[e]=t}}}findNearestPoint(t){const i={};const s=Math.floor((t[0]-this._box.minx)/this._cellSize);const e=Math.floor((t[1]-this._box.miny)/this._cellSize);const r=this._findRadius;for(let t=e-r;t<=e+r;++t){if(t<0||t>=this._cellNumY)continue;for(let e=s-r;e<=s+r;++e){if(e<0||e>=this._cellNumX)continue;const o=this._ids[e+t*this._cellNumX];if(o!=0)i[o-1]=1}}const n=[];for(let e in i){const a=this._data[e];const l=a.geometry;for(let e=1;e<l.coordinates.length;++e){const h=l.coordinates[e-1];const c=l.coordinates[e];const u=d.Math2D.ProjPointToLine(h,c,t);n.push({pt:u,sd:d.GeoMath.squareDistance(u,t)})}}if(n.length>0){n.sort((e,t)=>e.sd-t.sd);return n[0].pt}return undefined}}d.NearestPointInLine=e})(CZMAP||(CZMAP={}));var CZMAP;(function(r){let i;(function(e){e["SOURCE"]="source";e["STYLE"]="style"})(i=r.VectorLayerProperty||(r.VectorLayerProperty={}));const s={enable:false,duration:5,maxDistance:undefined,showTail:false,tailWidth:10,tailStyle:{type:"glow",glowPower:.2,taperPower:.5,color:Cesium.Color.CORNFLOWERBLUE},maxTailSeconds:5,maxTailLength:1e3};class n extends r.Folder{constructor(e,t){super(e,t);this._loaded=false;this._enableCluster=true;this.onProperty(i.SOURCE,this._handleSourceChange,this);this.onProperty(i.STYLE,this._handleStyleChange,this);this.onProperty(r.LayerProperty.VISIBLE,this._handleVectorVisibleChanged,this);this.source=t.source;this.style=t.style;this._enableCluster=r.Types.defaultValue(t.enableCluster,true);this._pointAnimation=r.deepAssign({},s,t.pointAnimation);this._processDeprecated(t);this._refLine=t.referenceLine;if(t.multiLevelCluster&&this.map.view3d){this._multiLevelCluster=new r.MultiLevelCluster(this.map.view3d.czviewer,t.multiLevelCluster)}if(!this.source)this.source=new r.VectorSource;if(!this.style)this.style=new r.FeatureStyle}_processDeprecated(e){this._pointAnimation.enable=r.defaultValue(e.enableAnimation,this._pointAnimation.enable);this._pointAnimation.duration=r.defaultValue(e.animationTimes,this._pointAnimation.duration);this._pointAnimation.maxDistance=r.defaultValue(e.maxAnimationDistance,this._pointAnimation.maxDistance)}get type(){return"FeatureCollectionLayer"}get boundBox(){return r.Transforms.transformBox(this.source.getBox(),this.projection,this.view.map.projection)}get source(){return this.get(i.SOURCE)}set source(e){if(e instanceof r.VectorSource)this.set(i.SOURCE,e)}get style(){return this.get(i.STYLE)}set style(e){if(e instanceof r.FeatureStyle||r.Types.isFunction(e))this.set(i.STYLE,e)}get enableCluster(){return this._enableCluster}get pointAnimation(){return this._pointAnimation}get multiLevelCluster(){return this._multiLevelCluster}get refLine(){return this._refLine}get projection(){const e=this.source;return e?e.projection:""}showLabel(t){this._children.forEach(e=>{e.enableLabel=t})}showIcon(t){this._children.forEach(e=>{e.enableIcon=t})}createFeatureLayer(e,t){let i;if(e instanceof r.Feature){i=e}else{i=new r.Feature(e)}const s=Object.assign({feature:i},t);if(!r.Types.isDefined(s.style)){s.style=this._getStyle(i)}if(!r.Types.isDefined(s.name)){s.name=s.style.name}if(!r.Types.isDefined(s.name)){s.name=`${this.name}-${this._children.length}`}s.visible=this.visible;return this.createLayer("feature",s)}removeFeatureLayer(t){let e;if(t instanceof r.Feature){e=this._children.find(e=>e.feature==t);if(e)this.removeLayer(e)}else if(t instanceof r.FeatureLayer){this.removeLayer(t)}}_createInner(){if(this.children.length==0&&this.source.state===r.SourceState.READY){this.source.forEachFeature(this.createFeatureLayer,this)}}flyTo(e){this.view.flyToBox(this.boundBox,e)}_handleSourceChange(e){const t=e.oldValue;if(t)t.un(n.events,this._handleSourceEvents,this);this.removeAllLayer();this.source.on(n.events,this._handleSourceEvents,this);this.source.loadFeatures(null,0,this.map.projection)}_handleStyleChange(e){const t=this.style;this._children.forEach(e=>{const t=e;t.style=this._getStyle(t.feature)})}_handleSourceEvents(e){switch(e.type){case r.VectorSourceEventType.ADDFEATURE:this.createFeatureLayer(e.feature);break;case r.VectorSourceEventType.REMOVEFEATURE:this.removeFeatureLayer(e.feature);break;case r.VectorSourceEventType.CHANGEFEATURE:break;case r.VectorSourceEventType.CLEAR:this.removeAllLayer();break}}_getStyle(e){const t=this.style;if(r.Types.isFunction(t)){return t(e,0)}else if(r.Types.isObject(t)){return t}else{return r.FeatureStyle.default}}_handleVectorVisibleChanged(e){if(this._multiLevelCluster){this._multiLevelCluster.show=this.visible}}}n.events=[r.VectorSourceEventType.ADDFEATURE,r.VectorSourceEventType.CHANGEFEATURE,r.VectorSourceEventType.CLEAR,r.VectorSourceEventType.REMOVEFEATURE];r.VectorLayer=n})(CZMAP||(CZMAP={}));var CZMAP;(function(i){const t={filterParam:{split_X:15,split_Y:2,max_X:75,max_Y:100},scale:[1,1,1],offset:[0,0,0],mode:1,sliceNum:[8,8]};class e extends i.Layer{constructor(e,t){super(e,t);this._view3d=e.map.view3d;this._options=t;this._box=new i.BoundingBox;this._box.setMin(t.volumeOptions.volumeMin);this._box.setMax(t.volumeOptions.volumeMax)}_createInner(){if(this._volumeRender)return;const e=this._options.volumeOptions;this._volumeRender=new ZMapVolume.VolumeRender(this._view3d.zmap3d,t);this._volumeSliceTool=new ZMapVolume.SliceTool(this._view3d.zmap3d,{});this._volumeGridTool=new ZMapVolume.GridLine(this._view3d.zmap3d,{stepZ:100});this._volumeRectTool=new ZMapVolume.RectPlane(this._view3d.zmap3d,{});this._volumeSliceTool.show=false;this._volumeGridTool.show=false;this._volumeRectTool.show=false;this._volumeRender.binding(this._volumeSliceTool);this._volumeRender.binding(this._volumeGridTool);this._volumeRender.binding(this._volumeRectTool);this._volumeRender.loadData({url:e.volumeData,min:e.volumeMin,max:e.volumeMax,offset:e.volumeOffset,scale:e.volumeScale,mode:e.volumeMode,rayDir:e.volumeRayDir,sliceNum:e.volumeSliceNum,colorMap:e.volumeColorMap,dataValueRange:e.volumeDataValueRange,sampleNum:e.volumeSampleNum});this._volumeRender.showVolume()}_destroyInner(){if(this._volumeRender){this._volumeRender.destroy();this._volumeRender=undefined}}get type(){return"VolumeLayer"}get boundBox(){return Object.freeze(this._box)}flyTo(e){this._zoomOrFlyto(e)}get volumeRender(){return this._volumeRender}get volumeSlice(){return this._volumeSliceTool}get volumeGrid(){return this._volumeGridTool}get volumeRect(){return this._volumeRectTool}_onVisible(e){this._volumeRender.show=e}_zoomOrFlyto(e){const t=this._volumeRender.box;const i=t.from.toCartesian3();const s=t.to.toCartesian3();const r=Cesium.BoundingSphere.fromPoints([i,s]);this.view.flyToSphere(r,e)}}i.VolumeLayer=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.LayerManager{}e.LayerManager2D=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{constructor(e){}set visible(e){}_destroyInner(){}}e.Point2D=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t={zmap:"",UrlTemplate:"",amap:"AmapImage",osm:"osmImage",tile:"tileImage"};class i extends e.TileLayer{constructor(e,t){super(e,t)}get boundBox(){throw new Error("Method not implemented.")}_onVisible(){throw new Error("Method not implemented.")}_createInner(){}_destroyInner(){}}e.TileLayer2D=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.FeatureRender{get view3d(){return this.map.view3d}}e.Feature3D=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.FeatureLayer{_createInner(){if(!this.geometry)return;if(this.geometry.type===e.GeometryType.POINT)this._render=new e.Point3D(this);if(this.geometry.type===e.GeometryType.POLYLINE)this._render=new e.Polyline3D(this)}_destroyInner(){if(this._render){this._render.destroy();this._render=undefined}}get render(){return this._render}}e.FeatureLayer3D=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){function t(){}e.creatImageyLayer=t})(CZMAP||(CZMAP={}));var CZMAP;(function(t){let e;function i(){if(!e)e=new Cesium.EllipsoidTerrainProvider;return e}class s extends t.LayerManager{constructor(e){super(e);this._register("terrain",t.TerrainLayer);this._register("tile",t.TileLayer3D);this._register("map",t.TileLayer3D);this._register("model",t.ModelLayer);this._register("volume",t.VolumeLayer);this._register("3dtiles",t.TDTilesLayer3D);this._register("feature",t.FeatureLayer3D);this._register("static",t.StaticImageLayer3D)}_clearTerrain(){const e=this.map.view3d.czviewer;e.terrainProvider=i();e.scene.globe.depthTestAgainstTerrain=false}_applyTerrain(e){const t=e.option;const i=t.clip||{};this.map.view3d.cegore.globe.setTerrain({url:t.url,tileWidth:20,tileHeight:20,waterHeight:0,heightOffset:t.heightOffset,heightScale:t.heightScale,heightScaleOffset:t.heightScaleOffset,qmesh:true,clip:JSON.stringify(i.clip),clipInner:i.inner,clipHeight:i.height,clipWall:i.wall,clipFloor:i.floor});const s=this.map.view3d.czviewer.scene.globe;s.depthTestAgainstTerrain=true;s.terrainProvider._czmap_obj=e}}t.LayerManager3D=s})(CZMAP||(CZMAP={}));var CZMAP;(function(g){const v=1/60;class t{constructor(e){this._point=e}get position(){const e=this._point.view3d.czviewer.clock.currentTime;return this._point.entity.position.getValue(e)}get properties(){return this._point.feature.properties}show(e){this._point.visible=e}}class e extends g.Feature3D{constructor(e){super(e);this._box=new g.BoundingBox;this._temp_hpr=new Cesium.HeadingPitchRoll;this._temp_ori=new Cesium.Quaternion;this._temp_date0=new Cesium.JulianDate;this._temp_date1=new Cesium.JulianDate;this._temp_date2=new Cesium.JulianDate;const t={id:e.id+"-point3d",show:true};this._entity=new Cesium.Entity(t);this._entity._czmap_obj=e;if(e.enableCluster)this.view3d.clusterEntities.add(this._entity);else this.view3d.entities.add(this._entity);const i=this.vectorLayer.pointAnimation;if(i.showTail){this._pathTail=this.view3d.pathTails.createTail({position:e=>{var t,i;return(i=(t=this.entity)===null||t===void 0?void 0:t.position)===null||i===void 0?void 0:i.getValue(e)},width:i.tailWidth,material:g.Polyline3D.getStrokeMaterial(i.tailStyle),maxLength:i.maxTailLength,maxSeconds:i.maxTailSeconds})}}get box(){return this._box}get entity(){return this._entity}_onVisibleChangle(){if(this._entity)this._entity.show=this.visible}_init(){}_release(){if(this._clusterItem)this.vectorLayer.multiLevelCluster.remove(this._clusterItem);if(this._entity){this.view3d.clusterEntities.remove(this._entity);this.view3d.entities.remove(this._entity);this._entity=undefined}if(this._pathTail){this.view3d.pathTails.removeTail(this._pathTail);this._pathTail=undefined}}_handleGeometryChange(){this._updatePositionAndPose();const e=this.vectorLayer.multiLevelCluster;if(e){if(!this._clusterItem){this._clusterItem=new t(this);e.add(this._clusterItem)}e.update()}}_handleStyleChange(e){this._entity.label=undefined;this._entity.billboard=undefined;this._entity.model=undefined;super._handleStyleChange(e)}_getLabel(){let e=this._entity.label;if(e)return e;e=new Cesium.LabelGraphics;e.style=Cesium.LabelStyle.FILL_AND_OUTLINE;e.scale=.5;e.showBackground=false;e.outlineWidth=0;e.disableDepthTestDistance=Number.POSITIVE_INFINITY;this._entity.label=e;return e}_getIcon(){let e=this._entity.billboard;if(e)return e;e=new Cesium.BillboardGraphics;e.disableDepthTestDistance=Number.POSITIVE_INFINITY;this._entity.billboard=e;return e}_getModel(){let e=this._entity.model;if(!e){e=new Cesium.ModelGraphics;this._entity.model=e}return e}_applyBillStyle(e,t,i){switch(t){case g.BillStyleProperty.OFFSET:e.pixelOffset=g.CesiumAttrib.getCartesian2(i);break;case g.BillStyleProperty.HORIZONTAL_ORIGIN:e.horizontalOrigin=g.CesiumAttrib.getHorizontal(i,Cesium.HorizontalOrigin.LEFT);break;case g.BillStyleProperty.VERTICAL_ORIGIN:e.verticalOrigin=g.CesiumAttrib.getVertical(i,Cesium.VerticalOrigin.BOTTOM);break;case g.BillStyleProperty.VISIBLE_RANGE:e.distanceDisplayCondition=g.CesiumAttrib.getDisplayDistance(i);break;case g.BillStyleProperty.SCALE_DISTANCE:e.scaleByDistance=g.CesiumAttrib.getNearFarScalar(i);break;case g.BillStyleProperty.FADE_DISTANCE:e.translucencyByDistance=g.CesiumAttrib.getNearFarScalar(i);break;case g.BillStyleProperty.DEPTH_DISTANCE:e.disableDepthTestDistance=i;break}}_handleLabelStyle(e){const t=e.target.get(e.key);if(!g.Types.isDefined(t))return;const i=this._getLabel();switch(e.key){case g.StyleProperty.VISIBLE:i.show=t;break;case g.LabelStyleProperty.TEXT:i.text=t;break;case g.LabelStyleProperty.FONT:i.font=g.Types.defaultValue(t,"32px 黑体");break;case g.LabelStyleProperty.COLOR:i.fillColor=g.CesiumAttrib.getColor(t,Cesium.Color.WHITE);break;case g.LabelStyleProperty.BORDER_COLOR:i.outlineColor=g.CesiumAttrib.getColor(t,Cesium.Color.BLACK);break;case g.LabelStyleProperty.BORDER_WIDTH:i.outlineWidth=g.CesiumAttrib.getNumber(t,0);break;case g.LabelStyleProperty.BACKGROUND:i.showBackground=g.CesiumAttrib.getBoolean(t,false);break;case g.LabelStyleProperty.BACKGROUND_COLOR:i.backgroundColor=g.CesiumAttrib.getColor(t,Cesium.Color.DARKGREY);break;default:this._applyBillStyle(i,e.key,t);break}}_handleIconStyle(e){const t=e.target.get(e.key);if(!g.Types.isDefined(t))return;const i=this._getIcon();switch(e.key){case g.StyleProperty.VISIBLE:i.show=t;break;case g.IconStyleProperty.SOURCE:i.image=t;break;case g.IconStyleProperty.COLOR:i.color=g.CesiumAttrib.getColor(t);break;case g.IconStyleProperty.ROTATION:i.rotation=g.CesiumAttrib.getRadian(t,0);break;case g.IconStyleProperty.WIDTH:i.width=g.CesiumAttrib.getNumber(t,undefined);break;case g.IconStyleProperty.HEIGHT:i.height=g.CesiumAttrib.getNumber(t,undefined);break;default:this._applyBillStyle(i,e.key,t);break}}_handleModelStyle(e){const t=e.target.get(e.key);const i=this._getModel();switch(e.key){case g.StyleProperty.VISIBLE:i.show=t;break;case g.ModelStyleProperty.SOURCE:i.uri=t;break;case g.ModelStyleProperty.POSE:this._updatePositionAndPose();break;case g.ModelStyleProperty.SCALE:i.scale=g.CesiumAttrib.getNumber(t,1);break}}_updatePositionAndPose(){let e=this.geometry.coordinates.slice();const t=this.style;const i=this.featureLayer.parent.refLine;if(i){const C=i.findNearestPoint(e);if(C!=null){e[0]=C[0];e[1]=C[1]}}this._transformCoordinates(e);this._box.setMin(e);this._box.setMax(e);const s=t.model?t.model.pose:[0,0,0];const r=g.CesiumAttrib.getCartesian3Degree(e);const n=Cesium.HeadingPitchRoll.fromDegrees(s[0]-90,s[1],s[2],this._temp_hpr);const o=Cesium.Transforms.headingPitchRollQuaternion(r,n,undefined,undefined,this._temp_ori);const a=this.vectorLayer.pointAnimation;if(!a.enable){this._entity.position=r;this._entity.orientation=o;return}const l=this._temp_pos2;const h=this._temp_pos1;if(l===undefined){this._temp_pos1=Cesium.Cartesian3.clone(r);this._temp_pos2=Cesium.Cartesian3.clone(r);this._entity.position=r;this._entity.orientation=o;return}if(Cesium.Cartesian3.equals(r,l)){return}Cesium.Cartesian3.clone(r,h);const c=a.duration;const u=this.view3d.czviewer.scene.lastRenderTime.clone(this._temp_date0);let d,m;if(a.maxDistance&&a.maxDistance<Cesium.Cartesian3.distance(l,h)){d=Cesium.JulianDate.addSeconds(u,-c,this._temp_date2);m=u.clone(this._temp_date1)}else{d=u.clone(this._temp_date1);m=Cesium.JulianDate.addSeconds(u,c,this._temp_date2)}const p=new Cesium.SampledPositionProperty;p.forwardExtrapolationType=Cesium.ExtrapolationType.HOLD;p.addSample(d,l);p.addSample(m,h);this._entity.position=p;const f=new Cesium.VelocityOrientationProperty(p);const _=f.getValue;f.getValue=(e,t)=>{if(Cesium.JulianDate.compare(e,m)>=0)e=Cesium.JulianDate.addSeconds(m,-v,this._temp_date0);return _.call(f,e,t)||o};this._entity.orientation=f;const y=this._temp_pos1;this._temp_pos1=this._temp_pos2;this._temp_pos2=y}}e.fullrange=new Cesium.TimeInterval({start:new Cesium.JulianDate,stop:new Cesium.JulianDate(3e6)});g.Point3D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(l){const e=1/60;class t{}class r extends l.Feature3D{constructor(e){super(e);this._items=[];this._box=new l.BoundingBox;this._updateHandle=0}get box(){return this._box}_init(){}_clearWall(){const t=this.view3d.entities;this._items.forEach(e=>{t.remove(e.wall);e.wall=undefined})}_clearPolyline(){const t=this.view3d.polylines;this._items.forEach(e=>{t.remove(e.polyline);e.polyline=undefined})}_release(){this._clearWall();this._clearPolyline()}_onVisibleChangle(){const t=this.visible;this._items.forEach(e=>{if(e.wall)e.wall.show=t;if(e.polyline)e.polyline.show=t})}_updateWalls(){const e=this.style.wall;const h=0;const c=e.height;const u=this.view3d.entities;this._items.forEach(t=>{const i=t.positions.length;let s=t.positions[0];const r=[s];const n=[h];const o=[c];for(let e=1;e<i;++e){const a=t.positions[e];const l=Cesium.Cartesian3.distance(s,a);const i=Math.round(l/c);for(let e=1;e<=i;++e){r.push(Cesium.Cartesian3.lerp(s,a,e/i,new Cesium.Cartesian3));n.push(h);o.push(c)}s=a}if(!t.wall)t.wall=u.add({wall:{}});const e=t.wall.wall;e.positions=r;e.minimumHeights=n;e.maximumHeights=o})}_createWalls(){if(!this.style.wall)return;this._updateWalls()}_createPoylines(){if(!this.style.stroke)return;this._items.forEach(e=>{const t=this.view3d.polylines.add({show:true,width:1,loop:false,positions:e.positions});t._czmap_obj=this.parent;e.polyline=t})}_updateGeometryImpl(){this._updateHandle=0;this._release();const e=this.feature.geometry;if(!e)return;let t;if(e.type==l.GeometryType.POLYLINE)t=[e.coordinates];else if(e.type==l.GeometryType.MULTI_POLYLINE)t=e.coordinates;else return;this._transformCoordinates(t);const r=new l.BoundingBox;this._items=t.map(e=>{const t=e.map(e=>{e[2]=l.defaultValue(e[2],0);let[t,i,s]=e;r.mergeXYZ(t,i,s);return Cesium.Cartesian3.fromDegrees(...e)});return{polyline:undefined,wall:undefined,coords:e,positions:t,length:i(t)}});this._createPoylines();this._createWalls();this._box=r;this._notifyStyle()}_updateGeometry(){cancelAnimationFrame(this._updateHandle);this._updateHandle=requestAnimationFrame(()=>this._updateGeometryImpl())}_handleGeometryChange(e){this._updateGeometry()}_handleStyleChange(e){if(!this.style.stroke)this._clearPolyline();if(!this.style.wall)this._clearWall();super._handleStyleChange(e)}_handleStrokeStyle(i){const s=i.target.get(i.key);this._items.forEach(e=>{const t=e.polyline;switch(i.key){case l.StyleProperty.VISIBLE:t.show=s;break;case l.StrokeStyleProperty.WIDTH:t.width=s;break;case l.StrokeStyleProperty.VISIBLE_RANGE:t.distanceDisplayCondition=l.CesiumAttrib.getDisplayDistance(s);break;case l.StrokeStyleProperty.DETAIL:t.material=r.getStrokeMaterial(s)}})}_handleWallStyle(o){const a=o.target.get(o.key);this._items.forEach(e=>{const t=e.wall;const i=t.wall;const s=this.style.wall;const r=s.height;const n=s.imageRepeatY;switch(o.key){case l.StyleProperty.VISIBLE:t.show=a;break;case l.WallStyleProperty.VISIBLE_RANGE:i.distanceDisplayCondition=l.CesiumAttrib.getDisplayDistance(a);break;case l.WallStyleProperty.COLOR:i.material=l.CesiumAttrib.getColor(s.color);break;case l.WallStyleProperty.HEIGHT:this._updateWalls();break;case l.WallStyleProperty.IMAGE:case l.WallStyleProperty.IMAGE_REPEAT_Y:i.material=new Cesium.ImageMaterialProperty({image:s.image,repeat:new Cesium.Cartesian2(e.length/r*n,n),transparent:true});break;case l.WallStyleProperty.OUTLINE_COLOR:case l.WallStyleProperty.OUTLINE_WITDH:if(s.outlineColor&&s.outlineWidth){i.outlineColor=l.CesiumAttrib.getColor(s.outlineColor);i.outlineWidth=s.outlineWidth;i.outline=true}else{i.outline=false}break}})}static getStrokeMaterial(e){switch(e.type){case l.StrokeDetailType.ARROW:return Cesium.Material.fromType(Cesium.Material.PolylineArrowType,{color:l.CesiumAttrib.getColor(e.color,Cesium.Color.WHITE)});case l.StrokeDetailType.DASH:const t=e;return Cesium.Material.fromType(Cesium.Material.PolylineDashType,{color:l.CesiumAttrib.getColor(e.color,Cesium.Color.WHITE),gapColor:l.CesiumAttrib.getColor(t.dashColor,Cesium.Color.TRANSPARENT),dashLength:l.Types.defaultValue(t.dashLength,16),dashPattern:l.Types.defaultValue(t.dashPattern,255)});case l.StrokeDetailType.GLOW:const i=e;return Cesium.Material.fromType(Cesium.Material.PolylineGlowType,{color:l.CesiumAttrib.getColor(e.color,Cesium.Color.WHITE),glowPower:l.Types.defaultValue(i.glowPower,.25),taperPower:l.Types.defaultValue(i.taperPower,1)});case l.StrokeDetailType.OUTLINE:const s=e;return Cesium.Material.fromType(Cesium.Material.PolylineOutlineType,{color:l.CesiumAttrib.getColor(e.color,Cesium.Color.WHITE),outlineColor:l.CesiumAttrib.getColor(s.outlineColor,Cesium.Color.BLACK),outlineWidth:l.Types.defaultValue(s.outlineWidth,1)});case l.StrokeDetailType.NORMAL:default:return Cesium.Material.fromType(Cesium.Material.ColorType,{color:l.CesiumAttrib.getColor(e.color,Cesium.Color.WHITE)})}}}l.Polyline3D=r;function i(s){let r=0;if(s.length>0){let i=s[0];for(let t=1;t<s.length;++t){let e=s[t];r+=Cesium.Cartesian3.distance(i,e);i=e}}return r}})(CZMAP||(CZMAP={}));var CZMAP;(function(r){class e extends r.StaticImageLayer{constructor(e,t){super(e,t);const i=t;var s={};s.type="SingleTile";s.url=i.url;s.visible=i.visible;s.rectangle=Cesium.Rectangle.fromDegrees(...i.extent);s.minimumLevel=r.Types.defaultValue(t.minLevel,0);s.maximumLevel=r.Types.defaultValue(t.maxLevel,18);this._ins=new Cegore.ImageLayer(s);this.view3d.cegore.images.add(this._ins);this._bb=r.BoundingBox.fromExtent(i.extent);this.onProperty(r.LayerProperty.OPACITY,()=>this._handleColorOpacity())}get view3d(){return this.map.view3d}get layer(){return this._ins}get boundBox(){return this._bb}_onVisible(){this._ins.visible=this.visible}_createInner(){}_destroyInner(){this.view3d.cegore.images.remove(this._ins)}_handleColorOpacity(){this._ins.alpha=this.opacity}}r.StaticImageLayer3D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e extends i.TDTilesLayer{constructor(e,t){super(e,t);this._view3d=e.map.view3d;this._options=t;this._prepReady()}_createInner(){if(this._3dtiles)return;const e=this._options;this._3dtiles=new Cesium.Cesium3DTileset({url:e.url,dynamicScreenSpaceErrorFactor:20,show:e.visible});this._3dtiles.readyPromise.then(()=>this._readyResolve(),e=>this._readyReject(e));this._onTransformChange();this._view3d.czscene.primitives.add(this._3dtiles)}_destroyInner(){if(this._3dtiles){this._view3d.czscene.primitives.remove(this._3dtiles);this._3dtiles.destroy()}}get type(){return"TDTilesLayer3D"}get boundBox(){const e=this._3dtiles.boundingSphere;const t=new Cegore.Position(e.center);return i.BoundingBox.formCenterSize([t.x,t.y,t.z],[e.radius,e.radius,e.radius])}flyTo(e){this._zoomOrFlyto(e)}get tdtiles(){return this._3dtiles}_onVisible(e){if(this._3dtiles)this._3dtiles.show=e}_zoomOrFlyto(e){if(!this._3dtiles)return;this._3dtiles.readyPromise.then(()=>{this.view.flyToSphere(this._3dtiles.boundingSphere,e)})}_onTransformChange(){if(!this._3dtiles)return;this.ready.then(()=>{if(!this._3dtiles.root)return;const e=this._3dtiles.root.transform;if(!Cesium.Matrix4.equals(e,Cesium.Matrix4.IDENTITY)){console.warn("the 3dtileset has owner transform, abort layer setting.");return}const t=this.position;const i=this.pose;const s=this.scale;const r=Cesium.Cartesian3.fromDegrees(...t);const n=Cesium.HeadingPitchRoll.fromDegrees(i[0],i[1],i[2]);const o=Cesium.Transforms.headingPitchRollQuaternion(r,n);const a=Cesium.Matrix4.fromTranslationQuaternionRotationScale(r,o,new Cesium.Cartesian3(...s),new Cesium.Matrix4);this._3dtiles.modelMatrix=a})}}i.TDTilesLayer3D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(n){const o={zmap:"ZMapImage",url:"UrlTemplate",UrlTemplate:"UrlTemplate",dem:"ZMapDemImage",tms:"UrlTemplate"};const a={[n.TileLayerScheme.Geographic]:"Geographic-level-0",[n.TileLayerScheme.WebMercator]:"WebMercator"};class e extends n.TileLayer{constructor(e,t){super(e,t);const i=t;const s=t;var r={};r.type=o[t.mapType];r.url=i.url;r.visible=t.visible;r.rectangle=t.extent;r.minimumLevel=n.Types.defaultValue(t.minLevel,1);r.maximumLevel=n.Types.defaultValue(t.maxLevel,18);r.scheme=a[t.scheme];r.subdomains=t.subdomains;this._ins=new Cegore.ImageLayer(r);this.view3d.cegore.images.add(this._ins);this.onProperty(n.LayerProperty.OPACITY,()=>this._handleColorOpacity())}get view3d(){return this.map.view3d}get layer(){return this._ins}get boundBox(){return new n.BoundingBox}_onVisible(){this._ins.visible=this.visible}_createInner(){}_destroyInner(){this.view3d.cegore.images.remove(this._ins)}_handleColorOpacity(){this._ins.alpha=this.opacity}}n.TileLayer3D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e extends i.MoveableLayer{constructor(e,t){super(e,t)}get boundBox(){return this._uvlayer.box}flyTo(e){this._uvlayer.flyTo(e)}move(e){if(!Array.isArray(e))e=[e];this._uvlayer.move(e)}setOpacity(e,t){this.opacity=e;if(i.defined(t))this.color=t}_onVisible(e){this._uvlayer.setVisible(e)}_destroyInner(){this._uvlayer.removeLayer()}_handleColorOpacity(){this._uvlayer.setOpacity(this.opacity,this.color)}_onTransformChange(){const e={};e.position=this.position;e.rotate=this.pose;e.scale=this.scale;this._uvlayer.updateLayer(e)}}i.MoveableLayerUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e extends i.MoveableLayerUE{constructor(e,t){super(e,t);this._option=t;this._uvlayer=new i.UELayerProxy(this.view,this)}_createInner(){const{path:e,position:t,pose:i,scale:s}=this._option;this._uvlayer.createLayer("dynActor",{path:e,visible:false,position:t,rotate:i,scale:s})}}i.DynActorLayerUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.FeatureLayer{_createInner(){if(!this.geometry)return;if(this.geometry.type===e.GeometryType.POINT)this._render=new e.PointUE(this);if(this.geometry.type===e.GeometryType.POLYLINE)this._render=new e.PolylineUE(this)}_destroyInner(){if(this._render){this._render.destroy();this._render=undefined}}get render(){return this._render}flyTo(e){var t;(t=this._render)===null||t===void 0?void 0:t.flyTo(e)}}e.FeatureLayerUE=t})(CZMAP||(CZMAP={}));var CZMAP;(function(t){class e extends t.FeatureRender{constructor(e){super(e);this._cachedUpdate={};this._uvlayer=new t.UELayerProxy(this.viewue,e)}get viewue(){return this.map.view}_onVisibleChangle(){this._uvlayer.setVisible(this.visible)}_release(){this._uvlayer.removeLayer()}_requestUpdate(e){t.deepAssign(this._cachedUpdate,e);cancelAnimationFrame(this._cachedHandle);this._cachedHandle=requestAnimationFrame(()=>{this._uvlayer.updateLayer(this._cachedUpdate);this._cachedUpdate={}})}flyTo(e){this._uvlayer.flyTo(e)}}t.FeatureUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(t){class e extends t.LayerManager{constructor(e){super(e);this._register("tile",t.TileLayerUE);this._register("map",t.TileLayerUE);this._register("3dtiles",t.TDTilesLayerUE);this._register("feature",t.FeatureLayerUE);this._register("dynActor",t.DynActorLayerUE);this._register("wrappedUE",t.WrappedLayerUE)}get viewue(){return this.map.view}get uview(){return this.viewue.uview}get uvapi(){return this.viewue.uvapi}_clearTerrain(){this.uvapi.setTerrain({url:""})}_applyTerrain(e){this.uvapi.setTerrain({url:e.url+"/tile/dem/tms/layer.json"})}}t.LayerManagerUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(s){class e extends s.FeatureUE{constructor(e){super(e);this._box=new s.BoundingBox;this._uvlayer.createLayer("point",{visible:true})}get box(){return this._box}get position(){return this.geometry.coordinates}flyTo(e){this._uvlayer.uvapi.flyTo({target:this.position,option:e})}_init(){}_handleGeometryChange(){this._updatePositionAndPose()}_handleStyleChange(e){super._handleStyleChange(e)}_handleLabelStyle(e){const t=e.target.get(e.key);if(!s.Types.isDefined(t))return;const i={};switch(e.key){case s.StyleProperty.VISIBLE:i.visible=t;break;case s.LabelStyleProperty.TEXT:i.text=t;break;case s.LabelStyleProperty.FONT:break;case s.LabelStyleProperty.COLOR:i.color=s.defaultValue(t,"white");break;case s.LabelStyleProperty.BORDER_COLOR:i.lineColor=s.defaultValue(t,"black");break;case s.LabelStyleProperty.BORDER_WIDTH:i.lineWidth=s.CesiumAttrib.getNumber(t,0);break;case s.LabelStyleProperty.BACKGROUND:i.background=s.CesiumAttrib.getBoolean(t,false);break;case s.LabelStyleProperty.BACKGROUND_COLOR:i.backgroundColor=s.defaultValue(t,"darkgrey");break}this._requestUpdate({label:i})}_handleIconStyle(e){const t=e.target.get(e.key);if(!s.Types.isDefined(t))return;const i={};switch(e.key){case s.StyleProperty.VISIBLE:i.visible=t;break;case s.IconStyleProperty.SOURCE:i.src=s.absURL(t);break;case s.IconStyleProperty.COLOR:i.color=t;break;case s.IconStyleProperty.ROTATION:i.rotation=t;break;case s.IconStyleProperty.WIDTH:i.width=s.CesiumAttrib.getNumber(t,undefined);break;case s.IconStyleProperty.HEIGHT:i.height=s.CesiumAttrib.getNumber(t,undefined);break;default:i[e.key]=t;break}this._requestUpdate({icon:i})}_handleModelStyle(e){const t=e.target.get(e.key);if(!s.Types.isDefined(t))return;const i={};switch(e.key){case s.StyleProperty.VISIBLE:i.visible=t;break;case s.ModelStyleProperty.SOURCE:i.src=t;break;case s.ModelStyleProperty.SCALE:i.scale=t;break;case s.ModelStyleProperty.POSE:i.pose=t;break}this._requestUpdate({model:i})}_updatePositionAndPose(){this._requestUpdate({position:this.position})}}s.PointUE=e;function t(e){const t=e.split(/\s/);t.reverse();return{family:t[0],size:t[1],weight:t[2],style:t[3]}}})(CZMAP||(CZMAP={}));var CZMAP;(function(n){const e=1/60;class t{}class i extends n.FeatureUE{constructor(e){super(e);this._items=[];this._box=new n.BoundingBox;this._updateHandle=0;this._uvlayer.createLayer("polyline",{visible:true})}get box(){return this._box}_init(){}_clearWall(){}_clearPolyline(){}_release(){this._clearWall();this._clearPolyline()}_onVisibleChangle(){const t=this.visible;this._items.forEach(e=>{if(e.wall)e.wall.show=t;if(e.polyline)e.polyline.show=t})}_updateWalls(){}_createWalls(){if(!this.style.wall)return;this._updateWalls()}_createPoylines(){if(!this.style.stroke)return}_updateGeometryImpl(){this._updateHandle=0;this._release();const e=this.feature.geometry;if(!e)return;let t;if(e.type==n.GeometryType.POLYLINE)t=[e.coordinates];else if(e.type==n.GeometryType.MULTI_POLYLINE)t=e.coordinates;else return;this._transformCoordinates(t);const r=new n.BoundingBox;this._items=t.map(e=>{const t=e.map(e=>{e[2]=n.defaultValue(e[2],0);let[t,i,s]=e;r.mergeXYZ(t,i,s);return Cesium.Cartesian3.fromDegrees(...e)});return{polyline:undefined,wall:undefined,coords:e,positions:t,length:s(t)}});this._createPoylines();this._createWalls();this._requestUpdate({positions:t[0],style:{wall:this.style.wall.toStyleOption(),stroke:this.style.stroke.toStyleOption()},material:"/Script/Engine.MaterialInstanceConstant'/Game/ZMap/Materials/M_Breathing_Light_Inst.M_Breathing_Light_Inst'"});this._box=r;this._notifyStyle()}_updateGeometry(){cancelAnimationFrame(this._updateHandle);this._updateHandle=requestAnimationFrame(()=>this._updateGeometryImpl())}_handleGeometryChange(e){this._updateGeometry()}_handleStyleChange(e){if(!this.style.stroke)this._clearPolyline();if(!this.style.wall)this._clearWall();super._handleStyleChange(e)}_handleStrokeStyle(e){const t=e.target.get(e.key);this._items.forEach(e=>{const t=e.polyline})}_handleWallStyle(e){const t=e.target.get(e.key);this._items.forEach(e=>{})}}n.PolylineUE=i;function s(s){let r=0;if(s.length>0){let i=s[0];for(let t=1;t<s.length;++t){let e=s[t];r+=Cesium.Cartesian3.distance(i,e);i=e}}return r}})(CZMAP||(CZMAP={}));var CZMAP;(function(r){class e extends r.TDTilesLayer{constructor(e,t){super(e,t);this._options=t;this._uvlayer=new r.UELayerProxy(this.view,this);this.onProperty(r.LayerProperty.COLOR,()=>this._handleColorOpacity());this.onProperty(r.LayerProperty.OPACITY,()=>this._handleColorOpacity())}get ready(){return this._uvlayer.ready}get boundBox(){return this._uvlayer.box}get uvapi(){return this._uvlayer.uvapi}flyTo(e){this._uvlayer.flyTo()}_onVisible(e){this._uvlayer.setVisible(e)}_createInner(){const{url:e,position:t,pose:i,scale:s}=this._options;this._uvlayer.createLayer("3dtiles",{url:r.absURL(e),visible:false,position:t,rotate:i,scale:s})}_destroyInner(){this._uvlayer.removeLayer()}_handleColorOpacity(){this._uvlayer.setOpacity(this.opacity,this.color)}_onTransformChange(){const{position:e,pose:t,scale:i}=this;this._uvlayer.updateLayer({position:e,rotate:t,scale:i})}}r.TDTilesLayerUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e extends i.TileLayer{constructor(e,t){super(e,t);this._options=t;this._uvlayer=new i.UELayerProxy(this.view,this)}get ready(){return this._uvlayer.ready}get boundBox(){return this._uvlayer.box}_onVisible(e){this._uvlayer.setVisible(e)}_createInner(){const{url:e,mapType:t}=this._options;if(e&&(t=="zmap"||t=="ZMapImage")){this._uvlayer.createLayer("image",{url:i.absURL(this._options.url+"/tms/tilemapresource.xml"),visible:false})}}_destroyInner(){this._uvlayer.removeLayer()}}i.TileLayerUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{constructor(e){this._view=e}get uview(){return this._view.uview}get uvapi(){return this._view.uvapi}}e.UnrealViewerHelp=t})(CZMAP||(CZMAP={}));var CZMAP;(function(i){const s=new Map;class e extends i.UnrealViewerHelp{constructor(e,t){super(e);this._id=-1;this._bbox=new i.BoundingBox;this._layer=t;this._ready=new Promise(e=>{this._resolve=e})}get ready(){return this._ready}get id(){return this._id}get layer(){return this._layer}get box(){return this._bbox}static getWrapperByID(e){return s.get(e)}static getLayerByID(e){var t;return(t=s.get(e))===null||t===void 0?void 0:t.layer}isValid(){return this._id!=-1}async createLayer(e,t){this._id=await this.uvapi.createLayer(e,t);s.set(this._id,this);this._resolve()}async flyTo(e){await this._ready;this.uvapi.flyTo({layerID:this._id,option:e})}async move(e){await this._ready;this.uvapi.moveLayer(this._id,e)}async setVisible(e){await this._ready;this.uvapi.setVisible(this._id,e)}async setOpacity(e,t){await this._ready;this.uvapi.setLayerOpacity(this._id,e,t)}async switchVisible(){await this._ready;this.uvapi.switchVisible(this._id)}async updateLayer(e){await this._ready;this.uvapi.updateLayer(this._id,e)}async executeLayer(e){await this._ready;this.uvapi.executeLayer(this._id,e)}async removeLayer(){await this._ready;s.delete(this._id);this.uvapi.removeLayer(this._id);this._id=-1}_setBoundBox(e,t){this._bbox.setMin(e);this._bbox.setMax(t)}}i.UELayerProxy=e})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e extends i.MoveableLayerUE{constructor(e,t){super(e,t);this._option=t;this._uvlayer=new i.UELayerProxy(this.view,this);this.onProperty(i.LayerProperty.COLOR,()=>this._handleColorOpacity());this.onProperty(i.LayerProperty.OPACITY,()=>this._handleColorOpacity())}get wrappedLayer(){return this._option.wrappedLayer}_createInner(){const{wrappedLayer:e}=this._option;this._uvlayer.createLayer("wrapped",{layer:e,visible:false})}}i.WrappedLayerUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(o){class e{static parseBoolean(e,t){if(o.Types.isBool(e))return e;if(o.Types.isString(e)){const i=e.toUpperCase();return i==="TRUE"||this.parseInteger(i)!=0}return o.Types.isDefined(e)?true:o.Types.isDefined(t)?t:false}static parseNumber(e,t){const i=Number.parseFloat(e);t=o.Types.defaultValue(t,0);return Number.isNaN(i)?t:i}static parseInteger(e,t){const i=Number.parseInt(e);t=o.Types.defaultValue(t,0);return Number.isNaN(i)?t:i}static parseArray(t,e,i){if(o.Types.isArray(t)){const s=t;const r=t.length;for(let e=0;e<r;++e)s[e]=this.parseNumber(t[e])}else if(o.Types.isString(t)){const n=t;t=n.split(e);const r=t.length;for(let e=0;e<r;++e){t[e]=this.parseNumber(t[e])}}else{t=[]}while(t.length<i){const s=t;s.push(0)}return t}static createParseArray(t,i){return e=>this.parseArray(e,t,i)}static parsePoint(e,t){let i;if(o.Types.isString(e)){i=e.split(",")}else if(o.Types.isObject(e)){const s=e;i=[s.x,s.y,s.z]}else if(o.Types.isArray(e)){i=e}else{i=[0,0,0];if(t){i[0]=t[0];i[1]=t[1];i[2]=t[2]}return i}i[0]=Number.parseFloat(i[0]);i[1]=Number.parseFloat(i[1]);i[2]=Number.parseFloat(i[2]);if(Number.isNaN(i[0]))i[0]=t?t[0]:0;if(Number.isNaN(i[1]))i[1]=t?t[1]:0;if(Number.isNaN(i[2]))i[2]=t?t[2]:0;return i}}o.Parse=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class i{static tree2map(e,t){if(!t)t=new Map;e.forEach(e=>{if(e.complex){this.tree2map(e.children,t)}else{t.set(e.id,e)}});return t}static merge(e,t){const i=[],s=[];e.forEach(e=>{i.push(e.name);s.push(e)});const r=t(i);const n=[];r.forEach(e=>{const t={name:e.name,items:[]};e.index.forEach(e=>{t.items.push(s[e])});n.push(t)});return n}static filterSimpleModel(e,t){if(!e.complex){t.push(e);return}e.children.forEach(e=>i.filterSimpleModel(e,t))}}i.parsePosition=e.Parse.parsePoint;e.ZFclsModel=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{constructor(){this._clusterPixel=100}get clusterPixel(){return this._clusterPixel}set clusterPixel(e){this._clusterPixel=e}}e.Cluster=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["MOUSE_OVER"]="mouseover";e["MOUSE_OUT"]="mouseout";e["MOUSE_CLICK"]="click";e["MOUSE_RCLICK"]="rclick";e["MOUSE_DBLCLICK"]="dblclick"})(t=e.MapEventsType||(e.MapEventsType={}));class i extends e.Event{constructor(e,t,i,s,r){super(e);this.x=0;this.y=0;this.x=t;this.y=i;this.object=s;this.ext=r}}e.MapMouseEvent=i;class s extends e.BaseObject{constructor(e){super();this.map=e.map;this.view=e}}e.MapEvents=s})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e[e["Mode2D"]=1]="Mode2D";e[e["Mode3D"]=2]="Mode3D";e[e["ModeCloud"]=3]="ModeCloud"})(t=e.MapMode||(e.MapMode={}))})(CZMAP||(CZMAP={}));var CZMAP;(function(n){function e(e){const t={year:2022,month:4,day:22,hour:0,minite:0,second:0};return Object.assign(t,e)}n.initDateTime=e;let t;(function(e){e["Sunny"]="Sunny";e["Cloudy"]="Cloudy";e["Partly_Cloudy"]="Partly_Cloudy";e["Foggy"]="Foggy";e["Overcast"]="Overcast";e["Rain"]="Rain";e["Rain_Light"]="Rain_Light";e["Rain_Thunderstorm"]="Rain_Thunderstorm";e["Sand_Dust_Calm"]="Sand_Dust_Calm";e["Sand_Dust_Storm"]="Sand_Dust_Storm";e["Snow"]="Snow";e["Snow_Blizzard"]="Snow_Blizzard";e["Snow_Light"]="Snow_Light"})(t=n.WeatherType||(n.WeatherType={}));class i extends n.BaseObject{constructor(e,t){super();this._dom=t;this._map=e}get map(){return this._map}get dom(){return this._dom}get events(){return this.getEvents()}get gridTool(){return this.getGridTool()}get drawTool(){return this.getDrawTool()}get measureTool(){return this.getMeasureTool()}measureDistance(e){this.measureTool.distance(e)}measureArae(e){this.measureTool.arae(e)}measureArea(e){this.measureTool.arae(e)}measureClear(){this.measureTool.clear()}zoomTo(e,t){const i=Object.assign({duration:0},t);this.flyTo(e,i)}flyTo(e,t){t=t||{};const i=n.Extents.getCenter(e);const s=Math.max(n.Extents.getWidth(e),n.Extents.getHeight(e))/2;let r=t.distance;if(!n.Types.isDefined(r))r=s*111e3;this.fly(Object.assign({position:[i[0],i[1],0],distance:r},t))}flyToSphere(e,t){this.fly(Object.assign({position:new Cegore.Position(e.center),distance:e.radius*3},t))}flyToBox(e,t){if(e.isEmpty())return;const i=Cesium.Cartesian3.fromDegrees(...e.getMin());const s=Cesium.Cartesian3.fromDegrees(...e.getMax());const r=Cesium.Cartesian3.distance(i,s);this.fly(Object.assign({position:e.getCenter(),distance:r*3},t))}removeInfoWindow(e){return e.close()}}n.MapView=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.MapEvents{constructor(e){super(e)}set enableTip(e){}}e.MapEvent2D=t})(CZMAP||(CZMAP={}));var CZMAP;(function(r){class e extends r.MapView{constructor(e,t){super(e,t);var i={};var s={};this._events=new r.MapEvent2D(this.map);this._layerManager=new r.LayerManager2D(e)}getEvents(){throw new Error("Method not implemented.")}getGridTool(){throw new Error("Method not implemented.")}getDrawTool(){throw new Error("Method not implemented.")}getMeasureTool(){throw new Error("Method not implemented.")}createTunnelEffct(){throw new Error("Method not implemented.")}createTunnelTransparent(){throw new Error("Method not implemented.")}createTerrainClips(e){throw new Error("Method not implemented.")}clearTerrainClips(){throw new Error("Method not implemented.")}get layerManager(){return this._layerManager}get cluster(){throw new Error("Method not implemented.");return null}get envents(){return this._events}setDateTime(e){throw new Error("Method not implemented.")}setWeather(e){throw new Error("Method not implemented.")}pick(e,t){return undefined}fly(){}lockTo(e){throw new Error("Method not implemented.")}unlockTo(){throw new Error("Method not implemented.")}getViewInfo(){return{position:[0,0,0]}}setViewInfo(e){}getExtend(){return[0,0,0,0]}createPathRoam(){return null}createClipPlane(e){return null}createInfoWindow(e){return null}get zmap2d(){return null}get olmap(){return null}get olview(){return null}}r.MapView2D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(v){class e extends v.BaseObject{constructor(e){super();this._wall=undefined;this._floor=undefined;this._clips=undefined;this._sphere=new Cesium.BoundingSphere;this._enable=true;this._enableWall=true;this._enableFloor=true;this._floor_color="yellow";this._floor_image=undefined;this._border_width=0;this._border_color="white";this._wall_color="blue";this._wall_image=undefined;this._useServerCut=false;this._useServerDEM=false;this.map=e;this.view3d=e.view3d}create(e){this.close();let t;if(v.Types.isArray(e.points)){t=e.points}else if(v.Types.isArray(e.extent)){const i=e.extent;t=[v.Extents.getBottomLeft(i),v.Extents.getBottomRight(i),v.Extents.getTopRight(i),v.Extents.getTopLeft(i)]}else{throw"need param <points> or <extent>"}this._points=this._preperPoints(t);this._depth=v.Types.defaultValue(e.depth,-1e3);if(v.Types.isDefined(e.border)){this._border_width=v.Types.defaultValue(e.border.width,1);this._border_color=v.Types.defaultValue(e.border.color,"white")}else{this._border_width=0;this._border_color="white"}if(v.Types.isDefined(e.floor)){this._floor_color=e.floor.color;this._floor_image=e.floor.image}else{this._floor_color="yellow";this._floor_image=undefined}if(v.Types.isDefined(e.wall)){this._wall_color=e.wall.color;this._wall_image=e.wall.image}else{this._wall_color="blue";this._wall_image=undefined}this._enable=true;this._enableWall=true;this._enableFloor=true;this._useServerCut=v.Types.defaultValue(e.useServerCut,this._useServerCut);this._useServerDEM=v.Types.defaultValue(e.useServerDEM,this._useServerDEM);this._createClips();this._createWall();this._createFloor()}close(){this.enabled=false;if(this._clips)this._clips.enabled=false;if(this._wall)this.view3d.czviewer.entities.remove(this._wall);if(this._floor)this.view3d.czviewer.entities.remove(this._floor);this._clips=undefined;this._wall=undefined;this._floor=undefined;if(this._wallListener){this._wallListener();this._wallListener=undefined}}set enabled(e){this._enable=e;if(this._clips)this._clips.enabled=e;this.enabledWall=e;this.enabledFloor=e;const t=w(this.map.layers);if(this._useServerCut&&t){if(e)t.setClip({clip:this._lonlats,height:this._depth-10,wall:false,floor:false});else t.setClip({clip:[],height:this._depth-10,wall:false,floor:false})}}get enabled(){return this._enable}set enabledWall(e){this._enableWall=e;if(this._wall)this._wall.show=e}get enabledWall(){return this._enableWall}set enabledFloor(e){this._enableFloor=e;if(this._floor)this._floor.show=e}get enabledFloor(){return this._enableFloor}_createClips(){const e=w(this.map.layers);if(this._useServerCut&&e){const u=v.Extents.createOrUpdateFromCoordinates(this._lonlats);const d=v.Extents.getCenter(u);this._lonlats.forEach(e=>{e[0]=(e[0]-d[0])*.99+d[0];e[1]=(e[1]-d[1])*.99+d[1]});e.setClip({clip:this._lonlats,height:this._depth-10,wall:false,floor:false});return}const t=this._points;const i=t.length;const s=new Cesium.Cartesian3;const r=new Cesium.Cartesian3;const n=new Cesium.Cartesian3;const o=new Cesium.Cartesian3;const a=[];for(var l=0;l<i;++l){const m=t[l];const p=t[(l+1)%i];if(Cesium.Cartesian3.equals(m,p))continue;Cesium.Cartesian3.add(m,p,r);Cesium.Cartesian3.multiplyByScalar(r,.5,r);Cesium.Cartesian3.normalize(r,s);Cesium.Cartesian3.subtract(p,r,n);Cesium.Cartesian3.normalize(n,n);Cesium.Cartesian3.cross(n,s,o);Cesium.Cartesian3.normalize(o,o);var h=new Cesium.Plane(o,0);var c=Cesium.Plane.getPointDistance(h,r);a.push(new Cesium.ClippingPlane(o,c))}this._clips=new Cesium.ClippingPlaneCollection({planes:a,edgeWidth:this._border_width,edgeColor:v.CesiumAttrib.getColor(this._border_color),enabled:this._enable});this.view3d.czviewer.scene.globe.clippingPlanes=this._clips}_createWall(){const a=this.view3d.czviewer.scene.globe;const e=100;const i=this._points;const s=i.length;let r=0;const n=[0];for(let t=1;t<s;++t){let e=Cesium.Cartesian3.distance(i[t-1],i[t]);n[t]=e;r+=e}const t=new Cesium.Cartesian3;const o=r/e;const l=[Cesium.Cartographic.fromCartesian(i[0])];for(let e=1;e<s;++e){const u=i[e-1],d=i[e];const m=Math.floor(n[e]/o)+1;for(let e=1;e<m;++e){Cesium.Cartesian3.lerp(u,d,e/m,t);l.push(Cesium.Cartographic.fromCartesian(t))}l.push(Cesium.Cartographic.fromCartesian(d))}const h=w(this.map.layers);if(this._useServerDEM&&h){const p=50;const f=v.Extents.createOrUpdateFromCoordinates(this._lonlats);const _=v.Extents.getSize(f);const y=Math.max(_[0],_[1]);v.Extents.buffer(f,y*.02,f);var c=h.url;if(c.indexOf("?")==-1){if(!Cegore.StringUtil.endsWidth(c,"/tile/dem",true))c+="/tile/dem";c+="?"}c+="&origin=left|top";c+="&id=100,0,0";c+=`&size=${p},${p}`;c+="&range="+f.join(",");c+="&style=float";fetch(c).then(e=>{if(e.ok)return e.arrayBuffer()}).then(e=>{let t;const i=p*p*Float32Array.BYTES_PER_ELEMENT;if(!v.Types.isDefined(e)||e.byteLength!=i){t=new Float32Array(i)}else{t=new Float32Array(e)}const s=new T(t,f,p,p);l.forEach(e=>{e.height=s.getCellValue(Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude))});this._updateWall(l)})}else{let r=0;let n=new Cesium.Cartesian3;const C=this.view3d.czviewer.camera;let o=this._sphere.radius*10;o=o*o;const g=()=>{const e=(new Date).getTime();let t=e-r;if(t<2e3)return;const i=Cesium.Cartesian3.distanceSquared(n,C.positionWC);if(i<o)return;r=e;C.positionWC.clone(n);for(let e=0,t=l.length;e<t;++e){const s=l[e];s.height=a.getHeight(s);if(!v.Types.isNumber(s.height))s.height=0}this._updateWall(l)};g();this._wallListener=C.moveEnd.addEventListener(g)}}_updateWall(e){const t=e;const i=t.length;const s=new Array(i);const r=new Array(i),n=new Array(i);for(let e=0;e<i;++e){const o=t[e];s[e]=Cesium.Cartographic.toCartesian(o);r[e]=this._depth;n[e]=o.height+1}if(this._wall){this._wall.wall.positions=s;this._wall.wall.minimumHeights=r;this._wall.wall.maximumHeights=n}else{const a=new Cesium.WallGraphics({positions:s,maximumHeights:n,minimumHeights:r,material:l(this._wall_color,this._wall_image)});this._wall=this.view3d.czviewer.entities.add({wall:a})}}_createFloor(){const e=this._points;this._floor=this.view3d.czviewer.entities.add({polygon:{hierarchy:new Cesium.PolygonHierarchy(e),material:l(this._floor_color,this._floor_image),height:this._depth}})}_preperPoints(t){this._lonlats=t=t.slice(0);let i=t.length;const e=t[0],s=t[i-1];if(e[0]!=s[0]||e[1]!=s[1]){t.push(e);i+=1}const r=a(t);if(r<0)t.reverse();const n=[];for(let e=0;e<i;++e){const o=t[e];n[e]=Cesium.Cartesian3.fromDegrees(o[0],o[1],this._depth)}Cesium.BoundingSphere.fromPoints(n,this._sphere);return n}}v.ClipTerrain=e;function a(e){if(e==null||e.length<3)return 0;var t=e.length;var i=e[t-1];var s=e[0];var r=e[1];var n=s[1]*(i[0]-r[0]);for(var o=1;o<t;++o){i=s;s=r;r=e[(o+1)%t];n+=s[1]*(i[0]-r[0])}return n/2}function l(e,t){if(t){return new Cesium.ImageMaterialProperty({image:t,color:v.CesiumAttrib.getColor(e,Cesium.Color.WHITE)})}else{return v.CesiumAttrib.getColor(e,Cesium.Color.WHITE)}}function w(e){var i=[];function s(e){if(e instanceof v.TerrainLayer){i.push(e);return}const t=e.children;t.forEach(e=>s(e))}s(e);return i[i.length-1]}class T{constructor(e,t,i,s){this.data=e;this.extent=v.Extents.clone(t);this.size=v.Extents.getSize(t);this.xnum=i;this.ynum=s;this.xres=this.size[0]/i;this.yres=this.size[1]/s}getCellValue(e,t){const i=Math.floor((e-this.extent[0])/this.xres);const s=Math.floor((this.extent[3]-t)/this.yres);return this.data[s*this.xnum+i]}}function t(e,t,i,s,r){}})(CZMAP||(CZMAP={}));var CZMAP;(function(s){class n extends s.MapMouseEvent{constructor(e,t,i,s,r){super(e,t,i,s,r)}}s.MapMouseEvent3D=n;class e extends s.MapEvents{constructor(e){super(e);this.view3d=e;this._handler=new Cesium.ScreenSpaceEventHandler(this.view3d.czviewer.scene.canvas);this._handler.setInputAction(e=>this._onMouseMoved(e),Cesium.ScreenSpaceEventType.MOUSE_MOVE);this._handler.setInputAction(e=>this._onLeftClick(e),Cesium.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(e=>this._onRightClick(e),Cesium.ScreenSpaceEventType.RIGHT_CLICK);this._handler.setInputAction(e=>this._onDoubleClick(e),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}_onMouseMoved(i){clearTimeout(this._timer);this._timer=setTimeout(()=>{const e=i.endPosition;let t=this.view3d.pick(e.x,e.y);if(this._last){if(this._last.layer===t.layer)return;this._fire(s.MapEventsType.MOUSE_OUT,e,this._last.layer,this._last);this._last=undefined}if(t.layer){this._fire(s.MapEventsType.MOUSE_OVER,e,t.layer,t);this._last=t}},200)}_onClickEvent(e,t){const i=e.position;let s=this.view3d.pick(i.x,i.y);this._fire(t,i,s.layer,s)}_onLeftClick(e){this._onClickEvent(e,s.MapEventsType.MOUSE_CLICK)}_onRightClick(e){this._onClickEvent(e,s.MapEventsType.MOUSE_RCLICK)}_onDoubleClick(e){this._onClickEvent(e,s.MapEventsType.MOUSE_DBLCLICK)}_fire(e,t,i,s){const r=new n(e,t.x,t.y,i);r.pickInfo=s;this.dispatchEvent(r)}_disposeInternal(){super._disposeInternal();this._handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);this._handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);this._handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK);this._handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);this._handler.destroy()}}s.MapEvent3D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(s){class e extends s.MapView{constructor(e,t,i){super(e,t);i=s.deepAssign({images:[]},i);this._zmap3d=new ZMap3D.Map(t,i,{navigation:true});this._cegore=this._zmap3d.cegore;this._cesium=this._zmap3d.cesium;this._czviewer=this._cesium.viewer;this._czviewer["vueCheck"]=new Proxy({},{defineProperty(e,t,i){console.error("检测到Vue等框架污染核心渲染对象，这将严重影响渲染性能！");return false}});this._czviewer.clock.currentTime=new Cesium.JulianDate(2459295,11086,Cesium.TimeStandard.TAI);this._czviewer.scene.logarithmicDepthBuffer=false;this._measure=new s.MeasureTool3D(this);this._events=new s.MapEvent3D(this);this._gridTool=new s.GridTool3D(this);this._drawTool=new s.DrawTool3D(this);this._czsource=new Cesium.CustomDataSource("MapView3D-Source");this._czsource.clustering.enabled=false;this.czviewer.dataSources.add(this._czsource);this._clusterSource=new Cesium.CustomDataSource("MapView3D-ClusterSource");this._clusterSource.clustering.enabled=true;this.czviewer.dataSources.add(this._clusterSource);this._cluster3D=new s.Cluster3D(this,this._clusterSource);this._polylines=new Cesium.PolylineCollection;this.czscene.primitives.add(this._polylines);this._pathTails=new s.PathTailCollection(this._czviewer);this._layerManager=new s.LayerManager3D(e)}get layerManager(){return this._layerManager}_disposeInternal(){super._disposeInternal();this._events.dispose()}pick(e,t,i){i=i||{};const s=this.czviewer;const r=this.czviewer.scene;const n=new Cesium.Cartesian2(e,t);const o={position:undefined,layer:undefined,pickedObject:undefined,cartesian:undefined};const a=Cesium.defaultValue(i.pickPosition,true);const l=Cesium.defaultValue(i.pickObject,true);if(l){o.pickedObject=r.pick(n)}if(a){if(r.pickPositionSupported&&(!l||Cesium.defined(o.pickedObject)&&o.pickedObject.primitive)){o.cartesian=r.pickPosition(n)}else{const c=s.camera.getPickRay(n);o.cartesian=r.globe.pick(c,r);if(l&&!o.pickedObject){o.pickedObject=r.globe.terrainProvider}}}if(Cesium.defined(o.cartesian)){const u=Cesium.Cartographic.fromCartesian(o.cartesian);const d=Cesium.Math.toDegrees(u.longitude);const m=Cesium.Math.toDegrees(u.latitude);const p=u.height;o.position=[d,m,p]}const h=o.pickedObject;if(h){if(h._czmap_obj)o.layer=h._czmap_obj;if(h.id&&h.id._czmap_obj)o.layer=h.id._czmap_obj;if(h.node&&h.node._czmap_obj)o.layer=h.node._czmap_obj;if(h.primitive&&h.primitive._czmap_obj)o.layer=h.primitive._czmap_obj}return o}fly(e){const t=s.defaultValue(e.distance,1)*s.Parse.parseNumber(e.distanceScale,1);const i=new Cegore.HeadingPitchDistance(s.Parse.parseNumber(e.heading,0),s.Parse.parseNumber(-e.pitch,-45),t);this.cegore.camera.flyToSphere({center:e.position,radius:t,offset:i,duration:e.duration})}lockTo(i){i.ready.then(()=>{const e=this.cegore.camera.position;const t=i.boundBox.getCenter();this.cegore.camera.lookAtFromTo(e,new Cegore.Position(t))})}unlockTo(){this.cegore.camera.clearLookAt()}getViewInfo(){const e=this.czviewer.camera;const t=e.positionCartographic;return{position:[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude),t.height],heading:Cesium.Math.toDegrees(e.heading),pitch:-Cesium.Math.toDegrees(e.pitch),roll:Cesium.Math.toDegrees(e.roll)}}setViewInfo(e,t){t=s.Types.defaultValue(t,{});this.czviewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1],e.position[2]),orientation:{heading:s.Types.isDefined(e.heading)?Cesium.Math.toRadians(e.heading):undefined,pitch:s.Types.isDefined(e.pitch)?Cesium.Math.toRadians(-e.pitch):undefined,roll:s.Types.isDefined(e.roll)?Cesium.Math.toRadians(e.roll):undefined},duration:t.duration})}getExtend(){return s.abstract()}getEvents(){return this._events}setDateTime(e){const t=s.initDateTime(e);const i=new Date(`${t.year}-${t.month}-${t.day} ${t.hour}:${t.minite}:${t.second}`);this.czviewer.clock.currentTime=Cesium.JulianDate.fromDate(i)}setWeather(e){throw new Error("Method not implemented.")}getGridTool(){return this._gridTool}getDrawTool(){return this._drawTool}getMeasureTool(){return this._measure}createPathRoam(){return new s.PathRoam3D(this)}createClipPlane(e){switch(e.type){case s.ClipPlaneType.AXIS_PLANE:return new s.AxisClipPlane3D(this,e.box);case s.ClipPlaneType.PATH_PLANE:return new s.PathClipPlane3D(this,e.box)}}createTunnelEffct(){return new s.TunnelEffct3D(this)}createTunnelTransparent(){return new s.TunnelTransparent3D(this)}createTerrainClips(e){if(!this._clips)this._clips=new s.ClipTerrain(this.map);this._clips.create(e);return this._clips}clearTerrainClips(){if(this._clips)this._clips.close()}createInfoWindow(e){return new s.InfoWindow3D(this,e)}get zmap3d(){return this._zmap3d}get cegore(){return this._cegore}get cesium(){return this._cesium}get czviewer(){return this._czviewer}get czscene(){return this._czviewer.scene}get entities(){return this._czsource.entities}get clusterEntities(){return this._clusterSource.entities}get polylines(){return this._polylines}get pathTails(){return this._pathTails}}s.MapView3D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.MapMouseEvent{constructor(e,t,i,s,r){super(e,t,i,s);this.pickInfo=r}}e.MapMouseEventUE=t;class i extends e.MapEvents{constructor(e){super(e);e.uvapi.on("mouse_event",e=>this._on_mouse_event(e))}_on_mouse_event(e){this.dispatchEvent(e.data)}}e.MapEventsUE=i})(CZMAP||(CZMAP={}));var CZMAP;(function(s){const i={[s.WeatherType.Sunny]:"Clear_Skies",[s.WeatherType.Cloudy]:"Cloudy",[s.WeatherType.Partly_Cloudy]:"Partly_Cloudy",[s.WeatherType.Foggy]:"Foggy",[s.WeatherType.Overcast]:"Overcast",[s.WeatherType.Rain]:"Rain",[s.WeatherType.Rain_Light]:"Rain_Light",[s.WeatherType.Rain_Thunderstorm]:"Rain_Thunderstorm",[s.WeatherType.Sand_Dust_Calm]:"Sand_Dust_Calm",[s.WeatherType.Sand_Dust_Storm]:"Sand_Dust_Storm",[s.WeatherType.Snow]:"Snow",[s.WeatherType.Snow_Blizzard]:"Snow_Blizzard",[s.WeatherType.Snow_Light]:"Snow_Light"};function t(e){if(e instanceof Cegore.Position){return[e.x,e.y,e.z]}else{return e}}class e extends s.MapView{constructor(e,t,i){super(e,t);this._option=s.deepAssign({dom:t},i);this._uview=new s.UnrealViewer(this._option);this._uvapi=new s.UnrealViewerAPI(this._uview);this._layerManager=new s.LayerManagerUE(e);this._events=new s.MapEventsUE(this);this.uvapi.clearScene();if(this._option.center){this.uvapi.initScene({center:this._option.center,time:"2022-03-18 14:00:00",zone:8,inputMode:this._option.inputMode})}}get uview(){return this._uview}get uvapi(){return this._uvapi}get layerManager(){return this._layerManager}pick(e,t){throw new Error("Method not implemented.")}fly(e){this.uvapi.flyTo({target:t(e.position),option:e})}lockTo(e){throw new Error("Method not implemented.")}unlockTo(){throw new Error("Method not implemented.")}getViewInfo(){return this.uvapi.getViewInfo()}setViewInfo(e,t){this.uvapi.setViewInfo(e)}getExtend(){throw new Error("Method not implemented.")}getEvents(){return this._events}setDateTime(e){const t=s.initDateTime(e);this._uvapi.initScene({zone:8,time:`${t.year}-${t.month}-${t.day} ${t.hour}:${t.minite}:${t.second}`})}setWeather(e){const t=i[e.weatherType];if(t){this._uvapi.initScene({weather:{name:t,duration:e.duration}})}}getGridTool(){throw new Error("Method not implemented.")}getDrawTool(){throw new Error("Method not implemented.")}getMeasureTool(){throw new Error("Method not implemented.")}createPathRoam(){return new s.PathRoamUE(this)}createClipPlane(e){throw new Error("Method not implemented.")}createTunnelEffct(){throw new Error("Method not implemented.")}createTunnelTransparent(){throw new Error("Method not implemented.")}createTerrainClips(e){throw new Error("Method not implemented.")}clearTerrainClips(){throw new Error("Method not implemented.")}createInfoWindow(e){return new s.InfoWindowUE(this,e)}}s.MapViewUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(h){let r;(function(e){e["InitScene"]="InitScene";e["ClearScene"]="ClearScene";e["SetTerrain"]="SetTerrain";e["SetViewInfo"]="SetViewInfo";e["FlyTo"]="FlyTo";e["CreateLayer"]="CreateLayer";e["UpdateLayer"]="UpdateLayer";e["RemoveLayer"]="RemoveLayer";e["SetVisible"]="SetVisible";e["SetLayerOpacity"]="SetLayerOpacity";e["SwitchVisible"]="SwitchVisible";e["ExecuteLayer"]="ExecuteLayer";e["MoveLayer"]="MoveLayer";e["AddOverlay"]="AddOverlay";e["RemoveOverlay"]="RemoveOverlay"})(r||(r={}));let t;(function(e){e["ViewInfo"]="Notify-ViewInfo";e["LayerInfo"]="Noitfy-LayerInfo";e["MouseEvent"]="Notify-MouseEvent";e["OverlayInfo"]="Notify-OverlayInfo"})(t||(t={}));class e extends h.Observable{constructor(e){super();this._nextSEQ=1;this._nextOverlay=1;this._viewInfo={position:[0,0,0],heading:0,pitch:0,roll:0};this._asyncCmds=new Map;this._notifys=new Map;this._overlays=new Map;this._uviewer=e;this._uviewer.on(h.UnrealViewerEvents.RTC_RESPONSE,this._onResponse,this);this._notifys.set(t.ViewInfo,this._notify_viewInfo);this._notifys.set(t.MouseEvent,this._notify_mosue_event);this._notifys.set(t.LayerInfo,this._notify_layerinfo);this._notifys.set(t.OverlayInfo,this._notify_overlayinfo);if(e.option.inputMode==="Globe")this._uviewer.ready.then(()=>this._bindInput())}_bindInput(){let l;const e=this._uviewer.sceneDOM;this._multiPointer=new h.MultiPointInput;this._multiPointer.bind(e);this._multiPointer.option.onBeginDragging=()=>{l=h.deepCopy(this._viewInfo)};const r=(e,t)=>{const i=Math.sqrt(e*e+t*t);const s=l.position[2];const r=(Math.PI/2-Math.atan2(t,-e))/Math.PI*180;const n=i*s*.002;console.debug("input:drag",i.toFixed(2),n.toFixed(0));const[o,a]=h.calcOffsetPoint2(l.position,n,r+l.heading,0,true);l.position=[o,a,s];this.setViewInfo(l)};const i=e=>{if(e===0)return;const t=l.position[2];l.position[2]-=t*e*.005;this.setViewInfo(l)};const n=e=>{if(e===0)return;l.heading+=e;this.setViewInfo(l)};const o=e=>{if(e===0)return;l.pitch+=e;if(l.pitch>90)l.pitch=90;else if(l.pitch<-90)l.pitch=-90;this.setViewInfo(l)};this._multiPointer.option.onDragging=(e,t,i,s)=>{if((i.buttons&2)===2){n(e/4);o(t/4)}else{r(e,t)}};this._multiPointer.option.onScale=(e,t)=>i(t-e);this._multiPointer.option.onRotate=(e,t)=>n((t-e)/Math.PI*180);this._multiPointer.option.onTilting=(e,t)=>o(t);e.addEventListener("wheel",e=>{i(e.deltaY>0?-10:10);e.stopPropagation();e.preventDefault()});e.addEventListener("contextmenu",e=>{e.stopPropagation();e.preventDefault()})}_sendCommand(e,t){const i=this._nextSEQ++;this._uviewer.ready.then(()=>{console.info("send command:",i,e,t);this._uviewer.emitUIInteraction({uvcmd:{cmd:e,data:t,seq:i}})});return i}_sendConsoleCmd(e){this._uviewer.ready.then(()=>{console.info("send console command:",e);this._uviewer.emitCommand(e)})}_sendCommandAnd(e,t){const i=this._sendCommand(e,t);const s=new Promise((e,t)=>{this._asyncCmds.set(i,{resolve:e,reject:t})});return s}_onResponse(e){let t;try{t=JSON.parse(e.data)}catch(e){console.error(e)}if(!t)return;if(t.uvcmd){const i=t.uvcmd;const s=this._asyncCmds.get(i.seq);if(s){s.resolve(i);this._asyncCmds.delete(i.seq)}}if(t.uvnotify){const r=t.uvnotify;const n=this._notifys.get(r.ncmd);if(n)n.call(this,r)}}initScene(e){this._sendCommand(r.InitScene,e)}clearScene(){this._sendCommand(r.ClearScene)}setTerrain(e){if(e.url)e.url=s(e.url);this._sendCommand(r.SetTerrain,e)}async createLayer(e,t){const i={type:e,define:t};return(await this._sendCommandAnd(r.CreateLayer,i)).data.layerID}updateLayer(e,t){const i=Object.assign({layerID:e},t);this._sendCommand(r.UpdateLayer,i)}setLayerOpacity(e,t,i){this._sendCommand(r.SetLayerOpacity,{layerID:e,opacity:t,color:i})}executeLayer(e,t){const i={layerID:e,param:t};this._sendCommand(r.ExecuteLayer,i)}moveLayer(e,t){const i={layerID:e,actions:t};this._sendCommand(r.MoveLayer,i)}removeLayer(e){const t={layerID:e};this._sendCommand(r.RemoveLayer,t)}addOverlay(e,t){const i=this._nextOverlay++;const s={id:i,position:e};this._sendCommand(r.AddOverlay,s);this._overlays.set(i,t);return i}updateOverlay(e,t){const i={id:e,position:t};this._sendCommand(r.AddOverlay,i)}removeOverlay(e){this._overlays.delete(e);this._sendCommand(r.RemoveOverlay,{id:e})}getViewInfo(){return h.deepCopy(this._viewInfo)}setViewInfo(e){this._sendCommand(r.SetViewInfo,e)}flyTo(e){this._sendCommand(r.FlyTo,e)}setVisible(e,t){this._sendCommand(r.SetVisible,{layerID:e,visible:t})}switchVisible(e){this._sendCommand(r.SwitchVisible,{layerID:e})}resize(e,t){this._sendConsoleCmd({"Resolution.Width":e,"Resolution.Height":t})}_notify_viewInfo(e){this._viewInfo=e.ndata}_notify_mosue_event(e){const t=e.ndata;const[i,s]=t.pixel;console.info(`mouse event:${t.type}, layer:${t.layerID}`);const r={layer:h.UELayerProxy.getLayerByID(t.layerID),pixel:t.pixel,position:t.position,pickedObject:e.ndata.info};const n=new h.MapMouseEventUE(t.type,i,s,r.layer,r);this.dispatchEvent("mouse_event",n)}_notify_layerinfo(e){const t=e.ndata;const i=h.UELayerProxy.getWrapperByID(t.layerID);if(i){i._setBoundBox(t.box.min,t.box.max)}}_notify_overlayinfo(e){e.ndata.ids.forEach(e=>{const[t,i,s]=e;const r=this._overlays.get(t);try{if(r)r(i,s)}catch(e){console.warn("notfiy overlayinfo error",e)}})}}h.UnrealViewerAPI=e;const i=document.createElement("a");function s(e){i.href=e;return i.href}h.absURL=s})(CZMAP||(CZMAP={}));var CZMAP;(function(s){let c;(function(e){e[e["QualityControlOwnership"]=0]="QualityControlOwnership";e[e["Response"]=1]="Response";e[e["Command"]=2]="Command";e[e["FreezeFrame"]=3]="FreezeFrame";e[e["UnfreezeFrame"]=4]="UnfreezeFrame";e[e["VideoEncoderAvgQP"]=5]="VideoEncoderAvgQP";e[e["LatencyTest"]=6]="LatencyTest";e[e["InitialSettings"]=7]="InitialSettings";e[e["FileExtension"]=8]="FileExtension";e[e["FileMimeType"]=9]="FileMimeType";e[e["FileContents"]=10]="FileContents"})(c||(c={}));let a;(function(e){e[e["IFrameRequest"]=0]="IFrameRequest";e[e["RequestQualityControl"]=1]="RequestQualityControl";e[e["FpsRequest"]=2]="FpsRequest";e[e["AverageBitrateRequest"]=3]="AverageBitrateRequest";e[e["StartStreaming"]=4]="StartStreaming";e[e["StopStreaming"]=5]="StopStreaming";e[e["LatencyTest"]=6]="LatencyTest";e[e["RequestInitialSettings"]=7]="RequestInitialSettings";e[e["UIInteraction"]=50]="UIInteraction";e[e["Command"]=51]="Command";e[e["KeyDown"]=60]="KeyDown";e[e["KeyUp"]=61]="KeyUp";e[e["KeyPress"]=62]="KeyPress";e[e["MouseEnter"]=70]="MouseEnter";e[e["MouseLeave"]=71]="MouseLeave";e[e["MouseDown"]=72]="MouseDown";e[e["MouseUp"]=73]="MouseUp";e[e["MouseMove"]=74]="MouseMove";e[e["MouseWheel"]=75]="MouseWheel";e[e["TouchStart"]=80]="TouchStart";e[e["TouchEnd"]=81]="TouchEnd";e[e["TouchMove"]=82]="TouchMove";e[e["GamepadButtonPressed"]=90]="GamepadButtonPressed";e[e["GamepadButtonReleased"]=91]="GamepadButtonReleased";e[e["GamepadAnalog"]=92]="GamepadAnalog"})(a||(a={}));let o;(function(e){e[e["MainButton"]=0]="MainButton";e[e["AuxiliaryButton"]=1]="AuxiliaryButton";e[e["SecondaryButton"]=2]="SecondaryButton";e[e["FourthButton"]=3]="FourthButton";e[e["FifthButton"]=4]="FifthButton"})(o||(o={}));let e;(function(e){e[e["PrimaryButton"]=1]="PrimaryButton";e[e["SecondaryButton"]=2]="SecondaryButton";e[e["AuxiliaryButton"]=4]="AuxiliaryButton";e[e["FourthButton"]=8]="FourthButton";e[e["FifthButton"]=16]="FifthButton"})(e||(e={}));const r=[[o.MainButton,e.PrimaryButton],[o.SecondaryButton,e.SecondaryButton],[o.AuxiliaryButton,e.AuxiliaryButton],[o.FourthButton,e.FourthButton],[o.FifthButton,e.FifthButton]];let t;(function(e){e[e["BackSpace"]=8]="BackSpace";e[e["Shift"]=16]="Shift";e[e["Control"]=17]="Control";e[e["Alt"]=18]="Alt";e[e["RightShift"]=253]="RightShift";e[e["RightControl"]=254]="RightControl";e[e["RightAlt"]=255]="RightAlt"})(t||(t={}));class i extends s.BaseObjectEvents{}i.RTC_RESPONSE="rtc_response";s.UnrealViewerEvents=i;function n(e){if(e.keyCode===t.Shift&&e.code==="ShiftRight")return t.RightShift;else if(e.keyCode===t.Control&&e.code==="ControlRight")return t.RightControl;else if(e.keyCode===t.Alt&&e.code==="AltRight")return t.RightAlt;else return e.keyCode}function l(e){return e>=112&&e<=123||e===9}function h(e){if(typeof e==="string")return document.getElementById(e);else return e}const u=1;const d={suppressBrowserKeys:true,fakeMouseWithTouches:false};class m extends s.Observable{constructor(e){super();this._autoPlayAudio=true;this._qualityController=false;this._freezeFrame={receiving:false,size:0,jpeg:undefined,height:0,width:0,valid:false};this._is_reconnection=false;this._print_inputs=false;this._ready=new Promise(e=>this._resolve=e);this._option=s.deepAssign(d,e);this._inputOptions=this._option;this._playerDiv=h(this._option.dom);this._playerDiv.style.position="relative";this._setupConnectionOverlay();this._setupConnectInfo();this._setupFreezeFrameOverlay()}get ready(){return this._ready}get sceneDOM(){return this._videoElement}get option(){return this._option}connect(){if(this._ws)return;const e=s.defaultValue(this._option.signalServer,this._option.singleServer);const t=this._ws=new WebSocket(e);this._appendConnectInfo(`开始连接到信号服务：${e}`);function i(e){console.log(`%c[Inbound SS (${e.type})]`,"background: lightblue; color: black",e)}t.onmessage=e=>{const t=JSON.parse(e.data);switch(t.type){case"config":i(t);this._onConfig(t);this._appendConnectInfo(`信号服务器已连接，等待创建渲染实例...`);break;case"playerCount":i(t);break;case"streamConnected":i(t);this._appendConnectInfo("渲染实例已创建，构建点对点通讯...");break;case"offer":i(t);this._onWebRtcOffer(t);break;case"answer":i(t);this._onWebRtcAnswer(t);break;case"iceCandidate":this._onWebRtcIce(t.candidate);break;case"warning":console.warn(t.warning);break;default:console.log(`Invalid SS message type: ${t.type}`);break}};t.onerror=e=>{console.log(`WS error`);this._appendConnectInfo(`连接失败!`)};t.onclose=e=>{console.log(`WS closed: ${JSON.stringify(e.code)} - ${e.reason}`);this._appendConnectInfo(`连接已断开。代码：[${e.code}]，信息：[${e.reason}]。`);this._ws=undefined;this._is_reconnection=true;let t=this._playerDiv;if(this._webRtcPlayerObj){t.removeChild(this._webRtcPlayerObj.video);this._webRtcPlayerObj.close();this._webRtcPlayerObj=undefined}}}updateSize(){if(!this._videoElement)return;const{clientWidth:e,clientHeight:t}=this._videoElement;this.emitCommand({"Resolution.Width":e,"Resolution.Height":t})}_onConfig(e){this._setupWebRtcPlayer(e);this._resizePlayerStyle();this._registerInputs();clearInterval(this._updateSizeHandle);this._updateSizeHandle=setInterval(()=>{if(!this._videoElement)return;const{clientWidth:e,clientHeight:t}=this._videoElement;if(e==this._lastViewWidth&&t==this._lastViewHeight)return;this._lastViewWidth=e;this._lastViewHeight=t;this.emitCommand({"Resolution.Width":e,"Resolution.Height":t})},1e3)}_onWebRtcOffer(e){this._webRtcPlayerObj.receiveOffer(e);this._webRtcPlayerObj.aggregateStats(1*1e3)}_onWebRtcAnswer(e){this._webRtcPlayerObj.receiveAnswer(e);this._webRtcPlayerObj.aggregateStats(1*1e3)}_onWebRtcIce(e){if(this._webRtcPlayerObj)this._webRtcPlayerObj.handleCandidateFromServer(e)}_setupWebRtcPlayer(e){const t=this._ws;const i=this._freezeFrame;const s=this._freezeFrameImage;const l=this._webRtcPlayerObj=new webRtcPlayer(e);this._autoPlayAudio=typeof e.autoPlayAudio!=="undefined"?e.autoPlayAudio:true;this._videoElement=l.video;this._audioElement=l.audio;this._setupVideoStyle();this._playerDiv.appendChild(this._videoElement);this._playerDiv.appendChild(this._audioElement);function r(e){console.log(`%c[Outbound SS message (${e.type})]`,"background: lightgreen; color: black",e)}l.onWebRtcOffer=function(e){if(t&&t.readyState===u){r(e);t.send(JSON.stringify(e))}};l.onWebRtcCandidate=function(e){if(t&&t.readyState===u){t.send(JSON.stringify({type:"iceCandidate",candidate:e}))}};l.onWebRtcAnswer=function(e){if(t&&t.readyState===u){r(e);t.send(JSON.stringify(e))}};l.onVideoInitialised=()=>{this._appendConnectInfo("视频已连接...",true);if(t&&t.readyState===u){this._resizePlayerStyle();this._playStream()}};l.onDataChannelConnected=()=>{this._appendConnectInfo("数据通道已建立...");if(t&&t.readyState===u){this._requestQualityControl();this._resolve()}};const n=()=>{let e=btoa(i.jpeg.reduce((e,t)=>e+String.fromCharCode(t),""));s.src="data:image/jpeg;base64,"+e;s.onload=()=>{i.height=s.naturalHeight;i.width=s.naturalWidth;this._resizeFreezeFrameOverlay();this._showFreezeFrameOverlay();l.setVideoEnabled(false)}};function h(e){if(!i.receiving){i.receiving=true;i.valid=false;i.size=0;i.jpeg=undefined}i.size=new DataView(e.slice(1,5).buffer).getInt32(0,true);let t=e.slice(1+4);if(i.jpeg){let e=new Uint8Array(i.jpeg.length+t.length);e.set(i.jpeg,0);e.set(t,i.jpeg.length);i.jpeg=e}else{i.jpeg=t;i.receiving=true;console.log(`received first chunk of freeze frame: ${i.jpeg.length}/${i.size}`)}if(i.jpeg.length===i.size){i.receiving=false;i.valid=true;console.log(`received complete freeze frame ${i.size}`);n()}else if(i.jpeg.length>i.size){console.error(`received bigger freeze frame than advertised: ${i.jpeg.length}/${i.size}`);i.jpeg=undefined;i.receiving=false}}l.onNewVideoTrack=e=>{if(l.video&&l.video.srcObject&&l.onVideoInitialised){l.onVideoInitialised()}};l.onDataChannelMessage=e=>{let n=new Uint8Array(e);const o=n[0];const a=()=>new TextDecoder("utf-16").decode(e.slice(1));switch(o){case c.QualityControlOwnership:let e=n[1]===0?false:true;this._qualityController=e;console.log("Received quality controller message, will control quality: "+e);break;case c.Response:let t=a();this._onRtcPlayerResponse(t);break;case c.Command:break;case c.FreezeFrame:h(n);break;case c.UnfreezeFrame:this._invalidateFreezeFrameOverlay();break;case c.VideoEncoderAvgQP:this._VideoEncoderQP=a();break;case c.LatencyTest:let i=a();console.log("Got latency timings from UE.");console.log(i);let s=JSON.parse(i);if(l){l.latencyTestTimings.SetUETimings(s)}break;case c.InitialSettings:let r=JSON.parse(a());break;case c.FileExtension:case c.FileMimeType:case c.FileContents:break;default:console.error(`unrecognized data received, packet ID ${o}`)}};return l.video}_playStream(){const e=this._webRtcPlayerObj;function t(){return e.video.play().catch(function(e){console.error(e);console.log("浏览器不支持自动播放视频，请点击播放按钮");return Promise.reject()})}function i(){e.audio.play().then(()=>{t()}).catch(e=>{console.error(e);console.log("浏览器不支持自动播放音频，请点击播放按钮");return Promise.reject()})}if(e&&e.video){if(e.audio.srcObject&&this._autoPlayAudio){i()}else{t()}this._requestInitialSettings();this._requestQualityControl();this._showFreezeFrameOverlay();this._showConnectionOverlay(false)}else{console.error("Could not player video stream because webRtcPlayerObj.video was not valid.")}}_resizePlayerStyle(){this._resizeFreezeFrameOverlay();this.updateSize();this._playerElementClientRect=this._videoElement.getBoundingClientRect()}_setupVideoStyle(){const e=this._videoElement;e.tabIndex=0;f(e,{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",width:"100%",height:"100%"})}_setupConnectionOverlay(){const e=this._connectOverlay=document.createElement("div");e.innerText="开始";f(e,{display:"block",position:"absolute",left:"0",top:"0",right:"0",bottom:"0",width:"200px",height:"200px",marginTop:"auto",marginBottom:"auto",marginRight:"auto",marginLeft:"auto",fontSize:"50px",lineHeight:"200px",textAlign:"center",verticalAlign:"middle",borderRadius:"25px",backgroundColor:"rgba(125,125,125,0.5)",cursor:"pointer"});e.onclick=()=>{this._showConnectionOverlay(false);this._showConnectionInfo(true);this.connect()};this._playerDiv.appendChild(e)}_setupConnectInfo(){const e=this._connectInfo=document.createElement("textarea");f(e,{display:"block",zIndex:"100",position:"absolute",visibility:"hidden",left:"0",right:"0",bottom:"10px",width:"600px",height:"150px",margin:"auto",padding:"5px",backgroundColor:"rgba(125, 125, 125, 0.5)"});this._playerDiv.appendChild(e)}_showConnectionOverlay(e){const t=e?"visible":"hidden";this._connectOverlay.style.visibility=t}_showConnectionInfo(e){const t=e?"visible":"hidden";this._connectInfo.style.visibility=t}_appendConnectInfo(e,t){this._connectInfo.value+=e+"\n";if(t){y.fadeOut(this._connectInfo)}}_clearConnectInfo(){this._connectInfo.value=""}_setupFreezeFrameOverlay(){const e=this._freezeFrameOverlay=document.createElement("div");e.style.display="none";e.style.pointerEvents="none";e.style.position="absolute";e.style.zIndex="20";this._freezeFrameImage=document.createElement("img");this._freezeFrameImage.style.position="absolute";e.appendChild(this._freezeFrameImage);this._playerDiv.appendChild(this._freezeFrameOverlay)}_showFreezeFrameOverlay(){if(this._freezeFrame.valid){this._freezeFrameOverlay.classList.add("freezeframeBackground");this._freezeFrameOverlay.style.display="block"}}_invalidateFreezeFrameOverlay(){this._freezeFrame.valid=false;this._freezeFrameOverlay.style.display="none";this._freezeFrameOverlay.classList.remove("freezeframeBackground");if(this._webRtcPlayerObj){this._webRtcPlayerObj.setVideoEnabled(true)}}_resizeFreezeFrameOverlay(){const e=this._freezeFrame;if(e.width!==0&&e.height!==0){let e=0;let t=0;let i=0;let s=0;let r=this._playerDiv;this._freezeFrameOverlay.style.width=r.offsetWidth+"px";this._freezeFrameOverlay.style.height=r.offsetHeight+"px";this._freezeFrameOverlay.style.left=0+"px";this._freezeFrameOverlay.style.top=0+"px";this._freezeFrameImage.style.width=e+"px";this._freezeFrameImage.style.height=t+"px";this._freezeFrameImage.style.left=s+"px";this._freezeFrameImage.style.top=i+"px"}}_onRtcPlayerResponse(e){this.dispatchEvent(i.RTC_RESPONSE,e)}_sendInputData(e){if(this._webRtcPlayerObj){this._webRtcPlayerObj.send(e)}}_emitMessageType(e){this._sendInputData(new Uint8Array([e]).buffer)}_emitDescriptor(e,t){let i=JSON.stringify(t);let s=new DataView(new ArrayBuffer(1+2+2*i.length));let r=0;s.setUint8(r,e);r++;s.setUint16(r,i.length,true);r+=2;for(let e=0;e<i.length;e++){s.setUint16(r,i.charCodeAt(e),true);r+=2}this._sendInputData(s.buffer)}emitUIInteraction(e){this._emitDescriptor(a.UIInteraction,e)}emitCommand(e){this._emitDescriptor(a.Command,e)}_requestInitialSettings(){this._emitMessageType(a.RequestInitialSettings)}_requestQualityControl(){if(this._qualityController)this._emitMessageType(a.RequestQualityControl)}_normalize(e,t){const i=this._videoElement.clientWidth;const s=this._videoElement.clientHeight;return[e/i,t/s]}normalizeAndQuantizeUnsigned(e,t){const[i,s]=this._normalize(e,t);if(i<0||s<0||i>1||s>1){return{inRange:false,x:65535,y:65535}}else{return{inRange:true,x:i*65536,y:s*65536}}}normalizeAndQuantizeSigned(e,t){const[i,s]=this._normalize(e,t);return{x:i*.5*32767,y:s*.5*32767}}unquantizeAndDenormalizeUnsigned(e,t){return{x:e/65536*this._videoElement.clientWidth,y:t/65536*this._videoElement.clientHeight}}emitKeyDown(e,t){if(this._print_inputs){console.log(`key down ${e}, repeat = ${t}`)}this._sendInputData(new Uint8Array([a.KeyDown,e,t]).buffer)}emitKeyUp(e){if(this._print_inputs){console.log(`key up ${e}`)}this._sendInputData(new Uint8Array([a.KeyUp,e]).buffer)}emitKeyPress(e){if(this._print_inputs){console.log(`key press ${e}`)}let t=new DataView(new ArrayBuffer(3));t.setUint8(0,a.KeyPress);t.setUint16(1,e,true);this._sendInputData(t.buffer)}emitMouseMove(e,t,i,s){if(this._print_inputs){console.log(`x: ${e}, y:${t}, dX: ${i}, dY: ${s}`)}let r=this.normalizeAndQuantizeUnsigned(e,t);let n=this.normalizeAndQuantizeSigned(i,s);let o=new DataView(new ArrayBuffer(9));o.setUint8(0,a.MouseMove);o.setUint16(1,r.x,true);o.setUint16(3,r.y,true);o.setInt16(5,n.x,true);o.setInt16(7,n.y,true);this._sendInputData(o.buffer)}emitMouseDown(e,t,i){if(this._print_inputs){console.log(`mouse button ${e} down at (${t}, ${i})`)}let s=this.normalizeAndQuantizeUnsigned(t,i);let r=new DataView(new ArrayBuffer(6));r.setUint8(0,a.MouseDown);r.setUint8(1,e);r.setUint16(2,s.x,true);r.setUint16(4,s.y,true);this._sendInputData(r.buffer)}emitMouseUp(e,t,i){if(this._print_inputs){console.log(`mouse button ${e} up at (${t}, ${i})`)}let s=this.normalizeAndQuantizeUnsigned(t,i);let r=new DataView(new ArrayBuffer(6));r.setUint8(0,a.MouseUp);r.setUint8(1,e);r.setUint16(2,s.x,true);r.setUint16(4,s.y,true);this._sendInputData(r.buffer)}emitMouseWheel(e,t,i){if(this._print_inputs){console.log(`mouse wheel with delta ${e} at (${t}, ${i})`)}let s=this.normalizeAndQuantizeUnsigned(t,i);let r=new DataView(new ArrayBuffer(7));r.setUint8(0,a.MouseWheel);r.setInt16(1,e,true);r.setUint16(3,s.x,true);r.setUint16(5,s.y,true);this._sendInputData(r.buffer)}releaseMouseButtons(t,i,s){for(let e of r){if(t&e[1]){this.emitMouseUp(e[0],i,s)}}}pressMouseButtons(t,i,s){for(let e of r){if(t&e[1]){this.emitMouseDown(e[0],i,s)}}}_registerInputs(){this._registerKeyboardEvents();this._registerMouseEvents();this._registerTouchEvents();this._registerMouseEnterAndLeaveEvents()}_registerKeyboardEvents(){const e=this._videoElement;e.onkeydown=e=>{this.emitKeyDown(n(e),e.repeat);if(e.keyCode===t.BackSpace){this.emitKeyPress(t.BackSpace)}if(this._inputOptions.suppressBrowserKeys&&l(e.keyCode)){e.preventDefault()}};e.onkeyup=e=>{this.emitKeyUp(n(e));if(this._inputOptions.suppressBrowserKeys&&l(e.keyCode)){e.preventDefault()}};e.onkeypress=e=>this.emitKeyPress(e.charCode)}_registerMouseEnterAndLeaveEvents(){const t=this._videoElement;t.onmouseenter=e=>{if(this._print_inputs){console.log("mouse enter")}this._emitMessageType(a.MouseEnter);t.pressMouseButtons(e)};t.onmouseleave=e=>{if(this._print_inputs){console.log("mouse leave")}this._emitMessageType(a.MouseLeave);t.releaseMouseButtons(e)}}_registerMouseEvents(){const t=this._videoElement;const i=this._option.inputMode!=="Globe";document.addEventListener("pointerlockchange",()=>{const e=document.pointerLockElement===t;console.log(`Pointer locked:${e}`)});t.onmousedown=e=>{if(i)t.requestPointerLock();this.emitMouseDown(e.button,e.offsetX,e.offsetY)};t.onmouseup=e=>{if(i)document.exitPointerLock();this.emitMouseUp(e.button,e.offsetX,e.offsetY)};t.onmousemove=e=>{t.focus();this.emitMouseMove(e.offsetX,e.offsetY,e.movementX,e.movementY);e.preventDefault()};t.onwheel=e=>{this.emitMouseWheel(e["wheelDelta"],e.offsetX,e.offsetY);e.preventDefault()};t.pressMouseButtons=e=>this.pressMouseButtons(e.buttons,e.offsetX,e.offsetY);t.releaseMouseButtons=e=>this.releaseMouseButtons(e.buttons,e.offsetX,e.offsetY)}_registerTouchEvents(){const l=this._videoElement;let i=[9,8,7,6,5,4,3,2,1,0];let h={};const s=e=>{let t=i.pop();if(t===undefined){console.log("exhausted touch indentifiers")}h[e.identifier]=t};const r=e=>{i.push(h[e.identifier]);delete h[e.identifier]};const n=(e,n)=>{let o=new DataView(new ArrayBuffer(2+7*n.length));o.setUint8(0,e);o.setUint8(1,n.length);let a=2;for(let r=0;r<n.length;r++){let e=n[r];let t=e.clientX-l.offsetLeft;let i=e.clientY-l.offsetTop;if(this._print_inputs){console.log(`F${h[e.identifier]}=(${t}, ${i})`)}let s=this.normalizeAndQuantizeUnsigned(t,i);o.setUint16(a,s.x,true);a+=2;o.setUint16(a,s.y,true);a+=2;o.setUint8(a,h[e.identifier]);a+=1;o.setUint8(a,255*e.force);a+=1;o.setUint8(a,s.inRange?1:0);a+=1}this._sendInputData(o.buffer)};if(this._inputOptions.fakeMouseWithTouches){let r=undefined;l.ontouchstart=t=>{if(r===undefined){let e=t.changedTouches[0];r={id:e.identifier,x:e.clientX-this._playerElementClientRect.left,y:e.clientY-this._playerElementClientRect.top};l.onmouseenter(t);this.emitMouseDown(o.MainButton,r.x,r.y)}t.preventDefault()};l.ontouchend=s=>{for(let e=0;e<s.changedTouches.length;e++){let i=s.changedTouches[e];if(i.identifier===r.id){let e=i.clientX-this._playerElementClientRect.left;let t=i.clientY-this._playerElementClientRect.top;this.emitMouseUp(o.MainButton,e,t);l.onmouseleave(s);r=undefined;break}}s.preventDefault()};l.ontouchmove=t=>{for(let e=0;e<t.touches.length;e++){let i=t.touches[e];if(i.identifier===r.id){let e=i.clientX-this._playerElementClientRect.left;let t=i.clientY-this._playerElementClientRect.top;this.emitMouseMove(e,t,e-r.x,t-r.y);r.x=e;r.y=t;break}}t.preventDefault()}}else{l.ontouchstart=t=>{for(let e=0;e<t.changedTouches.length;e++){s(t.changedTouches[e])}if(this._print_inputs){console.log("touch start")}n(a.TouchStart,t.changedTouches);t.preventDefault()};l.ontouchend=t=>{if(this._print_inputs){console.log("touch end")}n(a.TouchEnd,t.changedTouches);for(let e=0;e<t.changedTouches.length;e++){r(t.changedTouches[e])}t.preventDefault()};l.ontouchmove=e=>{if(this._print_inputs){console.log("touch move")}n(a.TouchMove,e.touches);e.preventDefault()}}}}s.UnrealViewer=m;function p(e){let t=document.createElement("div");t.id="messageOverlay";t.innerHTML=e?e:""}function f(e,t){if(!e)return;s.deepAssign(e.style,t)}class _{constructor(){this._fadeMap=new Map;this._lastTime=0;requestAnimationFrame(e=>this._fadeProc(e))}fadeOut(e){this.fade(e,true)}fadeIn(e){this.fade(e,false)}fade(e,t){const i=t?-1:1;const s=t?1:0;const r=this._fadeMap.get(e);if(!r){this._fadeMap.set(e,{opacity:s,fadeout:i})}else{r.fadeout=i}}_fadeProc(e){if(this._lastTime==0)this._lastTime=e;const s=(e-this._lastTime)/100;this._lastTime=e;for(let[t,i]of this._fadeMap){let e=false;i.opacity+=i.fadeout*s;if(i.opacity<0){i.opacity=0;e=true}else if(i.opacity>1){i.opacity=1;e=true}t.style.opacity=i.opacity.toFixed(2);if(e){this._fadeMap.delete(t);t.style.visibility=i.opacity==1?"visible":"hidden"}}requestAnimationFrame(e=>this._fadeProc(e))}}const y=new _})(CZMAP||(CZMAP={}));var CZMAP;(function(d){class e{constructor(e){this._attackEntites=[];this._intercepEntites=[];this._map=e;this._view3d=e.view3d;this._czviewer=this._view3d.czviewer}create(e,t){if(e)this.createAttack(e);if(t)this.createIntercept(t)}createAttack(e){this.clearAttack();const t=e.track.map(e=>Cesium.Cartesian3.fromDegrees(...e));const i=t[0];const s=t.last();const r=new m;r.addPoints(t);const n=r.samples(100);this._createAttackEntity({name:"起点",position:i,billboard:{image:e.start.icon}});this._createTrackLine(n,e.start);if(e.target){const o=Cesium.Cartesian3.fromDegrees(...e.target.position);const a=Cesium.Cartesian3.distance(i,o);const l=a*.05;this._createAttackEntity({name:"目标",position:o,ellipse:{semiMinorAxis:l,semiMajorAxis:l,material:new d.DynamicCircleMaterialProperty(e.target)}});this._createTrackLine([s,o],e.target)}if(e.estimated){const h=Cesium.Cartesian3.fromDegrees(...e.estimated.position);const a=Cesium.Cartesian3.distance(i,h);const l=a*.05;this._createAttackEntity({name:"预估点",position:h,ellipse:{semiMinorAxis:l/2,semiMajorAxis:l/2,material:new d.DynamicCircleMaterialProperty(e.estimated)}});this._createTrackLine([s,h],e.estimated)}if(e.model){const{position:c,orientation:u}=r.calcPositonAndOrientation(1,e.model.hpr);this._createAttackEntity({name:"当前点",position:c,orientation:u,model:e.model})}}createIntercept(e){this.clearIntercept();const t=new m;const i=[];let s=0,r=0;if(e.current){s=t.addPoints(e.current.positions.map(e=>Cesium.Cartesian3.fromDegrees(...e)))}if(e.estimated){r=t.addPoints(e.estimated.positions.map(e=>Cesium.Cartesian3.fromDegrees(...e)))}const n=s/t.totalDistance;const o=r/t.totalDistance;this._createIntercept(t,0,n,e.current,e.model);this._createIntercept(t,n,o,e.estimated,e.model)}clearAttack(){this._attackEntites.forEach(e=>this._czviewer.entities.remove(e));this._attackEntites.length=0}clearIntercept(){this._intercepEntites.forEach(e=>this._czviewer.entities.remove(e));this._intercepEntites.length=0}clear(){this.clearAttack();this.clearIntercept()}_createIntercept(e,t,i,s,r){if(!s)return;const n=e.sampleByPercentRange(t,i,50);this._createTrackLine(n,s);if(r){const o=e.calcPositonAndOrientation(i,r.hpr);this._createInterceptEntity({name:"当前点",position:o.position,orientation:o.orientation,model:r});const a=e.calcPositonAndOrientation(i,[0,-90,0]);this._createInterceptEntity({name:"拦截区",position:a.position,orientation:a.orientation,ellipsoid:{radii:new Cesium.Cartesian3(s.radius,s.radius,s.radius),maximumCone:Cesium.Math.PI_OVER_TWO,material:new d.DynamicCircleMaterialProperty({color:s.color,speed:-40,repeat:10,mode:d.DynamicCircleMode.OnAxisY}),outline:false}})}}_createAttackEntity(e){const t=this._czviewer.entities.add(e);this._attackEntites.push(t);return t}_createInterceptEntity(e){const t=this._czviewer.entities.add(e);this._intercepEntites.push(t);return t}_createTrackLine(e,t){if(t.trackStyle){const i=this._czviewer.entities.add({polyline:r(e,t.trackStyle)});this._attackEntites.push(i)}if(t.flowStyle){const s=this._czviewer.entities.add({polyline:{positions:e,width:t.flowStyle.width,material:new d.LineFlowMaterialProperty({color:d.CesiumAttrib.getColor(t.flowStyle.color),speed:t.flowStyle.speed,percent:t.flowStyle.percent,gradient:t.flowStyle.gradient})}});this._attackEntites.push(s)}}}d.MissileTrack=e;function r(e,t){let i;switch(t.type){case d.StrokeDetailType.NORMAL:i=d.CesiumAttrib.getColor(t.color);break;case d.StrokeDetailType.DASH:i=new Cesium.PolylineDashMaterialProperty({color:d.CesiumAttrib.getColor(t.color),gapColor:d.CesiumAttrib.getColor(t.dashColor),dashLength:d.Types.defaultValue(t.dashLength,16),dashPattern:d.Types.defaultValue(t.dashPattern,255)});break;case d.StrokeDetailType.GLOW:i=new Cesium.PolylineGlowMaterialProperty({color:d.CesiumAttrib.getColor(t.color,Cesium.Color.WHITE),glowPower:d.Types.defaultValue(t.glowPower,.25),taperPower:d.Types.defaultValue(t.taperPower,1)});break;case d.StrokeDetailType.ARROW:i=new Cesium.PolylineArrowMaterialProperty(d.CesiumAttrib.getColor(t.color,Cesium.Color.WHITE));break;case d.StrokeDetailType.OUTLINE:i=new Cesium.PolylineOutlineMaterialProperty({color:d.CesiumAttrib.getColor(t.color,Cesium.Color.WHITE),outlineColor:d.CesiumAttrib.getColor(t.outlineColor,Cesium.Color.BLACK),outlineWidth:d.Types.defaultValue(t.outlineWidth,1)})}return{positions:e,width:t.width,material:i}}function t(e,t,i,s){}class m{constructor(){this._startTime=new Cesium.JulianDate(0,0);this._stopTime=new Cesium.JulianDate(0,0);this._sampled=new Cesium.SampledPositionProperty;this._totalDistance=0;const e=new Cesium.SampledPositionProperty;e.forwardExtrapolationType=Cesium.ExtrapolationType.HOLD;e.backwardExtrapolationType=Cesium.ExtrapolationType.HOLD;e.setInterpolationOptions({interpolationDegree:2,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation});this._sampled=e}get totalDistance(){return this._totalDistance}addPoint(e){let t=0;if(this._lastPoint){t=Cesium.Cartesian3.distance(e,this._lastPoint);if(t===0)return}this._totalDistance+=t;const i=Cesium.JulianDate.addSeconds(this._startTime,this._totalDistance,new Cesium.JulianDate);this._sampled.addSample(i,e);this._stopTime=i;this._lastPoint=e.clone(this._lastPoint);return this._totalDistance}addPoints(e){e.forEach(e=>this.addPoint(e));return this._totalDistance}sampleByPercent(e){return this.sampleByDistance(e*this._totalDistance)}sampleByDistance(e){const t=Cesium.JulianDate.addSeconds(this._startTime,e,new Cesium.JulianDate);return this._sampled.getValue(t)}samples(t){const i=[];const s=new Cesium.JulianDate;const r=this._totalDistance/(t-1);for(let e=0;e<t;++e){const n=Cesium.JulianDate.addSeconds(this._startTime,e*r,s);i.push(this._sampled.getValue(n))}return i}sampleByPercentRange(e,t,i){return this.sampleByDistanceRange(e*this._totalDistance,t*this._totalDistance,i)}sampleByDistanceRange(t,e,i){const s=[];const r=new Cesium.JulianDate;const n=(e-t)/(i-1);for(let e=0;e<i;++e){const o=Cesium.JulianDate.addSeconds(this._startTime,e*n+t,r);s.push(this._sampled.getValue(o))}return s}frontDirByPercent(e,t){let i=e+.01;if(e<0){e=0;i=.01}else if(e>=1){e=1-.01;i=1}const s=this.sampleByPercent(e);const r=this.sampleByPercent(i);const n=Cesium.Cartesian3.subtract(r,s,new Cesium.Cartesian3);if(t)Cesium.Cartesian3.normalize(n,n);return n}calcPositonAndOrientation(e,t){const i=this.frontDirByPercent(e,true);const s=this.sampleByPercent(e);const r=new Cesium.Matrix3;Cesium.Transforms.rotationMatrixFromPositionVelocity(s,i,undefined,r);const n=Cesium.Quaternion.fromRotationMatrix(r,new Cesium.Quaternion);if(t){const[o,a,l]=t;const h=Cesium.HeadingPitchRoll.fromDegrees(o,a,l);const c=Cesium.Quaternion.fromHeadingPitchRoll(h);Cesium.Quaternion.multiply(n,c,n)}return{position:s,orientation:n}}}})(CZMAP||(CZMAP={}));var CZMAP;(function(e){const t="+proj=longlat +a=6378140 +b=6356755.288157528 +no_defs";function r(e){return`+proj=tmerc +lat_0=0 +lon_0=${e.toFixed(12)} +k=1 +x_0=500000 +y_0=0 +a=6378140 +b=6356755.288157528 +units=m +no_defs`}class i{constructor(){this._dst=t;this._centerX=0;this._centerY=0}setCrs(e){this._centerX=0;this._centerY=0;this._src=e;this._proj=proj4(this._src,this._dst)}setCenter(e,t){this._src=r(e);this._proj=proj4(this._src,this._dst);const[i,s]=this._proj.inverse([e,t]);this._centerX=i;this._centerY=s}toLongLat(e){const[t,i]=this._proj.forward([e[0]+this._centerX,e[1]+this._centerY]);return[t,i,e[2]]}toLocal(e){const[t,i,s]=this._proj.inverse(e);return[t-this._centerX,i-this._centerY,s]}}e.ProjectionForGlobe=i})(CZMAP||(CZMAP={}));var CZMAP;(function(a){class e{static transformBox(t,i,s){if(!i||!s)return t;if(i===s)return t;try{let e=proj4(i,s);const r=t.getMin();l(e,r);const n=t.getMax();l(e,n);const o=new a.BoundingBox;o.mergePoint(r);o.mergePoint(n);return o}catch(e){}return t}static transformCoordinates(e,t,i){if(!t||!i)return e;if(t===i)return e;if(!a.Types.isArray(e))return e;let s=e;try{let e=proj4(t,i);l(e,s)}catch(e){}return s}static transformFeatures(e,t,i){let r=e;if(!a.Types.isArray(e))r=[e];if(!t||!i)return e;try{let s=proj4(t,i);for(let i=0;i<r.length;++i){let e=r[i];let t=e.geometry;if(t instanceof a.Geometry){t.applyTransform((e,t)=>{const i=s.forward(e);a.copyPoint(i,t)})}else{l(s,t.coordinates)}}}catch(e){}return r}}a.Transforms=e;function l(i,s){if(!a.Types.isArray(s))return;if(a.Types.isArray(s[0])){s.forEach(e=>l(i,e));return}if(a.Types.isNumber(s[0])){let t=i.forward(s);for(let e=0;e<t.length;++e)s[e]=t[e]}}})(CZMAP||(CZMAP={}));var CZMAP;(function(a){function i(s,r,n,o){return function(e,t,i){a.HttpUtil.get(new a.HttpArgs(s)).then(e=>{switch(r.getType()){case a.FeatureFormatType.JSON:return e.json();case a.FeatureFormatType.TEXT:return e.text();case a.FeatureFormatType.XML:return e.text();case a.FeatureFormatType.ARRAY_BUFFER:return e.arrayBuffer()}},e=>{if(o)o.call(this)}).then(e=>{if(!e)return;n.call(this,r.readFeatures(e),r.readProjection(e))},()=>{if(o)o.call(this)})}}a.createUrlFeatureLoader=i;function e(e,t){return i(e,t,function(e,t){if(a.Types.isFunction(this.addFeatures))this.addFeatures(e)})}a.createUrlVectorFeatureLoader=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["UNDEFINED"]="undefined";e["LOADING"]="loading";e["READY"]="ready";e["ERROR"]="error"})(t=e.SourceState||(e.SourceState={}))})(CZMAP||(CZMAP={}));var CZMAP;(function(t){let i;(function(e){e[e["LEFT"]=0]="LEFT";e[e["CENTER"]=1]="CENTER";e[e["RIGHT"]=1]="RIGHT"})(i=t.HorizontalOrigin||(t.HorizontalOrigin={}));let s;(function(e){e[e["BOTTOM"]=0]="BOTTOM";e[e["CENTER"]=1]="CENTER";e[e["TOP"]=2]="TOP";e[e["BASELINE"]=3]="BASELINE"})(s=t.VerticalOrigin||(t.VerticalOrigin={}));let r;(function(e){e["VISIBLE"]="visible"})(r=t.StyleProperty||(t.StyleProperty={}));class e extends t.BaseObject{constructor(e){super(e)}get visible(){return this.get(r.VISIBLE)}set visible(e){this.set(r.VISIBLE,e)}toStyleOption(){return this.getProperties()}static fmtHorizontal(e){e=t.Types.isString(e)?e.toUpperCase():e;switch(e){case"LEFT":return i.LEFT;case"CENTER":return i.CENTER;case"RIGHT":return i.RIGHT;case i.LEFT:return i.LEFT;case i.CENTER:return i.CENTER;case i.RIGHT:return i.RIGHT;default:return i.LEFT}}static fmtVertital(e){e=t.Types.isString(e)?e.toUpperCase():e;switch(e){case"BOTTOM":return s.BOTTOM;case"CENTER":return s.CENTER;case"TOP":return s.TOP;case"BASELINE":return s.BASELINE;case s.BOTTOM:return s.BOTTOM;case s.CENTER:return s.CENTER;case s.TOP:return s.TOP;case s.BASELINE:return s.BASELINE;default:return s.BOTTOM}}_initDefines(){super._initDefines();this.def(r.VISIBLE,true,t.Parse.parseBoolean)}}t.Style=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["OFFSET"]="offset";e["HORIZONTAL_ORIGIN"]="horizontalOrigin";e["VERTICAL_ORIGIN"]="verticalOrigin";e["VISIBLE_RANGE"]="visibleRange";e["FADE_DISTANCE"]="fadeDistance";e["SCALE_DISTANCE"]="scaleDistance";e["DEPTH_DISTANCE"]="depthDistance"})(t=e.BillStyleProperty||(e.BillStyleProperty={}));class i extends e.Style{constructor(e){super(e)}_initDefines(){this.def(t.OFFSET,[0,0],e.Numbers.parseArray2,e.ArrayUtils.equals);this.def(t.HORIZONTAL_ORIGIN,e.HorizontalOrigin.LEFT,e.Style.fmtHorizontal);this.def(t.VERTICAL_ORIGIN,e.VerticalOrigin.BOTTOM,e.Style.fmtVertital);this.def(t.VISIBLE_RANGE,[0,1e8],e.Numbers.parseArray2,e.ArrayUtils.equals);this.def(t.SCALE_DISTANCE,undefined,e.Numbers.parseArray4,e.ArrayUtils.equals);this.def(t.FADE_DISTANCE,undefined,e.Numbers.parseArray4,e.ArrayUtils.equals);this.def(t.DEPTH_DISTANCE,undefined,e.Numbers.parseNumber)}set offset(e){this.set(t.OFFSET,e,false)}get offset(){return this.get(t.OFFSET)}set horizontalOrigin(e){this.set(t.HORIZONTAL_ORIGIN,e)}get horizontalOrigin(){return this.get(t.HORIZONTAL_ORIGIN)}set vertitalOrigin(e){this.set(t.VERTICAL_ORIGIN,e)}get vertitalOrigin(){return this.get(t.VERTICAL_ORIGIN)}set visibleRange(e){this.set(t.VISIBLE_RANGE,e)}get visibleRange(){return this.get(t.VISIBLE_RANGE)}set scaleDistance(e){this.set(t.SCALE_DISTANCE,e)}get scaleDistance(){return this.get(t.SCALE_DISTANCE)}set fadeDistance(e){this.set(t.FADE_DISTANCE,e)}get fadeDistance(){return this.get(t.FADE_DISTANCE)}set depthDistance(e){this.set(t.DEPTH_DISTANCE,e)}get depthDistance(){return this.get(t.DEPTH_DISTANCE)}}e.BillStyle=i})(CZMAP||(CZMAP={}));var CZMAP;(function(o){class e extends o.Style{constructor(e){super();this._icon=null;this._label=null;this._model=null;this._stroke=null;this._wall=null;this._name=null;this._tip=undefined;this._menu=undefined;e=e||{};this._name=o.Types.defaultValue(e.name,"");this._icon=t(o.IconStyle,e.icon);this._label=t(o.LabelStyle,e.label);this._model=t(o.ModelStyle,e.model);this._stroke=t(o.StrokeStyle,e.stroke);this._wall=t(o.WallStyle,e.wall);this._tip=undefined;this._menu=undefined}get name(){return this._name}get icon(){return this._icon}get label(){return this._label}get model(){return this._model}get stroke(){return this._stroke}get wall(){return this._wall}get tip(){return this._tip}get menu(){return this._menu}update(e,t,i){let s=JSON.parse(JSON.stringify(e));if(t)a(s,t,i);s=s||{};this._name=s.name;const r=(e,t,i,s,r)=>{if(!o.Types.isDefined(i[s]))return;if(!e)e=new t;i=h(i,s,r);n(e,i);return e};this._label=r(this._label,o.LabelStyle,s,"label","text");this._icon=r(this._icon,o.IconStyle,s,"icon","src");this._model=r(this._model,o.ModelStyle,s,"model","src");this._stroke=r(this._stroke,o.StrokeStyle,s,"stroke","src");this._wall=r(this._wall,o.WallStyle,s,"wall","src");if(o.Types.isDefined(s.tip)){this._tip=s.tip}if(o.Types.isDefined(s.menu)){this._menu=s.menu}}}e.default=new e;o.FeatureStyle=e;function n(e,t){for(const i in t){e.set(i,t[i]);const s=r(i);if(s)e.set(s,t[i])}}function i(e){return e.substr(0,1).toUpperCase()+e.substr(1)}function r(e){const t=e.split("-");if(t.length==1)return;for(let e=1;e<t.length;++e){t[e]=i(t[e])}return t.join("")}function t(e,t){if(!o.Types.isDefined(t))return undefined;if(t instanceof e)return t;return new e(t)}function a(i,s,r){if(o.Types.isString(i)){if(r)return o.StringTemp.parseVarMatch(i,s);else return o.StringTemp.parseVar(i,s)}if(o.Types.isArray(i)){const n=[];let t=false;for(let e=0;e<i.length;++e){n[e]=a(i[e],s,r);if(n[e]!==null){t=true}else{n[e]=i[e]}}return r&&!t?null:n}if(o.Types.isObject(i)){for(let e in i){i[e]=a(i[e],s,r);if(r&&i[e]===null){delete i[e]}}return i}if(r)return null;return i}function l(t,i,s){const e=Object.keys(t);e.forEach(e=>{if(e.startsWith(i))s[e.substring(i.length)]=t[e]})}function h(e,t,i){let s=e[t];if(o.Types.isDefined(s)&&!o.Types.isObject(s)){s={[i]:e[t]};l(e,`${t}-`,s)}return s}})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["SOURCE"]="src";e["COLOR"]="color";e["WIDTH"]="width";e["HEIGHT"]="height";e["ROTATION"]="rotate"})(t=e.IconStyleProperty||(e.IconStyleProperty={}));class i extends e.BillStyle{constructor(e){super(e)}_initDefines(){this.def(t.SOURCE,"");this.def(t.COLOR,"white");this.def(t.WIDTH,undefined,e.Numbers.parseNumber);this.def(t.HEIGHT,undefined,e.Numbers.parseNumber);this.def(t.ROTATION,0,e.Numbers.parseNumber)}get src(){return this.get(t.SOURCE)}set src(e){this.set(t.SOURCE,e)}get color(){return this.get(t.COLOR)}set color(e){this.set(t.COLOR,e)}get width(){return this.get(t.WIDTH)}set width(e){this.set(t.WIDTH,e)}get height(){return this.get(t.HEIGHT)}set height(e){this.set(t.HEIGHT,e)}get rotate(){return this.get(t.ROTATION)}set rotate(e){this.set(t.ROTATION,e)}}e.IconStyle=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["TEXT"]="text";e["FONT"]="font";e["COLOR"]="color";e["BORDER_COLOR"]="borderColor";e["BORDER_WIDTH"]="borderWidth";e["BACKGROUND"]="background";e["BACKGROUND_COLOR"]="backgroundColor";e["LINE_OFFSET"]="lineOffset";e["LINE_COLOR"]="lineColor";e["LINE_WIDTH"]="lineWidth"})(t=e.LabelStyleProperty||(e.LabelStyleProperty={}));class i extends e.BillStyle{constructor(e){super(e)}_initDefines(){this.def(t.TEXT);this.def(t.FONT,"32px 黑体");this.def(t.COLOR,"black");this.def(t.BORDER_COLOR,"black");this.def(t.BORDER_WIDTH,0,e.Numbers.parseNumber);this.def(t.BACKGROUND,true);this.def(t.BACKGROUND_COLOR,"#606060");this.def(t.LINE_OFFSET,undefined,e.Numbers.parseArray3,e.ArrayUtils.equals);this.def(t.LINE_WIDTH,1,e.Numbers.parseNumber);this.def(t.LINE_COLOR,"red")}set text(e){this.set(t.TEXT,e)}get text(){return this.get(t.TEXT)}set font(e){this.set(t.FONT,e)}get font(){return this.get(t.FONT)}set color(e){this.set(t.COLOR,e)}get color(){return this.get(t.COLOR)}set borderColor(e){this.set(t.BORDER_COLOR,e)}get borderColor(){return this.get(t.BORDER_COLOR)}set borderWidth(e){this.set(t.BORDER_WIDTH,e)}get borderWidth(){return this.get(t.BORDER_WIDTH)}set backgroundColor(e){this.set(t.BACKGROUND_COLOR,e)}get backgroundColor(){return this.get(t.BACKGROUND_COLOR)}set lineOffset(e){this.set(t.LINE_OFFSET,e)}get lineOffset(){return this.get(t.LINE_OFFSET)}set lineWidth(e){this.set(t.LINE_WIDTH,e)}get lineWidth(){return this.get(t.LINE_WIDTH)}set lineColor(e){this.set(t.LINE_COLOR,e)}get lineColor(){return this.get(t.LINE_COLOR)}}e.LabelStyle=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["SOURCE"]="src";e["POSE"]="pose";e["SCALE"]="scale"})(t=e.ModelStyleProperty||(e.ModelStyleProperty={}));class i extends e.Style{constructor(e){super(e)}_initDefines(){this.def(t.SOURCE,"");this.def(t.POSE,[0,0,0],e.Numbers.parseArray3,e.ArrayUtils.equals);this.def(t.SCALE,1,e.Numbers.parseNumber)}get src(){return this.get(t.SOURCE)}set src(e){this.set(t.SOURCE,e)}get pose(){return this.get(t.POSE)}set pose(e){this.set(t.POSE,e)}get scale(){return this.get(t.SCALE)}set scale(e){this.set(t.SCALE,e)}}e.ModelStyle=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["NORMAL"]="normal";e["GLOW"]="glow";e["OUTLINE"]="outline";e["DASH"]="dash";e["ARROW"]="arrow"})(t=e.StrokeDetailType||(e.StrokeDetailType={}));let i;(function(e){e["NONE"]="none";e["GEODESIC"]="geodesic";e["RHUMB"]="rhumb"})(i=e.StrokeArcType||(e.StrokeArcType={}));let s;(function(e){e["FOLLOW_SURFACE"]="followSurface";e["WIDTH"]="width";e["ARC_TYPE"]="arcType";e["DETAIL"]="detail";e["VISIBLE_RANGE"]="visibleRange"})(s=e.StrokeStyleProperty||(e.StrokeStyleProperty={}));class r extends e.Style{constructor(e){super(e)}_initDefines(){this.def(s.FOLLOW_SURFACE,false);this.def(s.WIDTH,1,e.Numbers.parseInteger);this.def(s.ARC_TYPE,"none");this.def(s.VISIBLE_RANGE,undefined,e.Numbers.parseArray2,e.ArrayUtils.equals);this.def(s.DETAIL)}get followSurface(){return this.get(s.FOLLOW_SURFACE)}set followSurface(e){this.set(s.FOLLOW_SURFACE,e)}get width(){return this.get(s.WIDTH)}set width(e){this.set(s.WIDTH,e)}get arcType(){return this.get(s.ARC_TYPE)}set arcType(e){this.set(s.ARC_TYPE,e)}get visibleRange(){return this.get(s.VISIBLE_RANGE)}set visibleRange(e){this.set(s.VISIBLE_RANGE,e)}get detail(){return this.get(s.DETAIL)}set detail(e){this.set(s.DETAIL,e)}}e.StrokeStyle=r})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e["COLOR"]="color";e["IMAGE"]="image";e["IMAGE_REPEAT_Y"]="imageRepeatY";e["HEIGHT"]="height";e["THICKNESS"]="thickness";e["OUTLINE_WITDH"]="outlineWidth";e["OUTLINE_COLOR"]="outlineColor";e["VISIBLE_RANGE"]="visibleRange"})(t=e.WallStyleProperty||(e.WallStyleProperty={}));class i extends e.Style{constructor(e){super(e)}_initDefines(){this.def(t.COLOR,"white");this.def(t.IMAGE);this.def(t.IMAGE_REPEAT_Y,1,e.Numbers.parseNumber);this.def(t.HEIGHT);this.def(t.THICKNESS,0);this.def(t.OUTLINE_COLOR);this.def(t.OUTLINE_WITDH,undefined,e.Numbers.parseInteger);this.def(t.VISIBLE_RANGE,undefined,e.Numbers.parseArray2,e.ArrayUtils.equals)}get color(){return this.get(t.COLOR)}set color(e){this.set(t.COLOR,e)}get image(){return this.get(t.IMAGE)}set image(e){this.set(t.IMAGE,e)}get imageRepeatY(){return this.get(t.IMAGE_REPEAT_Y)}set imageRepeatY(e){this.set(t.IMAGE_REPEAT_Y,e)}get height(){return this.get(t.HEIGHT)}set height(e){this.set(t.HEIGHT,e)}get thickness(){return this.get(t.THICKNESS)}set thickness(e){this.set(t.THICKNESS,e)}get outlineColor(){return this.get(t.OUTLINE_COLOR)}set outlineColor(e){this.set(t.OUTLINE_COLOR,e)}get outlineWidth(){return this.get(t.OUTLINE_WITDH)}set outlineWidth(e){this.set(t.OUTLINE_WITDH,e)}get visibleRange(){return this.get(t.VISIBLE_RANGE)}set visibleRange(e){this.set(t.VISIBLE_RANGE,e)}}e.WallStyle=i})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.BaseObject{constructor(e){super();this.map=e.map;this.view=e}}e.BaseTool=t})(CZMAP||(CZMAP={}));var CZMAP;(function(c){let t;(function(e){e["COLOR"]="color";e["BORDER_COLOR"]="border_color";e["BORDER_WIDTH"]="border_width"})(t=c.ClipPlaneProperty||(c.ClipPlaneProperty={}));let i;(function(e){e["AXIS"]="axis";e["DISTANCE"]="distance"})(i=c.AxisClipPlaneProperty||(c.AxisClipPlaneProperty={}));let e;(function(e){e["PATH"]="path"})(e=c.PathClipPlanesProperty||(c.PathClipPlanesProperty={}));let s;(function(e){e[e["AXIS_PLANE"]=0]="AXIS_PLANE";e[e["PATH_PLANE"]=1]="PATH_PLANE"})(s=c.ClipPlaneType||(c.ClipPlaneType={}));class r extends c.BaseTool{constructor(e,t){super(e);this._box=t.clone();this._center=t.getCenter();this._size=t.getSize();const[i,s,r]=this._size;this._gsize=[i*111e3,s*111e3,r]}get box(){return this._box}get center(){return this._center}get size(){return this._size}get gsize(){return this._gsize}}c.BoxBasedTool=r;class n extends r{constructor(e,t){super(e,t)}get color(){return this.get(t.COLOR)}set color(e){this.set(t.COLOR,e)}get borderColor(){return this.get(t.BORDER_COLOR)}set borderColor(e){this.set(t.BORDER_COLOR,e)}get borderWidth(){return this.get(t.BORDER_WIDTH)}set borderWidth(e){this.set(t.BORDER_WIDTH,e)}}c.ClipPlaneBase=n;class o extends n{constructor(e,t){super(e,t)}get axis(){return this.get(i.AXIS)}set axis(e){this.set(i.AXIS,e)}get distance(){return this.get(i.DISTANCE)}set distance(e){this.set(i.DISTANCE,e)}get percent(){const e=this.gsize[this.axis];return(this.distance+e/2)/e}set percent(e){const t=this.gsize[this.axis];this.distance=e*t-t/2}}c.AxisClipPlane=o;class a extends n{constructor(e,t){super(e,t);this._path=[];this._path0=[]}get path(){return this._path.slice()}_clone(){const t=this._path0.length;this._path.length=t;for(let e=0;e<t;++e){this._path[e]=this._path0[e].slice()}}addPoint(e){const[t,i]=e;this._path0.push([t,i,0]);this._clone();this._onPathChanged()}clear(){this._path0.length=0;this._path.length=0;this._onPathChanged()}closePath(){if(this._path0.length<3)return;this._clone();const e=this._path[0];const t=this._path[this._path.length-1];if(!c.comparePoint(e,t)){this._path.push(e.slice())}this._onPathChanged()}extendPath(){if(this._path0.length<2)return;this._clone();const e=this._path;const t=e.length;const i=c.GeoMath.mulScalar(this.size,.5);const[s,r]=this.center;const[n,o]=i;const a=[[s-n,r-o],[s+n,r-o],[s+n,r+o],[s-n,r+o],[s-n,r-o]];e[0]=this._extendLineToBox(e[1],e[0],a);e[t-1]=this._extendLineToBox(e[t-2],e[t-1],a);this._onPathChanged()}_extendLineToBox(t,i,s){const r=[];for(let e=1;e<s.length;++e){const n=s[e-1];const o=s[e];const a=[0,0,0];if(c.Math2D.Intersect2D(t,i,n,o,a,false)){const l=c.GeoMath.squareDistance(i,a);const h=c.GeoMath.squareDistance(t,a);if(l<h)r.push({e:a,d:l})}}r.sort((e,t)=>e.d-t.d);return r[0].e}_onPathChanged(){}}c.PathClipPlanes=a})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.BaseTool{constructor(e){super(e)}}e.DrawTool=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.BaseTool{constructor(e){super(e)}}e.GridTool=t})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e extends i.BaseTool{constructor(e,t){super(e);this._visible=true;this._position=t.position;this._positioning=i.defaultValue(t.positioning,"bottom-center");this._offset=[i.defaultValue(t.offsetX,0),i.defaultValue(t.offsetY,0)];this._createDom(t.content,i.defaultValue(t.domID,i.randomString({prefix:"Random-"})));this._onClosing=t.onClosing;this._onClosed=t.onClosed;this.content=t.content}get position(){return this._position}set position(e){this._position=e;this._onPositionChange()}get positioning(){return this._positioning}set positioning(e){this._positioning=e;this._updateArrow();this._pixelX=-1}get offset(){return this._offset}set offset(e){this._offset=e.slice();this._pixelX=-1}get content(){return this._content}set content(e){this._content=e;if(e instanceof Element)this._contentDom.append(e);else this._contentDom.innerHTML=e;this._pixelX=-1}get visible(){return this._visible}set visible(e){this._visible=e;if(this._overlayDom)this._overlayDom.style.display=e?"block":"none"}close(){if(!this._dom)return true;if(this._onClosing&&!i.tryCatchCall(this._onClosing,[this]))return false;this._dom.remove();this._dom=undefined;this._overlayDom=undefined;i.tryCatchCall(this._onClosed,[this]);return true}_onPositionChange(){}_createDom(e,t){var i=`
                <div id="${t}Content" class="leaflet-popup" style="top:5px;left:0;">
                    <a class="leaflet-popup-close-button" href="#">×</a>
                    <div class="leaflet-popup-content-wrapper">
                        <div id="${t}Link" class="leaflet-popup-content" style="max-width: 300px;"></div>
                    </div>
                    <div class="leaflet-popup-tip-container"><div class="leaflet-popup-tip"></div></div>
                </div>`;const s=document.createElement("div");s.id=t;s.innerHTML=i;this._overlayDom=s.querySelector("div.leaflet-popup");this._arrowDom=s.querySelector("div.leaflet-popup-tip-container");this._contentDom=s.querySelector("div.leaflet-popup-content");const r=s.querySelector("a.leaflet-popup-close-button");r.addEventListener("click",()=>this.close());this._updateArrow();this.map.overlayRoot.append(s);this._dom=s}_updateArrow(){if(this._positioning=="bottom-center")this._arrowDom.style.display="block";else this._arrowDom.style.display="none"}_updatePosition(e,t){if(!this._visible)return;if(e==this._pixelX&&t==this._pixelY)return;const[i,s]=this._offset;const[r,n]=this._positioning.split("-");const o=this._overlayDom.offsetWidth;const a=this._overlayDom.offsetHeight;switch(n){case"left":e+=i;break;case"center":e-=o/2+i;break;case"right":e-=o+i;break}switch(r){case"top":t+=s;break;case"center":t-=a/2+s;break;case"bottom":t-=a+s;break}this._pixelX=e;this._pixelY=t;this._overlayDom.style.transform=`translate(${e}px, ${t}px)`}}i.InfoWindow=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{constructor(e,t){this._points=e;this._value=t}get points(){return this._points}get value(){return this._value}}e.MeasureCallbackParam=t;class i extends t{constructor(e,t){super(e,t)}get type(){return"distance"}get distance(){return this.value}}e.DistanceCallbackParam=i;class s extends t{constructor(e,t,i){super(e,i);this._center=t}get type(){return"area"}get area(){return this.value}get center(){return this._center}}e.AreaCallbackParam=s;class r extends e.BaseTool{constructor(e){super(e);this.set("deaultUI",false)}}e.MeasureTool=r})(CZMAP||(CZMAP={}));var CZMAP;(function(u){let t;(function(e){e["START"]="start";e["STOP"]="stop";e["MOVE"]="move";e["FORWARD"]="forward";e["BACKWARD"]="backward";e["CURRENT_TIME"]="currentTime";e["SPEED"]="speed";e["LOOP"]="loop";e["FOLLOW"]="follow";e["LOCK_VIEW"]="lockview";e["FIRST_VIEW"]="firstview"})(t=u.PathRoamEvents||(u.PathRoamEvents={}));let i;(function(e){e[e["NONE"]=0]="NONE";e[e["RETURN"]=1]="RETURN";e[e["RETURN_TO_START"]=2]="RETURN_TO_START"})(i=u.PathRoamLoopType||(u.PathRoamLoopType={}));class e{constructor(e){var t;this.distance=0;this.distanceTotal=0;if(Array.isArray(e)){this.position=e.slice()}else{this.position=u.defaultValues(e.position,e.cameraPoint).slice();this.target=(t=u.defaultValues(e.target,e.targetPoint))===null||t===void 0?void 0:t.slice();this.speed=e.speed;this.time=e.time}}}u.PathNode=e;class s extends u.BaseTool{constructor(e){super(e);this._play=false;this._lock=false;this._follow=true;this._first=false;this._modelForward=false;this._dir=1;this._speed=1;this._loop=i.NONE;this._showLine=false;this._lineWidth=1;this._lineColor="white"}start(){this._play=true;this.dispatchEvent(t.START)}pause(){this._play=false;this.dispatchEvent(t.STOP)}resume(){this._play=true;this.dispatchEvent(t.START)}forward(){this._dir=1;this.dispatchEvent(t.FORWARD)}backward(){this._dir=-1;this.dispatchEvent(t.BACKWARD)}get offset(){return undefined}set offset(e){}get playing(){return this._play}set speed(e){this._speed=e;this.dispatchEvent(t.SPEED)}get speed(){return this._speed}set loop(e){this._loop=e;this.dispatchEvent(t.LOOP)}get loop(){return this._loop}set follow(e){this._follow=e;this.dispatchEvent(t.FOLLOW)}get follow(){return this._follow}set lockview(e){this._lock=e;this.dispatchEvent(t.LOCK_VIEW)}get lockview(){return this._lock}set firstview(e){this._first=e;this.dispatchEvent(t.FIRST_VIEW)}get firstview(){return this._first}set modelForward(e){this._modelForward=e}get modelForward(){return this._modelForward}set showline(e){this._showLine=e}get showline(){return this._showLine}set lineWidth(e){this._lineWidth=e}get lineWidth(){return this._lineWidth}set lineColor(e){this._lineColor=e}get lineColor(){return this._lineColor}_disposeInternal(){super._disposeInternal();this.close()}buildRoamPath(e,t){const i=10;let s=0;let r=false;let n=false;let o;const a=[];e.forEach(e=>{const t=this._createPathNode(e);if(u.defined(o)){if(u.defined(t.time)&&t.time===o.time)return;t.distance=this._calcDistance(t,o);t.distanceTotal=s+=t.distance}if(!u.Types.isNumber(t.time))r=true;if(!u.Types.isNumber(t.speed))n=true;a.push(t);o=t});let l=0;if(n){if(u.Types.isDefined(t))l=t;else l=s/i}if(r){let t=0;a[0].time=0;const h=a.length;for(let e=1;e<h;++e){const c=a[e];if(n)c.time=t+c.distance/l;else c.time=t+c.distance/c.speed;t=c.time}}return a}}u.PathRoam=s})(CZMAP||(CZMAP={}));var CZMAP;(function(t){let i;(function(e){e["VISIBLE"]="visible";e["ANIMATION"]="animation";e["SPEED"]="speed"})(i=t.TunnelProperty||(t.TunnelProperty={}));let e;(function(e){e[e["NONE"]=0]="NONE";e[e["FORWARD"]=1]="FORWARD";e[e["BACKWARD"]=2]="BACKWARD"})(e=t.TunnelDir||(t.TunnelDir={}));class s extends t.BaseTool{constructor(e){super(e);this.set(i.VISIBLE,true);this.set(i.ANIMATION,false);this.set(i.SPEED,1);this.on(t.BaseObject.getChangeEventType(i.VISIBLE),this._onVisibleChanged);this.on(t.BaseObject.getChangeEventType(i.ANIMATION),this._onAnimationChanged)}set visible(e){this.set(i.VISIBLE,e)}get visible(){return this.get(i.VISIBLE)}set animation(e){this.set(i.ANIMATION,e)}get animation(){return this.get(i.ANIMATION)}set speed(e){this.set(i.SPEED,e)}get speed(){return this.get(i.SPEED)}_onVisibleChanged(){}_onAnimationChanged(){}_disposeInternal(){super._disposeInternal();this.close()}}t.TunnelEffct=s})(CZMAP||(CZMAP={}));var CZMAP;(function(t){class e extends t.BaseTool{constructor(e){super(e);this.set("enable",false);this.on(t.BaseTool.getChangeEventType("enable"),this._handleEnable)}init(e){t.abstract(e)}checkExist(e){}close(){}set enable(e){this.set("enable",e)}get enable(){return this.get("enable")}_disposeInternal(){super._disposeInternal();this.close()}}t.TunnelTransparent=e})(CZMAP||(CZMAP={}));var CZMAP;(function(r){class e extends r.AxisClipPlane{constructor(e,t){super(e,t);this._dim=new Cesium.Cartesian2;this.on(r.BaseObjectEvents.PROPERTYCHANGE,this._onPropertyChange,this);this._plane=new Cesium.Plane(Cesium.Cartesian3.UNIT_Z,0);this._updateAxis(r.Axis.AXIS_Z);const i=Cesium.Cartesian3.fromDegrees(...this.center);this._entity=new Cesium.Entity({position:i,plane:{plane:new Cesium.CallbackProperty(()=>this._plane,false),dimensions:new Cesium.CallbackProperty(()=>this._dim,false),material:Cesium.Color.WHITE.withAlpha(.1),outline:true,outlineColor:Cesium.Color.WHITE}});this._planeGraphics=this._entity.plane;e.czviewer.entities.add(this._entity)}_onPropertyChange(e){const t=e.target.get(e.key);if(!r.Types.isDefined(t))return;switch(e.key){case r.AxisClipPlaneProperty.AXIS:this._updateAxis(r.Axis.parser(t));break;case r.AxisClipPlaneProperty.DISTANCE:this._plane.distance=this.distance;break;case r.ClipPlaneProperty.COLOR:this._planeGraphics.material=r.CesiumAttrib.getColor(t);break;case r.ClipPlaneProperty.BORDER_COLOR:this._planeGraphics.outlineColor=r.CesiumAttrib.getColor(t);break;case r.ClipPlaneProperty.BORDER_WIDTH:this._planeGraphics.outlineWidth=t;break}}_updateAxis(e){const t=this._dim;const i=this.gsize;const s=this._plane.normal;Cesium.Cartesian3.ZERO.clone(s);switch(e){case r.Axis.AXIS_X:t.x=i[1];t.y=i[2];s.x=-1;break;case r.Axis.AXIS_Y:t.x=i[0];t.y=i[2];s.y=-1;break;case r.Axis.AXIS_Z:t.x=i[0];t.y=i[1];s.z=-1;break}}_disposeInternal(){this.map.view3d.czviewer.entities.remove(this._entity);this._entity=null;this.un(r.BaseObjectEvents.PROPERTYCHANGE,this._onPropertyChange,this);super._disposeInternal()}}r.AxisClipPlane3D=e;class t extends r.PathClipPlanes{constructor(e,t){super(e,t);this.on(r.BaseObjectEvents.PROPERTYCHANGE,this._onPropertyChange,this);this._entity=new Cesium.Entity({wall:{positions:[],minimumHeights:[],maximumHeights:[],material:Cesium.Color.WHITE.withAlpha(.1),outline:true,outlineColor:Cesium.Color.WHITE}});this._wallGraphics=this._entity.wall;e.czviewer.entities.add(this._entity)}_onPropertyChange(e){const t=e.target.get(e.key);if(!r.Types.isDefined(t))return;switch(e.key){case r.ClipPlaneProperty.COLOR:this._wallGraphics.material=r.CesiumAttrib.getColor(t);break;case r.ClipPlaneProperty.BORDER_COLOR:this._wallGraphics.outlineColor=r.CesiumAttrib.getColor(t);break;case r.ClipPlaneProperty.BORDER_WIDTH:this._wallGraphics.outlineWidth=t;break}}_updateWall(){const e=this._path.map(e=>Cesium.Cartesian3.fromDegrees(...e));const t=this._path.map(e=>this.box.minz);const i=this._path.map(e=>this.box.maxz);this._wallGraphics.positions=e;this._wallGraphics.minimumHeights=t;this._wallGraphics.maximumHeights=i}_onPathChanged(){this._updateWall()}_disposeInternal(){this.map.view3d.czviewer.entities.remove(this._entity);this._entity=null;this.un(r.BaseObjectEvents.PROPERTYCHANGE,this._onPropertyChange,this);super._disposeInternal()}}r.PathClipPlane3D=t})(CZMAP||(CZMAP={}));var CZMAP;(function(o){const a={fillColor:"yellow",lineColor:"yellow",lineWidth:3};class e extends o.DrawTool{constructor(e){super(e);this._next_id=0;this.view3d=e;this._3dDrawTool=new ZMap3DLib.Input3DTool(this.view3d.zmap3d);this._entity=this.view3d.zmap3d.zmapGeometry||new ZMAPGEOMETRY(this.view3d.zmap3d);this._entities=e.czviewer.entities}_getNextID(){return this._next_id++}add(e,t){switch(e.type){case o.GeometryType.POINT:return this.addPoint(e,t);case o.GeometryType.POLYLINE:return this.addPolyline(e,t);case o.GeometryType.POLYGON:return this.addPolygon(e,t);case o.GeometryType.CIRCLE:return this.addCircle(e,t);case o.GeometryType.RECTANGLE:return this.addRect(e,t);default:throw`no type '${e.type}'`}}addPoint(e,t){t=t||a;const i="point-"+this._getNextID();this._entity.addPoint({id:i,dcolor:t.fillColor,doutlineColor:t.lineColor,position:e.coordinates,dpixelSize:8});return i}addPolyline(e,t){t=t||a;const i="polyline-"+this._getNextID();this._entity.addLine({id:i,position:e.coordinates,dfollowSurface:true,dclampToGround:true,dwidth:t.lineWidth?t.lineWidth:5,dmaterial:{materialName:"dPolylineOutlineMaterial",dcolor:t.fillColor||"rgba(255,255,0,1)",doutlineColor:t.lineColor||"rgba(255,255,0,1)",doutlineWidth:t.lineWidth}});return i}addPolygon(e,t){t=t||a;const i="polygon-"+this._getNextID();this._entity.Addpolygon({id:i,position:e.coordinates,doutline:true,dperPositionHeight:true,doutlineColor:t.lineColor||"rgba(255,255,0,1)",doutlineWidth:t.lineWidth,dmaterial:{materialName:"dGridMaterial",dcolor:t.fillColor||"rgba(255,255,0,1)",dcellAlpha:1,dlineThickness:[1,1]}});return i}addRect(e,t){t=t||a;const i="rect-"+this._getNextID();const s=e.min;const r=e.max;const n=[[s[0],s[1],0],[r[0],s[1],0],[r[0],r[1],0],[s[0],r[1],0],[s[0],s[1],0]];this._entity.Addpolygon({id:i,position:n,doutline:true,dperPositionHeight:true,doutlineColor:t.lineColor||"rgba(255,255,0,1)",doutlineWidth:t.lineWidth,dmaterial:{materialName:"dGridMaterial",dcolor:t.fillColor||"rgba(255,255,0,1)",dcellAlpha:.5,dlineThickness:[1,1]}});return i}addCircle(e,t){return o.abstract(e,t)}addDynamicCircle(e,t){const i="dyn-circle-"+this._getNextID();const s=this._entities.add({id:i,name:"扩散圆",position:Cesium.Cartesian3.fromDegrees(...e.center),ellipse:{semiMinorAxis:e.radius,semiMajorAxis:e.radius,material:new o.DynamicCircleMaterialProperty(t)}});return s.id}remove(e){this._entity.removeEntityById(e)}clear(){this._entity.removeAll()}draw(e,s,r,n){const t=()=>{};const i=e=>{let t={};if(e.type==="circle"){t.type=o.GeometryType.CIRCLE;t.center=e.center;t.radius=e.radius}else if(e.type==="rectangle"){t.type=o.GeometryType.RECTANGLE;t.coordinates=[[e.geometry[0],e.geometry[1],0],[e.geometry[2],e.geometry[3],0]]}else if(e.type==="point"||e.type==="polyline"||e.type==="polygon"){t.type=e.type;t.coordinates=e.geometry}const i=o.GeometryFactory.create(t);if(!o.Types.isDefined(i)){throw new Error("Bad Geometry.")}s.call(n,i);this.add(i,r);this._3dDrawTool.stopDrawing()};switch(e){case o.GeometryType.POINT:this._3dDrawTool.StartPointTool(t,i,{});break;case o.GeometryType.POLYLINE:this._3dDrawTool.StartLineTool(t,i,{});break;case o.GeometryType.POLYGON:this._3dDrawTool.StartPolygonTool(t,i,{});break;case o.GeometryType.RECTANGLE:this._3dDrawTool.StartRectTool(t,i,{});break;case o.GeometryType.CIRCLE:this._3dDrawTool.StartCircleTool(t,i,{});break}}stopDraw(){this._3dDrawTool.stopDrawing()}drawPoint(e,t,i){this.draw(o.GeometryType.POINT,e,t,i)}drawPolyline(e,t,i){this.draw(o.GeometryType.POLYLINE,e,t,i)}drawCircle(e,t,i){this.draw(o.GeometryType.CIRCLE,e,t,i)}drawRect(e,t,i){this.draw(o.GeometryType.RECTANGLE,e,t,i)}drawPolygon(e,t,i){this.draw(o.GeometryType.POLYGON,e,t,i)}}o.DrawTool3D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(u){const d={offset:[0,0,0],scale:[1,1,1],lineColor:"white",lineWidth:2,pointColor:"white",pointSize:10,textColor:"red",textFont:"16px sans-serif"};class e extends u.GridTool{constructor(e){super(e);this._grids=new Map;this._rid=0;this._fixedNum=[];this._view3d=e;this._entities=this._view3d.czviewer.entities}create(e){e=Object.assign({},d,e);const t=e.name||`AutoNamedGrid-${this._rid++}`;this.remove(t);this._dataBox=e.dataBox;if(!u.defined(this._dataBox)){this._dataBox=new u.BoundingBox;this._dataBox.setMin(e.min);this._dataBox.setMax(e.max)}this._dispBox=e.displayBox||this._dataBox;this._dmin=this._dataBox.getMin();this._dsiz=this._dataBox.getSize();this._pmin=this._dispBox.getMin();this._psiz=this._dispBox.getSize();const i=this._dataBox;const s=e.stepx?p(i.minx,i.maxx,e.stepx):f(i.minx,i.maxx);const r=e.stepy?p(i.miny,i.maxy,e.stepy):f(i.miny,i.maxy);const n=e.stepz?p(i.minz,i.maxz,e.stepz):f(i.minz,i.maxz);const o=m(i.minx,i.maxx,s);const a=m(i.miny,i.maxy,r);const l=m(i.minz,i.maxz,n);function h(e,t){if(u.defined(t))return t;let i=0;while(e<1){e*=10;i++}return i}this._fixedNum[0]=h(s,e.fixedNumX);this._fixedNum[1]=h(r,e.fixedNumY);this._fixedNum[2]=h(n,e.fixedNumZ);const c=[].concat(this._lineAxis(e,o,a,l,[0,1,2],[20,20]),this._lineAxis(e,a,o,l,[1,0,2],[-40,20]),this._lineAxis(e,l,o,a,[2,0,1],[-40,0]));this._grids.set(t,c);return t}remove(e){const t=this._grids.get(e);if(!t)return;const i=this._view3d.czviewer.entities;t.forEach(e=>i.remove(e))}clear(){const t=this._view3d.czviewer.entities;this._grids.forEach(e=>{e.forEach(e=>{t.remove(e)})})}_lineAxis(l,e,h,c,t,u){const d=[];const[m,p,f]=t;const _=this._dataBox.getMin(),y=[0,0,0];e.forEach(t=>{const e=h.map(e=>{y[m]=_[m]+t;y[p]=_[p]+e;y[f]=_[f];this._getRealValue(y,y);return Cesium.Cartesian3.fromDegrees(...y)});const i=c.map(e=>{y[m]=_[m]+t;y[p]=_[p];y[f]=_[f]+e;this._getRealValue(y,y);return Cesium.Cartesian3.fromDegrees(...y)});i.reverse();i.length=i.length-1;const s=i.concat(e);d.push(this._addPloyline(s,l));y[m]=_[m]+t;y[p]=_[p];y[f]=_[f];const r=this._getRealValue(y);const n=Cesium.Cartesian3.fromDegrees(...r);const o=y[m].toFixed(this._fixedNum[m]);const a=this._addSinglePointWithText(n,o,u,l);d.push(a)});return d}_addPloyline(e,t){return this._entities.add({polyline:{positions:e,material:Cesium.Color.fromCssColorString(t.lineColor),width:t.lineWidth,clampToGround:false}})}_addSinglePointWithText(e,t,i,s){return this._entities.add({position:e,point:{pixelSize:s.pointSize,color:Cesium.Color.fromCssColorString(s.pointColor)},label:{text:t,font:"16px sans-serif",pixelOffset:new Cesium.Cartesian2(i[0],i[1]),fillColor:Cesium.Color.fromCssColorString(s.textColor)}})}_getRealValue(t,i){i=i||[0,0,0];for(let e=0;e<3;++e){i[e]=(t[e]-this._dmin[e])/this._dsiz[e]*this._psiz[e]+this._pmin[e]}return i}}u.GridTool3D=e;function m(e,t,i){let s=[],r=t-e;for(let e=0;e<r/i;e++){s.push(i*e)}if(r%i!==0){s.push(r)}return s}function p(e,t,i){const s=Math.abs(t-e);while(s/i>10){i*=10}return i}function f(e,t){const i=t-e;if(i<=0)return 1;let s=i/5;let r=1;let n=0;if(s>10){while(s>10){r*=10;s/=10}n=Math.floor(s);return n*r}else if(s<1){while(s<1){r*=10;s*=10}n=Math.floor(s);return n/r}else{n=Math.floor(s);return n}}})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.InfoWindow{constructor(e,t){super(e,t);const i=this.view;this._postRenderHandle=i.czscene.postRender.addEventListener(this._onPostRender,this)}close(){if(!super.close())return false;if(this._postRenderHandle){this._postRenderHandle();this._postRenderHandle=undefined}return true}_onPostRender(e){try{const t=Cesium.Cartesian3.fromDegrees(...this.position);const i=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,t);if(i)this._updatePosition(i.x,i.y);else this._updatePosition(-1e4,-1e4)}catch(e){}}}e.InfoWindow3D=t})(CZMAP||(CZMAP={}));var CZMAP;(function(d){class p{constructor(){this.distance=0;this.zdiff=0;this.xydiff=0}inc(e){this.distance+=e.distance;this.zdiff+=e.zdiff;this.xydiff+=e.xydiff;return this}}d.DistanceResult=p;class u{static computeDistance(e,t,i){const s=Cesium.Cartographic.fromDegrees(...e);const r=Cesium.Cartographic.fromDegrees(...t);const n=new Cesium.EllipsoidGeodesic(s,r,i);const o=n.ellipsoid.maximumRadius*Cesium.Math.toRadians(1);let a=Math.round(n.surfaceDistance/o);if(a==0)a=1;const l=new p;l.xydiff=n.surfaceDistance;let h=Cesium.Cartographic.clone(s);let c=Cesium.Cartographic.toCartesian(s,n.ellipsoid);const u=new Cesium.Cartesian3;const d=new Cesium.Cartographic;for(let e=1;e<=a;++e){const m=e/a;n.interpolateUsingFraction(m,d);d.height=Cesium.Math.lerp(s.height,r.height,m);Cesium.Cartographic.toCartesian(d,n.ellipsoid,u);l.zdiff+=d.height-h.height;l.distance+=Cesium.Cartesian3.distance(u,c);d.clone(h);u.clone(c)}return l}static computeDistances(t){if(t.length<1)throw new Error("pts length must > 1");let i=t[0];const s=new p;for(let e=1;e<t.length;++e){s.inc(u.computeDistance(i,t[e]));i=t[e]}return s}static computeCenter(t){if(!t.length){throw new Error("not array or array length == 0")}const e=t[0];const i=new Cesium.Cartesian3;const s=new Cesium.Cartesian3(...e);const r=new Cesium.Cartesian3(...e);for(let e=1;e<t.length;++e){const[n,o,a]=t[e];Cesium.Cartesian3.fromElements(n,o,a,i);Cesium.Cartesian3.minimumByComponent(s,i,s);Cesium.Cartesian3.maximumByComponent(r,i,r)}Cesium.Cartesian3.midpoint(s,r,i);return[i.x,i.y,i.z]}static formatDistance(e){if(e>1e3){return(e/1e3).toFixed(2)+"千米"}else{return e.toFixed(2)+"米"}}static pickGlobe(e,t,i){const s=e.scene;const r=e.scene.globe;const n=s.camera;if(!Cesium.defined(r))return undefined;var o,a;if(s.pickPositionSupported){o=s.pickPosition(t,u.scratch_PickGlobe_DepthIntersection)}var l=n.getPickRay(t,u.scratch_PickGlobe_Ray);a=r.pick(l,s,u.scratch_PickGlobe_RayIntersection);var h=Cesium.defined(o)?Cesium.Cartesian3.distance(o,n.positionWC):Number.POSITIVE_INFINITY;var c=Cesium.defined(a)?Cesium.Cartesian3.distance(a,n.positionWC):Number.POSITIVE_INFINITY;if(h<c){return Cesium.Cartesian3.clone(o,i)}return Cesium.Cartesian3.clone(a,i)}}u.scratch_PickGlobe_Ray=new Cesium.Ray;u.scratch_PickGlobe_DepthIntersection=new Cesium.Cartesian3;u.scratch_PickGlobe_RayIntersection=new Cesium.Cartesian3;d.DistUtils=u;class t{constructor(e,t){this.lines=[];this.points=[];this.polygons=[];this.polylines=[];this.labels=[];this.lineLabels=[];this.map3DView=e;this.viewer=e.cesium.viewer;this.drawOpt=t||{};this.map3DTool=new ZMap3DLib.Input3DTool(e);this.map3DTool.PickPositonM=function(e){const t=this._map.cesium.viewer;return u.pickGlobe(t,e,undefined)};this.animationEnd=function(t){const i={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd",MSAnimationEnd:"MSAnimationEnd"};for(let e in i){if(t.style[e]!==undefined){return i[e]}}}(document.createElement("div"));this.transitionEnd=function(t){const i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(let e in i){if(t.style[e]!==undefined){return i[e]}}}(document.createElement("div"))}cleanAll(){return this._cleanType(["points","polygons","labels","lines","polylines","lineLabels"])}_cleanType(e){if(Array.isArray(e)){e.forEach(function(e){this[e].forEach(function(e){this.viewer.entities.remove(e)},this)},this)}else{this[e].forEach(function(e){this.viewer.entities.remove(e)},this)}return this}_calcLabelPosition(e,t){if(!t.labelOffset)return e;const[i,s,r]=e;const[n,o,a]=t.labelOffset;return[i+n,s+o,r+a]}_createLabel(e,t,i){var s,r,n,o,a,l;if(i.label===false)return;const h={text:e,fillColor:d.CesiumAttrib.getColor((s=i.labelStyle)===null||s===void 0?void 0:s.fillColor,new Cesium.Color(0,255,0)),pixelOffset:d.CesiumAttrib.getCartesian2((r=i.labelStyle)===null||r===void 0?void 0:r.pixelOffset,new Cesium.Cartesian2(0,-20)),verticalOrigin:d.CesiumAttrib.getVertical((n=i.labelStyle)===null||n===void 0?void 0:n.verticalOrigin,Cesium.VerticalOrigin.BOTTOM),font:d.defaultValue((o=i.labelStyle)===null||o===void 0?void 0:o.font,"1.2vw arial"),outlineWidth:d.defaultValue((a=i.labelStyle)===null||a===void 0?void 0:a.outlineWidth,0),outlineColor:d.CesiumAttrib.getColor((l=i.labelStyle)===null||l===void 0?void 0:l.outlineColor,Cesium.Color.BLACK)};if(h.outlineWidth){h.style=Cesium.LabelStyle.FILL_AND_OUTLINE}const c=this._calcLabelPosition(t,i);const u=this.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(...c),label:h});this.lineLabels.push(u)}measuringDistance(h){h=h||{};this.end();const e=e=>{var t,i;const s=e.geometry;if(!s)return;this.msg("结束画线",1e3);const r=this.viewer.entities.add({polyline:{show:true,positions:s.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2])),material:new Cesium.PolylineGlowMaterialProperty({glowPower:.1,color:d.CesiumAttrib.getColor((t=h.lineStyle)===null||t===void 0?void 0:t.lineColor,Cesium.Color.YELLOW)}),width:d.defaultValue((i=h.lineStyle)===null||i===void 0?void 0:i.lineWidth,10)}});this.lines.push(r);const n=u.computeDistances(s);const o=u.computeCenter(s);const a=u.formatDistance;const l=`距离：${a(n.distance)}\n水平距离：${a(n.xydiff)}\n垂直距离：${a(n.zdiff)}`;this._createLabel(l,o,h);if(h.icons){this._createIcon(s[0],h.icons.start);this._createIcon(s[s.length-1],h.icons.end)}if(typeof h.callback==="function"){h.callback(new c(s,n))}};this.msg("左键单击开始画线，再次单击结束画线");this.map3DTool._returnZ=true;if(h.multi)this.map3DTool.StartLineTool(()=>{},e,{});else this.map3DTool.StartSingleLineTool(()=>{},e,undefined,this.drawOpt)}_createIcon(e,t){if(!t)return;if(!t.img)return;const i=this.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(...e),billboard:{image:t.img,pixelOffset:t.offset?new Cesium.Cartesian2(...t.offset):undefined,verticalOrigin:Cesium.VerticalOrigin.BOTTOM}});this.lineLabels.push(i)}drawPolyline(i){this.end();const e=e=>{const t=e.geometry;if(t){this.msg("画线完毕");if(typeof i==="function")i.call(this,t)}};this.msg("左键单击开始画线，右键结束画线");this.map3DTool._returnZ=true;this.map3DTool.StartLineTool(()=>{},e)}end(){this.map3DTool.ClearAll()}drawFlat(e,t){var i,s,r;const n=e.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]+1));this.polygons.push(this.viewer.entities.add({id:Date.now()+""+this.randomNum(),polygon:{hierarchy:new Cesium.PolygonHierarchy(n),outline:true,perPositionHeight:true,outlineColor:d.CesiumAttrib.getColor((i=t.areaStyle)===null||i===void 0?void 0:i.outlineColor,Cesium.Color.YELLOW),outlineWidth:(s=t.areaStyle)===null||s===void 0?void 0:s.outlineWidth,material:new Cesium.GridMaterialProperty({color:d.CesiumAttrib.getColor(d.defaultValue((r=t.areaStyle)===null||r===void 0?void 0:r.fillColor,"rgba(255,255,0,0.3)")),cellAlpha:.5})}}))}areaMeasuring(o){o=o||{};this.drawPolyline(e=>{this.drawFlat(e,o);const t=e.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]+1));const i=u.computeCenter(e);const s=ZMap3DLib.Math;const r=s.CalcAnyPolyArea(t,this.map3DView);let n="";if(r>=1e4){n="总面积:"+(r/1e6).toFixed(2)+"平方公里"}else{n="总面积:"+r.toFixed(2)+"平方米"}this._createLabel(n,i,o);a(o.callback,this,new d.AreaCallbackParam(e,i,r))})}msg(e,t){const i=$(`<div class="zmap-msg-panel-wapper"><div class="zmap-msg-panel">${e}</div></div>`);$("body").append(i);setTimeout(()=>{i.addClass("zmap-msg-panel-hide");i.on(this.transitionEnd,()=>{i.remove()})},t||1500)}randomNum(){return Math.floor(Math.random()*(999-100+1))+100}}class c extends d.DistanceCallbackParam{constructor(e,t){super(e,t.distance);this.zdiff=t.zdiff;this.xydiff=t.xydiff}}d.Distance3DCallbackParam=c;class e extends d.MeasureTool{constructor(e){super(e);this.tool=new t(e.zmap3d)}distance(e){this.tool.measuringDistance(e)}arae(e){this.tool.areaMeasuring(e)}clear(){this.tool.cleanAll()}}d.MeasureTool3D=e;function a(e,t,...i){if(typeof e!=="function")return;e.apply(this,i)}})(CZMAP||(CZMAP={}));var CZMAP;(function(e){function n(i,s,r){s=Array.isArray(s)?s:[s];for(let t=0;t<i.length;++t){let e=i.get(t);if(e instanceof Cesium.PrimitiveCollection){n(e,s,r)}else{if(s.indexOf(e.id)!=-1)r(e)}}}e.forEachModelPrimitive=n})(CZMAP||(CZMAP={}));var CZMAP;(function(w){class t extends w.PathNode{constructor(e){super(e);this.position3D=Cesium.Cartesian3.fromDegrees(...this.position)}}const e=new Cesium.Matrix4;const T=new Cesium.HeadingPitchRoll;const i=Cesium.Cartesian3.fromElements(1,1,1);class s extends w.PathRoam{constructor(e){super(e);this._begin_seconds=0;this._end_seconds=0;this._total_seconds=0;this._current_seconds=0;this._current_position=[0,0,0];this._last_time=0;this._temp_pos=new Cesium.Cartesian3;this._temp_dir=new Cesium.Cartesian3;this._temp_tar=new Cesium.Cartesian3;this._temp_vec=new Cesium.Cartesian3;this._temp_mat=new Cesium.Matrix3;this._temp_ori=new Cesium.Quaternion;this._temp_ori2=new Cesium.Quaternion;this._temp_pos_c=new Cesium.Cartographic;this._temp_tar_c=new Cesium.Cartographic;this._temp_offset=new Cesium.Cartesian3;this._temp_matrix3=new Cesium.Matrix3;this._temp_matrix4=new Cesium.Matrix4;this._temp_inv_matrix4=new Cesium.Matrix4;this._sphere=new Cesium.BoundingSphere;this._line=undefined;this._isFirstFollow=true;this._lastFollowOffset=new Cesium.Cartesian3;this._lastMode=0;this.view3d=e}open(e,t){t=t||{};this.close();this._nodes=this.buildRoamPath(e,t.speed);this._eye_offset=t.offset;this.buildPath();this.buildSampled();this.createModel(t);this.createLine();this._play=false;this._dir=1;this._speed=1;this._last_time=0;this._current_seconds=0;this._isFirstFollow=true;this.view3d.czviewer.scene.postRender.addEventListener(this._tick,this);if(t.jumpToPath!==false)this.view3d.czviewer.camera.viewBoundingSphere(this._sphere)}close(){this.view3d.czviewer.scene.postRender.removeEventListener(this._tick,this);this.view3d.cegore.camera.clearLookAt();if(this._entity)this.view3d.czviewer.entities.remove(this._entity);this.view3d.czviewer.entities.remove(this._line);this._czcamera.lookAtTransform(Cesium.Matrix4.IDENTITY)}get totalTime(){return this._total_seconds}get currentTime(){return this._current_seconds}set currentTime(e){this._current_seconds=e;this._update()}get currentSegment(){const t=this._current_seconds;const i=this._nodes;for(let e=0;e<i.length;++e){const s=i[e];if(t<s.time)return e-1}return i.length}get currentPosition(){return this._current_position}_tick(){const e=new Date;const t=e.getTime();if(this._last_time==0){this._last_time=t;return}const i=(t-this._last_time)/1e3;this._last_time=t;if(!this._play)return;this._current_seconds+=i*this._speed*this._dir;const s=this._dir>0?this._begin_seconds:this._end_seconds;const r=this._dir>0?this._end_seconds:this._begin_seconds;let n=false;if(this._current_seconds<this._begin_seconds||this._current_seconds>=this._end_seconds){this._current_seconds=r;if(this._loop!==w.PathRoamLoopType.NONE){n=false;if(this._loop===w.PathRoamLoopType.RETURN)this._dir=-this._dir;else if(this._loop===w.PathRoamLoopType.RETURN_TO_START)this._current_seconds=s}else{n=true}}this._update();if(n)this.pause()}_update(){const e=new Cesium.JulianDate(0,this._current_seconds);const t=this._sample_pos.getValue(e,this._temp_pos);const i=this._sample_dir.getValue(e,this._temp_dir);const s=this._sample_ori.getValue(e,this._temp_vec);const r=Cesium.Cartographic.fromCartesian(t,undefined,this._temp_pos_c);const n=this._current_position;n[0]=Cesium.Math.toDegrees(r.longitude);n[1]=Cesium.Math.toDegrees(r.latitude);n[2]=r.height;let o;(function(e){e[e["FIRST_PERSON"]=0]="FIRST_PERSON";e[e["THIRD_LOCK"]=1]="THIRD_LOCK";e[e["THIRD_FREE"]=2]="THIRD_FREE";e[e["PATH_TRACK"]=3]="PATH_TRACK"})(o||(o={}));const a=this._lastMode;this._lastMode=this._follow?this._first?o.FIRST_PERSON:this._lock?o.THIRD_LOCK:o.THIRD_FREE:o.PATH_TRACK;if(i&&s){if(this._modelForward&&this._dir==-1)Cesium.Cartesian3.negate(s,s);Cesium.Transforms.rotationMatrixFromPositionVelocity(t,s,undefined,this._temp_mat);const l=Cesium.Quaternion.fromRotationMatrix(this._temp_mat,this._temp_ori);const h=Cesium.Cartesian3.multiplyByScalar(i,100,this._temp_tar);Cesium.Cartesian3.add(t,h,h);const c=Cesium.Cartographic.fromCartesian(h,undefined,this._temp_tar_c);const u=this.view3d.czviewer.camera;const d=this.view3d.cegore.camera;if(this._follow){if(this._first){d.lookAtFromTo(r,c)}else{const m=Cesium.Transforms.eastNorthUpToFixedFrame(t,Cesium.Ellipsoid.WGS84,this._temp_matrix4);if(w.Types.isDefined(this._eye_offset)){this._temp_offset.x=this._eye_offset[0];this._temp_offset.y=this._eye_offset[1];this._temp_offset.z=this._eye_offset[2]}else{this._temp_offset.x=-this._sphere.radius;this._temp_offset.y=0;this._temp_offset.z=this._sphere.radius}let e;if(this._lock){const p=Cesium.Matrix3.fromQuaternion(l,this._temp_matrix3);Cesium.Matrix3.multiplyByVector(p,this._temp_offset,this._temp_offset);Cesium.Cartesian3.add(this._temp_offset,t,this._temp_offset);const f=Cesium.Matrix4.inverse(m,this._temp_inv_matrix4);e=Cesium.Matrix4.multiplyByPoint(f,this._temp_offset,this._temp_offset)}else{if(this._isFirstFollow){this._isFirstFollow=false;Cesium.Cartesian3.clone(this._temp_offset,this._lastFollowOffset);e=this._lastFollowOffset}else{if(a==o.THIRD_FREE)e=Cesium.Cartesian3.clone(u.position,this._lastFollowOffset);else e=this._lastFollowOffset}}u.lookAtTransform(m,e)}}if(this._entity){if(this._entityRotate){const[_,y,C]=this._entityRotate;const g=Cesium.HeadingPitchRoll.fromDegrees(_,y,C,T);const v=Cesium.Quaternion.fromHeadingPitchRoll(g,this._temp_ori2);Cesium.Quaternion.multiply(l,v,l)}this._entity.position=t;this._entity.orientation=l}}this.dispatchEvent(w.PathRoamEvents.MOVE)}get _czcamera(){return this.view3d.czviewer.camera}set follow(e){this._follow=e;if(e)this._czcamera.viewBoundingSphere(this._sphere);else this._czcamera.lookAtTransform(Cesium.Matrix4.IDENTITY)}get follow(){return this._follow}set showline(e){this._showLine=e;this._line.show=e}get showline(){return this._showLine}set lineWidth(e){this._lineWidth=e;this._line.polyline.width=e}get lineWidth(){return this._lineWidth}set lineColor(e){this._lineColor=e;this._line.polyline.material.color=w.CesiumAttrib.getColor(e)}get lineColor(){return this._lineColor}get offset(){return this._eye_offset}set offset(e){this._eye_offset=e}buildPath(){this._begin_seconds=Infinity;this._end_seconds=-Infinity;this._nodes.forEach(e=>{this._begin_seconds=Math.min(this._begin_seconds,e.time);this._end_seconds=Math.max(this._end_seconds,e.time)});this._total_seconds=this._end_seconds-this._begin_seconds}buildSampled(){this._begin_seconds=Infinity;this._end_seconds=-Infinity;this._nodes.forEach(e=>{this._begin_seconds=Math.min(this._begin_seconds,e.time);this._end_seconds=Math.max(this._end_seconds,e.time)});this._total_seconds=this._end_seconds-this._begin_seconds;const t=this._nodes;const i=t.length;this._sample_pos=new Cesium.SampledPositionProperty;this._sample_dir=new Cesium.SampledPositionProperty;let s;const r=new Cesium.Cartesian3;for(var n=0;n<i;n++){const o=t[n];const a=o.time-this._begin_seconds;let e;if(w.Types.isDefined(o.target)){const h=Cesium.Cartesian3.fromDegrees(...o.target);Cesium.Cartesian3.subtract(h,o.position3D,r);e=Cesium.Cartesian3.normalize(r,new Cesium.Cartesian3)}else{if(n!==i-1){const o=t[n],c=t[n+1];Cesium.Cartesian3.subtract(c.position3D,o.position3D,r);e=Cesium.Cartesian3.normalize(r,new Cesium.Cartesian3)}else{e=s.clone()}}const l=new Cesium.JulianDate(0,a);this._sample_pos.addSample(l,o.position3D);this._sample_dir.addSample(l,e);s=e}this._sample_ori=new Cesium.VelocityVectorProperty(this._sample_pos);this._sample_pos.setInterpolationOptions({interpolationDegree:1,interpolationAlgorithm:Cesium.LinearApproximation})}createModel(e){if(!w.Types.isDefined(e.icon)&&!w.Types.isDefined(e.model))return;this._entity=new Cesium.Entity;this.view3d.czviewer.entities.add(this._entity);if(w.Types.isDefined(e.icon)){this._entity.billboard=new Cesium.BillboardGraphics({image:e.icon.url,pixelOffset:w.CesiumAttrib.getCartesian2(e.icon["offset"]),rotation:w.CesiumAttrib.getRadian(e.icon["rotation"],0),width:w.CesiumAttrib.getNumber(e.icon["width"]),height:w.CesiumAttrib.getNumber(e.icon["height"])})}if(w.Types.isDefined(e.model)){this._entityRotate=e.model.rotate;this._entity.model=new Cesium.ModelGraphics({uri:e.model.url||e.model.uri,scale:w.CesiumAttrib.getNumber(e.model["scale"],1)})}if(w.Types.isDefined(e.label)){this._entity.label=new Cesium.LabelGraphics({text:e.label.text,scale:w.CesiumAttrib.getNumber(e.label["scale"],.5),font:w.Types.defaultValue(e.label["font"],"32px 黑体"),style:Cesium.LabelStyle.FILL,pixelOffset:w.CesiumAttrib.getCartesian2(e.label["offset"]),fillColor:w.CesiumAttrib.getColor(e.label["color"],Cesium.Color.WHITE),outlineColor:Cesium.Color.BLACK,outlineWidth:0,showBackground:true,backgroundColor:w.CesiumAttrib.getColor(e.label["backgroundColor"],Cesium.Color.DARKGREY)})}}createLine(){const e=this._nodes.map(e=>e.position3D);this._sphere=Cesium.BoundingSphere.fromPoints(e,this._sphere);this._line=this.view3d.czviewer.entities.add({show:this._showLine,polyline:{positions:e,width:this._lineWidth,material:new Cesium.PolylineOutlineMaterialProperty({color:w.CesiumAttrib.getColor(this._lineColor),outlineWidth:1,outlineColor:w.CesiumAttrib.getColor(this._lineColor)})}})}_createPathNode(e){return new t(e)}_calcDistance(e,t){return Cesium.Cartesian3.distance(e.position3D,t.position3D)}}w.PathRoam3D=s})(CZMAP||(CZMAP={}));var CZMAP;(function(l){const n=512;const o=512;class h{constructor(e,t,i){this.dir=e;this.color=t;this.tex=i}get getTex(){return()=>{return this.tex}}}class e extends l.TunnelEffct{constructor(e){super(e);this.model_key_field=undefined;this.data_key_field=undefined;this.loopHandle=undefined;this.view3d=e;this.scene=e.czviewer.scene;this.image=new Image;this.image.onload=()=>{t(this,0)};this.uniforms=[];this.texs={};this.model_key_field=undefined;this.data_key_field=undefined}init(s){this.close();if(!l.Types.isDefined(s.data))throw"no params param!";if(!l.Types.isDefined(s.model))throw"no model param!";if(!l.Types.isDefined(s.datakeyfield))throw"no keyfield param!";if(!l.Types.isDefined(s.modelkeyfield))throw"no keyfield param!";this.model_key_field=s.modelkeyfield;this.data_key_field=s.datakeyfield;var e=l.Types.defaultValue(s.image,"images/arrow.png");this.image.src=e;this.canvas=i();this.ctx=this.canvas.getContext("2d");if(s.model instanceof l.ModelLayer){this.models=s.model.models.slice(0)}else if(Array.isArray(s.model)){this.models=s.model}else{this.models=[s.model]}this.texs={};this.params={};for(let e=0,t=s.data.length;e<t;++e){const r=s.data[e];const n=u(s,r);const o=d(s,r);const a=r[s.datakeyfield];if(o!=l.TunnelDir.FORWARD&&o!=l.TunnelDir.BACKWARD||!l.Types.isDefined(n))continue;let t=o+"-"+n;let i=this.texs[t];if(!i){let e=c(this.scene._context);i=new h(o,n,e);this.texs[t]=i}this.params[a]=i}if(this.visible)this.show();if(this.animation)this.start()}close(){this.stop();this.hide();for(let e in this.texs){const t=this.texs[e];t.tex.destroy()}this.texs=undefined;this.params=undefined}show(){if(this.uniforms.length>0)return;this.models.forEach(e=>{if(!e.gltf)return;let r=e._nodeCommands;let t=e.gltf.meshes;for(let s=0;s<r.length;++s){let e=r[s].command;this.uniforms.push([e._uniformMap,e._uniformMap.u_baseColorTexture]);let i=t[e.owner.mesh.id];if(l.Types.isDefined(i.extras)&&l.Types.isDefined(i.extras.attribute)){let e=i.extras.attribute[this.model_key_field];if(!l.Types.isDefined(e))continue;let t=this.params[e];if(!l.Types.isDefined(t))continue;r[s].command._uniformMap.u_baseColorTexture=t.getTex}}})}hide(){if(this.uniforms.length==0)return;var e=this.uniforms;for(var t=0;t<e.length;++t){var i=e[t];i[0].u_baseColorTexture=i[1]}e.length=0}start(){if(this.loopHandle)return;var e=this;this.loopHandle=setInterval(()=>{t(e,100)},50)}stop(){if(!this.loopHandle)return;clearInterval(this.loopHandle);this.loopHandle=0}_onVisibleChanged(){if(this.visible)this.show();else this.hide()}_onAnimationChanged(){if(this.animation)this.start();else this.stop()}}l.TunnelEffct3D=e;function t(t,e){var i=t.pos=(t.pos+e)%n;for(let e in t.texs){s(t,i,t.texs[e])}}function s(e,t,i){var s=e.image;var r=e.ctx;if(i.dir==1){r.clearRect(0,0,n,o);r.fillStyle=i.color;r.fillRect(0,0,n,o);r.drawImage(s,t-n,0,n,o);r.drawImage(s,t,0,n,o);i.tex.copyFrom(e.canvas)}else{r.clearRect(0,0,n,o);r.fillStyle=i.color;r.fillRect(0,0,n,o);r.translate(n/2,0);r.scale(-1,1);r.translate(-n/2,0);r.drawImage(s,t+n,0,-n,o);r.drawImage(s,t,0,-n,o);r.setTransform(1,0,0,1,0,0);i.tex.copyFrom(e.canvas)}}function i(){const e=document.createElement("CANVAS");e.width=n;e.height=o;return e}function c(e){return new Cesium.Texture({context:e,width:n,height:o,preMultiplyAlpha:false,flipY:false,sampler:new Cesium.Sampler({wrapS:Cesium.TextureWrap.REPEAT,wrapT:Cesium.TextureWrap.REPEAT})})}function u(e,t){let i;if(l.Types.isString(e.colorfield)){i=t[e.colorfield]}if(l.Types.isDefined(i)&&l.Types.isObject(e.colormap)){i=e.colormap[i]}if(l.Types.isDefined(i))return i;if(l.Types.isDefined(e.color))return e.color;return undefined}function d(e,t){let i;if(l.Types.isString(e.dirfield)){i=t[e.dirfield]}if(l.Types.isDefined(i)&&l.Types.isObject(e.dirmap)){i=e.dirmap[i]}if(l.Types.isDefined(i))return i;return l.TunnelDir.NONE}})(CZMAP||(CZMAP={}));var CZMAP;(function(u){class e extends u.TunnelTransparent{constructor(e){super(e);this.view3d=e;this.models=undefined;this.scene=this.map.view3d.czviewer.scene}init(e){if(!u.Types.isDefined(e.model))throw"no model param!";if(e.model instanceof u.ModelLayer){this.models=e.model.models.slice(0)}else if(Array.isArray(e.model)){this.models=e.model}else{this.models=[e.model]}this._commands=[];this.models.forEach(t=>{if(!t.gltf)return;const i=t._runtime.nodes;for(let e in i){const s=i[e];const r=s.publicNode.id;const n=t.gltf.nodes[r].mesh;const o=t.gltf.meshes[n];if(!u.Types.isDefined(o.extras))continue;const a=o.extras["surface-side"];if(!u.Types.isDefined(a))continue;const l=s.commands;for(let e=0;e<l.length;++e){const h=a[e];if(!u.Types.isDefined(h))continue;if(h==1)this._commands.push(l[e])}}});this._handleEnable()}checkExist(e){if(!u.Types.isDefined(e.model))throw"no model param!";if(e.model instanceof u.ModelLayer){this.models=e.model.models.slice(0)}else if(Array.isArray(e.model)){this.models=e.model}else{this.models=[e.model]}let c=[];this.models.forEach(t=>{if(!t.gltf)return;const i=t._runtime.nodes;for(let e in i){const s=i[e];const r=s.publicNode.id;const n=t.gltf.nodes[r].mesh;const o=t.gltf.meshes[n];if(!u.Types.isDefined(o.extras))continue;const a=o.extras["surface-side"];if(!u.Types.isDefined(a))continue;const l=s.commands;for(let e=0;e<l.length;++e){const h=a[e];if(!u.Types.isDefined(h))continue;if(h==1)c.push(l[e])}}});return c.length>0}close(){this.enable=false;this._commands.length=0}_handleEnable(){const t=this.enable;this._commands.forEach(e=>{e.show=t})}}u.TunnelTransparent3D=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.InfoWindow{constructor(e,t){super(e,t);this._id=-1;const i=e;this._uvapi=i.uvapi;this._id=this._uvapi.addOverlay(this.position,(e,t)=>{this._updatePosition(e,t)})}close(){if(!super.close())return false;if(!this._id)return true;this._uvapi.removeOverlay(this._id);this._id=undefined;return true}_onPositionChange(){this._uvapi.updateOverlay(this._id,this.position)}}e.InfoWindowUE=t})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class t extends i.PathNode{constructor(e){super(e);this.position3D=Cesium.Cartesian3.fromDegrees(...this.position)}}class e extends i.PathRoam{constructor(e){super(e);const t=e;this._uvroam=new i.UELayerProxy(t);this.on(i.PathRoamEvents.SPEED,()=>this._execute({speed:this.speed}));this.on(i.PathRoamEvents.LOOP,()=>this._execute({loop:this.loop}));this.on(i.PathRoamEvents.FOLLOW,()=>this._execute({follow:this.follow}));this.on(i.PathRoamEvents.FIRST_VIEW,()=>this._execute({firstview:this.firstview}));this.on(i.PathRoamEvents.LOCK_VIEW,()=>this._execute({lockview:this.lockview}));this.on(i.PathRoamEvents.CURRENT_TIME,()=>this._execute({currentTime:this.currentTime}))}open(e,t){this._nodes=this.buildRoamPath(e,t.speed);this._uvroam.createLayer("pathroam",{path:this._nodes,option:t})}close(){this._uvroam.removeLayer()}start(){super.start();this._uvroam.executeLayer({start:1})}pause(){super.start();this._uvroam.executeLayer({pause:1})}resume(){super.start();this._uvroam.executeLayer({resume:1})}forward(){super.start();this._uvroam.executeLayer({forward:1})}backward(){super.start();this._uvroam.executeLayer({backward:1})}get totalTime(){return 10}get currentTime(){return 0}set currentTime(e){this._uvroam.executeLayer({currentTime:e})}get currentPosition(){return undefined}set offset(e){}_execute(e){this._uvroam.executeLayer(e)}_createPathNode(e){return new t(e)}_calcDistance(e,t){return Cesium.Cartesian3.distance(e.position3D,t.position3D)}}i.PathRoamUE=e})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{static equals(t,i){if(Object.is(t,i))return true;if(!e.Types.isArray(t))return false;if(!e.Types.isArray(i))return false;const s=t.length;if(s!==i.length)return false;for(let e=0;e<s;++e){if(!Object.is(t[e],i[e]))return false}return true}static removeItem(e,t){const i=e.indexOf(t);if(i==-1)return;e.splice(i,1)}}e.ArrayUtils=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let t;(function(e){e[e["AXIS_X"]=0]="AXIS_X";e[e["AXIS_Y"]=1]="AXIS_Y";e[e["AXIS_Z"]=2]="AXIS_Z"})(t=e.Axis||(e.Axis={}));(function(t){function e(e){switch(e){case 0:case"x":case"X":return t.AXIS_X;case 1:case"y":case"Y":return t.AXIS_Y;case 2:case"z":case"Z":return t.AXIS_Z}}t.parser=e})(t=e.Axis||(e.Axis={}))})(CZMAP||(CZMAP={}));const EntityClusterUpdate=Cesium.EntityCluster.prototype.update;Cesium.EntityCluster.prototype.update=function(e){function t(t){if(!Cesium.defined(t))return false;const i=t.length;for(let e=0;e<i;++e){const s=t.get(e);if(s.text.length>0&&s._glyphs.length===0){return true}}return false}var i=[];if(t(this._labelCollection)){i=e.commandList;e.commandList=[];this._labelCollection.update(e);e.commandList=i}const s=this;EntityClusterUpdate.call(s,e);const r=s._labelCollection;if(!r)return;const n=r.length;for(let e=0;e<n;++e){const o=r.get(e);const a=o.clusterShow;o.clusterShow=!a;o.clusterShow=a}};var CZMAP;(function(d){class e{constructor(e,t){this._maxStarBurst=30;this._numFontSize=15;this._numColor="white";this._numBkColor="red";this._sbs=new i;this._view3d=e;this._datasource=t;this._czviewer=e.czviewer;this._setupCluster3D(t,e.czviewer)}set maxStarBurst(e){this._maxStarBurst=e}get maxStarBurst(){return this._maxStarBurst}set numFontSize(e){this._numFontSize=e}get numFontSize(){return this._numFontSize}set numColor(e){this._numColor=e}get numColor(){return this._numColor}set numBkColor(e){this._numBkColor=e}get numBkColor(){return this._numBkColor}_setupCluster3D(e,i){e.clustering.clusterEvent.addEventListener((e,t)=>{this._cesiumEntityClusterCustom(e,t,i)});this._handler=new Cesium.ScreenSpaceEventHandler(i.scene.canvas);this._handler.setInputAction(e=>this._onLeftClick(e),Cesium.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(e=>this._onMouseMove(e),Cesium.ScreenSpaceEventType.MOUSE_MOVE);this._handler.setInputAction(e=>this._onMouseWheel(e),Cesium.ScreenSpaceEventType.WHEEL);const t=i.camera;t.moveStart.addEventListener(this._onMoveStart,this)}_onMoveStart(){_(this._czviewer,this._sbs)}_onMouseWheel(e){_(this._czviewer,this._sbs)}_onMouseMove(e){t(this._czviewer,this._sbs,e.endPosition)}_onLeftClick(e){const t=this._czviewer.scene.pick(e.position);const i=t===null||t===void 0?void 0:t.id;if(!Array.isArray(i))return;if(!(t.primitive instanceof Cesium.Billboard))return;const s=i.length;if(s>this._maxStarBurst)return;r(this._czviewer,t.primitive,i,this._sbs)}async _cesiumEntityClusterCustom(t,e,i){e.label.show=false;let s;const r=t.length;for(let e=0;e<r;++e){const l=t[e];if(!l.billboard)continue;const h=l.billboard.image;if(h.isConstant){s=l.billboard;break}}const n=i.clock.currentTime;const o=s.image.getValue(undefined);const a=await d.clusterIconCreater.requestIcon({url:o,num:t.length,numColor:this._numColor,numBkColro:this._numBkColor,numFontSize:this._numFontSize});e.billboard.show=true;try{const c=e.billboard;const u=s;c.id=e.label.id;c.image=a;y(c,u,"scale",n);y(c,u,"color",n);y(c,u,"rotation",n);y(c,u,"width",n);y(c,u,"height",n);y(c,u,"sizeInMeters",n);y(c,u,"horizontalOrigin",n);y(c,u,"verticalOrigin",n)}catch(e){}}}d.Cluster3D=e;function m(t,i){const s=i.length;for(let e=0;e<s;++e){const r=i.get(e);if(r instanceof Cesium.PrimitiveCollection){const n=m(t,r);if(n)return n;continue}if(r instanceof Cesium.EntityCluster){const o=r._billboardCollection;if(!o)continue;const a=o.length;for(let e=0;e<a;++e){const l=o.get(e);if(l.id===t)return l}continue}}}class i{constructor(){this.items=[];this.pixelPadding=10}}function C(e,t,i,s,r,n){if(d.compVersion(Cesium.VERSION,"1.63")>=0){return e.frustum.getPixelDimensions(t,i,s,r,n)}else{const o=e.frustum;return o.getPixelDimensions(t,i,s,n)}}function p(e,t,i,s,r){const n=e.camera;const o=t.entity;const a=r*Math.cos(s);const l=r*Math.sin(s);const h=e.drawingBufferWidth;const c=e.drawingBufferHeight;const u=e.pixelRatio;const d=Cesium.Cartesian3.subtract(i,n.positionWC,new Cesium.Cartesian3);const m=Cesium.Cartesian3.dot(n.directionWC,d);const p=new Cesium.Cartesian2(a,l);const f=C(n,h,c,m,u,new Cesium.Cartesian2);Cesium.Cartesian2.multiplyByScalar(p,Cesium.Cartesian2.maximumComponent(f),p);const _=new Cesium.Cartesian3(p.x,p.y,0);o.billboard.eyeOffset=_;if(Cesium.defined(o.label)){o.label.eyeOffset=new Cesium.Cartesian3(p.x,p.y,-10);o.label.show=false}const y=Cesium.Matrix4.multiplyByPoint(n.viewMatrix,i,new Cesium.Cartesian3);Cesium.Cartesian3.add(_,y,y);Cesium.Matrix4.multiplyByPoint(n.inverseViewMatrix,y,y);t.endPoint=y}function f(s,t){let i=false;let r=0;const n=[];let o=t+t*.25;const a=o;let l=0;while(l<s){let e=t/o;const h=Math.floor(Math.PI/e)+1;const c=s-l;const u=Math.min(h,c);n.push({count:u,maxCount:h,angleInc:e,radius:o});r+=h;if(u<h/2)i=true;o+=a;l+=u}if(i&&n.length>1){let i=0;n.forEach(e=>{const t=e.maxCount/r*s+i;e.count=Math.round(t)-Math.round(i);i=t+1})}return{circles:n,maxRadius:o}}function r(s,r,e,n){if(n.cluster!==r){_(s,n)}const o=s.scene;const a=[];e.forEach(e=>{if(e.billboard){const t=m(e,o.primitives);if(t){const i=new Cesium.Entity(e);i.position=r.position;i._czmap_obj=e._czmap_obj;s.entities.add(i);a.push({entity:i,billboard:t})}}});if(a.length===0){return}const l=n.items;n.maxDimension=Number.NEGATIVE_INFINITY;n.cluster=r;r.show=false;const h=Cesium.Cartesian3.clone(r.position);let c=Number.NEGATIVE_INFINITY;a.forEach(e=>{const{width:t,height:i,scale:s}=e.billboard;const r=Math.max(t,i)*s+n.pixelPadding;c=Math.max(c,r)});const t=f(a.length,c);let u=0;t.circles.forEach(t=>{const e=(t.count-1)*t.angleInc;let i=(Math.PI-e)/2;for(let e=0;e<t.count;++e){const s=a[u+e];if(!s)continue;const r={entity:s.entity,billboard:s.billboard,endPoint:new Cesium.Cartesian3};p(o,r,h,i,t.radius);l.push(r);i+=t.angleInc}u+=t.count});const i=[];l.forEach(e=>{i.push(new Cesium.GeometryInstance({geometry:new Cesium.SimplePolylineGeometry({positions:[h,e.endPoint],arcType:Cesium.ArcType.NONE,granularity:Cesium.Math.PI_OVER_FOUR}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.WHITE)}}))});n.maxDimension=c;n.lines=o.primitives.add(new Cesium.Primitive({geometryInstances:i,appearance:new Cesium.PerInstanceColorAppearance({flat:true,translucent:false}),asynchronous:false}));n.radius=t.maxRadius}function t(e,t,i){if(!Cesium.defined(t.cluster)){return}const s=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e.scene,t.cluster.position);const r=Cesium.Cartesian2.subtract(i,s,new Cesium.Cartesian2);const n=t.radius;if(Cesium.Cartesian2.magnitudeSquared(r)>n*n||r.y>3*(t.maxDimension+t.pixelPadding)){_(e,t)}else{o(e,t,i)}}function _(t,e){if(!e.cluster)return;e.items.forEach(e=>{t.entities.remove(e.entity)});t.scene.primitives.remove(e.lines);e.cluster.show=true;e.lines=undefined;e.items.length=0;e.cluster=undefined}let n;function o(e,t,i){const s=e.scene.pick(i);if(!s)return;const r=t.items.find(e=>e.entity===s.id);if(!r)return;if(s!==n){if(Cesium.defined(n)&&Cesium.defined(n.label)){n.label.show=false;n=undefined}if(Cesium.defined(s)&&Cesium.defined(s.id.label)){n=s.id;n.label.show=true}}}function y(e,t,i,s){const r=t[i];if(!r)return;const n=r.getValue(s);if(!n)return;e[i]=n}})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t{constructor(){this._maxCache=200;this._lowWater=150;this._cache=new Map}async requestIcon(e){e=Object.assign({numColor:"white",numBkColor:"red",numFontSize:15},e);const t=this.genkey(e);let i=this.get(t);if(i){return i}const s=await this.requestImage(e.url);i=document.createElement("canvas");const r=i.getContext("2d");const n=e.num.toFixed(0);const o=8;const a=e.numFontSize;r.font=`${a}px 黑体`;const l=r.measureText(n);const h=Math.max(a,l.width);const c=a;const u=h>>1;const d=c>>1;i.width=s.width+u+1;i.height=s.height+d+1;const m=s.width-u;const p=0;const f=s.width;const _=d;r.drawImage(s,0,d);const y=C(m,p,u<<1,d<<1,o);r.fillStyle=e.numBkColro;r.fill(y);r.fillStyle=e.numColor;r.textAlign="center";r.textBaseline="middle";r.fillText(n,f,_);this.put(t,i);return i}genkey(e){return`num:${e.num}-f:${e.numFontSize}-c:${e.numColor}-${e.numBkColro}@${e.url}`}get(e){let t=this._cache.get(e);if(t){t.timestamp=(new Date).getTime();return t.canvas}}put(e,t){if(this._cache.size>=this._maxCache){const i=[];this._cache.forEach(e=>i.push(e));i.sort((e,t)=>e.timestamp-t.timestamp);const s=this._cache.size-this._lowWater;for(let e=0;e<s;++e){this._cache.delete(i[e].key)}}this._cache.set(e,{key:e,timestamp:(new Date).getTime(),canvas:t})}requestImage(s){return new Promise((e,t)=>{const i=new Image;i.onload=()=>e(i);i.crossOrigin="anonymous";i.src=s})}}e.ClusterIconCreater=t;e.clusterIconCreater=new t;function C(e,t,i,s,r){const n=new Path2D;const o=Math.PI/2;const a=Math.min(i,s);const l=Math.min(r,a/2);n.moveTo(e+l,t+0);n.lineTo(e+i-l,t+0);n.arc(e+i-l,t+l,l,o*3,o*4,false);n.lineTo(e+i,t+s-l);n.arc(e+i-l,t+s-l,l,0,o,false);n.lineTo(e+l,t+s);n.arc(e+l,t+s-l,l,o,o*2,false);n.lineTo(e+0,t+l);n.arc(e+l,t+l,l,o*2,o*3,false);return n}})(CZMAP||(CZMAP={}));var CZMAP;(function(t){let n;(function(e){e["ARRAY_BUFFER"]="arraybuffer";e["JSON"]="json";e["TEXT"]="text";e["XML"]="xml"})(n=t.DynamicDataType||(t.DynamicDataType={}));class o{constructor(e,t,i){this.handles=new Set;this.url=e;this.type=t;this.interval=i}start(){const e=()=>{this.loop(t)};const t=()=>{this.timer=setTimeout(e,this.interval)};t()}stop(){this.handles.clear();if(this.timer){clearTimeout(this.timer);this.timer=undefined}}add(e){this.handles.add(e)}remove(e){this.handles.delete(e)}isEmpty(){return this.handles.size===0}loop(e){t.HttpUtil.get(new t.HttpArgs(this.url)).then(e=>{switch(this.type){case n.ARRAY_BUFFER:return e.arrayBuffer();case n.JSON:return e.json();case n.TEXT:return e.text()}},()=>{console.warn("load dyndata error")}).then(t=>{if(t)this.handles.forEach(e=>e(t))},e=>{console.warn("update dynamic data error",e)}).then(e,e)}}class e{constructor(){this._urls=new Map}reg(e,t,i=n.JSON,s=1e4){this.get(e,i,s,true).add(t)}unReg(e,t,i=n.JSON,s=1e5){const r=this.get(e,i,s,false);if(r){r.remove(t);if(r.isEmpty()){r.stop();this._urls.delete(r.key)}}}unRegAll(){this._urls.forEach(e=>e.stop());this._urls.clear()}get(e,t,i,s=false){const r=`${e} + ${i} + ${t}`;let n;if(this._urls.has(r))n=this._urls.get(r);else if(s){n=new o(e,t,i);n.key=r;n.start();this._urls.set(r,n)}return n}}t.DynamicData=e})(CZMAP||(CZMAP={}));var CZMAP;(function(n){class i{static add(e,t,i){if(!i)i=[0,0,0];i[0]=e[0]+t[0];i[1]=e[1]+t[1];i[2]=e[2]+t[2];return i}static sub(e,t,i){if(!i)i=[0,0,0];i[0]=e[0]-t[0];i[1]=e[1]-t[1];i[2]=e[2]-t[2];return i}static mul(e,t,i){if(!i)i=[0,0,0];i[0]=e[0]*t[0];i[1]=e[1]*t[1];i[2]=e[2]*t[2];return i}static mulScalar(e,t,i){if(!i)i=[0,0,0];i[0]=e[0]*t;i[1]=e[1]*t;i[2]=e[2]*t;return i}static div(e,t,i){if(!i)i=[0,0,0];i[0]=e[0]/t[0];i[1]=e[1]/t[1];i[2]=e[2]/t[2];return i}static squareDistance(e,t){const i=e[0]-t[0];const s=e[1]-t[1];const r=n.Parse.parseNumber(e[2]-t[2]);return i*i+s*s+r*r}static distance(e,t){return Math.sqrt(i.squareDistance(e,t))}static squareLength(e){const t=e[0];const i=e[1];const s=n.Parse.parseNumber(e[2]);return t*t+i*i+s*s}static calcLength(e){return Math.sqrt(i.squareLength(e))}}n.GeoMath=i})(CZMAP||(CZMAP={}));var CZMAP;(function(s){class e{constructor(e,t=undefined){this.url=e;this.data=t}}s.HttpArgs=e;class t{static _getCookiesObj(){return document.cookie.split(";").reduce((e,t)=>{let i=t.trim().split("=").map(e=>{return e.trim()});e[i[0]]=i[1];return e},{})}static _initOptions(e=undefined){let t=e;if(!s.Types.isDefined(t)){t={}}const i=this._getCookiesObj();if(s.Types.isDefined(i)){t.headers={};if(s.Types.isDefined(i.orgid)){t.headers["orgid"]=i.orgid}if(s.Types.isDefined(i.domain)){t.headers["Domain"]=i.domain}if(s.Types.isDefined(i.accept_domain)){t.headers["AcceptDomain"]=i.accept_domain}if(s.Types.isDefined(i.user_token)){t.headers["UserId"]=i.user_token}if(s.Types.isDefined(i.person_token)){t.headers["person_token"]=i.person_token}}t.mode="cors";return t}static get(e,t=undefined){const i=this._initOptions(t);return fetch(e.url,i)}static post(e,t=undefined){let i=this._initOptions(t);i.method="POST";i.headers["Accept"]="application/json";i.headers["Content-Type"]="application/json";if(e.data)i.body=JSON.stringify(e.data);return fetch(e.url,i)}static put(e,t=undefined){let i=this._initOptions(t);i.method="PUT";i.headers["Accept"]="application/json";i.headers["Content-Type"]="application/json";if(e.data)i.body=JSON.stringify(e.data);return fetch(e.url,i)}}s.HttpUtil=t;async function i(e,t){const i=await fetch(e,t);return await i.json()}s.fetchJSON=i;async function r(e,t){const i=await fetch(e,t);const s=await i.text();const r=new Function("const json5 = \n"+s+";\n return json5;");return r()}s.fetchJSON5=r})(CZMAP||(CZMAP={}));var CZMAP;(function(a){function y(e,t=true){if(t){const i=Cesium.Cartographic.fromCartesian(e);return[Cesium.Math.toDegrees(i.longitude),Cesium.Math.toDegrees(i.latitude),i.height]}else{return[e.x,e.y,e.z]}}function C(e,t=true){return t?Cesium.Cartesian3.fromDegrees(...e):Cesium.Cartesian3.fromElements(...e)}function l(e,t,i){const s=Cesium.Math.toRadians(i||0);const r=Cesium.Math.toRadians(90-t||0);const n=Math.sin(s)*e;const o=Math.cos(s)*e;const a=Math.cos(r)*o;const l=Math.sin(r)*o;return[a,l,n]}function e(e,t,i,s=true){const r=C(e,s);const n=C(t,s);const o=Cesium.Cartesian3.subtract(n,r,new Cesium.Cartesian3);const a=Cesium.Cartesian3.magnitude(o);if(a==0){throw new Error("输入点和输出点位置相同")}if(i<=0){throw new Error("参数：dist值不能小于等于0")}o.x=o.x/a;o.y=o.y/a;o.z=o.z/a;let l=0;const h=[];while(l<a){const c=new Cesium.Cartesian3;Cesium.Cartesian3.multiplyByScalar(o,l,c);Cesium.Cartesian3.add(r,c,c);h.push(y(c,s));l+=i}return h}a.putOnLine=e;function o(e,t,i,s,r=true){const n=Cesium.Cartesian3.fromElements(t,i,s);if(r){const o=Cesium.Cartesian3.fromDegrees(...e);const a=Cesium.Transforms.eastNorthUpToFixedFrame(o,Cesium.Ellipsoid.WGS84,new Cesium.Matrix4);const l=Cesium.Matrix4.multiplyByPoint(a,n,n);return y(l,r)}else{const[h,c,u]=e;return[h+n.x,c+n.y,u+n.z]}}a.calcOffsetPoint=o;function t(e,t,i,s,r=true){const n=l(t,i,s);return o(e,...n,r)}a.calcOffsetPoint2=t;function h(e,t,i,s,r,n=true){const o=Cesium.Cartesian3.subtract;const a=Cesium.Cartesian3.multiplyByScalar;const l=Cesium.Cartesian3.divideByScalar;const h=Cesium.Cartesian3.cross;const c=Cesium.Cartesian3.normalize;const u=C(e,n);const d=C(t,n);const m=o(d,u,new Cesium.Cartesian3);const p=Cesium.Cartesian3.magnitude(m);if(p==0){throw new Error("起点和终点的位置相同")}l(m,p,m);const f=h(m,Cesium.Cartesian3.UNIT_Z,new Cesium.Cartesian3);const _=h(f,m,new Cesium.Cartesian3);c(f,f);c(_,_);a(f,i,f);a(m,s,m);a(_,r,_);d.x+=f.x+m.x+_.x;d.y+=f.y+m.y+_.y;d.z+=f.z+m.z+_.z;return y(d,n)}a.calcLineOffsetPoint=h;function i(e,t,i,s,r,n=true){const o=l(i,s,r);return h(e,t,...o,n)}a.calcLineOffsetPoint2=i;function s(e,t,i,s){const r=Cesium.Cartesian3.fromDegrees(...e.position);const n=a.Transforms.transformCoordinates(e.position.slice(),s||"EPSG:4326",i);const o=Cesium.Transforms.eastNorthUpToFixedFrame(r,Cesium.Ellipsoid.WGS84,new Cesium.Matrix4);return t.map(e=>{e=a.GeoMath.sub(e,n);const t=new Cesium.Cartesian3(...e);Cesium.Matrix4.multiplyByPoint(o,t,t);return y(t)})}a.transformModelCoordinates=s})(CZMAP||(CZMAP={}));var CZMAP;(function(u){let e;(function(e){e["LEFT"]="left";e["RIGHT"]="right";e["SECTION"]="section"})(e=u.CutRetain||(u.CutRetain={}));class t{constructor(e){this._items=[];this._layer=e;if(this._layer.format!==u.ModelDataFormat.ZFCLS){throw new Error("不支持的图层，仅支持zfcls图层")}}addAxisPlane(e,t){const i=this._layer.scale;this.addPlane(e.axis,e.distance/i[e.axis],t)}addPlane(e,t,i){const s={type:"plane",retain:i,axis:e,dist:t,absolute:false};this._items.push(s)}addPath(e,t){const i=new u.ProjectionForGlobe;const s=u.GeoMath.add(this._layer.position,this._layer.offset);i.setCenter(s[0],s[1]);const r=u.BoundingBox.formString(this._layer.zfclsInfo.box);const n=r.getCenter();const o=this._layer.scale;const a=e.map(e=>u.GeoMath.add(u.GeoMath.div(i.toLocal(e),o),n));const l={type:"path",retain:t,path:a};this._items.push(l)}addComplex(e,t,i){const s=this._projPath(e);const r=this._layer.scale;const n=t.distance/r[t.axis];const o={type:"complex",retain:i,path:s,height:n,absolute:false};this._items.push(o)}cut(l){l=l||{};function h(e,...t){try{if(e instanceof Function)e(...t)}catch(e){console.warn("call callback function error!",e)}}const c=this._layer.url2;const e=c+"/cut/create";const t=new Promise((n,o)=>{const a=async e=>{if(!e.success){o(e.msg);return}const t=`${c}/cut/query?ssid=${e.ssid}`;const i=await u.HttpUtil.post(new u.HttpArgs(t));if(!i.ok)o(i.statusText);const s=await i.json();if(s.success===false){o(s.exception);return}if(s.status==="error"){o(s.einfo);return}h(l.onloadeddata,s);if(s.status==="finished"){const r=this._createCutLayer(`${c}/cut/get?cid=${e.cid}&name=cut.glb`);n(r);return}setTimeout(()=>a(e),1e3)};u.HttpUtil.post({url:e,data:{cuts:this._items}}).then(e=>e.ok?e.json():Promise.reject(e.statusText)).then(e=>a(e)).catch(e=>o(e))});t.then(e=>h(l.onload,e),e=>h(l.onerror,e));return t}_projPath(e){const t=new u.ProjectionForGlobe;const i=u.GeoMath.add(this._layer.position,this._layer.offset);t.setCenter(i[0],i[1]);const s=u.BoundingBox.formString(this._layer.zfclsInfo.box);const r=s.getCenter();const n=this._layer.scale;return e.map(e=>u.GeoMath.add(u.GeoMath.div(t.toLocal(e),n),r))}_createCutLayer(e){const t=u.MapLoader.loadLayer(this._layer.parent,{name:"切割结果",visible:true,type:"model",url:e,position:this._layer.position,scale:this._layer.scale,offset:this._layer.offset,style:this._layer.define.style});return t}}u.ModelCutHelper=t})(CZMAP||(CZMAP={}));var CZMAP;(function(_){class y{static calcBox(e){const t=e.scale;const i=e.offset;const s=e.position.slice();const r=_.BoundingBox.formString(e.zfclsInfo.cbox);const n=r.getSize();_.GeoMath.mul(n,t,n);_.GeoMath.mulScalar(n,1.1,n);_.GeoMath.add(s,i,s);return _.BoundingBox.formCenterSize(s,n,r)}static createClipPlane(e,t){const i=y.calcBox(e);return e.view.createClipPlane({type:t,box:i})}static createBoundBox(e){e.showBoxEntity(true)}static removeBoundBox(e){e.showBoxEntity(false)}static createCoordGrid(e){e.showCoordGrid(true)}static removeCoordGrid(e){e.showCoordGrid(false)}static async fetchModelVolume(e){const t=e.url2+"/measure/volume";const i=await fetch(t);return await(i.ok?i.json():{success:false,msg:"error"})}static async fetchModelEdges(e){const t=[];_.ZFclsModel.filterSimpleModel(e.zfclsInfo,t);if(t.length===0)return;const i=e.offset.join(",");const s=e.scale.join(",");const r=e.url2+`/measure/edges?fid=${t[0].id}&offset=${i}&scale=${s}`;const n=await fetch(r);const o=await(n.ok?n.json():{success:false,msg:"error"});return o}static async createModelTerrain(e,t){y.removeModelTerrain(e);const i=await y.fetchModelEdges(e);if(!i)return Promise.reject(i.msg);if(!i.success)return Promise.reject(i.msg);const s=i.edges2.features;if(!s||s.length==0)return Promise.reject("result is empty");const r=s[0].geometry.coordinates[0];const n=t.heightOffset||0;const o=e.map;const a=e.offset;const l=o.rootLayer.createLayer(_.TerrainLayer,{name:t.name||"地形",url:t.terrain,heightOffset:a[2]+n,heightScale:e.scale[2],heightScaleOffset:e.position[2]});let h=undefined;const c=_.BoundingBox.formString(e.zfclsInfo.cbox);const u=[c.minx,c.miny,c.maxx,c.maxy];if(t.images){h=[];t.images.forEach(e=>{e.style.extent=u;h.push(_.MapLoader.loadTileLayer(o.rootLayer,e))})}else{const p=o.rootLayer.createLayer(_.TileLayer3D,{name:"DEM",visible:true,extent:u,url:t.terrain,scheme:"GEOGRAPHIC",mapType:"dem"});const f=p.layer.provider;f._minVal=c.minz;f._maxVal=c.maxz;h=[p]}l.setClip({clip:r,height:0,inner:false,wall:false,floor:false});const d=o.view3d.cesium.globe;let m={terrain:l,images:h,globe:d.show};d.show=true;y.terrains.set(e,m);return m}static removeModelTerrain(e){const t=y.terrains.get(e);if(!t)return;y.terrains.delete(e);if(t.terrain)t.terrain.parent.removeLayer(t.terrain);if(t.images){t.images.forEach(e=>e.parent.removeLayer(e))}const i=e.map.view3d.cesium.globe;if(!t.globe)i.show=false}}y.terrains=new Map;_.ModelLayerHelper=y})(CZMAP||(CZMAP={}));var CZMAP;(function(e){let n;(function(e){e[e["NONE"]=0]="NONE";e[e["PICK_MODEL"]=1]="PICK_MODEL";e[e["PICK_POSITION"]=2]="PICK_POSITION"})(n||(n={}));const o=(e,t=8)=>Cesium.Math.toDegrees(e).toFixed(t);class t{constructor(e){this.viewer=e}}const r=new Cesium.Matrix4;const a=Cesium.Cartesian3.fromElements(1,1,1);function l(e){const t=new Cegore.HeadingPitchRoll;t.setFromRadius(e);return t}class s extends t{constructor(e,t){super(e);this.enitity=t}get position(){return this.enitity.position.getValue(this.viewer.clock.currentTime)}get pos(){return new Cegore.Position(this.position)}set pos(e){this.enitity.position=Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.altitude)}get hpr(){const e=this.position;const t=this.enitity;let i;if(t.orientation){const s=t.orientation.getValue(this.viewer.clock.currentTime);Cesium.Matrix4.fromTranslationQuaternionRotationScale(e,s,a,r);i=Cesium.Transforms.fixedFrameToHeadingPitchRoll(r)}else{i=new Cesium.HeadingPitchRoll}return l(i)}set hpr(e){const t=this.position;const i=Cesium.HeadingPitchRoll.fromDegrees(e.heading,e.pitch,e.roll);this.enitity.orientation=Cesium.Transforms.headingPitchRollQuaternion(t,i,undefined,undefined)}}class i extends t{constructor(e,t){super(e);this._mat=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY);this._pos=new Cesium.Cartesian3;this._hpr=new Cesium.HeadingPitchRoll;this._ori=new Cesium.Quaternion;this.primitive=t;if(t.modelMatrix)Cesium.Matrix4.clone(t.modelMatrix,this._mat);Cesium.Matrix4.getTranslation(this._mat,this._pos);const i=Cesium.Matrix4.getMatrix3(this._mat,new Cesium.Matrix3);const s=Cesium.Quaternion.fromRotationMatrix(i);Cesium.Matrix4.fromRotationTranslation(i,this._pos,r);Cesium.Matrix4.fromTranslationQuaternionRotationScale(this._pos,s,a,r);Cesium.Transforms.fixedFrameToHeadingPitchRoll(r,undefined,undefined,this._hpr)}get pos(){return new Cegore.Position(this._pos)}set pos(e){this._pos=Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z,undefined,this._pos);this.update()}get hpr(){return l(this._hpr)}set hpr(e){this._hpr=Cesium.HeadingPitchRoll.fromDegrees(e.heading,e.pitch,e.roll,this._hpr);this.update()}update(){Cesium.Transforms.headingPitchRollQuaternion(this._pos,this._hpr,undefined,undefined,this._ori);this.primitive.modelMatrix=Cesium.Matrix4.fromTranslationQuaternionRotationScale(this._pos,this._ori,a,this._mat)}}class h extends t{constructor(e,t){super(e);this.enitity=t}get pos(){return new Cegore.Position(this.enitity.position)}set pos(e){this.enitity.position=[e.x,e.y,e.z]}get hpr(){return new Cegore.HeadingPitchRoll(this.enitity.pose)}set hpr(e){this.enitity.pose=[e.heading,e.pitch,e.roll]}}class c{constructor(e){this._entities=[];this._entitiesReset=[];this._mode=n.NONE;this._keys={};this._czmap=e;this._viewer=e.view3d.czviewer;const t=this._viewer.scene;this._handler=new Cesium.ScreenSpaceEventHandler(t.canvas);this._handler.setInputAction(e=>this._clickHandle(e),Cesium.ScreenSpaceEventType.LEFT_CLICK);this._initUI()}pickModel(){this._mode=n.PICK_MODEL}pickPosition(){this._mode=n.PICK_POSITION}pickLine(){this._mode=n.NONE;this._czmap.view3d.drawTool.drawPolyline(e=>{const t=JSON.stringify(e.coordinates)})}pickPose(){const e=this._viewer.camera.positionWC;const t=Cesium.Cartographic.fromCartesian(e);const{heading:i,pitch:s,roll:r}=this._viewer.camera;this._posInput.value=`pos:${o(t.longitude)},${o(t.latitude)},${t.height.toFixed(2)}`;this._poseInput.value=`ori: ${o(i,2)}, ${o(s,2)}, ${o(r,2)}`}pickViewInfo(){const e=this._czmap.view3d.getViewInfo();const[t,i,s]=e.position;this._posInput.value=`${t.toFixed(8)},${i.toFixed(8)},${s.toFixed(2)}`;this._poseInput.value=`${e.heading.toFixed(2)},${e.pitch.toFixed(2)},${e.roll.toFixed(2)}`}clear(){this._entitiesReset.forEach(e=>e());this._entitiesReset.length=0;this._entities.length=0;this._entitiesDom.innerHTML="";this._mode=n.NONE}show(){this._content.style.display="block"}hide(){this._content.style.display="none"}_createDom(e){const t=document.createElement(e);this._content.append(t);return t}_createLabel(e){const t=document.createElement("label");t.innerText=e;return t}_createInput(e,t){this._createLabel(e);const i=document.createElement("input");this._content.appendChild(i);this._createDom("br");return i}_createRange(e,i){let s=50;const r=this._createInput(e,"range");r.type="range";r.value=s;r.oninput=e=>{console.info(e);const t=r.valueAsNumber;i(t-s);s=t};r.onmouseup=()=>s=r.valueAsNumber=50;return r}_createButton(e,t){const i=document.createElement("button");i.innerText=e;i.onclick=t;this._content.appendChild(i)}_initUI(){this._content=document.createElement("div");this._content.className="zmap-model-mover";this._content.style.display="none";this._createButton("拾取模型",()=>this.pickModel());this._createButton("拾取坐标",()=>this.pickPosition());this._createButton("获取姿态",()=>this.pickPose());this._createButton("视图信息",()=>this.pickViewInfo());this._createButton("绘制线",()=>this.pickLine());this._createButton("清除",()=>this.clear());this._createDom("br");this._createDom("br");this._createRange("X",e=>this._onPosition("x",e));this._createRange("Y",e=>this._onPosition("y",e));this._createRange("Z",e=>this._onPosition("z",e));this._posInput=this._createInput("pos","input");this._createDom("br");this._createRange("X",e=>this._onPose("x",e));this._createRange("Y",e=>this._onPose("y",e));this._createRange("Z",e=>this._onPose("z",e));this._poseInput=this._createInput("ori","input");this._createDom("br");this._entitiesDom=this._createDom("div");document.body.appendChild(this._content);document.addEventListener("keydown",e=>{this._keys[e.key]=true});document.addEventListener("keyup",e=>{this._keys[e.key]=false})}_onPosition(n,o){if(this._entities.length==0)return;let a;const e=this._viewer.scene;const t=e.pickPosition(new Cesium.Cartesian2(e.canvas.width>>1,e.canvas.height>>1));if(t){a=Cesium.Cartesian3.distance(t,this._viewer.camera.positionWC)}this._entities.forEach(e=>{const t=e.pos;const i=Cesium.Cartesian3.fromDegrees(t.x,t.y,t.z);if(a===undefined)a=Cesium.Cartesian3.distance(i,this._viewer.camera.positionWC);const s=o/100*a;switch(n){case"x":t.x+=Cesium.Math.toRadians(s/111e3);break;case"y":t.y+=Cesium.Math.toRadians(s/111e3);break;case"z":t.z+=s}const r=e=>Cesium.Math.toDegrees(e).toFixed(8);e.pos=t;this._posInput.value=`${t.x.toFixed(8)}, ${t.y.toFixed(8)}, ${t.z.toFixed(2)}`})}_onPose(s,r){if(this._keys.Alt){r/=10}this._entities.forEach(e=>{const t=e.hpr;switch(s){case"x":t.heading+=Cesium.Math.toRadians(r);break;case"y":t.pitch+=Cesium.Math.toRadians(r);break;case"z":t.roll+=Cesium.Math.toRadians(r);break}const i=e=>Cesium.Math.toDegrees(e).toFixed(2);e.hpr=t;this._poseInput.value=`${i(t.heading)}, ${i(t.pitch)}, ${t.roll}`})}_addEntity(t){const e=this._entities.find(e=>e instanceof s&&e.enitity===t);if(e)return;if(t.model){const i=t.model;i.silhouetteColor=Cesium.Color.YELLOW;i.silhouetteSize=2;this._entitiesReset.push(()=>i.silhouetteSize=0)}this._entities.push(new s(this._viewer,t));this._entitiesDom.appendChild(this._createLabel("entity"));this._entitiesDom.appendChild(this._createDom("br"))}_add3dtiles(t){const e=this._entities.find(e=>e instanceof i&&e.primitive===t);if(e)return;t.debugWireframe=true;this._entitiesReset.push(()=>t.debugWireframe=false);this._entities.push(new i(this._viewer,t));this._entitiesDom.appendChild(this._createLabel("3dtiles"));this._entitiesDom.appendChild(this._createDom("br"))}_clickHandle(t){const i=this._viewer.scene;if(this._mode==n.PICK_MODEL){var e=i.pick(t.position);if(Cesium.defined(e)){if(e.id instanceof Cesium.Entity)this._addEntity(e.id);if(e.primitive instanceof Cesium.Cesium3DTileset)this._add3dtiles(e.primitive)}}if(this._mode==n.PICK_POSITION){const e=e=>Cesium.Math.toDegrees(e).toFixed(8);const s=i.pickPosition(t.position);if(s){const r=Cesium.Cartographic.fromCartesian(s);this._posInput.value=`${e(r.longitude)},${e(r.latitude)},${r.height}`}}}}e.ModelMover=c})(CZMAP||(CZMAP={}));var CZMAP;(function(o){class r extends o.Disposable{constructor(e,t,i){super();this.items=[];this.group=e;this.key=t;this.values=i.slice();this.cluster=e.cluster}add(e){this.items.push(e);this.requestUpdate()}remove(e){o.ArrayUtils.removeItem(this.items,e);this.requestUpdate()}requestUpdate(){if(this._updateHandle)return;this._updateHandle=requestAnimationFrame(()=>{this._updateHandle=0;this.update()})}update(){const t=new Cesium.Rectangle(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);this.items.forEach(e=>Cesium.Rectangle.expand(t,Cesium.Cartographic.fromCartesian(e.position),t));const e=Cesium.Rectangle.center(t);this.range=[Cesium.Math.toDegrees(t.west),Cesium.Math.toDegrees(t.south),Cesium.Math.toDegrees(t.east),Cesium.Math.toDegrees(t.north)];const i=Cesium.Cartographic.toCartesian(e);const s={fields:this.group.fields.map(e=>e.name),value:this.values.last(),values:this.values,count:this.items.length};this.entity=this.cluster.createCluster(this.group,i,s,this.entity)}show(e){if(this.entity)this.entity.show=e}_disposeInternal(){this.cluster.removeCluster(this.entity);this.entity=undefined;this.cluster=undefined}}class i extends o.Disposable{constructor(e,t){super();this.items={};this.cluster=e;this.label=t.label;this.fields=t.fields.map(e=>{return{name:e.name,regex:e.regex?new RegExp(e.regex):undefined}});this.minDistance=t.minDistance;this.maxDistance=t.maxDistance}getValues(t){return this.fields.map(e=>this.getValue(t,e))}getValue(e,t){if(!o.defined(e))return;let i=e[t.name];if(t.regex&&t.regex.test(i)){i=RegExp.$1}return i}add(e,t,i){let s=this.items[e];if(!s){this.items[e]=s=new r(this,e,t)}s.add(i)}remove(e,t){let i=this.items[e];if(!i)return;i.remove(t)}show(t){for(let e in this.items){const i=this.items[e];i.show(t)}}clear(){for(let e in this.items){const t=this.items[e];t.dispose()}this.items={}}update(){for(let e in this.items){const t=this.items[e];t.requestUpdate()}}_disposeInternal(){this.clear()}}class e extends o.Disposable{constructor(e,t){super();this._items=[];this._lastCameraPos=new Cesium.Cartesian3;this._visible=true;this._viewer=e;this._scene=e.scene;this._style=t.style;this._range=t.range?Cesium.Rectangle.fromDegrees(...t.range):undefined;this._groups=t.classes.map(e=>new i(this,e));this._scene.postRender.addEventListener(this.onPostRender,this)}get show(){return this._visible}set show(e){this._visible=!!e;if(this._visible){this.updateVisible(true)}else{this._groups.forEach(e=>e.show(false))}}add(e){this.doWithItem(e,true)}remove(e){this.doWithItem(e,false)}update(){this._groups.forEach(e=>e.update())}doWithItem(i,s){if(s)this._items.push(i);else o.ArrayUtils.removeItem(this._items,i);const r=[];if(this._range){const e=Cesium.Cartographic.fromCartesian(i.position);if(!Cesium.Rectangle.contains(this._range,e))return}let n="key";this._groups.forEach(e=>{const t=e.getValues(i.properties);r.push(t.join("-"));n+="-"+t;if(s)e.add(n,r,i);else e.remove(n,i)})}createCluster(e,t,i,s){const r=JSON.parse(JSON.stringify(this.getStyle(i)));if(!o.defined(r.icon.horizontalOrigin))r.icon.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT;if(!o.defined(r.label.horizontalOrigin))r.label.horizontalOrigin=Cesium.HorizontalOrigin.LEFT;if(!o.defined(e.label))r.label.text=`${i.fields.join("-")}:${i.value}(${i.count})`;else r.label.text=o.StringUtils.parseVar(e.label,i);if(!s){s=this._viewer.entities.add({position:t,label:r.label,billboard:r.icon})}s.position=t;for(let e in r.label){s.label[e]=r.label[e]}for(let e in r.icon){s.billboard[e]=r.icon[e]}return s}removeCluster(e){this._viewer.entities.remove(e)}_disposeInternal(){this._scene.postRender.removeEventListener(this.onPostRender,this);this._groups.forEach(e=>e.dispose())}destroy(){this.dispose()}getStyle(e){if(typeof this._style==="function"){return this._style(e)}return this._style}updateVisible(e){if(!this._visible){return}const t=this._scene.camera.position;if(!e&&Cesium.Cartesian3.equals(t,this._lastCameraPos))return;Cesium.Cartesian3.clone(t,this._lastCameraPos);const i=Cesium.Cartographic.fromCartesian(t);let s=false;this._groups.forEach(e=>{const t=i.height>=e.minDistance&&i.height<e.maxDistance;e.show(t);if(t){s=true}});this._items.forEach(e=>e.show(!s))}onPostRender(e,t){this.updateVisible()}}o.MultiLevelCluster=e})(CZMAP||(CZMAP={}));var CZMAP;(function(a){class e{constructor(e){this._events=[];this._pointers=new Map;this.enableScale=true;this.enableRotate=false;this.option=e||{}}bind(e){this._dom=e;this.on(e,"pointerdown",e=>this._pointer_down(e));this.on(e,"pointerup",e=>this._pointer_up(e));this.on(e,"pointermove",e=>this._pointer_move(e));this.on(e,"pointercancel",e=>this._pointer_cancel(e));this.on(e,"dragstart",e=>false);this._oldTouchAction=e.style.touchAction;e.style.touchAction="none"}release(){this._events.forEach(e=>e());this._events.length=0;if(this._dom&&this._oldTouchAction){this._dom.style.touchAction=this._oldTouchAction}this._pointers.clear()}on(t,e,i,s){function r(e){if(e.target!==t)return;i(e)}t.addEventListener(e,r,s);this._events.push(()=>{t.removeEventListener(e,r,s)})}_clear(){this._pointers.clear();this._firstPoint=undefined}_pointer_down(e){console.info("pointer_down",e);if(e.isPrimary){this._clear();this._firstPoint=e}this._pointers.set(e.pointerId,e);this._notifyBeginEnd(this._pointers.size,-1)}_pointer_up(e){console.info("pointer_up",e);const t=this._pointers.get(e.pointerId);if(!t)return;this._pointers.delete(e.pointerId);this._notifyBeginEnd(this._pointers.size,1);if(this._pointers.size===0&&e.isPrimary&&this._firstPoint&&i(this._firstPoint,e)){a.tryCatchCall(this.option.onClick,[e])}}_notifyBeginEnd(e,t){const i=e+t;switch(i){case 1:a.tryCatchCall(this.option.onEndDragging,[]);break;case 2:a.tryCatchCall(this.option.onEndScaleRotate,[]);break;case 3:a.tryCatchCall(this.option.onEndTilting,[]);break}switch(e){case 1:a.tryCatchCall(this.option.onBeginDragging,[]);break;case 2:a.tryCatchCall(this.option.onBeginScaleRotate,[]);break;case 3:a.tryCatchCall(this.option.onBeginTilting,[]);break}}_pointer_move(e){if(this._pointers.size===0){a.tryCatchCall(this.option.onMouseMove,[e]);return}const t=this._pointers.get(e.pointerId);if(!t)return;if(this._pointers.size===1){a.tryCatchCall(this.option.onDragging,[e.movementX,e.movementY,t,e])}else if(this._pointers.size===2){const i=this._getOtherPointer(e.pointerId);const s=l(i,t);const r=l(i,e);const n=h(i,t);const o=h(i,e);a.tryCatchCall(this.option.onScale,[s,r,t,e]);a.tryCatchCall(this.option.onRotate,[n,o,t,e]);console.debug("MultiPointInput:scale",r-s,s,r);console.debug("MultiPointInput:rotate",o-n,n,o)}else if(this._pointers.size===3){a.tryCatchCall(this.option.onTilting,[e.movementX,e.movementY,t,e])}this._pointers.set(e.pointerId,e)}_pointer_cancel(e){this._clear()}_getOtherPointer(t){for(let e of this._pointers){if(e[0]!==t)return e[1]}}}a.MultiPointInput=e;function s(e,t,i=1e-5){let s=e-t;if(s<0)s=-s;return s<=i}function i(e,t,i=1e-5){return s(e.offsetX,t.offsetX,i)&&s(e.offsetY,t.offsetY,i)}function r(e,t){const i=e.offsetX-t.offsetX;const s=e.offsetY-t.offsetY;return{x:i,y:s}}a.calcDiff=r;function l(e,t){const i=r(e,t);return Math.sqrt(i.x*i.x+i.y*i.y)}function h(e,t){const i=r(e,t);return Math.atan2(i.y,i.x)}a.calcRadius=h})(CZMAP||(CZMAP={}));var CZMAP;(function(e){class t extends e.Parse{}t.parseArray2=t.createParseArray(",",2);t.parseArray3=t.createParseArray(",",3);t.parseArray4=t.createParseArray(",",4);e.Numbers=t})(CZMAP||(CZMAP={}));var CZMAP;(function(e){function o(e,t){let i=0;for(;i<e.length;++i){if(Cesium.JulianDate.greaterThan(e[i].time,t))break}return i}function s(e,t){if(e instanceof Cesium.Material)return e;if(e.getType&&e.getValue){const i=e.getType(t);const s=e.getValue(t);return Cesium.Material.fromType(i,s)}return undefined}class r{constructor(e,t){this.positions=[];this.maxLength=100;this.maxSeconds=5;this.lastTime=new Cesium.JulianDate;this.polyline=e;this.position=t.position;this.maxLength=t.maxLength||100;this.maxSeconds=t.maxSeconds||1}update(e){let t=false;const i=this.position(e);if(i&&!Cesium.Cartesian3.equals(this.lastPos,i)){this.lastPos=i;this.positions.push({position:i,time:e});t=true}const s=Cesium.JulianDate.addSeconds(e,-this.maxSeconds,this.lastTime);const r=o(this.positions,s);const n=Math.max(r,this.positions.length-this.maxLength);if(n>0){this.positions=this.positions.slice(n);t=true}if(t)this._updatePolyline()}_updatePolyline(){this.polyline.positions=this.positions.map(e=>e.position)}}e.PathTail=r;class t{constructor(e){this._tails=[];this._viewer=e;this._viewer.scene.postRender.addEventListener(this._postRender,this);this._polylines=new Cesium.PolylineCollection;this.scene.primitives.add(this._polylines)}get scene(){return this._viewer.scene}createTail(e){const t=this._polylines.add({width:e.width,material:s(e.material,this.scene.lastRenderTime),distanceDisplayCondition:e.distanceDisplayCondition});const i=new r(t,e);this._tails.push(i);return i}removeTail(e){const t=this._tails.indexOf(e);if(t!=-1){this._tails.splice(t,1);this._polylines.remove(e.polyline)}}_postRender(e,t){this._tails.forEach(e=>e.update(t))}}e.PathTailCollection=t})(CZMAP||(CZMAP={}));var CZMAP;(function(o){const i=/{[^}]+}/g;class e{static getVarNames(e){let t=e.match(i);if(t===null){t=[];return t}return t.map(e=>{return e.substr(1,e.length-2)})}static parseVar(r,n){if(!o.Types.isString(r))return r;while(true){let e=r.indexOf("{");let t=r.indexOf("}");if(e==-1||t==-1||e>t)break;let i=r.substring(e+1,t);let s=n[i];if(!o.Types.isDefined(s))s="";r=r.substring(0,e)+s+r.substring(t+1)}return r}static parseVarMatch(e,t){if(!o.Types.isString(e))return null;const i=this.getVarNames(e);if(i.length===0)return null;const s=i.every(e=>{return t.hasOwnProperty(e)});if(!s)return null;return this.parseVar(e,t)}}o.StringTemp=e})(CZMAP||(CZMAP={}));var CZMAP;(function(i){class e{static parseVar(e,t){return i.StringTemp.parseVar(e,t)}static isNotEmpty(e){return i.Types.isString(e)&&e.length>0}}i.StringUtils=e})(CZMAP||(CZMAP={}));var CZMAP;(function(s){const i={[s.HorizontalOrigin.LEFT]:Cesium.HorizontalOrigin.LEFT,[s.HorizontalOrigin.CENTER]:Cesium.HorizontalOrigin.CENTER,[s.HorizontalOrigin.RIGHT]:Cesium.HorizontalOrigin.RIGHT};const r={[s.VerticalOrigin.BASELINE]:Cesium.VerticalOrigin.BASELINE,[s.VerticalOrigin.BOTTOM]:Cesium.VerticalOrigin.BOTTOM,[s.VerticalOrigin.CENTER]:Cesium.VerticalOrigin.CENTER,[s.VerticalOrigin.TOP]:Cesium.VerticalOrigin.TOP};class e{static getBoolean(e,t=true){if(!s.Types.isDefined(e))return t;if(s.Types.isBool(e))return e;if(s.Types.isString(e)){return e.toUpperCase()==="TRUE"}return t}static getNumber(e,t=0){if(!s.Types.isDefined(e))return t;if(s.Types.isString(e))e=Number.parseFloat(e);if(s.Types.isNumber(e))return e;return t}static getRadian(e,t=0){return this.getNumber(e,t)/180*Math.PI}static getColor(e,t){if(!s.Types.isDefined(e))return t;if(e instanceof Cesium.Color)return e;return Cesium.Color.fromCssColorString(e)}static getCartesian2(e,t=Cesium.Cartesian2.ZERO){if(!s.Types.isDefined(e))return t;if(s.Types.isArray(e))return new Cesium.Cartesian2(e[0],e[1]);if(s.Types.isObject(e))return new Cesium.Cartesian2(e.x,e.y);return t}static getCartesian3(e,t=Cesium.Cartesian3.ZERO){if(!s.Types.isDefined(e))return t;if(s.Types.isArray(e))return new Cesium.Cartesian3(e[0],e[1],e[2]);if(s.Types.isObject(e))return new Cesium.Cartesian3(e.x,e.y,e.z);return t}static getCartesian3Degree(e,t=Cesium.Cartesian3.ZERO){if(!s.Types.isDefined(e))return t;if(s.Types.isArray(e))return Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]);if(s.Types.isObject(e))return Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z);return t}static getHorizontal(e,t=Cesium.HorizontalOrigin.LEFT){if(!s.Types.isDefined(e))return t;return i[e]}static getVertical(e,t=Cesium.VerticalOrigin.BOTTOM){if(!s.Types.isDefined(e))return t;return r[e]}static getDisplayDistance(e){if(!s.Types.isArray(e))return new Cesium.DistanceDisplayCondition;return new Cesium.DistanceDisplayCondition(e[0],e[1])}static getNearFarScalar(e){if(!s.Types.isArray(e))return undefined;return new Cesium.NearFarScalar(e[0],e[1],e[2],e[3])}static readValue(e,t,i){if(!s.defined(e))return undefined;return e.getValue(t,i)}}s.CesiumAttrib=e})(CZMAP||(CZMAP={}));if(Array.prototype["last"]===undefined){Array.prototype["last"]=function(){const e=this.length;if(e==0)return;return this[e-1]}}var CZMAP;(function(t){const i="DynamicCircleMaterialType";let e;(function(e){e[e["OnRadial"]=0]="OnRadial";e[e["OnAxisX"]=1]="OnAxisX";e[e["OnAxisY"]=2]="OnAxisY"})(e=t.DynamicCircleMode||(t.DynamicCircleMode={}));class s{constructor(e){this._definitionChanged=new Cesium.Event;this["color"]=t.CesiumAttrib.getColor(e===null||e===void 0?void 0:e.color);this["speed"]=e===null||e===void 0?void 0:e.speed;this["repeat"]=e===null||e===void 0?void 0:e.repeat;this["mode"]=e===null||e===void 0?void 0:e.mode}get isConstant(){return false}get definitionChanged(){return this._definitionChanged}getType(e){return i}getValue(e,t){if(!Cesium.defined(t)){t={}}t.color=Cesium.Property.getValueOrDefault(this._color,e,Cesium.Color.RED,t.color);t.speed=Cesium.Property.getValueOrDefault(this._speed,e,10,t.speed);t.repeat=Cesium.Property.getValueOrDefault(this._repeat,e,1,t.repeat);t.mode=Cesium.Property.getValueOrDefault(this._mode,e,0,t.mode);return t}equals(e){return this===e||e instanceof s&&Cesium.Property.equals(this._color,e._color)&&Cesium.Property.equals(this._speed,e._speed)&&Cesium.Property.equals(this._repeat,e._repeat)&&Cesium.Property.equals(this._mode,e._mode)}}t.DynamicCircleMaterialProperty=s;Object.defineProperties(s.prototype,{color:Cesium.createPropertyDescriptor("color"),speed:Cesium.createPropertyDescriptor("speed"),repeat:Cesium.createPropertyDescriptor("repeat"),mode:Cesium.createPropertyDescriptor("mode")});const r=`
        //js
        uniform vec4 color;
        uniform float speed;
        uniform float repeat;
        uniform float mode;

        float circlePing(float r, float v1, float v2, float v3, float v4)
        {
            r = 1.0 - fract(r);
            return smoothstep(v1, v2, r) - smoothstep(v3, v4, r);
        }

        czm_material czm_getMaterial(czm_materialInput materialInput)
        {
            czm_material material = czm_getDefaultMaterial(materialInput);
            float time = fract(czm_frameNumber * speed / 1000.0);
            float r = 0.0;
            if (mode == 0.0)
            {
                vec2 st = (materialInput.st * 2.0  - 1.0);
                vec2 center = vec2(0.);
                r = length(st - center);
            }
            else if (mode == 1.0)
            {
                r = materialInput.st.x;
            }
            else 
            {
                r = materialInput.st.y;
            }
            
            float flag = circlePing(r * repeat - time, 0.01, 0.05, 0.05, 0.5);
            material.alpha = flag * smoothstep(1.0, 0.9, r);
            material.diffuse = flag * color.rgb;
            return material;
        }
        //!js
    `;Cesium.Material._materialCache.addMaterial(i,{fabric:{type:i,uniforms:{color:new Cesium.Color(1,0,0,1),speed:10,repeat:1,mode:0},source:r},translucent:function(e){return true}})})(CZMAP||(CZMAP={}));var CZMAP;(function(e){const t="LineFlowMaterialType";class i{constructor(e){this._definitionChanged=new Cesium.Event;this._color=undefined;this._speed=undefined;this._percent=undefined;this._gradient=undefined;this["color"]=e.color;this["speed"]=e.speed;this["percent"]=e.percent;this["gradient"]=e.gradient}get isConstant(){return false}get definitionChanged(){return this._definitionChanged}getType(e){return t}getValue(e,t){if(!Cesium.defined(t)){t={}}t.color=Cesium.Property.getValueOrDefault(this._color,e,Cesium.Color.RED,t.color);t.speed=Cesium.Property.getValueOrDefault(this._speed,e,5,t.speed);t.percent=Cesium.Property.getValueOrDefault(this._percent,e,.1,t.percent);t.gradient=Cesium.Property.getValueOrDefault(this._gradient,e,.01,t.gradient);return t}equals(e){return this===e||e instanceof i&&Cesium.Property.equals(this._color,e._color)&&Cesium.Property.equals(this._speed,e._speed)&&Cesium.Property.equals(this._percent,e._percent)&&Cesium.Property.equals(this._gradient,e._gradient)}}e.LineFlowMaterialProperty=i;Object.defineProperties(i.prototype,{color:Cesium.createPropertyDescriptor("color"),speed:Cesium.createPropertyDescriptor("speed"),percent:Cesium.createPropertyDescriptor("percent"),gradient:Cesium.createPropertyDescriptor("gradient")});const s=`
            //js
            uniform vec4 color;
            uniform float speed;
            uniform float percent;
            uniform float gradient;
            
            czm_material czm_getMaterial(czm_materialInput materialInput)
            {
                czm_material material = czm_getDefaultMaterial(materialInput);
                vec2 st = materialInput.st;
                float t = fract(czm_frameNumber * speed / 1000.0);
                t *= (1.0 + percent);
                float alpha = smoothstep(t- percent, t, st.s) * step(-t, -st.s);
                alpha += gradient;
                material.diffuse = color.rgb;
                material.alpha = alpha;
                return material;
            }
        //!js
        `;Cesium.Material._materialCache.addMaterial(t,{fabric:{type:t,uniforms:{color:new Cesium.Color(1,0,0,1),speed:10,percent:.1,gradient:.01},source:s},translucent:function(){return true}})})(CZMAP||(CZMAP={}));